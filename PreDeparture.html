<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>SugarCube</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<!--

SugarCube (build: 2850): A free (gratis and libre) header for Twine/Twee, based on TiddlyWiki.
Copyright (c) 2013-2014 Thomas Michael Edwards.

-->
<script type="text/javascript">
document.documentElement.className = "loading";
</script>
<script type="text/javascript">
/*! jQuery v2.0.3 | (c) 2005, 2013 jQuery Foundation, Inc. | jquery.org/license
//# sourceMappingURL=jquery-2.0.3.min.map
*/
(function(e,undefined){var t,n,r=typeof undefined,i=e.location,o=e.document,s=o.documentElement,a=e.jQuery,u=e.$,l={},c=[],p="2.0.3",f=c.concat,h=c.push,d=c.slice,g=c.indexOf,m=l.toString,y=l.hasOwnProperty,v=p.trim,x=function(e,n){return new x.fn.init(e,n,t)},b=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,w=/\S+/g,T=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,C=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,k=/^-ms-/,N=/-([\da-z])/gi,E=function(e,t){return t.toUpperCase()},S=function(){o.removeEventListener("DOMContentLoaded",S,!1),e.removeEventListener("load",S,!1),x.ready()};x.fn=x.prototype={jquery:p,constructor:x,init:function(e,t,n){var r,i;if(!e)return this;if("string"==typeof e){if(r="<"===e.charAt(0)&&">"===e.charAt(e.length-1)&&e.length>=3?[null,e,null]:T.exec(e),!r||!r[1]&&t)return!t||t.jquery?(t||n).find(e):this.constructor(t).find(e);if(r[1]){if(t=t instanceof x?t[0]:t,x.merge(this,x.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:o,!0)),C.test(r[1])&&x.isPlainObject(t))for(r in t)x.isFunction(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}return i=o.getElementById(r[2]),i&&i.parentNode&&(this.length=1,this[0]=i),this.context=o,this.selector=e,this}return e.nodeType?(this.context=this[0]=e,this.length=1,this):x.isFunction(e)?n.ready(e):(e.selector!==undefined&&(this.selector=e.selector,this.context=e.context),x.makeArray(e,this))},selector:"",length:0,toArray:function(){return d.call(this)},get:function(e){return null==e?this.toArray():0>e?this[this.length+e]:this[e]},pushStack:function(e){var t=x.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return x.each(this,e,t)},ready:function(e){return x.ready.promise().done(e),this},slice:function(){return this.pushStack(d.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(0>e?t:0);return this.pushStack(n>=0&&t>n?[this[n]]:[])},map:function(e){return this.pushStack(x.map(this,function(t,n){return e.call(t,n,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:h,sort:[].sort,splice:[].splice},x.fn.init.prototype=x.fn,x.extend=x.fn.extend=function(){var e,t,n,r,i,o,s=arguments[0]||{},a=1,u=arguments.length,l=!1;for("boolean"==typeof s&&(l=s,s=arguments[1]||{},a=2),"object"==typeof s||x.isFunction(s)||(s={}),u===a&&(s=this,--a);u>a;a++)if(null!=(e=arguments[a]))for(t in e)n=s[t],r=e[t],s!==r&&(l&&r&&(x.isPlainObject(r)||(i=x.isArray(r)))?(i?(i=!1,o=n&&x.isArray(n)?n:[]):o=n&&x.isPlainObject(n)?n:{},s[t]=x.extend(l,o,r)):r!==undefined&&(s[t]=r));return s},x.extend({expando:"jQuery"+(p+Math.random()).replace(/\D/g,""),noConflict:function(t){return e.$===x&&(e.$=u),t&&e.jQuery===x&&(e.jQuery=a),x},isReady:!1,readyWait:1,holdReady:function(e){e?x.readyWait++:x.ready(!0)},ready:function(e){(e===!0?--x.readyWait:x.isReady)||(x.isReady=!0,e!==!0&&--x.readyWait>0||(n.resolveWith(o,[x]),x.fn.trigger&&x(o).trigger("ready").off("ready")))},isFunction:function(e){return"function"===x.type(e)},isArray:Array.isArray,isWindow:function(e){return null!=e&&e===e.window},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?l[m.call(e)]||"object":typeof e},isPlainObject:function(e){if("object"!==x.type(e)||e.nodeType||x.isWindow(e))return!1;try{if(e.constructor&&!y.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}return!0},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},error:function(e){throw Error(e)},parseHTML:function(e,t,n){if(!e||"string"!=typeof e)return null;"boolean"==typeof t&&(n=t,t=!1),t=t||o;var r=C.exec(e),i=!n&&[];return r?[t.createElement(r[1])]:(r=x.buildFragment([e],t,i),i&&x(i).remove(),x.merge([],r.childNodes))},parseJSON:JSON.parse,parseXML:function(e){var t,n;if(!e||"string"!=typeof e)return null;try{n=new DOMParser,t=n.parseFromString(e,"text/xml")}catch(r){t=undefined}return(!t||t.getElementsByTagName("parsererror").length)&&x.error("Invalid XML: "+e),t},noop:function(){},globalEval:function(e){var t,n=eval;e=x.trim(e),e&&(1===e.indexOf("use strict")?(t=o.createElement("script"),t.text=e,o.head.appendChild(t).parentNode.removeChild(t)):n(e))},camelCase:function(e){return e.replace(k,"ms-").replace(N,E)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,n){var r,i=0,o=e.length,s=j(e);if(n){if(s){for(;o>i;i++)if(r=t.apply(e[i],n),r===!1)break}else for(i in e)if(r=t.apply(e[i],n),r===!1)break}else if(s){for(;o>i;i++)if(r=t.call(e[i],i,e[i]),r===!1)break}else for(i in e)if(r=t.call(e[i],i,e[i]),r===!1)break;return e},trim:function(e){return null==e?"":v.call(e)},makeArray:function(e,t){var n=t||[];return null!=e&&(j(Object(e))?x.merge(n,"string"==typeof e?[e]:e):h.call(n,e)),n},inArray:function(e,t,n){return null==t?-1:g.call(t,e,n)},merge:function(e,t){var n=t.length,r=e.length,i=0;if("number"==typeof n)for(;n>i;i++)e[r++]=t[i];else while(t[i]!==undefined)e[r++]=t[i++];return e.length=r,e},grep:function(e,t,n){var r,i=[],o=0,s=e.length;for(n=!!n;s>o;o++)r=!!t(e[o],o),n!==r&&i.push(e[o]);return i},map:function(e,t,n){var r,i=0,o=e.length,s=j(e),a=[];if(s)for(;o>i;i++)r=t(e[i],i,n),null!=r&&(a[a.length]=r);else for(i in e)r=t(e[i],i,n),null!=r&&(a[a.length]=r);return f.apply([],a)},guid:1,proxy:function(e,t){var n,r,i;return"string"==typeof t&&(n=e[t],t=e,e=n),x.isFunction(e)?(r=d.call(arguments,2),i=function(){return e.apply(t||this,r.concat(d.call(arguments)))},i.guid=e.guid=e.guid||x.guid++,i):undefined},access:function(e,t,n,r,i,o,s){var a=0,u=e.length,l=null==n;if("object"===x.type(n)){i=!0;for(a in n)x.access(e,t,a,n[a],!0,o,s)}else if(r!==undefined&&(i=!0,x.isFunction(r)||(s=!0),l&&(s?(t.call(e,r),t=null):(l=t,t=function(e,t,n){return l.call(x(e),n)})),t))for(;u>a;a++)t(e[a],n,s?r:r.call(e[a],a,t(e[a],n)));return i?e:l?t.call(e):u?t(e[0],n):o},now:Date.now,swap:function(e,t,n,r){var i,o,s={};for(o in t)s[o]=e.style[o],e.style[o]=t[o];i=n.apply(e,r||[]);for(o in t)e.style[o]=s[o];return i}}),x.ready.promise=function(t){return n||(n=x.Deferred(),"complete"===o.readyState?setTimeout(x.ready):(o.addEventListener("DOMContentLoaded",S,!1),e.addEventListener("load",S,!1))),n.promise(t)},x.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){l["[object "+t+"]"]=t.toLowerCase()});function j(e){var t=e.length,n=x.type(e);return x.isWindow(e)?!1:1===e.nodeType&&t?!0:"array"===n||"function"!==n&&(0===t||"number"==typeof t&&t>0&&t-1 in e)}t=x(o),function(e,undefined){var t,n,r,i,o,s,a,u,l,c,p,f,h,d,g,m,y,v="sizzle"+-new Date,b=e.document,w=0,T=0,C=st(),k=st(),N=st(),E=!1,S=function(e,t){return e===t?(E=!0,0):0},j=typeof undefined,D=1<<31,A={}.hasOwnProperty,L=[],q=L.pop,H=L.push,O=L.push,F=L.slice,P=L.indexOf||function(e){var t=0,n=this.length;for(;n>t;t++)if(this[t]===e)return t;return-1},R="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",M="[\\x20\\t\\r\\n\\f]",W="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",$=W.replace("w","w#"),B="\\["+M+"*("+W+")"+M+"*(?:([*^$|!~]?=)"+M+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+$+")|)|)"+M+"*\\]",I=":("+W+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+B.replace(3,8)+")*)|.*)\\)|)",z=RegExp("^"+M+"+|((?:^|[^\\\\])(?:\\\\.)*)"+M+"+$","g"),_=RegExp("^"+M+"*,"+M+"*"),X=RegExp("^"+M+"*([>+~]|"+M+")"+M+"*"),U=RegExp(M+"*[+~]"),Y=RegExp("="+M+"*([^\\]'\"]*)"+M+"*\\]","g"),V=RegExp(I),G=RegExp("^"+$+"$"),J={ID:RegExp("^#("+W+")"),CLASS:RegExp("^\\.("+W+")"),TAG:RegExp("^("+W.replace("w","w*")+")"),ATTR:RegExp("^"+B),PSEUDO:RegExp("^"+I),CHILD:RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+M+"*(even|odd|(([+-]|)(\\d*)n|)"+M+"*(?:([+-]|)"+M+"*(\\d+)|))"+M+"*\\)|)","i"),bool:RegExp("^(?:"+R+")$","i"),needsContext:RegExp("^"+M+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+M+"*((?:-\\d)?\\d*)"+M+"*\\)|)(?=[^-]|$)","i")},Q=/^[^{]+\{\s*\[native \w/,K=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,Z=/^(?:input|select|textarea|button)$/i,et=/^h\d$/i,tt=/'|\\/g,nt=RegExp("\\\\([\\da-f]{1,6}"+M+"?|("+M+")|.)","ig"),rt=function(e,t,n){var r="0x"+t-65536;return r!==r||n?t:0>r?String.fromCharCode(r+65536):String.fromCharCode(55296|r>>10,56320|1023&r)};try{O.apply(L=F.call(b.childNodes),b.childNodes),L[b.childNodes.length].nodeType}catch(it){O={apply:L.length?function(e,t){H.apply(e,F.call(t))}:function(e,t){var n=e.length,r=0;while(e[n++]=t[r++]);e.length=n-1}}}function ot(e,t,r,i){var o,s,a,u,l,f,g,m,x,w;if((t?t.ownerDocument||t:b)!==p&&c(t),t=t||p,r=r||[],!e||"string"!=typeof e)return r;if(1!==(u=t.nodeType)&&9!==u)return[];if(h&&!i){if(o=K.exec(e))if(a=o[1]){if(9===u){if(s=t.getElementById(a),!s||!s.parentNode)return r;if(s.id===a)return r.push(s),r}else if(t.ownerDocument&&(s=t.ownerDocument.getElementById(a))&&y(t,s)&&s.id===a)return r.push(s),r}else{if(o[2])return O.apply(r,t.getElementsByTagName(e)),r;if((a=o[3])&&n.getElementsByClassName&&t.getElementsByClassName)return O.apply(r,t.getElementsByClassName(a)),r}if(n.qsa&&(!d||!d.test(e))){if(m=g=v,x=t,w=9===u&&e,1===u&&"object"!==t.nodeName.toLowerCase()){f=gt(e),(g=t.getAttribute("id"))?m=g.replace(tt,"\\$&"):t.setAttribute("id",m),m="[id='"+m+"'] ",l=f.length;while(l--)f[l]=m+mt(f[l]);x=U.test(e)&&t.parentNode||t,w=f.join(",")}if(w)try{return O.apply(r,x.querySelectorAll(w)),r}catch(T){}finally{g||t.removeAttribute("id")}}}return kt(e.replace(z,"$1"),t,r,i)}function st(){var e=[];function t(n,r){return e.push(n+=" ")>i.cacheLength&&delete t[e.shift()],t[n]=r}return t}function at(e){return e[v]=!0,e}function ut(e){var t=p.createElement("div");try{return!!e(t)}catch(n){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function lt(e,t){var n=e.split("|"),r=e.length;while(r--)i.attrHandle[n[r]]=t}function ct(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&(~t.sourceIndex||D)-(~e.sourceIndex||D);if(r)return r;if(n)while(n=n.nextSibling)if(n===t)return-1;return e?1:-1}function pt(e){return function(t){var n=t.nodeName.toLowerCase();return"input"===n&&t.type===e}}function ft(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function ht(e){return at(function(t){return t=+t,at(function(n,r){var i,o=e([],n.length,t),s=o.length;while(s--)n[i=o[s]]&&(n[i]=!(r[i]=n[i]))})})}s=ot.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?"HTML"!==t.nodeName:!1},n=ot.support={},c=ot.setDocument=function(e){var t=e?e.ownerDocument||e:b,r=t.defaultView;return t!==p&&9===t.nodeType&&t.documentElement?(p=t,f=t.documentElement,h=!s(t),r&&r.attachEvent&&r!==r.top&&r.attachEvent("onbeforeunload",function(){c()}),n.attributes=ut(function(e){return e.className="i",!e.getAttribute("className")}),n.getElementsByTagName=ut(function(e){return e.appendChild(t.createComment("")),!e.getElementsByTagName("*").length}),n.getElementsByClassName=ut(function(e){return e.innerHTML="<div class='a'></div><div class='a i'></div>",e.firstChild.className="i",2===e.getElementsByClassName("i").length}),n.getById=ut(function(e){return f.appendChild(e).id=v,!t.getElementsByName||!t.getElementsByName(v).length}),n.getById?(i.find.ID=function(e,t){if(typeof t.getElementById!==j&&h){var n=t.getElementById(e);return n&&n.parentNode?[n]:[]}},i.filter.ID=function(e){var t=e.replace(nt,rt);return function(e){return e.getAttribute("id")===t}}):(delete i.find.ID,i.filter.ID=function(e){var t=e.replace(nt,rt);return function(e){var n=typeof e.getAttributeNode!==j&&e.getAttributeNode("id");return n&&n.value===t}}),i.find.TAG=n.getElementsByTagName?function(e,t){return typeof t.getElementsByTagName!==j?t.getElementsByTagName(e):undefined}:function(e,t){var n,r=[],i=0,o=t.getElementsByTagName(e);if("*"===e){while(n=o[i++])1===n.nodeType&&r.push(n);return r}return o},i.find.CLASS=n.getElementsByClassName&&function(e,t){return typeof t.getElementsByClassName!==j&&h?t.getElementsByClassName(e):undefined},g=[],d=[],(n.qsa=Q.test(t.querySelectorAll))&&(ut(function(e){e.innerHTML="<select><option selected=''></option></select>",e.querySelectorAll("[selected]").length||d.push("\\["+M+"*(?:value|"+R+")"),e.querySelectorAll(":checked").length||d.push(":checked")}),ut(function(e){var n=t.createElement("input");n.setAttribute("type","hidden"),e.appendChild(n).setAttribute("t",""),e.querySelectorAll("[t^='']").length&&d.push("[*^$]="+M+"*(?:''|\"\")"),e.querySelectorAll(":enabled").length||d.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),d.push(",.*:")})),(n.matchesSelector=Q.test(m=f.webkitMatchesSelector||f.mozMatchesSelector||f.oMatchesSelector||f.msMatchesSelector))&&ut(function(e){n.disconnectedMatch=m.call(e,"div"),m.call(e,"[s!='']:x"),g.push("!=",I)}),d=d.length&&RegExp(d.join("|")),g=g.length&&RegExp(g.join("|")),y=Q.test(f.contains)||f.compareDocumentPosition?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)while(t=t.parentNode)if(t===e)return!0;return!1},S=f.compareDocumentPosition?function(e,r){if(e===r)return E=!0,0;var i=r.compareDocumentPosition&&e.compareDocumentPosition&&e.compareDocumentPosition(r);return i?1&i||!n.sortDetached&&r.compareDocumentPosition(e)===i?e===t||y(b,e)?-1:r===t||y(b,r)?1:l?P.call(l,e)-P.call(l,r):0:4&i?-1:1:e.compareDocumentPosition?-1:1}:function(e,n){var r,i=0,o=e.parentNode,s=n.parentNode,a=[e],u=[n];if(e===n)return E=!0,0;if(!o||!s)return e===t?-1:n===t?1:o?-1:s?1:l?P.call(l,e)-P.call(l,n):0;if(o===s)return ct(e,n);r=e;while(r=r.parentNode)a.unshift(r);r=n;while(r=r.parentNode)u.unshift(r);while(a[i]===u[i])i++;return i?ct(a[i],u[i]):a[i]===b?-1:u[i]===b?1:0},t):p},ot.matches=function(e,t){return ot(e,null,null,t)},ot.matchesSelector=function(e,t){if((e.ownerDocument||e)!==p&&c(e),t=t.replace(Y,"='$1']"),!(!n.matchesSelector||!h||g&&g.test(t)||d&&d.test(t)))try{var r=m.call(e,t);if(r||n.disconnectedMatch||e.document&&11!==e.document.nodeType)return r}catch(i){}return ot(t,p,null,[e]).length>0},ot.contains=function(e,t){return(e.ownerDocument||e)!==p&&c(e),y(e,t)},ot.attr=function(e,t){(e.ownerDocument||e)!==p&&c(e);var r=i.attrHandle[t.toLowerCase()],o=r&&A.call(i.attrHandle,t.toLowerCase())?r(e,t,!h):undefined;return o===undefined?n.attributes||!h?e.getAttribute(t):(o=e.getAttributeNode(t))&&o.specified?o.value:null:o},ot.error=function(e){throw Error("Syntax error, unrecognized expression: "+e)},ot.uniqueSort=function(e){var t,r=[],i=0,o=0;if(E=!n.detectDuplicates,l=!n.sortStable&&e.slice(0),e.sort(S),E){while(t=e[o++])t===e[o]&&(i=r.push(o));while(i--)e.splice(r[i],1)}return e},o=ot.getText=function(e){var t,n="",r=0,i=e.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=o(e)}else if(3===i||4===i)return e.nodeValue}else for(;t=e[r];r++)n+=o(t);return n},i=ot.selectors={cacheLength:50,createPseudo:at,match:J,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(nt,rt),e[3]=(e[4]||e[5]||"").replace(nt,rt),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||ot.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&ot.error(e[0]),e},PSEUDO:function(e){var t,n=!e[5]&&e[2];return J.CHILD.test(e[0])?null:(e[3]&&e[4]!==undefined?e[2]=e[4]:n&&V.test(n)&&(t=gt(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(nt,rt).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=C[e+" "];return t||(t=RegExp("(^|"+M+")"+e+"("+M+"|$)"))&&C(e,function(e){return t.test("string"==typeof e.className&&e.className||typeof e.getAttribute!==j&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r){var i=ot.attr(r,e);return null==i?"!="===t:t?(i+="","="===t?i===n:"!="===t?i!==n:"^="===t?n&&0===i.indexOf(n):"*="===t?n&&i.indexOf(n)>-1:"$="===t?n&&i.slice(-n.length)===n:"~="===t?(" "+i+" ").indexOf(n)>-1:"|="===t?i===n||i.slice(0,n.length+1)===n+"-":!1):!0}},CHILD:function(e,t,n,r,i){var o="nth"!==e.slice(0,3),s="last"!==e.slice(-4),a="of-type"===t;return 1===r&&0===i?function(e){return!!e.parentNode}:function(t,n,u){var l,c,p,f,h,d,g=o!==s?"nextSibling":"previousSibling",m=t.parentNode,y=a&&t.nodeName.toLowerCase(),x=!u&&!a;if(m){if(o){while(g){p=t;while(p=p[g])if(a?p.nodeName.toLowerCase()===y:1===p.nodeType)return!1;d=g="only"===e&&!d&&"nextSibling"}return!0}if(d=[s?m.firstChild:m.lastChild],s&&x){c=m[v]||(m[v]={}),l=c[e]||[],h=l[0]===w&&l[1],f=l[0]===w&&l[2],p=h&&m.childNodes[h];while(p=++h&&p&&p[g]||(f=h=0)||d.pop())if(1===p.nodeType&&++f&&p===t){c[e]=[w,h,f];break}}else if(x&&(l=(t[v]||(t[v]={}))[e])&&l[0]===w)f=l[1];else while(p=++h&&p&&p[g]||(f=h=0)||d.pop())if((a?p.nodeName.toLowerCase()===y:1===p.nodeType)&&++f&&(x&&((p[v]||(p[v]={}))[e]=[w,f]),p===t))break;return f-=i,f===r||0===f%r&&f/r>=0}}},PSEUDO:function(e,t){var n,r=i.pseudos[e]||i.setFilters[e.toLowerCase()]||ot.error("unsupported pseudo: "+e);return r[v]?r(t):r.length>1?(n=[e,e,"",t],i.setFilters.hasOwnProperty(e.toLowerCase())?at(function(e,n){var i,o=r(e,t),s=o.length;while(s--)i=P.call(e,o[s]),e[i]=!(n[i]=o[s])}):function(e){return r(e,0,n)}):r}},pseudos:{not:at(function(e){var t=[],n=[],r=a(e.replace(z,"$1"));return r[v]?at(function(e,t,n,i){var o,s=r(e,null,i,[]),a=e.length;while(a--)(o=s[a])&&(e[a]=!(t[a]=o))}):function(e,i,o){return t[0]=e,r(t,null,o,n),!n.pop()}}),has:at(function(e){return function(t){return ot(e,t).length>0}}),contains:at(function(e){return function(t){return(t.textContent||t.innerText||o(t)).indexOf(e)>-1}}),lang:at(function(e){return G.test(e||"")||ot.error("unsupported lang: "+e),e=e.replace(nt,rt).toLowerCase(),function(t){var n;do if(n=h?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return n=n.toLowerCase(),n===e||0===n.indexOf(e+"-");while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===f},focus:function(e){return e===p.activeElement&&(!p.hasFocus||p.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeName>"@"||3===e.nodeType||4===e.nodeType)return!1;return!0},parent:function(e){return!i.pseudos.empty(e)},header:function(e){return et.test(e.nodeName)},input:function(e){return Z.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||t.toLowerCase()===e.type)},first:ht(function(){return[0]}),last:ht(function(e,t){return[t-1]}),eq:ht(function(e,t,n){return[0>n?n+t:n]}),even:ht(function(e,t){var n=0;for(;t>n;n+=2)e.push(n);return e}),odd:ht(function(e,t){var n=1;for(;t>n;n+=2)e.push(n);return e}),lt:ht(function(e,t,n){var r=0>n?n+t:n;for(;--r>=0;)e.push(r);return e}),gt:ht(function(e,t,n){var r=0>n?n+t:n;for(;t>++r;)e.push(r);return e})}},i.pseudos.nth=i.pseudos.eq;for(t in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})i.pseudos[t]=pt(t);for(t in{submit:!0,reset:!0})i.pseudos[t]=ft(t);function dt(){}dt.prototype=i.filters=i.pseudos,i.setFilters=new dt;function gt(e,t){var n,r,o,s,a,u,l,c=k[e+" "];if(c)return t?0:c.slice(0);a=e,u=[],l=i.preFilter;while(a){(!n||(r=_.exec(a)))&&(r&&(a=a.slice(r[0].length)||a),u.push(o=[])),n=!1,(r=X.exec(a))&&(n=r.shift(),o.push({value:n,type:r[0].replace(z," ")}),a=a.slice(n.length));for(s in i.filter)!(r=J[s].exec(a))||l[s]&&!(r=l[s](r))||(n=r.shift(),o.push({value:n,type:s,matches:r}),a=a.slice(n.length));if(!n)break}return t?a.length:a?ot.error(e):k(e,u).slice(0)}function mt(e){var t=0,n=e.length,r="";for(;n>t;t++)r+=e[t].value;return r}function yt(e,t,n){var i=t.dir,o=n&&"parentNode"===i,s=T++;return t.first?function(t,n,r){while(t=t[i])if(1===t.nodeType||o)return e(t,n,r)}:function(t,n,a){var u,l,c,p=w+" "+s;if(a){while(t=t[i])if((1===t.nodeType||o)&&e(t,n,a))return!0}else while(t=t[i])if(1===t.nodeType||o)if(c=t[v]||(t[v]={}),(l=c[i])&&l[0]===p){if((u=l[1])===!0||u===r)return u===!0}else if(l=c[i]=[p],l[1]=e(t,n,a)||r,l[1]===!0)return!0}}function vt(e){return e.length>1?function(t,n,r){var i=e.length;while(i--)if(!e[i](t,n,r))return!1;return!0}:e[0]}function xt(e,t,n,r,i){var o,s=[],a=0,u=e.length,l=null!=t;for(;u>a;a++)(o=e[a])&&(!n||n(o,r,i))&&(s.push(o),l&&t.push(a));return s}function bt(e,t,n,r,i,o){return r&&!r[v]&&(r=bt(r)),i&&!i[v]&&(i=bt(i,o)),at(function(o,s,a,u){var l,c,p,f=[],h=[],d=s.length,g=o||Ct(t||"*",a.nodeType?[a]:a,[]),m=!e||!o&&t?g:xt(g,f,e,a,u),y=n?i||(o?e:d||r)?[]:s:m;if(n&&n(m,y,a,u),r){l=xt(y,h),r(l,[],a,u),c=l.length;while(c--)(p=l[c])&&(y[h[c]]=!(m[h[c]]=p))}if(o){if(i||e){if(i){l=[],c=y.length;while(c--)(p=y[c])&&l.push(m[c]=p);i(null,y=[],l,u)}c=y.length;while(c--)(p=y[c])&&(l=i?P.call(o,p):f[c])>-1&&(o[l]=!(s[l]=p))}}else y=xt(y===s?y.splice(d,y.length):y),i?i(null,s,y,u):O.apply(s,y)})}function wt(e){var t,n,r,o=e.length,s=i.relative[e[0].type],a=s||i.relative[" "],l=s?1:0,c=yt(function(e){return e===t},a,!0),p=yt(function(e){return P.call(t,e)>-1},a,!0),f=[function(e,n,r){return!s&&(r||n!==u)||((t=n).nodeType?c(e,n,r):p(e,n,r))}];for(;o>l;l++)if(n=i.relative[e[l].type])f=[yt(vt(f),n)];else{if(n=i.filter[e[l].type].apply(null,e[l].matches),n[v]){for(r=++l;o>r;r++)if(i.relative[e[r].type])break;return bt(l>1&&vt(f),l>1&&mt(e.slice(0,l-1).concat({value:" "===e[l-2].type?"*":""})).replace(z,"$1"),n,r>l&&wt(e.slice(l,r)),o>r&&wt(e=e.slice(r)),o>r&&mt(e))}f.push(n)}return vt(f)}function Tt(e,t){var n=0,o=t.length>0,s=e.length>0,a=function(a,l,c,f,h){var d,g,m,y=[],v=0,x="0",b=a&&[],T=null!=h,C=u,k=a||s&&i.find.TAG("*",h&&l.parentNode||l),N=w+=null==C?1:Math.random()||.1;for(T&&(u=l!==p&&l,r=n);null!=(d=k[x]);x++){if(s&&d){g=0;while(m=e[g++])if(m(d,l,c)){f.push(d);break}T&&(w=N,r=++n)}o&&((d=!m&&d)&&v--,a&&b.push(d))}if(v+=x,o&&x!==v){g=0;while(m=t[g++])m(b,y,l,c);if(a){if(v>0)while(x--)b[x]||y[x]||(y[x]=q.call(f));y=xt(y)}O.apply(f,y),T&&!a&&y.length>0&&v+t.length>1&&ot.uniqueSort(f)}return T&&(w=N,u=C),b};return o?at(a):a}a=ot.compile=function(e,t){var n,r=[],i=[],o=N[e+" "];if(!o){t||(t=gt(e)),n=t.length;while(n--)o=wt(t[n]),o[v]?r.push(o):i.push(o);o=N(e,Tt(i,r))}return o};function Ct(e,t,n){var r=0,i=t.length;for(;i>r;r++)ot(e,t[r],n);return n}function kt(e,t,r,o){var s,u,l,c,p,f=gt(e);if(!o&&1===f.length){if(u=f[0]=f[0].slice(0),u.length>2&&"ID"===(l=u[0]).type&&n.getById&&9===t.nodeType&&h&&i.relative[u[1].type]){if(t=(i.find.ID(l.matches[0].replace(nt,rt),t)||[])[0],!t)return r;e=e.slice(u.shift().value.length)}s=J.needsContext.test(e)?0:u.length;while(s--){if(l=u[s],i.relative[c=l.type])break;if((p=i.find[c])&&(o=p(l.matches[0].replace(nt,rt),U.test(u[0].type)&&t.parentNode||t))){if(u.splice(s,1),e=o.length&&mt(u),!e)return O.apply(r,o),r;break}}}return a(e,f)(o,t,!h,r,U.test(e)),r}n.sortStable=v.split("").sort(S).join("")===v,n.detectDuplicates=E,c(),n.sortDetached=ut(function(e){return 1&e.compareDocumentPosition(p.createElement("div"))}),ut(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||lt("type|href|height|width",function(e,t,n){return n?undefined:e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),n.attributes&&ut(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||lt("value",function(e,t,n){return n||"input"!==e.nodeName.toLowerCase()?undefined:e.defaultValue}),ut(function(e){return null==e.getAttribute("disabled")})||lt(R,function(e,t,n){var r;return n?undefined:(r=e.getAttributeNode(t))&&r.specified?r.value:e[t]===!0?t.toLowerCase():null}),x.find=ot,x.expr=ot.selectors,x.expr[":"]=x.expr.pseudos,x.unique=ot.uniqueSort,x.text=ot.getText,x.isXMLDoc=ot.isXML,x.contains=ot.contains}(e);var D={};function A(e){var t=D[e]={};return x.each(e.match(w)||[],function(e,n){t[n]=!0}),t}x.Callbacks=function(e){e="string"==typeof e?D[e]||A(e):x.extend({},e);var t,n,r,i,o,s,a=[],u=!e.once&&[],l=function(p){for(t=e.memory&&p,n=!0,s=i||0,i=0,o=a.length,r=!0;a&&o>s;s++)if(a[s].apply(p[0],p[1])===!1&&e.stopOnFalse){t=!1;break}r=!1,a&&(u?u.length&&l(u.shift()):t?a=[]:c.disable())},c={add:function(){if(a){var n=a.length;(function s(t){x.each(t,function(t,n){var r=x.type(n);"function"===r?e.unique&&c.has(n)||a.push(n):n&&n.length&&"string"!==r&&s(n)})})(arguments),r?o=a.length:t&&(i=n,l(t))}return this},remove:function(){return a&&x.each(arguments,function(e,t){var n;while((n=x.inArray(t,a,n))>-1)a.splice(n,1),r&&(o>=n&&o--,s>=n&&s--)}),this},has:function(e){return e?x.inArray(e,a)>-1:!(!a||!a.length)},empty:function(){return a=[],o=0,this},disable:function(){return a=u=t=undefined,this},disabled:function(){return!a},lock:function(){return u=undefined,t||c.disable(),this},locked:function(){return!u},fireWith:function(e,t){return!a||n&&!u||(t=t||[],t=[e,t.slice?t.slice():t],r?u.push(t):l(t)),this},fire:function(){return c.fireWith(this,arguments),this},fired:function(){return!!n}};return c},x.extend({Deferred:function(e){var t=[["resolve","done",x.Callbacks("once memory"),"resolved"],["reject","fail",x.Callbacks("once memory"),"rejected"],["notify","progress",x.Callbacks("memory")]],n="pending",r={state:function(){return n},always:function(){return i.done(arguments).fail(arguments),this},then:function(){var e=arguments;return x.Deferred(function(n){x.each(t,function(t,o){var s=o[0],a=x.isFunction(e[t])&&e[t];i[o[1]](function(){var e=a&&a.apply(this,arguments);e&&x.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[s+"With"](this===r?n.promise():this,a?[e]:arguments)})}),e=null}).promise()},promise:function(e){return null!=e?x.extend(e,r):r}},i={};return r.pipe=r.then,x.each(t,function(e,o){var s=o[2],a=o[3];r[o[1]]=s.add,a&&s.add(function(){n=a},t[1^e][2].disable,t[2][2].lock),i[o[0]]=function(){return i[o[0]+"With"](this===i?r:this,arguments),this},i[o[0]+"With"]=s.fireWith}),r.promise(i),e&&e.call(i,i),i},when:function(e){var t=0,n=d.call(arguments),r=n.length,i=1!==r||e&&x.isFunction(e.promise)?r:0,o=1===i?e:x.Deferred(),s=function(e,t,n){return function(r){t[e]=this,n[e]=arguments.length>1?d.call(arguments):r,n===a?o.notifyWith(t,n):--i||o.resolveWith(t,n)}},a,u,l;if(r>1)for(a=Array(r),u=Array(r),l=Array(r);r>t;t++)n[t]&&x.isFunction(n[t].promise)?n[t].promise().done(s(t,l,n)).fail(o.reject).progress(s(t,u,a)):--i;return i||o.resolveWith(l,n),o.promise()}}),x.support=function(t){var n=o.createElement("input"),r=o.createDocumentFragment(),i=o.createElement("div"),s=o.createElement("select"),a=s.appendChild(o.createElement("option"));return n.type?(n.type="checkbox",t.checkOn=""!==n.value,t.optSelected=a.selected,t.reliableMarginRight=!0,t.boxSizingReliable=!0,t.pixelPosition=!1,n.checked=!0,t.noCloneChecked=n.cloneNode(!0).checked,s.disabled=!0,t.optDisabled=!a.disabled,n=o.createElement("input"),n.value="t",n.type="radio",t.radioValue="t"===n.value,n.setAttribute("checked","t"),n.setAttribute("name","t"),r.appendChild(n),t.checkClone=r.cloneNode(!0).cloneNode(!0).lastChild.checked,t.focusinBubbles="onfocusin"in e,i.style.backgroundClip="content-box",i.cloneNode(!0).style.backgroundClip="",t.clearCloneStyle="content-box"===i.style.backgroundClip,x(function(){var n,r,s="padding:0;margin:0;border:0;display:block;-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box",a=o.getElementsByTagName("body")[0];a&&(n=o.createElement("div"),n.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",a.appendChild(n).appendChild(i),i.innerHTML="",i.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%",x.swap(a,null!=a.style.zoom?{zoom:1}:{},function(){t.boxSizing=4===i.offsetWidth}),e.getComputedStyle&&(t.pixelPosition="1%"!==(e.getComputedStyle(i,null)||{}).top,t.boxSizingReliable="4px"===(e.getComputedStyle(i,null)||{width:"4px"}).width,r=i.appendChild(o.createElement("div")),r.style.cssText=i.style.cssText=s,r.style.marginRight=r.style.width="0",i.style.width="1px",t.reliableMarginRight=!parseFloat((e.getComputedStyle(r,null)||{}).marginRight)),a.removeChild(n))}),t):t}({});var L,q,H=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,O=/([A-Z])/g;function F(){Object.defineProperty(this.cache={},0,{get:function(){return{}}}),this.expando=x.expando+Math.random()}F.uid=1,F.accepts=function(e){return e.nodeType?1===e.nodeType||9===e.nodeType:!0},F.prototype={key:function(e){if(!F.accepts(e))return 0;var t={},n=e[this.expando];if(!n){n=F.uid++;try{t[this.expando]={value:n},Object.defineProperties(e,t)}catch(r){t[this.expando]=n,x.extend(e,t)}}return this.cache[n]||(this.cache[n]={}),n},set:function(e,t,n){var r,i=this.key(e),o=this.cache[i];if("string"==typeof t)o[t]=n;else if(x.isEmptyObject(o))x.extend(this.cache[i],t);else for(r in t)o[r]=t[r];return o},get:function(e,t){var n=this.cache[this.key(e)];return t===undefined?n:n[t]},access:function(e,t,n){var r;return t===undefined||t&&"string"==typeof t&&n===undefined?(r=this.get(e,t),r!==undefined?r:this.get(e,x.camelCase(t))):(this.set(e,t,n),n!==undefined?n:t)},remove:function(e,t){var n,r,i,o=this.key(e),s=this.cache[o];if(t===undefined)this.cache[o]={};else{x.isArray(t)?r=t.concat(t.map(x.camelCase)):(i=x.camelCase(t),t in s?r=[t,i]:(r=i,r=r in s?[r]:r.match(w)||[])),n=r.length;while(n--)delete s[r[n]]}},hasData:function(e){return!x.isEmptyObject(this.cache[e[this.expando]]||{})},discard:function(e){e[this.expando]&&delete this.cache[e[this.expando]]}},L=new F,q=new F,x.extend({acceptData:F.accepts,hasData:function(e){return L.hasData(e)||q.hasData(e)},data:function(e,t,n){return L.access(e,t,n)},removeData:function(e,t){L.remove(e,t)},_data:function(e,t,n){return q.access(e,t,n)},_removeData:function(e,t){q.remove(e,t)}}),x.fn.extend({data:function(e,t){var n,r,i=this[0],o=0,s=null;if(e===undefined){if(this.length&&(s=L.get(i),1===i.nodeType&&!q.get(i,"hasDataAttrs"))){for(n=i.attributes;n.length>o;o++)r=n[o].name,0===r.indexOf("data-")&&(r=x.camelCase(r.slice(5)),P(i,r,s[r]));q.set(i,"hasDataAttrs",!0)}return s}return"object"==typeof e?this.each(function(){L.set(this,e)}):x.access(this,function(t){var n,r=x.camelCase(e);if(i&&t===undefined){if(n=L.get(i,e),n!==undefined)return n;if(n=L.get(i,r),n!==undefined)return n;if(n=P(i,r,undefined),n!==undefined)return n}else this.each(function(){var n=L.get(this,r);L.set(this,r,t),-1!==e.indexOf("-")&&n!==undefined&&L.set(this,e,t)})},null,t,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){L.remove(this,e)})}});function P(e,t,n){var r;if(n===undefined&&1===e.nodeType)if(r="data-"+t.replace(O,"-$1").toLowerCase(),n=e.getAttribute(r),"string"==typeof n){try{n="true"===n?!0:"false"===n?!1:"null"===n?null:+n+""===n?+n:H.test(n)?JSON.parse(n):n}catch(i){}L.set(e,t,n)}else n=undefined;return n}x.extend({queue:function(e,t,n){var r;return e?(t=(t||"fx")+"queue",r=q.get(e,t),n&&(!r||x.isArray(n)?r=q.access(e,t,x.makeArray(n)):r.push(n)),r||[]):undefined},dequeue:function(e,t){t=t||"fx";var n=x.queue(e,t),r=n.length,i=n.shift(),o=x._queueHooks(e,t),s=function(){x.dequeue(e,t)
};"inprogress"===i&&(i=n.shift(),r--),i&&("fx"===t&&n.unshift("inprogress"),delete o.stop,i.call(e,s,o)),!r&&o&&o.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return q.get(e,n)||q.access(e,n,{empty:x.Callbacks("once memory").add(function(){q.remove(e,[t+"queue",n])})})}}),x.fn.extend({queue:function(e,t){var n=2;return"string"!=typeof e&&(t=e,e="fx",n--),n>arguments.length?x.queue(this[0],e):t===undefined?this:this.each(function(){var n=x.queue(this,e,t);x._queueHooks(this,e),"fx"===e&&"inprogress"!==n[0]&&x.dequeue(this,e)})},dequeue:function(e){return this.each(function(){x.dequeue(this,e)})},delay:function(e,t){return e=x.fx?x.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var r=setTimeout(t,e);n.stop=function(){clearTimeout(r)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,r=1,i=x.Deferred(),o=this,s=this.length,a=function(){--r||i.resolveWith(o,[o])};"string"!=typeof e&&(t=e,e=undefined),e=e||"fx";while(s--)n=q.get(o[s],e+"queueHooks"),n&&n.empty&&(r++,n.empty.add(a));return a(),i.promise(t)}});var R,M,W=/[\t\r\n\f]/g,$=/\r/g,B=/^(?:input|select|textarea|button)$/i;x.fn.extend({attr:function(e,t){return x.access(this,x.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){x.removeAttr(this,e)})},prop:function(e,t){return x.access(this,x.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each(function(){delete this[x.propFix[e]||e]})},addClass:function(e){var t,n,r,i,o,s=0,a=this.length,u="string"==typeof e&&e;if(x.isFunction(e))return this.each(function(t){x(this).addClass(e.call(this,t,this.className))});if(u)for(t=(e||"").match(w)||[];a>s;s++)if(n=this[s],r=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(W," "):" ")){o=0;while(i=t[o++])0>r.indexOf(" "+i+" ")&&(r+=i+" ");n.className=x.trim(r)}return this},removeClass:function(e){var t,n,r,i,o,s=0,a=this.length,u=0===arguments.length||"string"==typeof e&&e;if(x.isFunction(e))return this.each(function(t){x(this).removeClass(e.call(this,t,this.className))});if(u)for(t=(e||"").match(w)||[];a>s;s++)if(n=this[s],r=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(W," "):"")){o=0;while(i=t[o++])while(r.indexOf(" "+i+" ")>=0)r=r.replace(" "+i+" "," ");n.className=e?x.trim(r):""}return this},toggleClass:function(e,t){var n=typeof e;return"boolean"==typeof t&&"string"===n?t?this.addClass(e):this.removeClass(e):x.isFunction(e)?this.each(function(n){x(this).toggleClass(e.call(this,n,this.className,t),t)}):this.each(function(){if("string"===n){var t,i=0,o=x(this),s=e.match(w)||[];while(t=s[i++])o.hasClass(t)?o.removeClass(t):o.addClass(t)}else(n===r||"boolean"===n)&&(this.className&&q.set(this,"__className__",this.className),this.className=this.className||e===!1?"":q.get(this,"__className__")||"")})},hasClass:function(e){var t=" "+e+" ",n=0,r=this.length;for(;r>n;n++)if(1===this[n].nodeType&&(" "+this[n].className+" ").replace(W," ").indexOf(t)>=0)return!0;return!1},val:function(e){var t,n,r,i=this[0];{if(arguments.length)return r=x.isFunction(e),this.each(function(n){var i;1===this.nodeType&&(i=r?e.call(this,n,x(this).val()):e,null==i?i="":"number"==typeof i?i+="":x.isArray(i)&&(i=x.map(i,function(e){return null==e?"":e+""})),t=x.valHooks[this.type]||x.valHooks[this.nodeName.toLowerCase()],t&&"set"in t&&t.set(this,i,"value")!==undefined||(this.value=i))});if(i)return t=x.valHooks[i.type]||x.valHooks[i.nodeName.toLowerCase()],t&&"get"in t&&(n=t.get(i,"value"))!==undefined?n:(n=i.value,"string"==typeof n?n.replace($,""):null==n?"":n)}}}),x.extend({valHooks:{option:{get:function(e){var t=e.attributes.value;return!t||t.specified?e.value:e.text}},select:{get:function(e){var t,n,r=e.options,i=e.selectedIndex,o="select-one"===e.type||0>i,s=o?null:[],a=o?i+1:r.length,u=0>i?a:o?i:0;for(;a>u;u++)if(n=r[u],!(!n.selected&&u!==i||(x.support.optDisabled?n.disabled:null!==n.getAttribute("disabled"))||n.parentNode.disabled&&x.nodeName(n.parentNode,"optgroup"))){if(t=x(n).val(),o)return t;s.push(t)}return s},set:function(e,t){var n,r,i=e.options,o=x.makeArray(t),s=i.length;while(s--)r=i[s],(r.selected=x.inArray(x(r).val(),o)>=0)&&(n=!0);return n||(e.selectedIndex=-1),o}}},attr:function(e,t,n){var i,o,s=e.nodeType;if(e&&3!==s&&8!==s&&2!==s)return typeof e.getAttribute===r?x.prop(e,t,n):(1===s&&x.isXMLDoc(e)||(t=t.toLowerCase(),i=x.attrHooks[t]||(x.expr.match.bool.test(t)?M:R)),n===undefined?i&&"get"in i&&null!==(o=i.get(e,t))?o:(o=x.find.attr(e,t),null==o?undefined:o):null!==n?i&&"set"in i&&(o=i.set(e,n,t))!==undefined?o:(e.setAttribute(t,n+""),n):(x.removeAttr(e,t),undefined))},removeAttr:function(e,t){var n,r,i=0,o=t&&t.match(w);if(o&&1===e.nodeType)while(n=o[i++])r=x.propFix[n]||n,x.expr.match.bool.test(n)&&(e[r]=!1),e.removeAttribute(n)},attrHooks:{type:{set:function(e,t){if(!x.support.radioValue&&"radio"===t&&x.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},propFix:{"for":"htmlFor","class":"className"},prop:function(e,t,n){var r,i,o,s=e.nodeType;if(e&&3!==s&&8!==s&&2!==s)return o=1!==s||!x.isXMLDoc(e),o&&(t=x.propFix[t]||t,i=x.propHooks[t]),n!==undefined?i&&"set"in i&&(r=i.set(e,n,t))!==undefined?r:e[t]=n:i&&"get"in i&&null!==(r=i.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){return e.hasAttribute("tabindex")||B.test(e.nodeName)||e.href?e.tabIndex:-1}}}}),M={set:function(e,t,n){return t===!1?x.removeAttr(e,n):e.setAttribute(n,n),n}},x.each(x.expr.match.bool.source.match(/\w+/g),function(e,t){var n=x.expr.attrHandle[t]||x.find.attr;x.expr.attrHandle[t]=function(e,t,r){var i=x.expr.attrHandle[t],o=r?undefined:(x.expr.attrHandle[t]=undefined)!=n(e,t,r)?t.toLowerCase():null;return x.expr.attrHandle[t]=i,o}}),x.support.optSelected||(x.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null}}),x.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){x.propFix[this.toLowerCase()]=this}),x.each(["radio","checkbox"],function(){x.valHooks[this]={set:function(e,t){return x.isArray(t)?e.checked=x.inArray(x(e).val(),t)>=0:undefined}},x.support.checkOn||(x.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})});var I=/^key/,z=/^(?:mouse|contextmenu)|click/,_=/^(?:focusinfocus|focusoutblur)$/,X=/^([^.]*)(?:\.(.+)|)$/;function U(){return!0}function Y(){return!1}function V(){try{return o.activeElement}catch(e){}}x.event={global:{},add:function(e,t,n,i,o){var s,a,u,l,c,p,f,h,d,g,m,y=q.get(e);if(y){n.handler&&(s=n,n=s.handler,o=s.selector),n.guid||(n.guid=x.guid++),(l=y.events)||(l=y.events={}),(a=y.handle)||(a=y.handle=function(e){return typeof x===r||e&&x.event.triggered===e.type?undefined:x.event.dispatch.apply(a.elem,arguments)},a.elem=e),t=(t||"").match(w)||[""],c=t.length;while(c--)u=X.exec(t[c])||[],d=m=u[1],g=(u[2]||"").split(".").sort(),d&&(f=x.event.special[d]||{},d=(o?f.delegateType:f.bindType)||d,f=x.event.special[d]||{},p=x.extend({type:d,origType:m,data:i,handler:n,guid:n.guid,selector:o,needsContext:o&&x.expr.match.needsContext.test(o),namespace:g.join(".")},s),(h=l[d])||(h=l[d]=[],h.delegateCount=0,f.setup&&f.setup.call(e,i,g,a)!==!1||e.addEventListener&&e.addEventListener(d,a,!1)),f.add&&(f.add.call(e,p),p.handler.guid||(p.handler.guid=n.guid)),o?h.splice(h.delegateCount++,0,p):h.push(p),x.event.global[d]=!0);e=null}},remove:function(e,t,n,r,i){var o,s,a,u,l,c,p,f,h,d,g,m=q.hasData(e)&&q.get(e);if(m&&(u=m.events)){t=(t||"").match(w)||[""],l=t.length;while(l--)if(a=X.exec(t[l])||[],h=g=a[1],d=(a[2]||"").split(".").sort(),h){p=x.event.special[h]||{},h=(r?p.delegateType:p.bindType)||h,f=u[h]||[],a=a[2]&&RegExp("(^|\\.)"+d.join("\\.(?:.*\\.|)")+"(\\.|$)"),s=o=f.length;while(o--)c=f[o],!i&&g!==c.origType||n&&n.guid!==c.guid||a&&!a.test(c.namespace)||r&&r!==c.selector&&("**"!==r||!c.selector)||(f.splice(o,1),c.selector&&f.delegateCount--,p.remove&&p.remove.call(e,c));s&&!f.length&&(p.teardown&&p.teardown.call(e,d,m.handle)!==!1||x.removeEvent(e,h,m.handle),delete u[h])}else for(h in u)x.event.remove(e,h+t[l],n,r,!0);x.isEmptyObject(u)&&(delete m.handle,q.remove(e,"events"))}},trigger:function(t,n,r,i){var s,a,u,l,c,p,f,h=[r||o],d=y.call(t,"type")?t.type:t,g=y.call(t,"namespace")?t.namespace.split("."):[];if(a=u=r=r||o,3!==r.nodeType&&8!==r.nodeType&&!_.test(d+x.event.triggered)&&(d.indexOf(".")>=0&&(g=d.split("."),d=g.shift(),g.sort()),c=0>d.indexOf(":")&&"on"+d,t=t[x.expando]?t:new x.Event(d,"object"==typeof t&&t),t.isTrigger=i?2:3,t.namespace=g.join("."),t.namespace_re=t.namespace?RegExp("(^|\\.)"+g.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=undefined,t.target||(t.target=r),n=null==n?[t]:x.makeArray(n,[t]),f=x.event.special[d]||{},i||!f.trigger||f.trigger.apply(r,n)!==!1)){if(!i&&!f.noBubble&&!x.isWindow(r)){for(l=f.delegateType||d,_.test(l+d)||(a=a.parentNode);a;a=a.parentNode)h.push(a),u=a;u===(r.ownerDocument||o)&&h.push(u.defaultView||u.parentWindow||e)}s=0;while((a=h[s++])&&!t.isPropagationStopped())t.type=s>1?l:f.bindType||d,p=(q.get(a,"events")||{})[t.type]&&q.get(a,"handle"),p&&p.apply(a,n),p=c&&a[c],p&&x.acceptData(a)&&p.apply&&p.apply(a,n)===!1&&t.preventDefault();return t.type=d,i||t.isDefaultPrevented()||f._default&&f._default.apply(h.pop(),n)!==!1||!x.acceptData(r)||c&&x.isFunction(r[d])&&!x.isWindow(r)&&(u=r[c],u&&(r[c]=null),x.event.triggered=d,r[d](),x.event.triggered=undefined,u&&(r[c]=u)),t.result}},dispatch:function(e){e=x.event.fix(e);var t,n,r,i,o,s=[],a=d.call(arguments),u=(q.get(this,"events")||{})[e.type]||[],l=x.event.special[e.type]||{};if(a[0]=e,e.delegateTarget=this,!l.preDispatch||l.preDispatch.call(this,e)!==!1){s=x.event.handlers.call(this,e,u),t=0;while((i=s[t++])&&!e.isPropagationStopped()){e.currentTarget=i.elem,n=0;while((o=i.handlers[n++])&&!e.isImmediatePropagationStopped())(!e.namespace_re||e.namespace_re.test(o.namespace))&&(e.handleObj=o,e.data=o.data,r=((x.event.special[o.origType]||{}).handle||o.handler).apply(i.elem,a),r!==undefined&&(e.result=r)===!1&&(e.preventDefault(),e.stopPropagation()))}return l.postDispatch&&l.postDispatch.call(this,e),e.result}},handlers:function(e,t){var n,r,i,o,s=[],a=t.delegateCount,u=e.target;if(a&&u.nodeType&&(!e.button||"click"!==e.type))for(;u!==this;u=u.parentNode||this)if(u.disabled!==!0||"click"!==e.type){for(r=[],n=0;a>n;n++)o=t[n],i=o.selector+" ",r[i]===undefined&&(r[i]=o.needsContext?x(i,this).index(u)>=0:x.find(i,this,null,[u]).length),r[i]&&r.push(o);r.length&&s.push({elem:u,handlers:r})}return t.length>a&&s.push({elem:this,handlers:t.slice(a)}),s},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,t){var n,r,i,s=t.button;return null==e.pageX&&null!=t.clientX&&(n=e.target.ownerDocument||o,r=n.documentElement,i=n.body,e.pageX=t.clientX+(r&&r.scrollLeft||i&&i.scrollLeft||0)-(r&&r.clientLeft||i&&i.clientLeft||0),e.pageY=t.clientY+(r&&r.scrollTop||i&&i.scrollTop||0)-(r&&r.clientTop||i&&i.clientTop||0)),e.which||s===undefined||(e.which=1&s?1:2&s?3:4&s?2:0),e}},fix:function(e){if(e[x.expando])return e;var t,n,r,i=e.type,s=e,a=this.fixHooks[i];a||(this.fixHooks[i]=a=z.test(i)?this.mouseHooks:I.test(i)?this.keyHooks:{}),r=a.props?this.props.concat(a.props):this.props,e=new x.Event(s),t=r.length;while(t--)n=r[t],e[n]=s[n];return e.target||(e.target=o),3===e.target.nodeType&&(e.target=e.target.parentNode),a.filter?a.filter(e,s):e},special:{load:{noBubble:!0},focus:{trigger:function(){return this!==V()&&this.focus?(this.focus(),!1):undefined},delegateType:"focusin"},blur:{trigger:function(){return this===V()&&this.blur?(this.blur(),!1):undefined},delegateType:"focusout"},click:{trigger:function(){return"checkbox"===this.type&&this.click&&x.nodeName(this,"input")?(this.click(),!1):undefined},_default:function(e){return x.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){e.result!==undefined&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,n,r){var i=x.extend(new x.Event,n,{type:e,isSimulated:!0,originalEvent:{}});r?x.event.trigger(i,null,t):x.event.dispatch.call(t,i),i.isDefaultPrevented()&&n.preventDefault()}},x.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)},x.Event=function(e,t){return this instanceof x.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||e.getPreventDefault&&e.getPreventDefault()?U:Y):this.type=e,t&&x.extend(this,t),this.timeStamp=e&&e.timeStamp||x.now(),this[x.expando]=!0,undefined):new x.Event(e,t)},x.Event.prototype={isDefaultPrevented:Y,isPropagationStopped:Y,isImmediatePropagationStopped:Y,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=U,e&&e.preventDefault&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=U,e&&e.stopPropagation&&e.stopPropagation()},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=U,this.stopPropagation()}},x.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){x.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=this,i=e.relatedTarget,o=e.handleObj;return(!i||i!==r&&!x.contains(r,i))&&(e.type=o.origType,n=o.handler.apply(this,arguments),e.type=t),n}}}),x.support.focusinBubbles||x.each({focus:"focusin",blur:"focusout"},function(e,t){var n=0,r=function(e){x.event.simulate(t,e.target,x.event.fix(e),!0)};x.event.special[t]={setup:function(){0===n++&&o.addEventListener(e,r,!0)},teardown:function(){0===--n&&o.removeEventListener(e,r,!0)}}}),x.fn.extend({on:function(e,t,n,r,i){var o,s;if("object"==typeof e){"string"!=typeof t&&(n=n||t,t=undefined);for(s in e)this.on(s,t,n,e[s],i);return this}if(null==n&&null==r?(r=t,n=t=undefined):null==r&&("string"==typeof t?(r=n,n=undefined):(r=n,n=t,t=undefined)),r===!1)r=Y;else if(!r)return this;return 1===i&&(o=r,r=function(e){return x().off(e),o.apply(this,arguments)},r.guid=o.guid||(o.guid=x.guid++)),this.each(function(){x.event.add(this,e,r,n,t)})},one:function(e,t,n,r){return this.on(e,t,n,r,1)},off:function(e,t,n){var r,i;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,x(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof e){for(i in e)this.off(i,t,e[i]);return this}return(t===!1||"function"==typeof t)&&(n=t,t=undefined),n===!1&&(n=Y),this.each(function(){x.event.remove(this,e,n,t)})},trigger:function(e,t){return this.each(function(){x.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];return n?x.event.trigger(e,t,n,!0):undefined}});var G=/^.[^:#\[\.,]*$/,J=/^(?:parents|prev(?:Until|All))/,Q=x.expr.match.needsContext,K={children:!0,contents:!0,next:!0,prev:!0};x.fn.extend({find:function(e){var t,n=[],r=this,i=r.length;if("string"!=typeof e)return this.pushStack(x(e).filter(function(){for(t=0;i>t;t++)if(x.contains(r[t],this))return!0}));for(t=0;i>t;t++)x.find(e,r[t],n);return n=this.pushStack(i>1?x.unique(n):n),n.selector=this.selector?this.selector+" "+e:e,n},has:function(e){var t=x(e,this),n=t.length;return this.filter(function(){var e=0;for(;n>e;e++)if(x.contains(this,t[e]))return!0})},not:function(e){return this.pushStack(et(this,e||[],!0))},filter:function(e){return this.pushStack(et(this,e||[],!1))},is:function(e){return!!et(this,"string"==typeof e&&Q.test(e)?x(e):e||[],!1).length},closest:function(e,t){var n,r=0,i=this.length,o=[],s=Q.test(e)||"string"!=typeof e?x(e,t||this.context):0;for(;i>r;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(11>n.nodeType&&(s?s.index(n)>-1:1===n.nodeType&&x.find.matchesSelector(n,e))){n=o.push(n);break}return this.pushStack(o.length>1?x.unique(o):o)},index:function(e){return e?"string"==typeof e?g.call(x(e),this[0]):g.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){var n="string"==typeof e?x(e,t):x.makeArray(e&&e.nodeType?[e]:e),r=x.merge(this.get(),n);return this.pushStack(x.unique(r))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}});function Z(e,t){while((e=e[t])&&1!==e.nodeType);return e}x.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return x.dir(e,"parentNode")},parentsUntil:function(e,t,n){return x.dir(e,"parentNode",n)},next:function(e){return Z(e,"nextSibling")},prev:function(e){return Z(e,"previousSibling")},nextAll:function(e){return x.dir(e,"nextSibling")},prevAll:function(e){return x.dir(e,"previousSibling")},nextUntil:function(e,t,n){return x.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return x.dir(e,"previousSibling",n)},siblings:function(e){return x.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return x.sibling(e.firstChild)},contents:function(e){return e.contentDocument||x.merge([],e.childNodes)}},function(e,t){x.fn[e]=function(n,r){var i=x.map(this,t,n);return"Until"!==e.slice(-5)&&(r=n),r&&"string"==typeof r&&(i=x.filter(r,i)),this.length>1&&(K[e]||x.unique(i),J.test(e)&&i.reverse()),this.pushStack(i)}}),x.extend({filter:function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?x.find.matchesSelector(r,e)?[r]:[]:x.find.matches(e,x.grep(t,function(e){return 1===e.nodeType}))},dir:function(e,t,n){var r=[],i=n!==undefined;while((e=e[t])&&9!==e.nodeType)if(1===e.nodeType){if(i&&x(e).is(n))break;r.push(e)}return r},sibling:function(e,t){var n=[];for(;e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n}});function et(e,t,n){if(x.isFunction(t))return x.grep(e,function(e,r){return!!t.call(e,r,e)!==n});if(t.nodeType)return x.grep(e,function(e){return e===t!==n});if("string"==typeof t){if(G.test(t))return x.filter(t,e,n);t=x.filter(t,e)}return x.grep(e,function(e){return g.call(t,e)>=0!==n})}var tt=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,nt=/<([\w:]+)/,rt=/<|&#?\w+;/,it=/<(?:script|style|link)/i,ot=/^(?:checkbox|radio)$/i,st=/checked\s*(?:[^=]|=\s*.checked.)/i,at=/^$|\/(?:java|ecma)script/i,ut=/^true\/(.*)/,lt=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,ct={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};ct.optgroup=ct.option,ct.tbody=ct.tfoot=ct.colgroup=ct.caption=ct.thead,ct.th=ct.td,x.fn.extend({text:function(e){return x.access(this,function(e){return e===undefined?x.text(this):this.empty().append((this[0]&&this[0].ownerDocument||o).createTextNode(e))},null,e,arguments.length)},append:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=pt(this,e);t.appendChild(e)}})},prepend:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=pt(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){var n,r=e?x.filter(e,this):this,i=0;for(;null!=(n=r[i]);i++)t||1!==n.nodeType||x.cleanData(mt(n)),n.parentNode&&(t&&x.contains(n.ownerDocument,n)&&dt(mt(n,"script")),n.parentNode.removeChild(n));return this},empty:function(){var e,t=0;for(;null!=(e=this[t]);t++)1===e.nodeType&&(x.cleanData(mt(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null==e?!1:e,t=null==t?e:t,this.map(function(){return x.clone(this,e,t)})},html:function(e){return x.access(this,function(e){var t=this[0]||{},n=0,r=this.length;if(e===undefined&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!it.test(e)&&!ct[(nt.exec(e)||["",""])[1].toLowerCase()]){e=e.replace(tt,"<$1></$2>");try{for(;r>n;n++)t=this[n]||{},1===t.nodeType&&(x.cleanData(mt(t,!1)),t.innerHTML=e);t=0}catch(i){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=x.map(this,function(e){return[e.nextSibling,e.parentNode]}),t=0;return this.domManip(arguments,function(n){var r=e[t++],i=e[t++];i&&(r&&r.parentNode!==i&&(r=this.nextSibling),x(this).remove(),i.insertBefore(n,r))},!0),t?this:this.remove()},detach:function(e){return this.remove(e,!0)},domManip:function(e,t,n){e=f.apply([],e);var r,i,o,s,a,u,l=0,c=this.length,p=this,h=c-1,d=e[0],g=x.isFunction(d);if(g||!(1>=c||"string"!=typeof d||x.support.checkClone)&&st.test(d))return this.each(function(r){var i=p.eq(r);g&&(e[0]=d.call(this,r,i.html())),i.domManip(e,t,n)});if(c&&(r=x.buildFragment(e,this[0].ownerDocument,!1,!n&&this),i=r.firstChild,1===r.childNodes.length&&(r=i),i)){for(o=x.map(mt(r,"script"),ft),s=o.length;c>l;l++)a=r,l!==h&&(a=x.clone(a,!0,!0),s&&x.merge(o,mt(a,"script"))),t.call(this[l],a,l);if(s)for(u=o[o.length-1].ownerDocument,x.map(o,ht),l=0;s>l;l++)a=o[l],at.test(a.type||"")&&!q.access(a,"globalEval")&&x.contains(u,a)&&(a.src?x._evalUrl(a.src):x.globalEval(a.textContent.replace(lt,"")))}return this}}),x.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){x.fn[e]=function(e){var n,r=[],i=x(e),o=i.length-1,s=0;for(;o>=s;s++)n=s===o?this:this.clone(!0),x(i[s])[t](n),h.apply(r,n.get());return this.pushStack(r)}}),x.extend({clone:function(e,t,n){var r,i,o,s,a=e.cloneNode(!0),u=x.contains(e.ownerDocument,e);if(!(x.support.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||x.isXMLDoc(e)))for(s=mt(a),o=mt(e),r=0,i=o.length;i>r;r++)yt(o[r],s[r]);if(t)if(n)for(o=o||mt(e),s=s||mt(a),r=0,i=o.length;i>r;r++)gt(o[r],s[r]);else gt(e,a);return s=mt(a,"script"),s.length>0&&dt(s,!u&&mt(e,"script")),a},buildFragment:function(e,t,n,r){var i,o,s,a,u,l,c=0,p=e.length,f=t.createDocumentFragment(),h=[];for(;p>c;c++)if(i=e[c],i||0===i)if("object"===x.type(i))x.merge(h,i.nodeType?[i]:i);else if(rt.test(i)){o=o||f.appendChild(t.createElement("div")),s=(nt.exec(i)||["",""])[1].toLowerCase(),a=ct[s]||ct._default,o.innerHTML=a[1]+i.replace(tt,"<$1></$2>")+a[2],l=a[0];while(l--)o=o.lastChild;x.merge(h,o.childNodes),o=f.firstChild,o.textContent=""}else h.push(t.createTextNode(i));f.textContent="",c=0;while(i=h[c++])if((!r||-1===x.inArray(i,r))&&(u=x.contains(i.ownerDocument,i),o=mt(f.appendChild(i),"script"),u&&dt(o),n)){l=0;while(i=o[l++])at.test(i.type||"")&&n.push(i)}return f},cleanData:function(e){var t,n,r,i,o,s,a=x.event.special,u=0;for(;(n=e[u])!==undefined;u++){if(F.accepts(n)&&(o=n[q.expando],o&&(t=q.cache[o]))){if(r=Object.keys(t.events||{}),r.length)for(s=0;(i=r[s])!==undefined;s++)a[i]?x.event.remove(n,i):x.removeEvent(n,i,t.handle);q.cache[o]&&delete q.cache[o]}delete L.cache[n[L.expando]]}},_evalUrl:function(e){return x.ajax({url:e,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})}});function pt(e,t){return x.nodeName(e,"table")&&x.nodeName(1===t.nodeType?t:t.firstChild,"tr")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function ft(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function ht(e){var t=ut.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function dt(e,t){var n=e.length,r=0;for(;n>r;r++)q.set(e[r],"globalEval",!t||q.get(t[r],"globalEval"))}function gt(e,t){var n,r,i,o,s,a,u,l;if(1===t.nodeType){if(q.hasData(e)&&(o=q.access(e),s=q.set(t,o),l=o.events)){delete s.handle,s.events={};for(i in l)for(n=0,r=l[i].length;r>n;n++)x.event.add(t,i,l[i][n])}L.hasData(e)&&(a=L.access(e),u=x.extend({},a),L.set(t,u))}}function mt(e,t){var n=e.getElementsByTagName?e.getElementsByTagName(t||"*"):e.querySelectorAll?e.querySelectorAll(t||"*"):[];return t===undefined||t&&x.nodeName(e,t)?x.merge([e],n):n}function yt(e,t){var n=t.nodeName.toLowerCase();"input"===n&&ot.test(e.type)?t.checked=e.checked:("input"===n||"textarea"===n)&&(t.defaultValue=e.defaultValue)}x.fn.extend({wrapAll:function(e){var t;return x.isFunction(e)?this.each(function(t){x(this).wrapAll(e.call(this,t))}):(this[0]&&(t=x(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstElementChild)e=e.firstElementChild;return e}).append(this)),this)},wrapInner:function(e){return x.isFunction(e)?this.each(function(t){x(this).wrapInner(e.call(this,t))}):this.each(function(){var t=x(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=x.isFunction(e);return this.each(function(n){x(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){x.nodeName(this,"body")||x(this).replaceWith(this.childNodes)}).end()}});var vt,xt,bt=/^(none|table(?!-c[ea]).+)/,wt=/^margin/,Tt=RegExp("^("+b+")(.*)$","i"),Ct=RegExp("^("+b+")(?!px)[a-z%]+$","i"),kt=RegExp("^([+-])=("+b+")","i"),Nt={BODY:"block"},Et={position:"absolute",visibility:"hidden",display:"block"},St={letterSpacing:0,fontWeight:400},jt=["Top","Right","Bottom","Left"],Dt=["Webkit","O","Moz","ms"];function At(e,t){if(t in e)return t;var n=t.charAt(0).toUpperCase()+t.slice(1),r=t,i=Dt.length;while(i--)if(t=Dt[i]+n,t in e)return t;return r}function Lt(e,t){return e=t||e,"none"===x.css(e,"display")||!x.contains(e.ownerDocument,e)}function qt(t){return e.getComputedStyle(t,null)}function Ht(e,t){var n,r,i,o=[],s=0,a=e.length;for(;a>s;s++)r=e[s],r.style&&(o[s]=q.get(r,"olddisplay"),n=r.style.display,t?(o[s]||"none"!==n||(r.style.display=""),""===r.style.display&&Lt(r)&&(o[s]=q.access(r,"olddisplay",Rt(r.nodeName)))):o[s]||(i=Lt(r),(n&&"none"!==n||!i)&&q.set(r,"olddisplay",i?n:x.css(r,"display"))));for(s=0;a>s;s++)r=e[s],r.style&&(t&&"none"!==r.style.display&&""!==r.style.display||(r.style.display=t?o[s]||"":"none"));return e}x.fn.extend({css:function(e,t){return x.access(this,function(e,t,n){var r,i,o={},s=0;if(x.isArray(t)){for(r=qt(e),i=t.length;i>s;s++)o[t[s]]=x.css(e,t[s],!1,r);return o}return n!==undefined?x.style(e,t,n):x.css(e,t)},e,t,arguments.length>1)},show:function(){return Ht(this,!0)},hide:function(){return Ht(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){Lt(this)?x(this).show():x(this).hide()})}}),x.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=vt(e,"opacity");return""===n?"1":n}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(e,t,n,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var i,o,s,a=x.camelCase(t),u=e.style;return t=x.cssProps[a]||(x.cssProps[a]=At(u,a)),s=x.cssHooks[t]||x.cssHooks[a],n===undefined?s&&"get"in s&&(i=s.get(e,!1,r))!==undefined?i:u[t]:(o=typeof n,"string"===o&&(i=kt.exec(n))&&(n=(i[1]+1)*i[2]+parseFloat(x.css(e,t)),o="number"),null==n||"number"===o&&isNaN(n)||("number"!==o||x.cssNumber[a]||(n+="px"),x.support.clearCloneStyle||""!==n||0!==t.indexOf("background")||(u[t]="inherit"),s&&"set"in s&&(n=s.set(e,n,r))===undefined||(u[t]=n)),undefined)}},css:function(e,t,n,r){var i,o,s,a=x.camelCase(t);return t=x.cssProps[a]||(x.cssProps[a]=At(e.style,a)),s=x.cssHooks[t]||x.cssHooks[a],s&&"get"in s&&(i=s.get(e,!0,n)),i===undefined&&(i=vt(e,t,r)),"normal"===i&&t in St&&(i=St[t]),""===n||n?(o=parseFloat(i),n===!0||x.isNumeric(o)?o||0:i):i}}),vt=function(e,t,n){var r,i,o,s=n||qt(e),a=s?s.getPropertyValue(t)||s[t]:undefined,u=e.style;return s&&(""!==a||x.contains(e.ownerDocument,e)||(a=x.style(e,t)),Ct.test(a)&&wt.test(t)&&(r=u.width,i=u.minWidth,o=u.maxWidth,u.minWidth=u.maxWidth=u.width=a,a=s.width,u.width=r,u.minWidth=i,u.maxWidth=o)),a};function Ot(e,t,n){var r=Tt.exec(t);return r?Math.max(0,r[1]-(n||0))+(r[2]||"px"):t}function Ft(e,t,n,r,i){var o=n===(r?"border":"content")?4:"width"===t?1:0,s=0;for(;4>o;o+=2)"margin"===n&&(s+=x.css(e,n+jt[o],!0,i)),r?("content"===n&&(s-=x.css(e,"padding"+jt[o],!0,i)),"margin"!==n&&(s-=x.css(e,"border"+jt[o]+"Width",!0,i))):(s+=x.css(e,"padding"+jt[o],!0,i),"padding"!==n&&(s+=x.css(e,"border"+jt[o]+"Width",!0,i)));return s}function Pt(e,t,n){var r=!0,i="width"===t?e.offsetWidth:e.offsetHeight,o=qt(e),s=x.support.boxSizing&&"border-box"===x.css(e,"boxSizing",!1,o);if(0>=i||null==i){if(i=vt(e,t,o),(0>i||null==i)&&(i=e.style[t]),Ct.test(i))return i;r=s&&(x.support.boxSizingReliable||i===e.style[t]),i=parseFloat(i)||0}return i+Ft(e,t,n||(s?"border":"content"),r,o)+"px"}function Rt(e){var t=o,n=Nt[e];return n||(n=Mt(e,t),"none"!==n&&n||(xt=(xt||x("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(t.documentElement),t=(xt[0].contentWindow||xt[0].contentDocument).document,t.write("<!doctype html><html><body>"),t.close(),n=Mt(e,t),xt.detach()),Nt[e]=n),n}function Mt(e,t){var n=x(t.createElement(e)).appendTo(t.body),r=x.css(n[0],"display");return n.remove(),r}x.each(["height","width"],function(e,t){x.cssHooks[t]={get:function(e,n,r){return n?0===e.offsetWidth&&bt.test(x.css(e,"display"))?x.swap(e,Et,function(){return Pt(e,t,r)}):Pt(e,t,r):undefined},set:function(e,n,r){var i=r&&qt(e);return Ot(e,n,r?Ft(e,t,r,x.support.boxSizing&&"border-box"===x.css(e,"boxSizing",!1,i),i):0)}}}),x(function(){x.support.reliableMarginRight||(x.cssHooks.marginRight={get:function(e,t){return t?x.swap(e,{display:"inline-block"},vt,[e,"marginRight"]):undefined}}),!x.support.pixelPosition&&x.fn.position&&x.each(["top","left"],function(e,t){x.cssHooks[t]={get:function(e,n){return n?(n=vt(e,t),Ct.test(n)?x(e).position()[t]+"px":n):undefined}}})}),x.expr&&x.expr.filters&&(x.expr.filters.hidden=function(e){return 0>=e.offsetWidth&&0>=e.offsetHeight},x.expr.filters.visible=function(e){return!x.expr.filters.hidden(e)}),x.each({margin:"",padding:"",border:"Width"},function(e,t){x.cssHooks[e+t]={expand:function(n){var r=0,i={},o="string"==typeof n?n.split(" "):[n];for(;4>r;r++)i[e+jt[r]+t]=o[r]||o[r-2]||o[0];return i}},wt.test(e)||(x.cssHooks[e+t].set=Ot)});var Wt=/%20/g,$t=/\[\]$/,Bt=/\r?\n/g,It=/^(?:submit|button|image|reset|file)$/i,zt=/^(?:input|select|textarea|keygen)/i;x.fn.extend({serialize:function(){return x.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=x.prop(this,"elements");return e?x.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!x(this).is(":disabled")&&zt.test(this.nodeName)&&!It.test(e)&&(this.checked||!ot.test(e))}).map(function(e,t){var n=x(this).val();return null==n?null:x.isArray(n)?x.map(n,function(e){return{name:t.name,value:e.replace(Bt,"\r\n")}}):{name:t.name,value:n.replace(Bt,"\r\n")}}).get()}}),x.param=function(e,t){var n,r=[],i=function(e,t){t=x.isFunction(t)?t():null==t?"":t,r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(t===undefined&&(t=x.ajaxSettings&&x.ajaxSettings.traditional),x.isArray(e)||e.jquery&&!x.isPlainObject(e))x.each(e,function(){i(this.name,this.value)});else for(n in e)_t(n,e[n],t,i);return r.join("&").replace(Wt,"+")};function _t(e,t,n,r){var i;if(x.isArray(t))x.each(t,function(t,i){n||$t.test(e)?r(e,i):_t(e+"["+("object"==typeof i?t:"")+"]",i,n,r)});else if(n||"object"!==x.type(t))r(e,t);else for(i in t)_t(e+"["+i+"]",t[i],n,r)}x.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){x.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}),x.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)
},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)}});var Xt,Ut,Yt=x.now(),Vt=/\?/,Gt=/#.*$/,Jt=/([?&])_=[^&]*/,Qt=/^(.*?):[ \t]*([^\r\n]*)$/gm,Kt=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Zt=/^(?:GET|HEAD)$/,en=/^\/\//,tn=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,nn=x.fn.load,rn={},on={},sn="*/".concat("*");try{Ut=i.href}catch(an){Ut=o.createElement("a"),Ut.href="",Ut=Ut.href}Xt=tn.exec(Ut.toLowerCase())||[];function un(e){return function(t,n){"string"!=typeof t&&(n=t,t="*");var r,i=0,o=t.toLowerCase().match(w)||[];if(x.isFunction(n))while(r=o[i++])"+"===r[0]?(r=r.slice(1)||"*",(e[r]=e[r]||[]).unshift(n)):(e[r]=e[r]||[]).push(n)}}function ln(e,t,n,r){var i={},o=e===on;function s(a){var u;return i[a]=!0,x.each(e[a]||[],function(e,a){var l=a(t,n,r);return"string"!=typeof l||o||i[l]?o?!(u=l):undefined:(t.dataTypes.unshift(l),s(l),!1)}),u}return s(t.dataTypes[0])||!i["*"]&&s("*")}function cn(e,t){var n,r,i=x.ajaxSettings.flatOptions||{};for(n in t)t[n]!==undefined&&((i[n]?e:r||(r={}))[n]=t[n]);return r&&x.extend(!0,e,r),e}x.fn.load=function(e,t,n){if("string"!=typeof e&&nn)return nn.apply(this,arguments);var r,i,o,s=this,a=e.indexOf(" ");return a>=0&&(r=e.slice(a),e=e.slice(0,a)),x.isFunction(t)?(n=t,t=undefined):t&&"object"==typeof t&&(i="POST"),s.length>0&&x.ajax({url:e,type:i,dataType:"html",data:t}).done(function(e){o=arguments,s.html(r?x("<div>").append(x.parseHTML(e)).find(r):e)}).complete(n&&function(e,t){s.each(n,o||[e.responseText,t,e])}),this},x.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){x.fn[t]=function(e){return this.on(t,e)}}),x.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Ut,type:"GET",isLocal:Kt.test(Xt[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":sn,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":x.parseJSON,"text xml":x.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?cn(cn(e,x.ajaxSettings),t):cn(x.ajaxSettings,e)},ajaxPrefilter:un(rn),ajaxTransport:un(on),ajax:function(e,t){"object"==typeof e&&(t=e,e=undefined),t=t||{};var n,r,i,o,s,a,u,l,c=x.ajaxSetup({},t),p=c.context||c,f=c.context&&(p.nodeType||p.jquery)?x(p):x.event,h=x.Deferred(),d=x.Callbacks("once memory"),g=c.statusCode||{},m={},y={},v=0,b="canceled",T={readyState:0,getResponseHeader:function(e){var t;if(2===v){if(!o){o={};while(t=Qt.exec(i))o[t[1].toLowerCase()]=t[2]}t=o[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return 2===v?i:null},setRequestHeader:function(e,t){var n=e.toLowerCase();return v||(e=y[n]=y[n]||e,m[e]=t),this},overrideMimeType:function(e){return v||(c.mimeType=e),this},statusCode:function(e){var t;if(e)if(2>v)for(t in e)g[t]=[g[t],e[t]];else T.always(e[T.status]);return this},abort:function(e){var t=e||b;return n&&n.abort(t),k(0,t),this}};if(h.promise(T).complete=d.add,T.success=T.done,T.error=T.fail,c.url=((e||c.url||Ut)+"").replace(Gt,"").replace(en,Xt[1]+"//"),c.type=t.method||t.type||c.method||c.type,c.dataTypes=x.trim(c.dataType||"*").toLowerCase().match(w)||[""],null==c.crossDomain&&(a=tn.exec(c.url.toLowerCase()),c.crossDomain=!(!a||a[1]===Xt[1]&&a[2]===Xt[2]&&(a[3]||("http:"===a[1]?"80":"443"))===(Xt[3]||("http:"===Xt[1]?"80":"443")))),c.data&&c.processData&&"string"!=typeof c.data&&(c.data=x.param(c.data,c.traditional)),ln(rn,c,t,T),2===v)return T;u=c.global,u&&0===x.active++&&x.event.trigger("ajaxStart"),c.type=c.type.toUpperCase(),c.hasContent=!Zt.test(c.type),r=c.url,c.hasContent||(c.data&&(r=c.url+=(Vt.test(r)?"&":"?")+c.data,delete c.data),c.cache===!1&&(c.url=Jt.test(r)?r.replace(Jt,"$1_="+Yt++):r+(Vt.test(r)?"&":"?")+"_="+Yt++)),c.ifModified&&(x.lastModified[r]&&T.setRequestHeader("If-Modified-Since",x.lastModified[r]),x.etag[r]&&T.setRequestHeader("If-None-Match",x.etag[r])),(c.data&&c.hasContent&&c.contentType!==!1||t.contentType)&&T.setRequestHeader("Content-Type",c.contentType),T.setRequestHeader("Accept",c.dataTypes[0]&&c.accepts[c.dataTypes[0]]?c.accepts[c.dataTypes[0]]+("*"!==c.dataTypes[0]?", "+sn+"; q=0.01":""):c.accepts["*"]);for(l in c.headers)T.setRequestHeader(l,c.headers[l]);if(c.beforeSend&&(c.beforeSend.call(p,T,c)===!1||2===v))return T.abort();b="abort";for(l in{success:1,error:1,complete:1})T[l](c[l]);if(n=ln(on,c,t,T)){T.readyState=1,u&&f.trigger("ajaxSend",[T,c]),c.async&&c.timeout>0&&(s=setTimeout(function(){T.abort("timeout")},c.timeout));try{v=1,n.send(m,k)}catch(C){if(!(2>v))throw C;k(-1,C)}}else k(-1,"No Transport");function k(e,t,o,a){var l,m,y,b,w,C=t;2!==v&&(v=2,s&&clearTimeout(s),n=undefined,i=a||"",T.readyState=e>0?4:0,l=e>=200&&300>e||304===e,o&&(b=pn(c,T,o)),b=fn(c,b,T,l),l?(c.ifModified&&(w=T.getResponseHeader("Last-Modified"),w&&(x.lastModified[r]=w),w=T.getResponseHeader("etag"),w&&(x.etag[r]=w)),204===e||"HEAD"===c.type?C="nocontent":304===e?C="notmodified":(C=b.state,m=b.data,y=b.error,l=!y)):(y=C,(e||!C)&&(C="error",0>e&&(e=0))),T.status=e,T.statusText=(t||C)+"",l?h.resolveWith(p,[m,C,T]):h.rejectWith(p,[T,C,y]),T.statusCode(g),g=undefined,u&&f.trigger(l?"ajaxSuccess":"ajaxError",[T,c,l?m:y]),d.fireWith(p,[T,C]),u&&(f.trigger("ajaxComplete",[T,c]),--x.active||x.event.trigger("ajaxStop")))}return T},getJSON:function(e,t,n){return x.get(e,t,n,"json")},getScript:function(e,t){return x.get(e,undefined,t,"script")}}),x.each(["get","post"],function(e,t){x[t]=function(e,n,r,i){return x.isFunction(n)&&(i=i||r,r=n,n=undefined),x.ajax({url:e,type:t,dataType:i,data:n,success:r})}});function pn(e,t,n){var r,i,o,s,a=e.contents,u=e.dataTypes;while("*"===u[0])u.shift(),r===undefined&&(r=e.mimeType||t.getResponseHeader("Content-Type"));if(r)for(i in a)if(a[i]&&a[i].test(r)){u.unshift(i);break}if(u[0]in n)o=u[0];else{for(i in n){if(!u[0]||e.converters[i+" "+u[0]]){o=i;break}s||(s=i)}o=o||s}return o?(o!==u[0]&&u.unshift(o),n[o]):undefined}function fn(e,t,n,r){var i,o,s,a,u,l={},c=e.dataTypes.slice();if(c[1])for(s in e.converters)l[s.toLowerCase()]=e.converters[s];o=c.shift();while(o)if(e.responseFields[o]&&(n[e.responseFields[o]]=t),!u&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),u=o,o=c.shift())if("*"===o)o=u;else if("*"!==u&&u!==o){if(s=l[u+" "+o]||l["* "+o],!s)for(i in l)if(a=i.split(" "),a[1]===o&&(s=l[u+" "+a[0]]||l["* "+a[0]])){s===!0?s=l[i]:l[i]!==!0&&(o=a[0],c.unshift(a[1]));break}if(s!==!0)if(s&&e["throws"])t=s(t);else try{t=s(t)}catch(p){return{state:"parsererror",error:s?p:"No conversion from "+u+" to "+o}}}return{state:"success",data:t}}x.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return x.globalEval(e),e}}}),x.ajaxPrefilter("script",function(e){e.cache===undefined&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),x.ajaxTransport("script",function(e){if(e.crossDomain){var t,n;return{send:function(r,i){t=x("<script>").prop({async:!0,charset:e.scriptCharset,src:e.url}).on("load error",n=function(e){t.remove(),n=null,e&&i("error"===e.type?404:200,e.type)}),o.head.appendChild(t[0])},abort:function(){n&&n()}}}});var hn=[],dn=/(=)\?(?=&|$)|\?\?/;x.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=hn.pop()||x.expando+"_"+Yt++;return this[e]=!0,e}}),x.ajaxPrefilter("json jsonp",function(t,n,r){var i,o,s,a=t.jsonp!==!1&&(dn.test(t.url)?"url":"string"==typeof t.data&&!(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&dn.test(t.data)&&"data");return a||"jsonp"===t.dataTypes[0]?(i=t.jsonpCallback=x.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,a?t[a]=t[a].replace(dn,"$1"+i):t.jsonp!==!1&&(t.url+=(Vt.test(t.url)?"&":"?")+t.jsonp+"="+i),t.converters["script json"]=function(){return s||x.error(i+" was not called"),s[0]},t.dataTypes[0]="json",o=e[i],e[i]=function(){s=arguments},r.always(function(){e[i]=o,t[i]&&(t.jsonpCallback=n.jsonpCallback,hn.push(i)),s&&x.isFunction(o)&&o(s[0]),s=o=undefined}),"script"):undefined}),x.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(e){}};var gn=x.ajaxSettings.xhr(),mn={0:200,1223:204},yn=0,vn={};e.ActiveXObject&&x(e).on("unload",function(){for(var e in vn)vn[e]();vn=undefined}),x.support.cors=!!gn&&"withCredentials"in gn,x.support.ajax=gn=!!gn,x.ajaxTransport(function(e){var t;return x.support.cors||gn&&!e.crossDomain?{send:function(n,r){var i,o,s=e.xhr();if(s.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(i in e.xhrFields)s[i]=e.xhrFields[i];e.mimeType&&s.overrideMimeType&&s.overrideMimeType(e.mimeType),e.crossDomain||n["X-Requested-With"]||(n["X-Requested-With"]="XMLHttpRequest");for(i in n)s.setRequestHeader(i,n[i]);t=function(e){return function(){t&&(delete vn[o],t=s.onload=s.onerror=null,"abort"===e?s.abort():"error"===e?r(s.status||404,s.statusText):r(mn[s.status]||s.status,s.statusText,"string"==typeof s.responseText?{text:s.responseText}:undefined,s.getAllResponseHeaders()))}},s.onload=t(),s.onerror=t("error"),t=vn[o=yn++]=t("abort"),s.send(e.hasContent&&e.data||null)},abort:function(){t&&t()}}:undefined});var xn,bn,wn=/^(?:toggle|show|hide)$/,Tn=RegExp("^(?:([+-])=|)("+b+")([a-z%]*)$","i"),Cn=/queueHooks$/,kn=[An],Nn={"*":[function(e,t){var n=this.createTween(e,t),r=n.cur(),i=Tn.exec(t),o=i&&i[3]||(x.cssNumber[e]?"":"px"),s=(x.cssNumber[e]||"px"!==o&&+r)&&Tn.exec(x.css(n.elem,e)),a=1,u=20;if(s&&s[3]!==o){o=o||s[3],i=i||[],s=+r||1;do a=a||".5",s/=a,x.style(n.elem,e,s+o);while(a!==(a=n.cur()/r)&&1!==a&&--u)}return i&&(s=n.start=+s||+r||0,n.unit=o,n.end=i[1]?s+(i[1]+1)*i[2]:+i[2]),n}]};function En(){return setTimeout(function(){xn=undefined}),xn=x.now()}function Sn(e,t,n){var r,i=(Nn[t]||[]).concat(Nn["*"]),o=0,s=i.length;for(;s>o;o++)if(r=i[o].call(n,t,e))return r}function jn(e,t,n){var r,i,o=0,s=kn.length,a=x.Deferred().always(function(){delete u.elem}),u=function(){if(i)return!1;var t=xn||En(),n=Math.max(0,l.startTime+l.duration-t),r=n/l.duration||0,o=1-r,s=0,u=l.tweens.length;for(;u>s;s++)l.tweens[s].run(o);return a.notifyWith(e,[l,o,n]),1>o&&u?n:(a.resolveWith(e,[l]),!1)},l=a.promise({elem:e,props:x.extend({},t),opts:x.extend(!0,{specialEasing:{}},n),originalProperties:t,originalOptions:n,startTime:xn||En(),duration:n.duration,tweens:[],createTween:function(t,n){var r=x.Tween(e,l.opts,t,n,l.opts.specialEasing[t]||l.opts.easing);return l.tweens.push(r),r},stop:function(t){var n=0,r=t?l.tweens.length:0;if(i)return this;for(i=!0;r>n;n++)l.tweens[n].run(1);return t?a.resolveWith(e,[l,t]):a.rejectWith(e,[l,t]),this}}),c=l.props;for(Dn(c,l.opts.specialEasing);s>o;o++)if(r=kn[o].call(l,e,c,l.opts))return r;return x.map(c,Sn,l),x.isFunction(l.opts.start)&&l.opts.start.call(e,l),x.fx.timer(x.extend(u,{elem:e,anim:l,queue:l.opts.queue})),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always)}function Dn(e,t){var n,r,i,o,s;for(n in e)if(r=x.camelCase(n),i=t[r],o=e[n],x.isArray(o)&&(i=o[1],o=e[n]=o[0]),n!==r&&(e[r]=o,delete e[n]),s=x.cssHooks[r],s&&"expand"in s){o=s.expand(o),delete e[r];for(n in o)n in e||(e[n]=o[n],t[n]=i)}else t[r]=i}x.Animation=x.extend(jn,{tweener:function(e,t){x.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");var n,r=0,i=e.length;for(;i>r;r++)n=e[r],Nn[n]=Nn[n]||[],Nn[n].unshift(t)},prefilter:function(e,t){t?kn.unshift(e):kn.push(e)}});function An(e,t,n){var r,i,o,s,a,u,l=this,c={},p=e.style,f=e.nodeType&&Lt(e),h=q.get(e,"fxshow");n.queue||(a=x._queueHooks(e,"fx"),null==a.unqueued&&(a.unqueued=0,u=a.empty.fire,a.empty.fire=function(){a.unqueued||u()}),a.unqueued++,l.always(function(){l.always(function(){a.unqueued--,x.queue(e,"fx").length||a.empty.fire()})})),1===e.nodeType&&("height"in t||"width"in t)&&(n.overflow=[p.overflow,p.overflowX,p.overflowY],"inline"===x.css(e,"display")&&"none"===x.css(e,"float")&&(p.display="inline-block")),n.overflow&&(p.overflow="hidden",l.always(function(){p.overflow=n.overflow[0],p.overflowX=n.overflow[1],p.overflowY=n.overflow[2]}));for(r in t)if(i=t[r],wn.exec(i)){if(delete t[r],o=o||"toggle"===i,i===(f?"hide":"show")){if("show"!==i||!h||h[r]===undefined)continue;f=!0}c[r]=h&&h[r]||x.style(e,r)}if(!x.isEmptyObject(c)){h?"hidden"in h&&(f=h.hidden):h=q.access(e,"fxshow",{}),o&&(h.hidden=!f),f?x(e).show():l.done(function(){x(e).hide()}),l.done(function(){var t;q.remove(e,"fxshow");for(t in c)x.style(e,t,c[t])});for(r in c)s=Sn(f?h[r]:0,r,l),r in h||(h[r]=s.start,f&&(s.end=s.start,s.start="width"===r||"height"===r?1:0))}}function Ln(e,t,n,r,i){return new Ln.prototype.init(e,t,n,r,i)}x.Tween=Ln,Ln.prototype={constructor:Ln,init:function(e,t,n,r,i,o){this.elem=e,this.prop=n,this.easing=i||"swing",this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=o||(x.cssNumber[n]?"":"px")},cur:function(){var e=Ln.propHooks[this.prop];return e&&e.get?e.get(this):Ln.propHooks._default.get(this)},run:function(e){var t,n=Ln.propHooks[this.prop];return this.pos=t=this.options.duration?x.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):Ln.propHooks._default.set(this),this}},Ln.prototype.init.prototype=Ln.prototype,Ln.propHooks={_default:{get:function(e){var t;return null==e.elem[e.prop]||e.elem.style&&null!=e.elem.style[e.prop]?(t=x.css(e.elem,e.prop,""),t&&"auto"!==t?t:0):e.elem[e.prop]},set:function(e){x.fx.step[e.prop]?x.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[x.cssProps[e.prop]]||x.cssHooks[e.prop])?x.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},Ln.propHooks.scrollTop=Ln.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},x.each(["toggle","show","hide"],function(e,t){var n=x.fn[t];x.fn[t]=function(e,r,i){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(qn(t,!0),e,r,i)}}),x.fn.extend({fadeTo:function(e,t,n,r){return this.filter(Lt).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var i=x.isEmptyObject(e),o=x.speed(t,n,r),s=function(){var t=jn(this,x.extend({},e),o);(i||q.get(this,"finish"))&&t.stop(!0)};return s.finish=s,i||o.queue===!1?this.each(s):this.queue(o.queue,s)},stop:function(e,t,n){var r=function(e){var t=e.stop;delete e.stop,t(n)};return"string"!=typeof e&&(n=t,t=e,e=undefined),t&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,i=null!=e&&e+"queueHooks",o=x.timers,s=q.get(this);if(i)s[i]&&s[i].stop&&r(s[i]);else for(i in s)s[i]&&s[i].stop&&Cn.test(i)&&r(s[i]);for(i=o.length;i--;)o[i].elem!==this||null!=e&&o[i].queue!==e||(o[i].anim.stop(n),t=!1,o.splice(i,1));(t||!n)&&x.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,n=q.get(this),r=n[e+"queue"],i=n[e+"queueHooks"],o=x.timers,s=r?r.length:0;for(n.finish=!0,x.queue(this,e,[]),i&&i.stop&&i.stop.call(this,!0),t=o.length;t--;)o[t].elem===this&&o[t].queue===e&&(o[t].anim.stop(!0),o.splice(t,1));for(t=0;s>t;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete n.finish})}});function qn(e,t){var n,r={height:e},i=0;for(t=t?1:0;4>i;i+=2-t)n=jt[i],r["margin"+n]=r["padding"+n]=e;return t&&(r.opacity=r.width=e),r}x.each({slideDown:qn("show"),slideUp:qn("hide"),slideToggle:qn("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){x.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),x.speed=function(e,t,n){var r=e&&"object"==typeof e?x.extend({},e):{complete:n||!n&&t||x.isFunction(e)&&e,duration:e,easing:n&&t||t&&!x.isFunction(t)&&t};return r.duration=x.fx.off?0:"number"==typeof r.duration?r.duration:r.duration in x.fx.speeds?x.fx.speeds[r.duration]:x.fx.speeds._default,(null==r.queue||r.queue===!0)&&(r.queue="fx"),r.old=r.complete,r.complete=function(){x.isFunction(r.old)&&r.old.call(this),r.queue&&x.dequeue(this,r.queue)},r},x.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},x.timers=[],x.fx=Ln.prototype.init,x.fx.tick=function(){var e,t=x.timers,n=0;for(xn=x.now();t.length>n;n++)e=t[n],e()||t[n]!==e||t.splice(n--,1);t.length||x.fx.stop(),xn=undefined},x.fx.timer=function(e){e()&&x.timers.push(e)&&x.fx.start()},x.fx.interval=13,x.fx.start=function(){bn||(bn=setInterval(x.fx.tick,x.fx.interval))},x.fx.stop=function(){clearInterval(bn),bn=null},x.fx.speeds={slow:600,fast:200,_default:400},x.fx.step={},x.expr&&x.expr.filters&&(x.expr.filters.animated=function(e){return x.grep(x.timers,function(t){return e===t.elem}).length}),x.fn.offset=function(e){if(arguments.length)return e===undefined?this:this.each(function(t){x.offset.setOffset(this,e,t)});var t,n,i=this[0],o={top:0,left:0},s=i&&i.ownerDocument;if(s)return t=s.documentElement,x.contains(t,i)?(typeof i.getBoundingClientRect!==r&&(o=i.getBoundingClientRect()),n=Hn(s),{top:o.top+n.pageYOffset-t.clientTop,left:o.left+n.pageXOffset-t.clientLeft}):o},x.offset={setOffset:function(e,t,n){var r,i,o,s,a,u,l,c=x.css(e,"position"),p=x(e),f={};"static"===c&&(e.style.position="relative"),a=p.offset(),o=x.css(e,"top"),u=x.css(e,"left"),l=("absolute"===c||"fixed"===c)&&(o+u).indexOf("auto")>-1,l?(r=p.position(),s=r.top,i=r.left):(s=parseFloat(o)||0,i=parseFloat(u)||0),x.isFunction(t)&&(t=t.call(e,n,a)),null!=t.top&&(f.top=t.top-a.top+s),null!=t.left&&(f.left=t.left-a.left+i),"using"in t?t.using.call(e,f):p.css(f)}},x.fn.extend({position:function(){if(this[0]){var e,t,n=this[0],r={top:0,left:0};return"fixed"===x.css(n,"position")?t=n.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),x.nodeName(e[0],"html")||(r=e.offset()),r.top+=x.css(e[0],"borderTopWidth",!0),r.left+=x.css(e[0],"borderLeftWidth",!0)),{top:t.top-r.top-x.css(n,"marginTop",!0),left:t.left-r.left-x.css(n,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||s;while(e&&!x.nodeName(e,"html")&&"static"===x.css(e,"position"))e=e.offsetParent;return e||s})}}),x.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,n){var r="pageYOffset"===n;x.fn[t]=function(i){return x.access(this,function(t,i,o){var s=Hn(t);return o===undefined?s?s[n]:t[i]:(s?s.scrollTo(r?e.pageXOffset:o,r?o:e.pageYOffset):t[i]=o,undefined)},t,i,arguments.length,null)}});function Hn(e){return x.isWindow(e)?e:9===e.nodeType&&e.defaultView}x.each({Height:"height",Width:"width"},function(e,t){x.each({padding:"inner"+e,content:t,"":"outer"+e},function(n,r){x.fn[r]=function(r,i){var o=arguments.length&&(n||"boolean"!=typeof r),s=n||(r===!0||i===!0?"margin":"border");return x.access(this,function(t,n,r){var i;return x.isWindow(t)?t.document.documentElement["client"+e]:9===t.nodeType?(i=t.documentElement,Math.max(t.body["scroll"+e],i["scroll"+e],t.body["offset"+e],i["offset"+e],i["client"+e])):r===undefined?x.css(t,n,s):x.style(t,n,r,s)},t,o?r:undefined,o,null)}})}),x.fn.size=function(){return this.length},x.fn.andSelf=x.fn.addBack,"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=x:"function"==typeof define&&define.amd&&define("jquery",[],function(){return x}),"object"==typeof e&&"object"==typeof e.document&&(e.jQuery=e.$=x)})(window);
</script>
<script type="text/javascript">
/*! jQuery throttle / debounce - v1.1 - 3/7/2010 [http://benalman.com/projects/jquery-throttle-debounce-plugin/] | (c) 2010 "Cowboy" Ben Alman | Dual licensed under the MIT and GPL licenses. [http://benalman.com/about/license/] */
(function(b,c){var $=b.jQuery||b.Cowboy||(b.Cowboy={}),a;$.throttle=a=function(e,f,j,i){var h,d=0;if(typeof f!=="boolean"){i=j;j=f;f=c}function g(){var o=this,m=+new Date()-d,n=arguments;function l(){d=+new Date();j.apply(o,n)}function k(){h=c}if(i&&!h){l()}h&&clearTimeout(h);if(i===c&&m>e){l()}else{if(f!==true){h=setTimeout(i?k:l,i===c?e-m:e)}}}if($.guid){g.guid=j.guid=j.guid||$.guid++}return g};$.debounce=function(d,e,f){return f===c?a(d,e,false):a(d,f,e!==false)}})(this);
</script>
<script type="text/javascript">
/*
Portions of this code are based on:
____

TiddlyWiki 1.2.39 by Jeremy Ruston, (jeremy [at] osmosoft [dot] com)

Published under a BSD open source license

Copyright (c) Osmosoft Limited 2005

Redistribution and use in source and binary forms, with or without modification,
are permitted provided that the following conditions are met:

Redistributions of source code must retain the above copyright notice, this list
of conditions and the following disclaimer.

Redistributions in binary form must reproduce the above copyright notice, this
list of conditions and the following disclaimer in the documentation and/or
other materials provided with the distribution.

Neither the name of the Osmosoft Limited nor the names of its contributors may
be used to endorse or promote products derived from this software without
specific prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR
ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/
(function(){
"use strict";
"undefined"===typeof document||"classList"in document.createElement("a")||function(a){if("HTMLElement"in a||"Element"in a){a=(a.HTMLElement||a.Element).prototype;var b=Object,c=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")},d=Array.prototype.indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1},e=function(a,b){this.name=a;this.code=DOMException[a];this.message=b},f=function(a,b){if(""===b)throw new e("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(b))throw new e("INVALID_CHARACTER_ERR","String contains an invalid character");return d.call(a,b)},g=function(a){for(var b=c.call(a.className),b=b?b.split(/\s+/):[],d=0,e=b.length;d<e;d++)this.push(b[d]);this._updateClassName=function(){a.className=this.toString()}},h=g.prototype=[],k=function(){return new g(this)};e.prototype=Error.prototype;h.item=function(a){return this[a]||null};h.contains=function(a){return-1!==f(this,a+"")};h.add=function(){var a=arguments,b=0,c=a.length,d,e=!1;do d=a[b]+"",-1===f(this,d)&&(this.push(d),e=!0);while(++b<c);e&&this._updateClassName()};h.remove=function(){var a=arguments,b=0,c=a.length,d,e=!1;do d=a[b]+"",d=f(this,d),-1!==d&&(this.splice(d,1),e=!0);while(++b<c);e&&this._updateClassName()};h.toggle=function(a,b){a+="";var c=this.contains(a),d=c?!0!==b&&"remove":!1!==b&&"add";if(d)this[d](a);return!c};h.toString=function(){return this.join(" ")};if(b.defineProperty){h={get:k,enumerable:!0,configurable:!0};try{b.defineProperty(a,"classList",h)}catch(m){-2146823252===m.number&&(h.enumerable=!1,b.defineProperty(a,"classList",h))}}else b.prototype.__defineGetter__&&a.__defineGetter__("classList",k)}}(window);(function(a){if(!("onhashchange"in a)){var b=a.location,c=b.href,d=b.hash;setInterval(function(){var e=b.href,f=b.hash;"function"===typeof a.onhashchange&&f!==d&&(a.onhashchange({type:"hashchange",oldURL:c,newURL:e}),c=e,d=f)},200)}})(window);Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){if(null==this)throw new TypeError;b||(b=0);for(var c=b,d=this.length;c<d;c++)if(this[c]===a)return c;return-1});Array.prototype.filter||(Array.prototype.filter=function(a,b){if(null==this||"function"!==typeof a)throw new TypeError;for(var c=Object(this),d=c.length>>>0,e=[],f=0;f<d;f++)if(f in c){var g=c[f];a.call(b,g,f,c)&&e.push(g)}return e});Array.prototype.map||(Array.prototype.map=function(a,b){if(null==this||"function"!==typeof a)throw new TypeError;for(var c=Object(this),d=c.length>>>0,e=Array(d),f=0;f<d;f++)f in c&&(e[f]=a.call(b,c[f],f,c));return e});Array.prototype.some||(Array.prototype.some=function(a,b){if(null==this||"function"!==typeof a)throw new TypeError;for(var c=Object(this),d=c.length>>>0,e=0;e<d;e++)if(e in c&&a.call(b,c[e],e,c))return!0;return!1});Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)});String.prototype.splice||(String.prototype.splice=function(a,b,c){if(null==this)throw new TypeError;if(0===this.length)return"";if("undefined"===typeof a)a=0;else if(a>=this.length)return this;"undefined"===typeof b?b=0:0>b&&(b=Math.abs(b));var d=this.slice(0,a);"undefined"!==typeof c&&(d+=c);if(0<=a||0>a+b)d+=this.slice(a+b);return d});String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});String.prototype.ltrim||(String.prototype.ltrim=function(){return this.replace(/^\s+/,"")});String.prototype.rtrim||(String.prototype.rtrim=function(){return this.replace(/\s+$/,"")});Object.create||(Object.create=function(){function a(){}return function(b){if(1!==arguments.length)throw Error("Object.create (polyfill) implementation only accepts one parameter.");a.prototype=b;return new a}}());var saveAs=saveAs||navigator.msSaveBlob&&navigator.msSaveBlob.bind(navigator)||function(a){var b=a.document,c=a.URL||a.webkitURL||a,d=b.createElementNS("http://www.w3.org/1999/xhtml","a"),e="download"in d,f=function(c){var d=b.createEvent("MouseEvents");d.initMouseEvent("click",!0,!1,a,0,0,0,0,0,!1,!1,!1,!1,0,null);c.dispatchEvent(d)},g=a.webkitRequestFileSystem,h=a.requestFileSystem||g||a.mozRequestFileSystem,k=function(b){(a.setImmediate||a.setTimeout)(function(){throw b;},0)},m=0,q=[],r=function(a,b,c){b=[].concat(b);for(var d=b.length;d--;){var e=a["on"+b[d]];if("function"===typeof e)try{e.call(a,c||a)}catch(f){k(f)}}},s=function(b,c){var k=this,n=b.type,s=!1,v,x,y=function(){var c=(a.URL||a.webkitURL||a).createObjectURL(b);q.push(c);return c},z=function(){r(k,["writestart","progress","write","writeend"])},u=function(){if(s||!v)v=y(b);x?x.location.href=v:window.open(v,"_blank");k.readyState=k.DONE;z()},w=function(a){return function(){if(k.readyState!==k.DONE)return a.apply(this,arguments)}},A={create:!0,exclusive:!1},B;k.readyState=k.INIT;c||(c="download");if(e)v=y(b),d.href=v,d.download=c,f(d),k.readyState=k.DONE,z();else{a.chrome&&(n&&"application/octet-stream"!==n)&&(B=b.slice||b.webkitSlice,b=B.call(b,0,b.size,"application/octet-stream"),s=!0);g&&"download"!==c&&(c+=".download");if("application/octet-stream"===n||g)x=a;h?(m+=b.size,h(a.TEMPORARY,m,w(function(a){a.root.getDirectory("saved",A,w(function(a){var d=function(){a.getFile(c,A,w(function(a){a.createWriter(w(function(c){c.onwriteend=function(b){x.location.href=a.toURL();q.push(a);k.readyState=k.DONE;r(k,"writeend",b)};c.onerror=function(){var a=c.error;a.code!==a.ABORT_ERR&&u()};["writestart","progress","write","abort"].forEach(function(a){c["on"+a]=k["on"+a]});c.write(b);k.abort=function(){c.abort();k.readyState=k.DONE};k.readyState=k.WRITING}),u)}),u)};a.getFile(c,{create:!1},w(function(a){a.remove();d()}),w(function(a){a.code===a.NOT_FOUND_ERR?d():u()}))}),u)}),u)):u()}},n=s.prototype;n.abort=function(){this.readyState=this.DONE;r(this,"abort")};n.readyState=n.INIT=0;n.WRITING=1;n.DONE=2;n.error=n.onwritestart=n.onprogress=n.onwrite=n.onabort=n.onerror=n.onwriteend=null;a.addEventListener("unload",function(){for(var a=q.length;a--;){var b=q[a];"string"===typeof b?c.revokeObjectURL(b):b.remove()}q.length=0},!1);return function(a,b){return new s(a,b)}}(self);Array.random=function(a,b,c){return Array.isArray(a)?a.random(b,c):void 0};Array.prototype.random=function(a,b){null==a?a=0:0>a?a=0:a>=this.length&&(a=this.length-1);null==b?b=this.length-1:0>b?b=0:b>=this.length&&(b=this.length-1);return this[random(a,b)]};Math.clamp=function(a,b,c){a=Number(a);return isNaN(a)?NaN:a.clamp(b,c)};Number.prototype.clamp=function(a,b){var c=Number(this);c<a&&(c=a);c>b&&(c=b);return c};Math.easeInOut=function(a){return 1-(Math.cos(a*Math.PI)+1)/2};String.prototype.readBracketedList=function(){var a=/(?:\[\[((?:\s|\S)*?)\]\])|([^"'\s]\S*)/gm,b=[];do{var c=a.exec(this);c&&(c[1]?b.push(c[1]):c[2]&&b.push(c[2]))}while(c);return b};function isNumeric(a){return"number"===typeof a||!isNaN(parseFloat(a))&&isFinite(a)}function isBoolean(a){return"boolean"===typeof a||"string"===typeof a&&("true"===a||"false"===a)}function clone(a,b){if(null===a||"object"!==typeof a)return a;if("function"===typeof a.clone)return a.clone(!0);if(a instanceof Date)return new Date(a.getTime());if(a instanceof RegExp)return RegExp(a);if(a.nodeType&&"function"===typeof a.cloneNode)return a.cloneNode(!0);var c;if(Array.isArray(a))if(c=[],b)for(var d=0;d<a.length;d++)c.push(clone(a[d],!0));else for(d=0;d<a.length;d++)c.push(a[d]);else if(c=Object.getPrototypeOf?Object.getPrototypeOf(a):a.__proto__,c||(c=a.constructor.prototype),c=Object.create(c),b)for(d in a)c[d]=clone(a[d],!0);else for(d in a)c[d]=a[d];return c}function deepCopy(a){return clone(a,!0)}function insertElement(a,b,c,d,e){b=document.createElement(b);c&&(b.id=c);d&&(b.className=d);e&&insertText(b,e);a&&a.appendChild(b);return b}function insertPassageLink(a,b,c,d){var e=document.createElement("a");"undefined"!==typeof b&&(e.setAttribute("data-passage",b),e.className=tale.has(b)?"link-internal":"link-broken");d&&(e.className+=" "+d);c&&insertText(e,c);a&&a.appendChild(e);return e}function insertText(a,b){return a.appendChild(document.createTextNode(b))}function removeChildren(a){if(a)for(;a.hasChildNodes();)a.removeChild(a.firstChild)}function setPageElement(a,b,c){if(a="object"===typeof a?a:document.getElementById(a))removeChildren(a),tale.has(b)?new Wikifier(a,tale.get(b).text):null!=c&&""!==c&&new Wikifier(a,c);return a}function addStyle(a){var b=document.createElement("style");b.type="text/css";var c=RegExp(formatter.byName.image.lookaheadRegExp.source,"gm"),d=RegExp(Wikifier.textPrimitives.imagePattern);c.test(a)&&(a=a.replace(c,function(a){var b=d.exec(a);return null!==b?(a=b[4],"data:"!==a.slice(0,5)&&tale.has(a)&&(b=tale.get(a),-1!==b.tags.indexOf("Twine.image")&&(a=b.text)),"url("+a+")"):a}));b.styleSheet?b.styleSheet.cssText=a:b.appendChild(document.createTextNode(a));document.head.appendChild(b)}function throwError(a,b){insertElement(a,"span",null,"error","Error: "+b);return!1}function fade(a,b){function c(a,b){var c=Math.floor(100*b);a.style.zoom=1;a.style.filter="alpha(opacity="+c+")";a.style.opacity=b}var d,e=a.cloneNode(!0),f="in"==b.fade?1:-1,g;a.parentNode.replaceChild(e,a);"in"==b.fade?(d=0,e.style.visibility="visible"):d=1;c(e,d);g=window.setInterval(function(){d+=0.05*f;c(e,Math.easeInOut(d));if(1==f&&1<=d||-1==f&&0>=d)if(a.style.visibility="in"==b.fade?"visible":"hidden",e.parentNode.replaceChild(a,e),e=null,window.clearInterval(g),b.onComplete)b.onComplete()},25)}function scrollWindowTo(a){var b=window.scrollY?window.scrollY:document.body.scrollTop;a=function(a){var b;b=a;for(var c=0;b.offsetParent;)c+=b.offsetTop,b=b.offsetParent;b=c;var c=b+a.offsetHeight,d=window.scrollY?window.scrollY:document.body.scrollTop,e=window.innerHeight?window.innerHeight:document.body.clientHeight;return b<d?b:c>d+e?a.offsetHeight<e?b-(e-a.offsetHeight)+20:b:b}(a);var c=Math.abs(b-a),d=0,e=b>a?-1:1,f=window.setInterval(function(){d+=0.1;window.scrollTo(0,b+e*c*Math.easeInOut(d));1<=d&&window.clearInterval(f)},25)}function slugify(a){return a.trim().replace(/[^\w\s\u2013\u2014-]+/g,"").replace(/[_\s\u2013\u2014-]+/g,"-").toLocaleLowerCase()}function utf8ToBase64(a){return window.btoa(unescape(encodeURIComponent(a)))}function base64ToUtf8(a){return decodeURIComponent(escape(window.atob(a)))}function generateUuid(){var a=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var c=(a+16*Math.random())%16|0;a=Math.floor(a/16);return("x"===b?c:c&7|8).toString(16)})}function getRandom(){return random.apply(null,arguments)}function random(a,b){if(0===arguments.length)throw Error("random(): insufficient arguments");1===arguments.length&&(b=a,a=0);if(a>b){var c=b;b=a;a=c}return Math.floor(Math.random()*(b-a+1))+a}function getRandomArbitrary(){return randomFloat.apply(null,arguments)}function randomFloat(a,b){if(0===arguments.length)throw Error("randomFloat(): insufficient arguments");1===arguments.length&&(b=a,a=0);if(a>b){var c=b;b=a;a=c}return Math.random()*(b-a)+a}function visited(a){a||(a=state.top.title);for(var b=0,c=0;c<state.history.length;c++)state.history[c].title===a&&b++;return b}function KeyValueStore(a,b){this.store=null;switch(a){case "cookie":this.name="cookie";break;case "localStorage":this.name=a;config.hasLocalStorage&&(this.store=window.localStorage);break;case "sessionStorage":this.name=a;config.hasSessionStorage&&(this.store=window.sessionStorage);break;default:throw Error("Unknown storage type.");}this.prefix=b+"."}KeyValueStore.prototype.setItem=function(a,b){if(!a)return!1;var c=a;a=this.prefix+a;b=JSON.stringify(b);if(this.store)try{this.store.setItem(a,b)}catch(d){return d==QUOTA_EXCEEDED_ERR&&window.alert("Unable to store key; "+this.name+" quota exceeded"),!1}else{var e=[escape(a)+"="+escape(b)];switch(this.name){case "cookie":case "localStorage":e.push("expires=Tue, 19 Jan 2038 03:14:07 GMT")}e.push("path=/");try{document.cookie=e.join("; ")}catch(f){return window.alert("Unable to store key; cookie error: "+f.message),!1}if(!this.hasItem(c))return window.alert("Unable to store key; unknown cookie error"),!1}return!0};KeyValueStore.prototype.getItem=function(a){if(!a)return null;a=this.prefix+a;if(this.store){if(this.store.getItem(a))return JSON.parse(this.store.getItem(a))}else{a=escape(a);for(var b=document.cookie.split(";"),c=0;c<b.length;c++){var d=b[c].split("=");if(d[0].trim()===a)return JSON.parse(unescape(d[1]))}}return null};KeyValueStore.prototype.removeItem=function(a){if(!a)return!1;a=this.prefix+a;this.store?this.store.removeItem(a):document.cookie=escape(a)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/";return!0};KeyValueStore.prototype.removeMatchingItems=function(a){if(!a)return!1;var b=[],c=RegExp(("^"+this.prefix+a).replace(/\./g,"\\.")+".*");if(this.store)for(a=0;a<this.store.length;a++){var d=this.store.key(a);c.test(d)&&b.push(d)}else{escape(a);var e=document.cookie.split(";");for(a=0;a<e.length;a++)d=e[a].split("=")[0].trim(),c.test(d)&&b.push(d)}for(a=0;a<b.length;a++)this.removeItem(b[a]);return!0};KeyValueStore.prototype.hasItem=function(a){if(!a)return!1;a=this.prefix+a;if(this.store){if(this.store.getItem(a))return!0}else{a=escape(a);for(var b=document.cookie.split(";"),c=0;c<b.length;c++)if(b[c].split("=")[0].trim()==a)return!0}return!1};var version={title:"SugarCube",major:1,minor:0,revision:0,build:2850,date:new Date("Fri, 10 Jan 2014"),extensions:{},toString:function(){return this.title+" "+this.major+"."+this.minor+"."+this.revision+"."+this.build+" ("+this.date.toLocaleDateString()+")"}},modes={hashTag:1,windowHistory:2,sessionHistory:3},config={hasPushState:"history"in window&&"pushState"in window.history,hasLocalStorage:"localStorage"in window&&function(){try{return null!=window.localStorage&&0<=window.localStorage.length}catch(a){return!1}}(),hasSessionStorage:"sessionStorage"in window&&function(){try{return null!=window.sessionStorage&&0<=window.sessionStorage.length}catch(a){return!1}}(),hasFileAPI:window.File&&window.FileReader&&window.Blob,userAgent:navigator.userAgent.toLowerCase(),browser:{},displayPassageTitles:!1,loadDelay:0,disableHistoryControls:!1,disableHistoryTracking:!1,historyMode:modes.hashTag,saves:{autosave:void 0,id:"untitled-story",isAllowed:void 0,onLoad:void 0,onSave:void 0,slots:8},errors:{savesNotAllowed:"Saving has been disallowed on this passage."}};config.browser={isGecko:navigator&&"Gecko"===navigator.product&&-1===config.userAgent.search(/webkit|trident/),isIE:-1!==config.userAgent.search(/msie|trident/)&&-1===config.userAgent.indexOf("opera"),ieVersion:function(){var a=/(?:msie\s+|rv:)(\d{1,2}\.\d)/.exec(config.userAgent);return a?+a[1]:0}(),isOpera:-1!==config.userAgent.indexOf("opera")||-1!==config.userAgent.indexOf(" opr/"),operaVersion:function(){var a=RegExp((/applewebkit|chrome/.test(config.userAgent)?"opr":"version")+"\\/(\\d{1,2}\\.\\d+)").exec(config.userAgent);return a?+a[1]:0}()};config.historyMode=config.hasPushState?config.browser.isGecko?modes.sessionHistory:modes.windowHistory:modes.hashTag;config.transitionEndEventName=function(){var a={transition:"transitionend",MSTransition:"msTransitionEnd",WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend"},b=document.createElement("div"),c;for(c in a)if(void 0!==b.style[c])return a[c];return""}();var formatter=null,macros={},tale={},state={},storage={},session={},options={},setup={},testPlay,prerender={},postrender={};$(document).ready(function(){if(document.head&&document.querySelector&&window.JSON){formatter=new WikiFormatter(Wikifier.formatters);macros=new Macros;tale=new Tale;state=new History;addStandardMacros();var a=setPageElement("story-title","StoryTitle",tale.title);a.textContent!==tale.title&&tale.setTitle(a.textContent);document.title=tale.title;storage=new KeyValueStore("localStorage",tale.domId);session=new KeyValueStore("sessionStorage",tale.domId);config.saves.id=tale.domId;setPageElement("story-banner","StoryBanner");setPageElement("story-subtitle","StorySubtitle");setPageElement("story-author","StoryAuthor");tale.has("StoryCaption")&&(document.getElementById("story-caption").style.display="block",setPageElement("story-caption","StoryCaption"));tale.has("StoryMenu")?(document.getElementById("menu-story").style.display="block",setPageElement("menu-story","StoryMenu")):tale.has("MenuStory")&&(document.getElementById("menu-story").style.display="block",setPageElement("menu-story","MenuStory"));for(var b=tale.lookup("tags","stylesheet"),a=0;a<b.length;a++)addStyle(b[a].text);b=tale.lookup("tags","script");for(a=0;a<b.length;a++)try{eval(b[a].text)}catch(c){var d=c.message;if("TypeError"===c.name&&/read[\s-]only/.test(c.message)){var e=/([\"\'])([^\1]+)\1/.exec(c.message);e&&e[2]&&macros.has(e[2])&&(d="cannot clobber protected macro <<"+e[2]+">>")}window.alert("There is a technical problem with this story ("+b[a].title+": "+d+"). You may be able to continue reading, but all parts of the story may not work properly.")}b=tale.lookup("tags","widget");for(a=0;a<b.length;a++)try{Wikifier.wikifyEval(b[a].text)}catch(f){window.alert("There is a technical problem with this story ("+b[a].title+": "+f.message+"). You may be able to continue reading, but all parts of the story may not work properly.")}SaveSystem.init();UISystem.init();macros.init();if(tale.has("StoryInit"))try{Wikifier.wikifyEval(tale.get("StoryInit").text)}catch(g){window.alert("There is a technical problem with this story (StoryInit: "+g.message+"). You may be able to continue reading, but all parts of the story may not work properly.")}config.disableHistoryTracking&&(config.disableHistoryControls=!0);state.init();macros.lateInit();window.SugarCube={macros:macros,tale:tale,state:state,storage:storage,session:session}}else $(document.documentElement).removeClass("loading"),$("#passages").children().replace("<b>Apologies.  This story requires a less obsolescent web browser.</b>")});var SaveSystem={_bad:!1,_max:-1,init:function(){function a(a,b){for(var e=0;e<b;e++)a.push(null);return a}0>config.saves.slots&&(config.saves.slots=0);if(null===storage.store)return!1;storage.hasItem("saves")||storage.setItem("saves",{autosave:null,slots:a([],config.saves.slots)});var b=storage.getItem("saves");if(null===b)return SaveSystem._bad=!0,!1;Array.isArray(b)&&(b={autosave:null,slots:b},storage.setItem("saves",b));config.saves.slots!==b.slots.length&&(config.saves.slots<b.slots.length?(b.slots.reverse(),b.slots=b.slots.filter(function(a,b,e){return null===a&&0<this.count?(this.count--,!1):!0},{count:b.slots.length-config.saves.slots}),b.slots.reverse()):config.saves.slots>b.slots.length&&a(b.slots,config.saves.slots-b.slots.length),storage.setItem("saves",b));SaveSystem._max=b.slots.length-1;return!0},OK:function(){return SaveSystem.autosaveOK()||SaveSystem.slotsOK()},autosaveOK:function(){return!SaveSystem._bad&&"undefined"!==typeof config.saves.autosave},slotsOK:function(){return!SaveSystem._bad&&-1!==SaveSystem._max},saveAuto:function(a){if("function"===typeof config.saves.isAllowed&&!config.saves.isAllowed())return!1;var b=storage.getItem("saves");if(null===b)return!1;b.autosave=SaveSystem.marshal();b.autosave.title=a||tale.get(state.active.title).excerpt();b.autosave.date=Date.now();return storage.setItem("saves",b)},loadAuto:function(){var a=storage.getItem("saves");return null===a||null===a.autosave?!1:SaveSystem.unmarshal(a.autosave)},deleteAuto:function(){var a=storage.getItem("saves");if(null===a)return!1;a.autosave=null;return storage.setItem("saves",a)},save:function(a,b){if("function"===typeof config.saves.isAllowed&&!config.saves.isAllowed())return window.alert(config.errors.savesNotAllowed),!1;if(0>a||a>SaveSystem._max)return!1;var c=storage.getItem("saves");if(null===c||a>c.slots.length)return!1;c.slots[a]=SaveSystem.marshal();c.slots[a].title=b||tale.get(state.active.title).excerpt();c.slots[a].date=Date.now();return storage.setItem("saves",c)},load:function(a){if(0>a||a>SaveSystem._max)return!1;var b=storage.getItem("saves");return null===b||a>b.slots.length||null===b.slots[a]?!1:SaveSystem.unmarshal(b.slots[a])},"delete":function(a){if(0>a||a>SaveSystem._max)return!1;var b=storage.getItem("saves");if(null===b||a>b.slots.length)return!1;b.slots[a]=null;return storage.setItem("saves",b)},purge:function(){storage.removeItem("saves");return SaveSystem.init()},exportSave:function(){if("function"!==typeof config.saves.isAllowed||config.saves.isAllowed()){var a=tale.domId+".json",b=JSON.stringify(SaveSystem.marshal());saveAs(new Blob([b],{type:"application/json;charset=UTF-8"}),a)}else window.alert(config.errors.savesNotAllowed)},importSave:function(a){a=a.target.files[0];var b=new FileReader;$(b).load(function(a){return function(a){if(a.target.result){var b;try{b=JSON.parse(a.target.result)}catch(c){}SaveSystem.unmarshal(b)}}}(a));b.readAsText(a)},marshal:function(){var a={mode:config.historyMode,id:config.saves.id};config.saves.version&&(a.version=config.saves.version);switch(config.historyMode){case modes.windowHistory:a.data=clone(state.history,!0);break;case modes.sessionHistory:a.data=clone(state.history.slice(0,state.active.sidx+1),!0);break;case modes.hashTag:a.data=state.active.hash}if("function"===typeof config.saves.onSave)config.saves.onSave(a);return a},unmarshal:function(a){if(!(a&&a.hasOwnProperty("mode")&&a.hasOwnProperty("id")&&a.hasOwnProperty("data")))return window.alert("Save is missing the required game data.  Either you've loaded a file which isn't a save, or the save has become corrupted.\n\nAborting load."),!1;if(a.mode!==config.historyMode)return window.alert("Save is from the wrong history mode.\n\nAborting load."),!1;if("function"===typeof config.saves.onLoad){var b=config.saves.onLoad(a);if(b)return window.alert(b+"\n\nAborting load."),!1}if(a.id!==config.saves.id)return window.alert("Save is from the wrong story.\n\nAborting load."),!1;switch(config.historyMode){case modes.windowHistory:case modes.sessionHistory:document.title=tale.title;state=new History;config.historyMode===modes.sessionHistory&&state.regenerateSuid();for(var b=0,c=a.data.length;b<c;b++)state.history.push(clone(a.data[b],!0)),config.disableHistoryControls||(config.historyMode===modes.windowHistory?window.history.pushState(state.history,document.title):window.history.pushState({sidx:state.history[b].sidx,suid:state.suid},document.title));state.activate(state.top);state.display(state.active.title,null,"back");break;case modes.hashTag:config.disableHistoryControls?(session.setItem("activeHash",a.data),window.location.reload()):window.location.hash=a.data}return!0}},UISystem={init:function(){var a=$(document.documentElement),b;insertElement(document.body,"div","ui-overlay");insertElement(document.body,"div","ui-body");UISystem.addClickHandler("#menu-saves",null,function(){UISystem.buildSaves()});b=$("#menu-rewind");!config.disableHistoryTracking&&0<tale.lookup("tags","bookmark").length?(b.css({display:"block"}),UISystem.addClickHandler(b.find("a"),null,function(){UISystem.buildRewind()})):b.remove();UISystem.addClickHandler("#menu-restart",null,function(){UISystem.buildRestart()});b=$("#menu-options");tale.has("MenuOptions")&&""!==tale.get("MenuOptions").text.trim()?(b.css({display:"block"}),UISystem.addClickHandler(b.find("a"),null,function(){UISystem.buildOptions()})):b.remove();b=$("#menu-share");tale.has("MenuShare")&&""!==tale.get("MenuShare").text.trim()?(b.css({display:"block"}),UISystem.addClickHandler(b.find("a"),null,function(){UISystem.buildShare()})):b.remove();"complete"===document.readyState&&a.removeClass("loading");document.addEventListener("readystatechange",function(){"complete"===document.readyState?0<config.loadDelay?setTimeout(function(){a.removeClass("loading")},config.loadDelay):a.removeClass("loading"):a.addClass("loading")},!1)},buildSaves:function(){function a(a,b,c){var d=document.createElement("li"),e=document.createElement("button");e.id="saves-"+a;"import"!==a&&e.classList.add("ui-close");e.innerHTML=b;$(e).click(c);d.appendChild(e);return d}function b(){function a(b,c,d,e){var f=document.createElement("button");f.id="saves-"+b+"-"+d;f.classList.add(b);f.classList.add("ui-close");f.innerHTML=c;$(f).click(function(a){return function(){e(a)}}(d));return f}var b=storage.getItem("saves");if(null===b)return!1;var c=document.createElement("tbody"),d,e,f,g,t,l;SaveSystem.autosaveOK()&&(d=document.createElement("tr"),e=document.createElement("td"),f=document.createElement("td"),g=document.createElement("td"),t=document.createElement("td"),l=document.createElement("b"),l.innerHTML="A",e.appendChild(l),b.autosave&&b.autosave.mode===config.historyMode?(l=document.createElement("button"),l.id="saves-load-autosave",l.classList.add("load"),l.classList.add("ui-close"),l.innerHTML="Load",$(l).click(SaveSystem.loadAuto),f.appendChild(l),l=document.createTextNode(b.autosave.title),g.appendChild(l),g.appendChild(document.createElement("br")),l=document.createElement("small"),l.innerHTML="Autosaved ("+(new Date(b.autosave.date)).toLocaleString()+")",g.appendChild(l),l=document.createElement("button"),l.id="saves-delete-autosave",l.classList.add("delete"),l.classList.add("ui-close"),l.innerHTML="Delete",$(l).click(SaveSystem.deleteAuto),t.appendChild(l)):(l=document.createElement("i"),l.innerHTML="(autosave slot empty)",g.appendChild(l),g.classList.add("empty")),d.appendChild(e),d.appendChild(f),d.appendChild(g),d.appendChild(t),c.appendChild(d));for(var p=0;p<b.slots.length;p++)d=document.createElement("tr"),e=document.createElement("td"),f=document.createElement("td"),g=document.createElement("td"),t=document.createElement("td"),e.appendChild(document.createTextNode(p+1)),b.slots[p]&&b.slots[p].mode===config.historyMode?(l=a("load","Load",p,SaveSystem.load),f.appendChild(l),l=document.createTextNode(b.slots[p].title),g.appendChild(l),g.appendChild(document.createElement("br")),l=document.createElement("small"),l.innerHTML=b.slots[p].date?"Saved ("+(new Date(b.slots[p].date)).toLocaleString()+")":"Saved (<i>unknown</i>)",g.appendChild(l),l=a("delete","Delete",p,SaveSystem.delete),t.appendChild(l)):(l=a("save","Save",p,SaveSystem.save),f.appendChild(l),l=document.createElement("i"),l.innerHTML="(save slot empty)",g.appendChild(l),g.classList.add("empty")),d.appendChild(e),d.appendChild(f),d.appendChild(g),d.appendChild(t),c.appendChild(d);b=document.createElement("table");b.id="saves-list";b.appendChild(c);return b}function c(){var a=document.createElement("div"),b=document.createElement("div"),c=document.createElement("input");b.id="saves-import-label";b.appendChild(document.createTextNode("Select a save file to load:"));a.appendChild(b);c.type="file";c.id="saves-import-file";c.name="saves-import-file";$(c).change(function(a){SaveSystem.importSave(a);UISystem.close()});a.appendChild(c);return a}var d=document.getElementById("ui-body"),e,f,g=SaveSystem.OK();$(d).empty().addClass("saves");g&&(e=b(),e||(e=document.createElement("div"),e.id="saves-list",e.innerHTML="<i>No save slots found</i>"),d.appendChild(e));if(g||config.hasFileAPI&&(!config.browser.isOpera||15<=config.browser.operaVersion))return f=document.createElement("div"),e=document.createElement("ul"),config.hasFileAPI&&(!config.browser.isOpera||15<=config.browser.operaVersion)&&(e.appendChild(a("export","Save to Disk\u2026",SaveSystem.exportSave)),e.appendChild(a("import","Load from Disk\u2026",function(a){document.getElementById("saves-import-file")||d.appendChild(c())}))),g&&e.appendChild(a("purge","Purge Save Slots",SaveSystem.purge)),f.appendChild(e),d.appendChild(f),!0;window.alert("Apologies!  Your browser either has none of the features required to support saves or has disabled them.\n\nThe former may be solved by updating it to a more recent version or by switching to a more modern browser.\n\nThe latter may be solved by loosening its security restrictions or, perhaps, by viewing the story via the HTTP protocol.");return!1},buildRewind:function(){var a=document.getElementById("ui-body"),b=!1;$(a).empty().addClass("rewind");for(var c=0,d=state.history.length-1;c<d;c++){var e=tale.get(state.history[c].title);e&&-1!==e.tags.indexOf("bookmark")&&(b=document.createElement("div"),b.classList.add("ui-close"),$(b).click(function(){var a=c;return config.historyMode===modes.windowHistory?function(){document.title=tale.title;if(!config.disableHistoryControls)for(var b=0;b<=a;b++)window.history.pushState(state.history.slice(0,b+1),document.title);state.pop(state.history.length-(a+1));state.activate(state.top);state.display(state.active.title,null,"back")}:config.historyMode===modes.sessionHistory?function(){document.title=tale.title;state.regenerateSuid();if(config.disableHistoryControls)window.history.replaceState({sidx:state.history[a].sidx,suid:state.suid},document.title);else for(var b=0;b<=a;b++)window.history.pushState({sidx:state.history[b].sidx,suid:state.suid},document.title);window.history.state.sidx<state.top.sidx&&state.pop(state.top.sidx-window.history.state.sidx);state.activate(state.top);state.display(state.active.title,null,"back")}:function(){config.disableHistoryControls?(session.setItem("activeHash",state.history[a].hash),window.location.reload()):window.location.hash=state.history[a].hash}}()),b.innerHTML=e.excerpt(),a.appendChild(b),b=!0)}b||(b=document.createElement("div"),b.innerHTML="<i>No passages available</i>",a.appendChild(b))},buildRestart:function(){var a=document.getElementById("ui-body");$(a).empty().addClass("restart").append('<p>Are you sure that you want to restart?  Unsaved progress will be lost.</p><ul><li><button id="restart-ok" class="ui-close">OK</button></li><li><button id="restart-cancel" class="ui-close">Cancel</button></li></ul></div>');$("#restart-ok").click(function(){state.restart()});return!0},buildOptions:function(){var a=document.getElementById("ui-body");$(a).empty().addClass("options");new Wikifier(a,tale.get("MenuOptions").text.trim());return!0},buildShare:function(){var a=document.getElementById("ui-body");$(a).empty().addClass("share");new Wikifier(a,tale.get("MenuShare").text.trim());a.innerHTML=a.innerHTML.replace(/(?:<br\s*\/?>)+/g,"\n");return!0},close:function(a){$(window).off("resize",UISystem.resizeHandler);$("#ui-body").css({display:"none",opacity:0,left:"",right:"",top:"",bottom:""}).removeClass().empty();$("#ui-overlay").fadeOut(200).add(".ui-close").off("click",UISystem.closeHandler);$(document.body).removeClass("ui-open");a&&"function"===typeof a.data&&a.data(a)},addClickHandler:function(a,b,c,d,e){b=$.extend({top:50,opacity:0.8},b);$(a).click(function(a){a.preventDefault();"function"===typeof c&&c(a);var g=$(window),h=$("#ui-overlay"),k=$("#ui-body");h.add(".ui-close").on("click",null,e,UISystem.close);$(document.body).addClass("ui-open");h.css({display:"block",opacity:0}).fadeTo(200,b.opacity);k.css($.extend({display:"block",opacity:0},UISystem.calcPositionalProperties(b.top))).fadeTo(200,1);"function"===typeof d&&d(a);g.on("resize",null,b.top,$.debounce(40,UISystem.resizeHandler))})},resizeHandler:function(a){$(window);var b=$("#ui-body");a=a&&"undefined"!==typeof a.data?a.data:50;"block"===b.css("display")&&(b.css({display:"none",left:"",right:"",top:"",bottom:""}),b.css($.extend({display:"block"},UISystem.calcPositionalProperties(a))))},calcPositionalProperties:function(a){"undefined"===typeof a&&(a=50);var b=$(window),c=$("#ui-body"),d={left:"",right:"",top:"",bottom:""},e=b.width()-c.outerWidth(!0),b=b.height()-c.outerHeight(!0);d.left=20>=e?d.right="10px":d.right=~~(e/2)+"px";d.top=20>=b?d.bottom="10px":b/2>a?a+"px":d.bottom=~~(b/2)+"px";return d}};function History(){this.active={init:!0,variables:{}};this.history=[]}History.prototype={get top(){return 0!==this.history.length?this.history[this.history.length-1]:null},get bottom(){return 0!==this.history.length?this.history[0]:null},get isEmpty(){return 0===this.history.length},get length(){return this.history.length}};History.prototype.index=function(a){return 0===this.history.length||0>a||a>=this.history.length?null:this.history[a]};History.prototype.peek=function(a){if(0===this.history.length)return null;a=1+(a?Math.abs(a):0);return a>this.history.length?null:this.history[this.history.length-a]};History.prototype.push=function(){if(0!==arguments.length){for(var a=0;a<arguments.length;a++){var b=arguments[a];config.historyMode===modes.sessionHistory&&(b.sidx=this.history.length);this.history.push(b)}return this.history.length}};History.prototype.pop=function(a){if(0===this.history.length)return[];a=a?Math.abs(a):1;return 1==a?this.history.pop():this.history.splice(this.history.length-a,a)};History.prototype.activate=function(a){if(0!==arguments.length){if("object"===typeof a){if(null===a)return null;this.active=clone(a,!0)}else{if(0===this.history.length||0>a||a>=this.history.length)return null;this.active=clone(this.history[a],!0)}return this.active}};History.prototype.init=function(){"undefined"!==typeof testPlay?this.display(testPlay):this.restore()||this.display("Start");config.historyMode===modes.windowHistory?window.addEventListener("popstate",History.popStateHandler_windowHistory,!1):config.historyMode===modes.sessionHistory?window.addEventListener("popstate",History.popStateHandler_sessionHistory,!1):window.addEventListener("hashchange",History.hashChangeHandler,!1)};History.prototype.display=function(a,b,c){a=tale.get(a);this.active.init&&!this.isEmpty&&(config.historyMode===modes.sessionHistory?this.activate(null!==window.history.state?window.history.state.sidx:this.top):this.activate(this.top));"back"!==c&&(this.isEmpty||(config.disableHistoryTracking?this.pop():config.historyMode===modes.sessionHistory&&window.history.state.sidx<this.top.sidx&&this.pop(this.top.sidx-window.history.state.sidx)),this.push({title:a.title,variables:clone(this.active.variables,!0)}),this.activate(this.top));if("back"!==c||config.disableHistoryControls)config.historyMode===modes.windowHistory?null===window.history.state||config.disableHistoryControls?window.history.replaceState(this.history,document.title):window.history.pushState(this.history,document.title):config.historyMode===modes.sessionHistory&&(null===window.history.state||config.disableHistoryControls?window.history.replaceState({sidx:this.active.sidx,suid:this.suid},document.title):window.history.pushState({sidx:this.active.sidx,suid:this.suid},document.title));config.historyMode!==modes.hashTag&&config.historyMode!==modes.sessionHistory||this.save();if("offscreen"!==c&&(document.body.className&&(document.body.className=""),tale.has("PassageReady")))try{Wikifier.wikifyEval(tale.get("PassageReady").text)}catch(d){window.alert("There is a technical problem with this story (PassageReady: "+d.message+"). You may be able to continue reading, but all parts of the story may not work properly.")}var e=a.render();e.style.visibility="visible";if("offscreen"!==c){b=document.getElementById("passages");var f=b.querySelector(".passage");if(null!==f&&("number"===typeof config.passageTransitionOut||"boolean"===typeof config.passageTransitionOut&&config.passageTransitionOut&&""!==config.transitionEndEventName))if(f.id="out-"+f.id,f.classList.add("transition-out"),"boolean"===typeof config.passageTransitionOut)$(f).on(config.transitionEndEventName,function(){this.parentNode&&this.parentNode.removeChild(this)});else setTimeout(function(){f.parentNode&&f.parentNode.removeChild(f)},config.passageTransitionOut);else removeChildren(b);e.classList.add("transition-in");b.appendChild(e);setTimeout(function(){e.classList.remove("transition-in")},1);config.displayPassageTitles&&"Start"!==a.title&&(document.title=tale.title+": "+a.title);config.historyMode===modes.hashTag&&(config.disableHistoryControls?session.setItem("activeHash",this.hash=this.active.hash):window.location.hash=this.hash=this.active.hash);window.scroll(0,0)}if("offscreen"!==c&&tale.has("PassageDone"))try{Wikifier.wikifyEval(tale.get("PassageDone").text)}catch(g){window.alert("There is a technical problem with this story (PassageDone: "+g.message+"). You may be able to continue reading, but all parts of the story may not work properly.")}"undefined"!==typeof config.saves.autosave&&("boolean"===typeof config.saves.autosave?config.saves.autosave&&SaveSystem.saveAuto():-1!==a.tags.indexOf(config.saves.autosave)&&SaveSystem.saveAuto());return e};History.prototype.regenerateSuid=function(){session.removeItem("activeHistory");this.suid=generateUuid();this.save()};History.prototype.restart=function(){config.historyMode===modes.windowHistory?(window.history.pushState(null,document.title),window.location.reload()):config.historyMode===modes.sessionHistory?(session.removeItem("activeHistory"),window.location.reload()):config.disableHistoryControls?(session.removeItem("activeHash"),window.location.reload()):window.location.hash=""};History.prototype.save=function(){if(config.historyMode===modes.sessionHistory)session.setItem("history."+this.suid,this.history)&&session.setItem("activeHistory",this.suid);else if(config.historyMode===modes.hashTag){for(var a="",b=0;b<this.history.length;b++){var c=tale.get(this.history[b].title);c&&"undefined"!==typeof c.id&&(a+=c.id.toString(36)+".")}this.active.hash=this.top.hash="#"+a.substr(0,a.length-1);return this.active.hash}};History.prototype.restore=function(a){if(config.historyMode===modes.windowHistory){if(null!==window.history.state&&(this.history=window.history.state),!this.isEmpty&&tale.has(this.top.title))return this.display(this.top.title,null,"back"),!0}else if(config.historyMode===modes.sessionHistory){if(a?this.suid=a:null!==window.history.state&&session.hasItem("activeHistory")?this.suid=session.getItem("activeHistory"):this.suid=generateUuid(),this.suid&&session.hasItem("history."+this.suid)&&(this.history=session.getItem("history."+this.suid),tale.has(this.history[window.history.state.sidx].title)))return this.display(this.history[window.history.state.sidx].title,null,"back"),!0}else if(config.historyMode===modes.hashTag){var b;session.hasItem("activeHash")?b=session.getItem("activeHash").replace("#","").split("."):""!==window.location.hash&&"#"!==window.location.hash&&(b=window.location.hash.replace("#","").split("."));if(b)try{a=0;for(var c=b.length-1;a<=c;a++){var d=parseInt(b[a],36);if(!tale.has(d))return!1;this.display(d,null,a===c?null:"offscreen")}return!0}catch(e){}}return!1};History.hashChangeHandler=function(a){if(window.location.hash!==state.hash){if(""!==window.location.hash&&"#"!==window.location.hash){a=document.getElementById("passages");var b=storage.getItem("remember");state.active={init:!0,variables:null===b?{}:clone(b,!0)};state.history=[];if(config.disableHistoryControls){session.setItem("activeHash",state.hash=window.location.hash);window.location.hash="";return}a.style.visibility="hidden";removeChildren(a);state.restore()||window.alert("The passage you had previously visited could not be found.");a.style.visibility="visible"}else window.location.reload();state.hash=window.location.hash}};History.popStateHandler_windowHistory=function(a){if(null!==a.state){if(0===a.state.length)throw Error("Guru meditation error!");state.history=a.state;state.display(state.activate(state.top).title,null,"back")}};History.popStateHandler_sessionHistory=function(a){null!==a.state&&(a.state.suid!==state.suid&&(state.save(),state.restore(a.state.suid)),state.display(state.activate(a.state.sidx).title,null,"back"))};function Passage(a,b,c){this.title=a;if(b)if(this.id=c,this.domId="passage-"+slugify(this.title),this.text=Passage.unescapeLineBreaks(b.firstChild?b.firstChild.nodeValue:""),this.textExcerpt=Passage.getExcerptFromText(this.text),this.tags=b.hasAttribute("tags")?b.getAttribute("tags").trim():""){if(this.tags=this.tags.split(/\s+/),this.classes=[],this.className="",0<this.tags.length){a=/^(?:debug|nobr|passage|script|stylesheet|widget|twine\.\w*)$/i;c=[];for(var d=0;d<this.tags.length;d++){var e=this.tags[d].toLowerCase();a.test(e)||c.push(slugify(e))}0<c.length&&(b.className&&(c=c.concat(b.className.split(/\s+/))),this.classes=c=c.sort().filter(function(a,b,c){return 0===b||c[b-1]!=a?!0:!1}),this.className=c.join(" "))}}else this.tags=[],this.classes=[],this.className="";else this.text='<html><span class="error">Error: this passage does not exist</span></html>',this.tags=[],this.classes=[],this.className=""}Passage.prototype.processText=function(){var a=this.text;-1!==this.tags.indexOf("nobr")&&(a=a.replace(/\n/g," "));-1!==this.tags.indexOf("Twine.image")&&(a="[img["+a+"]]");return a};Passage.prototype.render=function(){var a=insertElement(null,"section",this.domId,"passage");a.setAttribute("data-passage",this.title);a.style.visibility="hidden";for(var b=0,c=this.classes.length;b<c;b++)document.body.classList.add(this.classes[b]),a.classList.add(this.classes[b]);insertElement(a,"header",null,"header");b=insertElement(a,"div",null,"body content");insertElement(a,"footer",null,"footer");for(var d in prerender)"function"===typeof prerender[d]&&prerender[d].call(this,b,d);new Wikifier(b,this.processText());for(d in postrender)"function"===typeof postrender[d]&&postrender[d].call(this,b,d);this.textExcerpt=Passage.getExcerptFromNode(b);return a};Passage.prototype.reset=function(){for(var a=document.getElementById("store-area").childNodes,b=0;b<a.length;b++){var c=a[b],d;if(c.getAttribute&&(d=c.getAttribute("tiddler"))&&this.title==d){this.text=Passage.unescapeLineBreaks(c.firstChild?c.firstChild.nodeValue:"");return}}this.text='<html><span class="error">Error: this passage does not exist</span></html>'};Passage.prototype.excerpt=function(){return this.textExcerpt};Passage.getExcerptFromText=function(a,b){var c=RegExp("(\\S+(?:\\s+\\S+){0,"+("undefined"!==typeof b?b-1:7)+"})");return(c=a.replace(/<<.*?>>/g," ").replace(/<.*?>/g," ").trim().replace(/^\s*\|.*\|.*?$/gm,"").replace(/\[[<>]?img\[[^\]]*\]\]/g,"").replace(/\[\[([^|\]]*)(?:|[^\]]*)?\]\]/g,"$1").replace(/^\s*!+(.*?)$/gm,"$1").replace(/\'{2}|\/{2}|_{2}|@{2}/g,"").replace(/\s+/g," ").trim().match(c))?c[1]+"\u2026":"\u2026"};Passage.getExcerptFromNode=function(a,b){function c(a){if(!a.hasChildNodes())return"";a=a.childNodes;for(var b="",d=0,e=a.length;d<e;d++)switch(a[d].nodeType){case 1:"none"!==a[d].style.display&&(b+=" ",a[d].hasChildNodes()&&(b+=c(a[d])));break;case 3:b+=a[d].textContent}return b}if(!a.hasChildNodes())return"";var d=RegExp("(\\S+(?:\\s+\\S+){0,"+("undefined"!==typeof b?b-1:7)+"})"),e=c(a).trim();e&&(e=e.replace(/\s+/g," ").match(d));return e?e[1]+"\u2026":"\u2026"};Passage.unescapeLineBreaks=function(a){return a&&""!=a?a.replace(/\\n/gm,"\n").replace(/\\t/gm,"\t").replace(/\\s|\\/gm,"\\").replace(/\r/gm,""):""};Passage.mergeClassNames=function(){if(0==arguments.length)return"";for(var a=[],b=0;b<arguments.length;b++)"object"===typeof arguments[b]&&Array.isArray(arguments[b])?a=a.concat(arguments[b]):"string"===typeof arguments[b]&&(a=a.concat(arguments[b].split(/\s+/)));return 0<a.length?a.sort().filter(function(a,b,e){return 0==b||e[b-1]!=a?!0:!1}).join(" "):""};function Tale(){this.passages={};document.normalize&&document.normalize();for(var a=document.getElementById("store-area").childNodes,b=0;b<a.length;b++){var c=a[b],d;c.getAttribute&&(d=c.getAttribute("tiddler"))&&(this.passages[d]=new Passage(d,c,b))}this.setTitle(this.passages.StoryTitle?this.passages.StoryTitle.text:"Untitled Story")}Tale.prototype.setTitle=function(a){this.title=a;this.domId=slugify(a)};Tale.prototype.has=function(a){if("string"===typeof a)return void 0!==this.passages[a]&&null!==this.passages[a];if("number"===typeof a)for(var b in this.passages)if(this.passages[b].id===a)return!0;return!1};Tale.prototype.get=function(a){if("string"===typeof a)return this.passages[a]||new Passage(a);if("number"===typeof a)for(var b in this.passages)if(this.passages[b].id===a)return this.passages[b]};Tale.prototype.lookup=function(a,b,c){c||(c="title");var d=[],e;for(e in this.passages){var f=this.passages[e];switch(typeof f[a]){case "undefined":break;case "object":for(var g=0;g<f[a].length;g++)f[a][g]==b&&d.push(f);break;default:f[a]==b&&d.push(f)}}d.sort(function(a,b){return a[c]==b[c]?0:a[c]<b[c]?-1:1});return d};Tale.prototype.reset=function(){for(var a in this.passages)this.passages[a].reset()};String.prototype.readMacroParams=function(){for(var a=RegExp("(?:(?:\"((?:(?:\\\\\")|[^\"])+)\")|(?:'((?:(?:\\\\')|[^'])+)')|((?:\"\")|(?:''))|(?:(\\[\\[(?:\\s|\\S)*?\\]\\]))|([^\"'\\s]\\S*))","gm"),b,c=[];null!==(b=a.exec(this));){var d;if(b[1])d=b[1];else if(b[2])d=b[2];else if(b[3])d="";else if(b[4]){d=b[4];b=RegExp(Wikifier.textPrimitives.linkPattern).exec(d);var e={};null!==b&&(e.count=b[1]?2:1,e.link=/\$\w+/.test(b[3])?Wikifier.getValue(b[3]):b[3],e.text=b[1]?/\$\w+/.test(b[1])?Wikifier.getValue(b[1]):b[1]:e.link,e.isExternal=!b[2]&&Wikifier.formatterHelpers.isExternalLink(e.link),e.setFn=b[4]?function(a){return function(){macros.eval(a,null,null)}}(Wikifier.parse(b[4])):null,d=e)}else b[5]&&(d=b[5],/\$\w+/.test(d)?d=Wikifier.getValue(d):isNumeric(d)?d=Number(d):isBoolean(d)?d="true"===d?!0:!1:"null"===d?d=null:"undefined"===d&&(d=void 0));c.push(d)}return c};String.prototype.unDash=function(){var a,b=this.split("-");if(1<b.length)for(a=1;a<b.length;a++)b[a]=b[a].substr(0,1).toUpperCase()+b[a].substr(1);return b.join("")};function WikiFormatter(a){this.formatters=[];this.byName={};for(var b=[],c=0;c<a.length;c++)b.push("("+a[c].match+")"),this.formatters.push(a[c]),this.byName[a[c].name]=this.formatters[this.formatters.length-1];this.formatterRegExp=RegExp(b.join("|"),"gm")}function Wikifier(a,b){this.source=b;this.output=a;this.nextMatch=0;this.formatter=formatter;this.subWikify(this.output)}Wikifier.prototype.subWikify=function(a,b){var c=this.output;this.output=a;var d=b?RegExp("("+b+")","gm"):null,e,f;do{this.formatter.formatterRegExp.lastIndex=this.nextMatch;d&&(d.lastIndex=this.nextMatch);e=this.formatter.formatterRegExp.exec(this.source);if((f=d?d.exec(this.source):null)&&(!e||f.index<=e.index)){f.index>this.nextMatch&&this.outputText(this.output,this.nextMatch,f.index);this.matchStart=f.index;this.matchLength=f[1].length;this.matchText=f[1];this.nextMatch=f.index+f[1].length;this.output=c;return}if(e){e.index>this.nextMatch&&this.outputText(this.output,this.nextMatch,e.index);this.matchStart=e.index;this.matchLength=e[0].length;this.matchText=e[0];this.nextMatch=this.formatter.formatterRegExp.lastIndex;for(var g=-1,h=1;h<e.length;h++)if(e[h]){g=h-1;break}-1!==g&&this.formatter.formatters[g].handler(this)}}while(f||e);this.nextMatch<this.source.length&&(this.outputText(this.output,this.nextMatch,this.source.length),this.nextMatch=this.source.length);this.output=c};Wikifier.prototype.outputText=function(a,b,c){insertText(a,this.source.substring(b,c))};Wikifier.prototype.rawArgs=function(){return this._macroRawArgs};Wikifier.prototype.fullArgs=function(){return Wikifier.parse(this.rawArgs())};Wikifier.parse=function(a){for(var b=RegExp("(?:(?:\"((?:(?:\\\\\")|[^\"])+)\")|(?:'((?:(?:\\\\')|[^'])+)')|((?:\"\")|(?:''))|([=+\\-*\\/%<>&\\|\\^~!?:,;\\(\\)\\[\\]{}]+)|([^\"'=+\\-*\\/%<>&\\|\\^~!?:,;\\(\\)\\[\\]{}\\s]+))","g"),c,d={$:"state.active.variables.",eq:"==",neq:"!=",gt:">",gte:">=",lt:"<",lte:"<=",and:"&&",or:"||",not:"!",is:"===","is not":"!==",to:"=",def:'"undefined" !== typeof',ndef:'"undefined" === typeof'};null!==(c=b.exec(a));)if(c[5]){var e=c[5];"$"!==e&&("$"===e[0]?e="$":"is"===e&&"is not"===a.slice(c.index,c.index+6)&&(e="is not"),d[e]&&(a=a.splice(c.index,e.length,d[e]),b.lastIndex+=d[e].length-e.length))}return a};Wikifier.getValue=function(a){a=Wikifier.parseStoryVariable(a);var b=void 0;if(0!==a.length)for(var b=state.active.variables,c=0,d=a.length;c<d;c++)if("undefined"!==typeof b[a[c]])b=b[a[c]];else{b=void 0;break}return b};Wikifier.setValue=function(a,b){var c=Wikifier.parseStoryVariable(a);if(0!==c.length){for(var d=state.active.variables,e=c.pop(),f=0,g=c.length;f<g;f++)if("undefined"!==typeof d[c[f]])d=d[c[f]];else{d=void 0;break}if(void 0!==d)return d[e]=b,!0}return!1};Wikifier.parseStoryVariable=function(a){for(var b=/^(?:\$(\w+)|\.(\w+)|\[(?:(?:\"((?:\\.|[^\"\\])+)\")|(?:\'((?:\\.|[^\'\\])+)\')|(\$\w.*)|(\d+))\])/,c,d=[];null!==(c=b.exec(a));)a=a.slice(c[0].length),c[1]?d.push(c[1]):c[2]?d.push(c[2]):c[3]?d.push(c[3]):c[4]?d.push(c[4]):c[5]?d.push(Wikifier.getValue(c[5])):c[6]&&d.push(Number(c[6]));return""===a?d:[]};Wikifier.wikifyEval=function(a){var b=document.createElement("div");try{for(new Wikifier(b,a);b.hasChildNodes();){var c=b.firstChild;if(c.classList&&c.classList.contains("error"))throw Error(c.textContent.replace(/^Error:\s+/,""));b.removeChild(c)}}finally{removeChildren(b),"function"===typeof b.remove&&b.remove()}};Wikifier.createInternalLink=function(a,b,c,d){var e=document.createElement("a");"undefined"!==typeof b&&(e.setAttribute("data-passage",b),e.className=tale.has(b)?"link-internal":"link-broken");c&&insertText(e,c);a&&a.appendChild(e);"undefined"!==typeof b&&$(e).click(function(){"function"===typeof d&&d();state.display(b,e)});return e};Wikifier.createExternalLink=function(a,b,c){a=insertElement(a,"a",null,"link-external",c);b&&(a.href=b);a.target="_blank";return a};/[\u0150\u0170]/g.test("\u0150")?Wikifier.textPrimitives={anyLetter:"[A-Za-z0-9_\\-\u00c0-\u00de\u00df-\u00ff\u0150\u0170\u0151\u0171]"}:Wikifier.textPrimitives={anyLetter:"[A-Za-z0-9_\\-\u00c0-\u00de\u00df-\u00ff]"};Wikifier.textPrimitives.urlPattern="(?:file|https?|mailto|ftp|javascript|irc|news|data):[^\\s'\"]+(?:/|\\b)";Wikifier.textPrimitives.linkPattern="\\[\\[\\s*(?:(.+?)\\s*\\|\\s*)?(~)?(.+?)\\s*\\](?:\\[\\s*(.+?)\\s*\\])?\\]";Wikifier.textPrimitives.imagePattern="\\[([<]?)([>]?)[Ii][Mm][Gg]\\[\\s*(?:(.+?)\\s*\\|\\s*)?([^\\|]+?)\\s*\\](?:\\[\\s*(~)?(.+?)\\s*\\])?(?:\\[\\s*(.+?)\\s*\\])?\\]";Wikifier.formatterHelpers={charFormatHelper:function(a){var b=insertElement(a.output,this.element);a.subWikify(b,this.terminator)},inlineCssHelper:function(a){var b=[],c=RegExp("(?:("+Wikifier.textPrimitives.anyLetter+"+)\\(([^\\)\\|\\n]+)(?:\\):))|(?:("+Wikifier.textPrimitives.anyLetter+"+):([^;\\|\\n]+);)","gm");do{c.lastIndex=a.nextMatch;var d=c.exec(a.source),e=d&&d.index==a.nextMatch;if(e){var f,g;d[1]?(f=d[1].unDash(),g=d[2]):(f=d[3].unDash(),g=d[4]);switch(f){case "bgcolor":f="backgroundColor";break;case "float":f="cssFloat"}b.push({style:f,value:g});a.nextMatch=d.index+d[0].length}}while(e);return b},monospacedByLineHelper:function(a){var b=RegExp(this.lookahead,"gm");b.lastIndex=a.matchStart;if((b=b.exec(a.source))&&b.index===a.matchStart){var c=b[1];config.browser.isIE&&10>config.browser.ieVersion&&(c=c.replace(/\n/g,"\r"));insertElement(a.output,"pre",null,null,c);a.nextMatch=b.index+b[0].length}},isExternalLink:function(a){return tale.has(a)?!1:RegExp("^"+Wikifier.textPrimitives.urlPattern,"gim").test(a)||-1!==a.search(/[\.\/\\#]/)?!0:!1}};Wikifier.formatters=[{name:"table",match:"^\\|(?:[^\\n]*)\\|(?:[fhck]?)$",lookahead:"^\\|([^\\n]*)\\|([fhck]?)$",rowTerminator:"\\|(?:[fhck]?)$\\n?",cellPattern:"(?:\\|([^\\n\\|]*)\\|)|(\\|[fhck]?$\\n?)",cellTerminator:"(?:\\x20*)\\|",rowTypes:{c:"caption",h:"thead","":"tbody",f:"tfoot"},handler:function(a){var b=insertElement(a.output,"table"),c=RegExp(this.lookahead,"gm"),d=null,e,f,g=[],h=0;a.nextMatch=a.matchStart;do{c.lastIndex=a.nextMatch;var k=c.exec(a.source),m=k&&k.index===a.nextMatch;m&&(e=k[2],"k"===e?(b.className=k[1],a.nextMatch+=k[0].length+1):(e!==d&&(f=insertElement(b,this.rowTypes[e])),d=e,"c"===d?(0===h?f.setAttribute("align","top"):f.setAttribute("align","bottom"),a.nextMatch+=1,a.subWikify(f,this.rowTerminator)):(e=insertElement(f,"tr"),this.rowHandler(a,e,g)),h++))}while(m)},rowHandler:function(a,b,c){var d=0,e=1,f=RegExp(this.cellPattern,"gm");do{f.lastIndex=a.nextMatch;var g=f.exec(a.source),h=g&&g.index===a.nextMatch;if(h){if("~"===g[1]){var k=c[d];k&&(k.rowCount++,k.element.setAttribute("rowSpan",k.rowCount),k.element.setAttribute("rowspan",k.rowCount),k.element.valign="center");a.nextMatch=g.index+g[0].length-1}else if(">"===g[1])e++,a.nextMatch=g.index+g[0].length-1;else if(g[2]){a.nextMatch=g.index+g[0].length;break}else{var k=g=!1,m;a.nextMatch++;for(var q=Wikifier.formatterHelpers.inlineCssHelper(a);" "===a.source.substr(a.nextMatch,1);)g=!0,a.nextMatch++;"!"===a.source.substr(a.nextMatch,1)?(m=insertElement(b,"th"),a.nextMatch++):m=insertElement(b,"td");c[d]={rowCount:1,element:m};1<e&&(m.setAttribute("colSpan",e),m.setAttribute("colspan",e),e=1);for(var r=0;r<q.length;r++)m.style[q[r].style]=q[r].value;a.subWikify(m,this.cellTerminator);" "===a.matchText.substr(a.matchText.length-2,1)&&(k=!0);g&&k?m.align="center":g?m.align="right":k&&(m.align="left");a.nextMatch-=1}d++}}while(h)}},{name:"heading",match:"^!{1,6}",terminator:"\\n",handler:function(a){a.subWikify(insertElement(a.output,"h"+a.matchLength),this.terminator)}},{name:"list",match:"^(?:(?:\\*+)|(?:#+))",lookahead:"^(?:(\\*+)|(#+))",terminator:"\\n",outerElement:"ul",itemElement:"li",handler:function(a){var b=RegExp(this.lookahead,"gm");a.nextMatch=a.matchStart;var c=[a.output],d=null,e,f=0,g;do{b.lastIndex=a.nextMatch;var h=b.exec(a.source),k=h&&h.index==a.nextMatch;if(k){e=h[2]?"ol":"ul";g=h[0].length;a.nextMatch+=h[0].length;if(g>f)for(d=f;d<g;d++)c.push(insertElement(c[c.length-1],e));else if(g<f)for(d=f;d>g;d--)c.pop();else g==f&&e!=d&&(c.pop(),c.push(insertElement(c[c.length-1],e)));f=g;d=e;e=insertElement(c[c.length-1],"li");a.subWikify(e,this.terminator)}}while(k)}},{name:"quoteByBlock",match:"^<<<\\n",terminator:"^<<<\\n",handler:function(a){var b=insertElement(a.output,"blockquote");a.subWikify(b,this.terminator)}},{name:"quoteByLine",match:"^>+",terminator:"\\n",element:"blockquote",handler:function(a){var b=RegExp(this.match,"gm"),c=[a.output],d=0,e=a.matchLength;do{if(e>d)for(;d<e;d++)c.push(insertElement(c[c.length-1],this.element));else if(e<d)for(;d>e;d--)c.pop();d=e;a.subWikify(c[c.length-1],this.terminator);insertElement(c[c.length-1],"br");b.lastIndex=a.nextMatch;var f=b.exec(a.source),g=f&&f.index==a.nextMatch;g&&(e=f[0].length,a.nextMatch+=f[0].length)}while(g)}},{name:"rule",match:"^----+$\\n?|<hr ?/?>\\n?",handler:function(a){insertElement(a.output,"hr")}},{name:"monospacedByLine",match:"^\\{\\{\\{\\n",lookahead:"^\\{\\{\\{\\n((?:^[^\\n]*\\n)+?)(^\\}\\}\\}$\\n?)",handler:Wikifier.formatterHelpers.monospacedByLineHelper},{name:"monospacedByLineForPlugin",match:"^//\\{\\{\\{\\n",lookahead:"^//\\{\\{\\{\\n\\n*((?:^[^\\n]*\\n)+?)(\\n*^//\\}\\}\\}$\\n?)",handler:Wikifier.formatterHelpers.monospacedByLineHelper},{name:"wikifyCommentForPlugin",match:"^/\\*\\*\\*\\n",terminator:"^\\*\\*\\*/\\n",handler:function(a){a.subWikify(a.output,this.terminator)}},{name:"prettyLink",match:"\\[\\[",lookaheadRegExp:/(\[\[(?:\s|\S)*?\]\])/gm,handler:function(a){this.lookaheadRegExp.lastIndex=a.matchStart;var b=this.lookaheadRegExp.exec(a.source);if(b&&b.index===a.matchStart){var c=RegExp("^"+Wikifier.textPrimitives.linkPattern+"$").exec(b[0]);if(null!==c){a.nextMatch=b.index+b[0].length;var b=/\$\w+/.test(c[3])?Wikifier.getValue(c[3]):c[3],d=c[1]?/\$\w+/.test(c[1])?Wikifier.getValue(c[1]):c[1]:b,e=c[4]?function(a){return function(){macros.eval(a,null,null)}}(Wikifier.parse(c[4])):null;!c[2]&&Wikifier.formatterHelpers.isExternalLink(b)?Wikifier.createExternalLink(a.output,b,d):Wikifier.createInternalLink(a.output,b,d,e)}}}},{name:"urlLink",match:Wikifier.textPrimitives.urlPattern,handler:function(a){var b=Wikifier.createExternalLink(a.output,a.matchText);a.outputText(b,a.matchStart,a.nextMatch)}},{name:"image",match:"\\[[<>]?[Ii][Mm][Gg]\\[",lookaheadRegExp:/(\[[<>]?[Ii][Mm][Gg]\[(?:\s|\S)*?\]\])/gm,handler:function(a){this.lookaheadRegExp.lastIndex=a.matchStart;var b=this.lookaheadRegExp.exec(a.source);if(b&&b.index===a.matchStart){var c=RegExp("^"+Wikifier.textPrimitives.imagePattern+"$").exec(b[0]);if(null!==c){a.nextMatch=b.index+b[0].length;a=a.output;b=c[7]?function(a){return function(){macros.eval(a,null,null)}}(Wikifier.parse(c[7])):null;if(c[6]){var d=/\$\w+/.test(c[6])?Wikifier.getValue(c[6]):c[6];a=!c[5]&&Wikifier.formatterHelpers.isExternalLink(d)?Wikifier.createExternalLink(a,d):Wikifier.createInternalLink(a,d,null,b);a.classList.add("link-image")}a=insertElement(a,"img");b=/\$\w+/.test(c[4])?Wikifier.getValue(c[4]):c[4];"data:"!==b.slice(0,5)&&tale.has(b)&&(d=tale.get(b),-1!==d.tags.indexOf("Twine.image")&&(b=d.text));a.src=b;c[3]&&(a.title=/\$\w+/.test(c[3])?Wikifier.getValue(c[3]):c[3]);c[1]?a.align="left":c[2]&&(a.align="right")}}}},{name:"macro",match:"<<",lookaheadRegExp:/<<([^>\s]+)(?:\s*)((?:(?:\"(?:\\.|[^\"\\])*\")|(?:\'(?:\\.|[^\'\\])*\')|[^>]|(?:>(?!>)))*)>>/gm,working:{name:"",handlerName:"",arguments:"",index:0},context:null,handler:function(a){this.lookaheadRegExp.lastIndex=a.matchStart;if(this.parseTag(a)){var b=this.working.name,c=this.working.handlerName,d=this.working.arguments;try{var e=macros.get(b);if(e){e.hasOwnProperty("excludeParams")&&(e.skipArgs=e.excludeParams,delete e.excludeParams);e.hasOwnProperty("children")&&!e.hasOwnProperty("tags")&&(e.tags=e.children,delete e.children);var f=null;if(e.hasOwnProperty("tags")&&(f=this.parseBody(a,e.tags),!f))return throwError(a.output,"cannot find a closing tag for macro <<"+b+">>");if("function"===typeof e[c]){var g=e.hasOwnProperty("skipArgs")&&e.skipArgs?[]:d.readMacroParams();if(e.hasOwnProperty("_USE_MACROS_API")){var h=this.context,k={self:e,name:b,args:g,payload:f,output:a.output,parser:a,context:this.context,contextHas:function(a){for(var b=this;null!==(b=b.context);)if(a(b))return!0;return!1},contextSelect:function(a){for(var b=this,c=[];null!==(b=b.context);)a(b)&&c.push(b);return c},error:function(a){throwError(this.output,"<<"+this.name+">>: "+a);return!1}};k.args.raw=d;k.args.full=Wikifier.parse(d);try{this.context=k,e[c].call(k)}finally{this.context=h}}else a._macroRawArgs=d,e[c](a.output,b,g,a,f),a._macroRawArgs=""}else return throwError(a.output,"macro <<"+b+'>> property "'+c+'" '+(e.hasOwnProperty(c)?"is not a function":"does not exist"))}else return macros.tags.hasOwnProperty(b)?throwError(a.output,"child tag <<"+b+">> was found outside of a call to its parent macro"+(1===macros.tags[b].length?"":"s")+" <<"+macros.tags[b].join(">>, <<")+">>"):throwError(a.output,"macro <<"+b+">> does not exist")}catch(m){return throwError(a.output,"cannot execute "+(e&&e.isWidget?"widget":"macro")+" <<"+b+">>: "+m.message)}finally{this.working.name="",this.working.handlerName="",this.working.arguments="",this.working.index=0}}},parseTag:function(a){var b=this.lookaheadRegExp.exec(a.source);return b&&b.index===a.matchStart&&b[1]?(a.nextMatch=b.index+b[0].length,this.lookaheadRegExp.lastIndex=a.nextMatch,a=b[1].indexOf("::"),-1!==a?(this.working.name=b[1].slice(0,a),this.working.handlerName=b[1].slice(a+2)):(this.working.name=b[1],this.working.handlerName="handler"),this.working.arguments=b[2],this.working.index=b.index,!0):!1},parseBody:function(a,b){for(var c=this.working.name,d="/"+c,e="end"+c,f=Array.isArray(b)?b:!1,g=-1,h=1,k=this.working.name,m=this.working.arguments,q=a.nextMatch,r=[];-1!==(a.matchStart=a.source.indexOf("<<",a.nextMatch))&&this.parseTag(a);){var s=this.working.name,n=this.working.arguments,t=this.working.index,l=a.nextMatch;switch(s){case c:h++;break;case e:case d:h--;break;default:if(1===h&&f)for(var p=0,C=f.length;p<C;p++)s===f[p]&&(r.push({name:k,arguments:m,contents:a.source.slice(q,t)}),k=s,m=n,q=l)}if(0===h){r.push({name:k,arguments:m,contents:a.source.slice(q,t)});g=l;break}}return-1!==g?(a.nextMatch=g,r):null}},{name:"html",match:"<[Hh][Tt][Mm][Ll]>",lookaheadRegExp:/<[Hh][Tt][Mm][Ll]>((?:.|\n)*?)<\/[Hh][Tt][Mm][Ll]>/gm,handler:function(a){this.lookaheadRegExp.lastIndex=a.matchStart;var b=this.lookaheadRegExp.exec(a.source);if(b&&b.index===a.matchStart){a.nextMatch=b.index+b[0].length;var c=document.createDocumentFragment(),d=document.createElement("div");for(d.innerHTML=b[1];d.firstChild;)c.appendChild(d.firstChild);a.output.appendChild(c)}}},{name:"commentByBlock",match:"/(?:%|\\*)",lookaheadRegExp:/\/(%|\*)((?:.|\n)*?)\1\//gm,handler:function(a){this.lookaheadRegExp.lastIndex=a.matchStart;var b=this.lookaheadRegExp.exec(a.source);b&&b.index===a.matchStart&&(a.nextMatch=b.index+b[0].length)}},{name:"htmlCommentByBlock",match:"\x3c!--",lookaheadRegExp:/\x3c!--((?:.|\\n)*?)--\x3e/gm,handler:function(a){this.lookaheadRegExp.lastIndex=a.matchStart;var b=this.lookaheadRegExp.exec(a.source);b&&b.index===a.matchStart&&(a.output.appendChild(document.createComment(b[1])),a.nextMatch=b.index+b[0].length)}},{name:"boldByChar",match:"''",terminator:"''",element:"strong",handler:Wikifier.formatterHelpers.charFormatHelper},{name:"strikeByChar",match:"==",terminator:"==",element:"strike",handler:Wikifier.formatterHelpers.charFormatHelper},{name:"underlineByChar",match:"__",terminator:"__",element:"u",handler:Wikifier.formatterHelpers.charFormatHelper},{name:"italicByChar",match:"//",terminator:"//",element:"em",handler:Wikifier.formatterHelpers.charFormatHelper},{name:"subscriptByChar",match:"~~",terminator:"~~",element:"sub",handler:Wikifier.formatterHelpers.charFormatHelper},{name:"superscriptByChar",match:"\\^\\^",terminator:"\\^\\^",element:"sup",handler:Wikifier.formatterHelpers.charFormatHelper},{name:"monospacedByChar",match:"\\{\\{\\{",lookahead:"\\{\\{\\{((?:.|\\n)*?)\\}\\}\\}",handler:function(a){var b=RegExp(this.lookahead,"gm");b.lastIndex=a.matchStart;(b=b.exec(a.source))&&b.index===a.matchStart&&(insertElement(a.output,"code",null,null,b[1]),a.nextMatch=b.index+b[0].length)}},{name:"styleByChar",match:"@@",terminator:"@@",lookahead:"(?:([^\\(@]+)\\(([^\\)]+)(?:\\):))|(?:([^:@]+):([^;]+);)",handler:function(a){var b=insertElement(a.output,"span",null,null,null),c=Wikifier.formatterHelpers.inlineCssHelper(a);if(0==c.length)b.className="marked";else for(var d=0;d<c.length;d++)b.style[c[d].style]=c[d].value;a.subWikify(b,this.terminator)}},{name:"emdash",match:"--",handler:function(a){insertText(a.output,"\u2014")}},{name:"lineContinuation",match:"\\\\[\\s\\u00a0\\u2028\\u2029]*?(?:\\n|$)",handler:function(a){a.nextMatch=a.matchStart+a.matchLength}},{name:"lineBreak",match:"\\n|<br ?/?>",handler:function(a){insertElement(a.output,"br")}},{name:"rawText",match:'"{3}|<nowiki>',lookaheadRegExp:/(?:\"{3}|<nowiki>)((?:.|\n)*?)(?:\"{3}|<\/nowiki>)/gm,handler:function(a){this.lookaheadRegExp.lastIndex=a.matchStart;var b=this.lookaheadRegExp.exec(a.source);b&&b.index===a.matchStart&&(insertElement(a.output,"span",null,null,b[1]),a.nextMatch=this.lookaheadRegExp.lastIndex)}},{name:"htmlTag",match:"<\\w+(?:\\s+[^\\u0000-\\u001F\\u007F-\\u009F\\s\"'>\\/=]+(?:\\s*=\\s*(?:\"[^\"]+\"|'[^']+'|[^\\s\"'=<>`]+))?)*\\s*\\/?>",tagPattern:"<(\\w+)",voidElements:"area base br col embed hr img input keygen link menuitem meta param source track wbr".split(" "),handler:function(a){var b=RegExp(this.tagPattern).exec(a.matchText);if(b=b&&b[1]){var c=-1!==this.voidElements.indexOf(b.toLowerCase()),d,e;c||(d="<\\/"+b+"\\s*>",e=RegExp(d,"gm"),e.lastIndex=a.matchStart,e=e.exec(a.source));if(c||e){b=document.createElement(a.output.tagName);for(b.innerHTML=a.matchText;b.firstChild;)b=b.firstChild;e&&a.subWikify(b,d);a.output.appendChild(b)}else throwError(a.output,'HTML tag "'+b+'" is not closed')}}}];function Macros(){return Object.defineProperties({tags:{},definitions:{},add:function(a,b,c){if(Array.isArray(a))a.forEach(function(a){this.add(a,b,c)},this);else{if(this.has(a))throw Error("cannot clobber existing macro <<"+a+">>");if(this.tags.hasOwnProperty(a))throw Error("cannot clobber child tag <<"+a+">> of parent macro"+(1===this.tags[a].length?"":"s")+" <<"+this.tags[a].join(">>, <<")+">>");try{if("object"===typeof b)this.definitions[a]=c?clone(b,!0):b;else if(this.has(b))this.definitions[a]=c?clone(this.definitions[b],!0):this.definitions[b];else throw Error("cannot create alias of nonexistent macro <<"+b+">>");Object.defineProperty(this.definitions,a,{writable:!1});this.definitions[a]._USE_MACROS_API=!0}catch(d){if("TypeError"===d.name)throw Error("cannot clobber protected macro <<"+a+">>");throw Error("unknown error when attempting to add macro <<"+a+">>: ["+d.name+"] "+d.message);}if(this.definitions[a].hasOwnProperty("tags"))if(null==this.definitions[a].tags)this.registerTags(a);else if(Array.isArray(this.definitions[a].tags))this.registerTags(a,this.definitions[a].tags);else throw Error('bad value for "tags" property of macro <<'+a+">>");}},remove:function(a){if(Array.isArray(a))a.forEach(function(a){this.remove(a)},this);else if(this.definitions.hasOwnProperty(a)){this.definitions[a].hasOwnProperty("tags")&&this.unregisterTags(a);try{Object.defineProperty(this.definitions,a,{writable:!0}),delete this.definitions[a]}catch(b){throw Error("unknown error removing macro <<"+a+">>: "+b.message);}}else if(this.tags.hasOwnProperty(a))throw Error("cannot remove child tag <<"+a+">> of parent macro <<"+this.tags[a]+">>");},has:function(a,b){return this.definitions.hasOwnProperty(a)||b&&this.tags.hasOwnProperty(a)},get:function(a){var b=null;this.definitions.hasOwnProperty(a)&&"function"===typeof this.definitions[a].handler?b=this.definitions[a]:this.hasOwnProperty(a)&&"function"===typeof this[a].handler&&(b=this[a]);return b},getHandler:function(a,b){var c=this.get(a);b||(b="handler");return c&&c.hasOwnProperty(b)&&"function"===typeof c[b]?c[b]:null},eval:function(a,b,c){try{var output=b;return eval("(function(){"+a+"}());"),!0}catch(d){return b?throwError(b,"<<"+c+">>: bad expression: "+d.message):!1}},registerTags:function(a,b){if(!a)throw Error("no parent specified");Array.isArray(b)||(b=[]);for(var c=[].concat(["/"+a,"end"+a],b),d=0;d<c.length;d++){var e=c[d];if(this.definitions.hasOwnProperty(e))throw Error("cannot register tag for an existing macro");this.tags.hasOwnProperty(e)?-1===this.tags[e].indexOf(a)&&(this.tags[e].push(a),this.tags[e].sort()):this.tags[e]=[a]}},unregisterTags:function(a){if(!a)throw Error("no parent specified");for(var b in this.tags){var c=this.tags[b].indexOf(a);-1!==c&&(1===this.tags[b].length?delete this.tags[b]:this.tags[b].splice(c,1))}},init:function(){for(var a in this.definitions){var b=this.getHandler(a,"init");b&&b.call(this.definitions[a],a)}for(a in this)(b=this.getHandler(a,"init"))&&b.call(this[a],a)},lateInit:function(){for(var a in this.definitions){var b=this.getHandler(a,"lateInit");b&&b.call(this.definitions[a],a)}for(a in this)(b=this.getHandler(a,"lateInit"))&&b.call(this[a],a)}},{tags:{writable:!1,enumerable:!1,configurable:!1},definitions:{writable:!1,enumerable:!1,configurable:!1},add:{writable:!1,enumerable:!1,configurable:!1},remove:{writable:!1,enumerable:!1,configurable:!1},has:{writable:!1,enumerable:!1,configurable:!1},get:{writable:!1,enumerable:!1,configurable:!1},getHandler:{writable:!1,enumerable:!1,configurable:!1},eval:{writable:!1,enumerable:!1,configurable:!1},registerTags:{writable:!1,enumerable:!1,configurable:!1},unregisterTags:{writable:!1,enumerable:!1,configurable:!1},init:{writable:!1,enumerable:!1,configurable:!1},lateInit:{writable:!1,enumerable:!1,configurable:!1}})}function registerMacroTags(a,b){return macros.registerTags(a,b)}function evalMacroExpression(a,b,c){return macros.eval(a,b,c)}function addStandardMacros(){macros.add("actions",{version:{major:2,minor:2,revision:0},handler:function(){var a=insertElement(this.output,"ul");a.classList.add(this.name);state.active.variables["#actions"]||(state.active.variables["#actions"]={});for(var b=0;b<this.args.length;b++){var c,d,e;"object"===typeof this.args[b]?(c=this.args[b].text,d=this.args[b].link,e=this.args[b].setFn):c=d=this.args[b];state.active.variables["#actions"][d]||(c=Wikifier.createInternalLink(insertElement(a,"li"),d,c,function(a,b){return function(){state.active.variables["#actions"][a]=!0;"function"===typeof b&&b()}}(d,e)),c.classList.add("link-"+this.name))}}});macros.add(["back","return"],{version:{major:4,minor:1,revision:0},handler:function(){var a=1,b,c,d=this.name[0].toUpperCase()+this.name.slice(1),e;1===this.args.length&&"object"===typeof this.args[0]&&(1===this.args[0].count?(this.args.push(this.args[0].link),this.args[0]="to"):(this.args.push("to"),this.args.push(this.args[0].link),this.args[0]=this.args[0].text));if(1===this.args.length)c=this.args[0];else if(0!==this.args.length){3===this.args.length&&(c=this.args.shift());var f=config.historyMode!==modes.sessionHistory?state.length:state.active.sidx+1;if("go"===this.args[0]){if(isNaN(this.args[1])||1>this.args[1])return this.error('the argument after "go" must be a whole number greater than zero');a=this.args[1]<f?this.args[1]:f-1;b=state.peek(a).title;d+=" (go "+a+")"}else if("to"===this.args[0]){"object"===typeof this.args[1]&&(this.args[1]=this.args[1].link);if(!tale.has(this.args[1]))return this.error('the "'+this.args[1]+'" passage does not exist');if("return"===this.name)b=this.args[1],d+=' (to "'+b+'")';else for(var g=f-1;0<=g;g--)if(state.history[g].title===this.args[1]){a=f-1-g;b=this.args[1];d+=' (to "'+b+'")';break}if(void 0===b)return this.error('cannot find passage "'+this.args[1]+'" in the current story history')}else return this.error('"'+this.args[0]+'" is not a valid action (go|to)')}void 0===b&&1<state.length&&(b=state.peek(a).title);if(void 0===b)return this.error("cannot find passage");if(0===a)return this.error("already at the first passage in the current story history");e=document.createElement("a");e.classList.add("link-"+this.name);0<a&&$(e).click(function(){return"back"===this.name?config.historyMode===modes.hashTag||config.disableHistoryControls?function(){for(;0<a;)state.isEmpty||state.pop(),a--;state.activate(state.top);state.display(b,e,"back")}:function(){1<state.length&&window.history.go(-a)}:function(){state.display(b,e)}}.call(this));insertText(e,c||this.self.dtext||d);this.output.appendChild(e)},linktext:function(){0===this.args.length?delete this.self.dtext:this.self.dtext=this.args[0]}},!0);macros.add("choice",{version:{major:4,minor:0,revision:0},handler:function(){if(0===this.args.length)return this.error("no passage specified");var a,b,c,d=state.active.title;1===this.args.length?"object"===typeof this.args[0]?(a=this.args[0].text,b=this.args[0].link,c=this.args[0].setFn):a=b=this.args[0]:(b=this.args[0],a=this.args[1]);if(!state.active.variables.hasOwnProperty("#choice"))state.active.variables["#choice"]={};else if(state.active.variables["#choice"][d]){insertElement(this.output,"span",null,"link-disabled link-"+this.name,a);return}Wikifier.createInternalLink(this.output,b,a,function(){state.active.variables["#choice"][d]=!0;"function"===typeof c&&c()}).classList.add("link-"+this.name)}});macros.add("link",{version:{major:3,minor:4,revision:0},handler:function(){if(0===this.args.length)return this.error("no link location specified");var a,b,c,d,e;3===this.args.length?e=this.args.pop():2!==this.args.length||"keep"!==this.args[1]&&"remove"!==this.args[1]&&"once"!==this.args[1]||(e=this.args.pop());if(e&&"keep"!==e&&"remove"!==e&&"once"!==e)return this.error('"'+e+'" is not a valid action (keep|remove)');2===this.args.length?(a=this.args[0],b=this.args[1]):"object"===typeof this.args[0]?(a=this.args[0].text,b=this.args[0].link,c=this.args[0].isExternal,d=this.args[0].setFn):a=b=this.args[0];void 0===c&&(c=Wikifier.formatterHelpers.isExternalLink(b));if(e)if(!state.active.variables.hasOwnProperty("#link"))state.active.variables["#link"]={};else if(state.active.variables["#link"][b]){"keep"===e&&insertElement(this.output,"span",null,"link-disabled link-"+this.name,a);return}(c?Wikifier.createExternalLink(this.output,b,a):Wikifier.createInternalLink(this.output,b,a,function(){e&&(state.active.variables["#link"][b]=!0);"function"===typeof d&&d()})).classList.add("link-"+this.name)}});macros.add("display",{version:{major:3,minor:1,revision:0},handler:function(){if(0===this.args.length)return this.error("no passage specified");var a;a="object"===typeof this.args[0]?this.args[0].link:this.args[0];if(!tale.has(a))return this.error('passage "'+a+'" does not exist');var b=this.output;a=tale.get(a);this.args[1]&&(b=insertElement(b,this.args[1],null,a.domId),b.setAttribute("data-passage",a.title));new Wikifier(b,a.processText())}});macros.add("nobr",{version:{major:1,minor:1,revision:0},skipArgs:!0,tags:null,handler:function(){new Wikifier(this.output,this.payload[0].contents.replace(/\n/g," "))}});macros.add("print",{version:{major:2,minor:0,revision:0},skipArgs:!0,handler:function(){try{var a=eval(this.args.full);null==a||"number"===typeof a&&isNaN(a)||new Wikifier(this.output,a.toString())}catch(b){return this.error("bad expression: "+b.message)}}});macros.add("silently",{version:{major:4,minor:0,revision:0},skipArgs:!0,tags:null,handler:function(){var a=document.createElement("div"),b=[];for(new Wikifier(a,this.payload[0].contents.trim());a.hasChildNodes();){var c=a.firstChild;c.classList&&c.classList.contains("error")&&b.push(c.textContent);a.removeChild(c)}"function"===typeof a.remove&&a.remove();if(0<b.length)return this.error("error"+(1===b.length?"":"s")+" within contents ("+b.join("; ")+")")}});macros.add("if",{version:{major:3,minor:0,revision:0},skipArgs:!0,tags:["elseif","else"],handler:function(){try{for(var a=0,b=this.payload.length;a<b;a++)if("else"===this.payload[a].name||eval(Wikifier.parse(this.payload[a].arguments))){new Wikifier(this.output,this.payload[a].contents);break}}catch(c){return this.error("bad conditional expression: "+c.message)}}});macros.add("set",{version:{major:3,minor:0,revision:0},skipArgs:!0,handler:function(){macros.eval(this.args.full,this.output,this.name)}});macros.add("unset",{version:{major:2,minor:0,revision:0},skipArgs:!0,handler:function(){for(var a=this.args.full,b=/state\.active\.variables\.(\w+)/g,c;null!==(c=b.exec(a));)c=c[1],state.active.variables.hasOwnProperty(c)&&delete state.active.variables[c]}});macros.add("remember",{version:{major:3,minor:0,revision:0},skipArgs:!0,handler:function(){var a=this.args.full;if(macros.eval(a,this.output,this.name)){for(var b=storage.getItem("remember")||{},c=/state\.active\.variables\.(\w+)/g,d;null!==(d=c.exec(a));)d=d[1],b[d]=state.active.variables[d];if(!storage.setItem("remember",b))return this.error("unknown error, cannot remember: "+this.args.raw)}},init:function(){var a=storage.getItem("remember");if(a)for(var b in a)state.active.variables[b]=a[b]}});macros.add("forget",{version:{major:1,minor:0,revision:0},skipArgs:!0,handler:function(){for(var a=this.args.full,b=/state\.active\.variables\.(\w+)/g,c,d=storage.getItem("remember"),e=!1;null!==(c=b.exec(a));)c=c[1],state.active.variables.hasOwnProperty(c)&&delete state.active.variables[c],d&&d.hasOwnProperty(c)&&(e=!0,delete d[c]);if(e&&!storage.setItem("remember",d))return this.error("unknown error, cannot update remember store")}});macros.add("run","set");macros.add("script",{version:{major:1,minor:0,revision:0},skipArgs:!0,tags:null,handler:function(){macros.eval(this.payload[0].contents.trim(),this.output,this.name)}});macros.add("click",{version:{major:3,minor:0,revision:0},tags:null,handler:function(){if(0===this.args.length)return this.error("no link text specified");var a,b,c=function(){var a;this.context&&state.active.variables.hasOwnProperty("args")&&this.contextHas(function(a){return a.self.isWidget})&&(a=state.active.variables.args);return a}.call(this),d=document.createElement("a");"object"===typeof this.args[0]?(a=this.args[0].text,b=this.args[0].link):(a=this.args[0],b=1<this.args.length?this.args[1]:void 0);d.classList.add("link-"+(b?tale.has(b)?"internal":"broken":"internal"));d.classList.add("link-"+this.name);insertText(d,a);$(d).click(function(a,c,g){return function(){""!==c&&(void 0!==g&&(state.active.variables.hasOwnProperty("args")&&(a.hasOwnProperty("_argsStack")||(a._argsStack=[]),a._argsStack.push(state.active.variables.args)),state.active.variables.args=g),new Wikifier(document.createElement("div"),c),void 0!==g&&(delete state.active.variables.args,a.hasOwnProperty("_argsStack")&&(state.active.variables.args=a._argsStack.pop(),0===a._argsStack.length&&delete a._argsStack)));void 0!==b&&state.display(b,d)}}(this.self,this.payload[0].contents.trim(),c));this.output.appendChild(d)}});macros.add("textbox",{version:{major:1,minor:1,revision:0},handler:function(){if(0===this.args.length)return this.error("no $variable name specified");var a=this.args[0].replace("$",""),b=slugify(a),c=1<this.args.length?this.args[1]:void 0,d=document.createElement("input");d.type="text";d.id="textbox-"+b;"undefined"!==typeof state.active.variables[a]&&(d.value=state.active.variables[a]);$(d).change(function(){state.active.variables[a]=this.value}).keypress(function(a){13===a.which&&(a.preventDefault(),$(this).change(),"undefined"!==typeof c&&state.display(c,this))});this.output.appendChild(d)}});macros.add(["addclass","toggleclass"],{version:{major:2,minor:0,revision:0},protect:!0,handler:function(){if(2>this.args.length){var a=[];1>this.args.length&&a.push("selector");2>this.args.length&&a.push("class names");return this.error("no "+a.join(" or ")+" specified")}a=$(this.args[0]);if(0===a.length)return this.error('no elements matched the selector "'+this.args[0]+'"');switch(this.name){case "addclass":a.addClass(this.args[1].trim());break;case "toggleclass":a.toggleClass(this.args[1].trim())}}});macros.add("removeclass",{version:{major:1,minor:0,revision:0},handler:function(){if(0===this.args.length)return this.error("no selector specified");var a=$(this.args[0]);if(0===a.length)return this.error('no elements matched the selector "'+this.args[0]+'"');1<this.args.length?a.removeClass(this.args[1].trim()):a.removeClass()}});macros.add(["append","prepend","replace"],{version:{major:2,minor:0,revision:0},tags:null,handler:function(){if(0===this.args.length)return this.error("no selector specified");var a=$(this.args[0]);if(0===a.length)return this.error('no elements matched the selector "'+this.args[0]+'"');"replace"===this.name&&a.empty();if(""!==this.payload[0].contents){var b=document.createDocumentFragment();new Wikifier(b,this.payload[0].contents);switch(this.name){case "replace":case "append":a.append(b);break;case "prepend":a.prepend(b)}}}});macros.add("remove",{version:{major:1,minor:0,revision:0},handler:function(){if(0===this.args.length)return this.error("no selector specified");var a=$(this.args[0]);if(0===a.length)return this.error('no elements matched the selector "'+this.args[0]+'"');a.remove()}});macros.add("widget",{version:{major:2,minor:0,revision:0},tags:null,handler:function(){if(0===this.args.length)return this.error("no widget name specified");var a=this.args[0];if(macros.has(a)){if(!macros.get(a).isWidget)return this.error('cannot clobber existing macro "'+a+'"');macros.remove(a)}try{macros.add(a,{version:{major:1,minor:0,revision:0},isWidget:!0,handler:function(a){return function(){try{state.active.variables.hasOwnProperty("args")&&(this.self.hasOwnProperty("_argsStack")||(this.self._argsStack=[]),this.self._argsStack.push(state.active.variables.args));state.active.variables.args=[];for(var b=0,e=this.args.length;b<e;b++)state.active.variables.args[b]=this.args[b];state.active.variables.args.raw=this.args.raw;state.active.variables.args.full=this.args.full;var f=document.createDocumentFragment(),g=document.createElement("div"),b=[];for(new Wikifier(g,a);g.hasChildNodes();){var h=g.firstChild;h.classList&&h.classList.contains("error")&&b.push(h.textContent);f.appendChild(h)}if(0===b.length)this.output.appendChild(f);else return this.error("error"+(1===b.length?"":"s")+" within widget contents ("+b.join("; ")+")")}catch(k){return this.error("cannot execute widget: "+k.message)}finally{delete state.active.variables.args,this.self.hasOwnProperty("_argsStack")&&(state.active.variables.args=this.self._argsStack.pop(),0===this.self._argsStack.length&&delete this.self._argsStack)}}}(this.payload[0].contents)})}catch(b){return this.error('cannot create widget macro "'+a+'": '+b.message)}}});macros.add(["optiontoggle","optionlist"],{version:{major:2,minor:0,revision:0},tags:["onchange"],handler:function(){if(0===this.args.length)return this.error("no option property specified");if("optionlist"===this.name&&2>this.args.length)return this.error("no list specified");var a=this.args[0],b=slugify(a),c=document.createElement("div"),d=document.createElement("div"),e=document.createElement("div");c.appendChild(d);c.appendChild(e);c.id="option-body-"+b;d.id="option-label-"+b;e.id="option-control-"+b;new Wikifier(d,this.payload[0].contents.trim());var f=2===this.payload.length?this.payload[1].contents.trim():"";options.hasOwnProperty(a)||(options[a]=void 0);switch(this.name){case "optiontoggle":var g=1<this.args.length?this.args[1]:void 0,h=document.createElement("a");void 0===options[a]&&(options[a]=!1);options[a]?(insertText(h,g||"On"),h.classList.add("enabled")):insertText(h,g||"Off");$(h).click(function(){return function(b){removeChildren(h);options[a]?(insertText(h,g||"Off"),h.classList.remove("enabled"),options[a]=!1):(insertText(h,g||"On"),h.classList.add("enabled"),options[a]=!0);macros.get("saveoptions").handler();""!==f&&new Wikifier(document.createElement("div"),f)}}());break;case "optionlist":d=this.args[1];h=document.createElement("select");Array.isArray(d)||(d=options.hasOwnProperty(d)?options[d]:d.trim().split(/\s*,\s*/));void 0===options[a]&&(options[a]=d[0]);for(var k=0;k<d.length;k++){var m=document.createElement("option");insertText(m,d[k]);h.appendChild(m)}h.value=options[a];$(h).change(function(){return function(b){options[a]=b.target.value;macros.get("saveoptions").handler();""!==f&&new Wikifier(document.createElement("div"),f)}}())}h.id="option-input-"+b;e.appendChild(h);this.output.appendChild(c)}});macros.add("optionbar",{version:{major:2,minor:0,revision:0},handler:function(){var a=document.createElement("div"),b=document.createElement("button"),c=document.createElement("button");a.appendChild(b);a.appendChild(c);a.classList.add("controls");b.classList.add("ui-close");c.classList.add("ui-close");insertText(b,"Close");insertText(c,"Reset to Defaults");$(c).click(function(a){macros.get("deleteoptions").handler();window.location.reload()});this.output.appendChild(a)}});macros.add("saveoptions",{version:{major:2,minor:0,revision:0},handler:function(){return storage.setItem("options",options)},init:function(){var a=storage.getItem("options");if(null!==a)for(var b in a)options[b]=a[b]}});macros.add("deleteoptions",{version:{major:2,minor:0,revision:0},handler:function(){options={};if(!storage.removeItem("options"))return this.error("unknown error, cannot update options store")}});macros.add("bind","click");macros.add("class",{version:{major:2,minor:2,revision:0},tags:null,handler:function(){var a=insertElement(this.output,this.args[1]||"span",null,this.args[0]||"");new Wikifier(a,this.payload[0].contents)}});macros.add("classupdate",{version:{major:1,minor:0,revision:0},handler:function(){if(3>this.args.length){var a=[];1>this.args.length&&a.push("element ID");2>this.args.length&&a.push("action");3>this.args.length&&a.push("class names");return this.error("no "+a.join(" or ")+" specified")}var a="body"===this.args[0]?document.body:document.getElementById(this.args[0]),b=this.args[1],c=this.args[2].trim().split(/\s+/);if(!a)return this.error('element with ID "'+this.args[0]+'" does not exist');if("add"!==b&&"remove"!==b&&"toggle"!==b)return this.error('"'+b+'" is not a valid action (add|remove|toggle)');for(var d=0;d<c.length;d++)switch(b){case "add":a.classList.add(c[d]);break;case "remove":a.classList.remove(c[d]);break;case "toggle":a.classList.toggle(c[d])}}});macros.add("id",{version:{major:2,minor:2,revision:0},tags:null,handler:function(){var a=insertElement(this.output,this.args[1]||"span",this.args[0]||"");new Wikifier(a,this.payload[0].contents)}});macros.add("runjs",{version:{major:3,minor:0,revision:0},skipArgs:!0,handler:function(){macros.eval(this.args.raw,this.output,this.name)}});macros.add("update",{version:{major:2,minor:0,revision:0},tags:null,handler:function(){if(0===this.args.length)return this.error("no element ID specified");var a=document.getElementById(this.args[0]),b=this.args[1];if(!a)return this.error('element with ID "'+this.args[0]+'" does not exist');if(b&&"append"!==b&&"prepend"!==b&&"replace"!==b)return this.error('"'+b+'" is not a valid action (append|prepend|replace)');switch(b){case "prepend":b=document.createDocumentFragment();new Wikifier(b,this.payload[0].contents);a.insertBefore(b,a.firstChild);break;case "append":new Wikifier(a,this.payload[0].contents);break;default:removeChildren(a),new Wikifier(a,this.payload[0].contents)}}})};
}());
</script>
<style type="text/css">
/* Loading screen styling */
body > #loading-screen { display: none; z-index: 100000; position: fixed; top: 0px; left: 0px; height: 100%; width: 100%; color: #fff; background-color: #111; text-align: center; }
body > #loading-screen p { font-family: verdana,"dejavu sans",tahoma,arial,sans-serif; font-size: 2em; font-weight: bold; font-style: italic; }
html.loading body > #loading-screen { display: block; }
html.loading body > #ui-bar, html.loading body > #passages { display: none; }

@font-face
{
	font-family: 'icomoon-sugarcube';
	src: url(data:application/font-woff;charset=utf-8;base64,d09GRk9UVE8AABEkAAsAAAAAHHgAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABDRkYgAAABCAAADeQAABb40HwEm0ZGVE0AAA7sAAAAGgAAABxmn3O0R0RFRgAADwgAAAAdAAAAIABOAARPUy8yAAAPKAAAAEsAAABgL9zcQGNtYXAAAA90AAAAPQAAAVLgMPLNaGVhZAAAD7QAAAAuAAAANv41RT9oaGVhAAAP5AAAAB4AAAAkBBD/5GhtdHgAABAEAAAAHgAAAEgEkACpbWF4cAAAECQAAAAGAAAABgAhUABuYW1lAAAQLAAAAOsAAAIHCW+4AnBvc3QAABEYAAAADAAAACAAAwAAeJyNWAl0lEUS7j9OZoYkThLIIGcCCASYABkIQkQQMHIFEWEERBQEvBgE1ImrnAIRlB+E1QmycoiRS8IqizHgystjMRwyHgkEQcK94ALBAJrNPzBDar/qngxR43v7Jq+6u7q76qvq6ur6owmTSWiaVv/5idNemDZtaseXs5596qWJWROeFlqE0ERvf88I/313+BuZ9Jg79BhTYpRoPKI+6Xq4E2NZPNmf48+KbKblxTYTIq6ZdiW+mYhpZo+oL1qxDKuIFQ1Fc9FaOEQXkS76iAFiqHhUjBUTxWTxonhVzBULxVLhFatErvhYbBM7RKHYK74Rh8VxcVb8ot2RNfX5/qmpqWgeDDdO1XRRTVfVpKmmm2ruUU131fRQTbpq+qqmn2oeUE2Gah5UTX/ZOJU+p9LnVPqcSp9T6XMqfU6lz6n0OZU+p9LnVPqcSp9T6XMqfc4H/+D9Px6HENoi7U3tLW2xpmtLtKXa29oybbn2V+0d7V3Nq+VoK7T3tJXa37T3tVXaam2Ntlb7QFunfajlah9p67UN2kbRkk8jQsSIUi3N1NDU0bTBtNd0wnQxcnDkqMjtZpu5o3moOcucYzYsvSyBesOix9xpjm0VOyz2qzgtLil+RPwz8Xr9Ypvu95iCXr/XYvNnG/l2EtYfTCQs7YNEfvTIaB9MclhkG+LUsBMDGYEMc50zjtpsKYzFJhnYYKlzptxSS3GYnWhkGNBQ10y5uU6kkG8z1pvq3OL31L3nT6wLeuo2wkZawLWLREbeG/CWttVKVD1iJ3rd5qMXvY+E2LeZ6Fb5QhIRSXOIbj58GhNfQ9CN0UeIAi/YJMG+gnXZTPpFMuOd0NSN0aVYfrA3b1zLImaFhEmx1TFWVjWPlXpYfT3IoepXMK0B76S/20isGtFV9WjS1m8hm2gWk9lM5jApDJPZLKcAxJXO4Bey5rmsD8AofbTCQLfOYHjjsdGseQ9gTvmWhOmdX6QF/UgMGjdbWhArucpWYd7kYPCFJCK3tWTwlzFMmKnAC60yHSRvH1swGLOiH5MFYdI3TLKtbFAaEw8b9A16w6+xzTvZ5oGRDP7emoMAeMguVOChbwaDX8AYWrDmr4Br42WGeT1kAcAXMtkdqcCDbONFm7H8HhNvXM8i+rEw9mL6+wo8VM1hpYOkequEEgK1avgvtYBK3PJwFFrsWVJjeuUsFTYSKFz0DOuboM5cYpBxoJwaeGGYRDuHnb5Qor2mIkYCVWEjD+rmw2cUUBxjhgIq4xIn7ZfHHYoYiRZx8k4Y7VTZi7T5M/xp9rKegVL8XIarrMwwBUyR0LRvx1IS9raX7aSlz91NWtqysURrOEyfarWcqH3qR0Qp8C2t+tdAEhO2zFWztPbkdCC+J2VwQxIp2WNIOErakZjUG/rXPNqHxA/fjyVxmG1JyV5NVNq5CVUH+UDFnocAx2NqEeX35NlbRhmVfpPdlxnw4JdmpPl85Y7fzJcblfaA18DPUpttM7x+j71VVNBlujvKYbhwcdNuVQJGREyIyGGYR6XokY97vvCwDl54b+JvNCBFzKoY6YaWJWPgm/fyq4nOdelE4tcGfqquzD6F47JMseokZnVeG3CxjwMujOZceg1uOj1eIA56fUZU5cb5TTjxM9H+u+sTrQxctMJFC+KvQBXRy+tPEj2XGUGi+XcjiWKuWEmLnnEGkeP3QjYtKJ5gSMkGZNO8hotwVVqsEwiQPctI1PMih61pVUKix8lUEs+aGllthsfErtPhWq8uc0TAhTMQ/XSw4Gev4YF3A17dSAOR19ZwESQW6mAhQDRwGBuzsDAN+7wQwQt1xUzTI+EqtzokzIO6pCZdKjJ4vtzvsvsTgviZjco8u8FhWGrJzERPz3MHE3Tdn5DnhqdWrFuAoBs3G844VHiTRMe+uGXjIE2MF5pKr7gxs2C/zoaExrNhiQsofZl60BX0Qpo30vBm2gMJPiPBYkCtXSft6dnbiS7MhmuazB9KdHx+MTshkM+WunU9mMB2+DmSlk5YTuKlNdOJuEfoJcGYz976J9Gp13ALv3zyC6KDPyKZlty1FDF9ZMvuLwE++UQFibs7rSTRuM14El1ffQQuSn/sLtDJ9bB3izWfxKNV/YlyjCEQePDmWdBi5Ee6PO8g0ck+uOsn+5qRFQYUNSLa2SsVQaTzgQwOXCT6PKIYWjqNMEA4Qd5fDQ8121xFov8/knUcdilpK/J3wYCxC58hOp+1h8QDjHfLQ6VQ9P6iT4A1exCQrCroHyJymD0oyEMkx0kYipkF/ROB+elXh/P+MmDensIy25Bourg3ZOyKzMUL+/OFXLykjRsSXR3zJFHl9m1E11dXhMjZ/Z+EyNXHJxEdLbkCCEcecClKIm79asklkdhjuFqJ3iOhXruOh9VG0WFXhV5D23U8pDbKPb8ncqJdpwS5fKtVNSxlo2Sz5CkhbYxQ2CYUK+gi+qFhyhxh+emyFa/c0gfPI559nHNIO3QhkcQnZwRXUqduEl3LxWWL8ewi+hWnImwTj6GqKHoMfvn2U+TpzcfP4VqWdBqJOOOXt2gqVF9LvorYQ2hQyZJ6WJ7cATx+zwOHOgFEH34ioyPQe2UR5KwaNwsvP+08QqLbOU5MC/F4OVa+i5B55hIcWNHvTtCrT/yK/T3Avb71O8jceFlCOE1iVJvxHCirO+DA2l6CZ+LwVvact5ghAFYnD147I6GaROyLV2BFFh7RGNtxyFlwFDbeNxkB2OXh23KO4wJesEBYzx1DsOcQntMmJ7ZiYhHCwno9GbxZmDU53oCqq3gc6CQSaVz+DMiZ9KEsV6pBvz5TBCtW4GUrbYFr261oNfwaf2QPDiqu4E3sLwUiG6dKq3wZuwxrwd5cx97sPgTxfBHlwtVjOL4iAAIERFnJa3fB6I5NzkF81jycUDonDLzLQPd8Dyav8bAPTwywMkXglqx4k2cQ+PuQY0B2Mq9/iIR5WBJk3iIpNRFvqJEADSmdjuOWl7QlOsHnebjkOZDiCzyEC090bsq8tiFyQi7GrEjp3BRJRJj4aRVjmqF3L4jYhHrC1ELAiHZzZ5Nw7+bS8brnXoRH5Uyi8rXINFUfvkV0yf2GbmWpySz1x9tSGdFKRpTM5Dke/phEoqF3JtQlPDWA9+Pptun7WSafydHXF7CmbD6Z0XFSP3obzktMCqO1lp2KyGFt24//3s4wL5HRLtQZPbxY78lXlEUiNnqhtBNVl/f+QkSW2OxEBJ/BiYvHytDbex6bAtsmKApMG9tILnqjvkfvdKFEP79mv00/wFL3s50DWdNf2O4ZSIV42JDI6YNh63GRqhsjB15y4HrdbIOUdZlr8qqrqHOuLLoGgb2qb8Louy1IVS+fhafPVKLG9N+H6Po3eELy9h/apsNd51Bq0jHOxYc3wur/tEaW/u7JNJ1pN9DD7MRGZZg/twm5JhlPsNqrZNGSxL+wfNTMlq/qK52CeRJDpEIlGrwap5AKu6y9G6PubVhabZXm5OEl3JCIGI+owE1uPeo7XN0quKKlA98TDfguNlk9BUs/tTig9IR/OCvAKSRF43Ja9hTjwQCPJG/UqCidT+GlaSCjfwB5uQBk5AHudQUZ9TZREDWJqLe7D4Ck4CMhKqsIzoo6VwyadnYxcuzNcyCn8LnSLZJfDUWZS0daLg59lvgSC4Dmv81TWcoS9BbjYyi4AYFSdX8ha8PNps35CgF6lYwKiZE2pVgVToUbhzGQbcFXjb9XqrKPmAd7U9iWBtdxLBcmutgruMunSmcoT1HZ5i5W5Tqbz5Tp9/osQReus8NXbslDG/D4DI8lzxEqGfIQPYFSn1FqCVeBk/A6vsSh+kSLGiKHTCi3ZoKWhkluzcRtnlqSG9qW5DbO2zN9PktewGvPcxsJDneew+2GSg8Q8YSPqzNXJsoTsyNTd/v0cvzBynh8YSHp4zPLxp96FSMKEh1l9tZRX5rayMI4I9R3ByqlnEzDCzk+w8XmkLb8Iy5ytk7eTdXLxm6l6k0dXmffgcHVD1UacDdTOHlZE7wU6/ZCW/NKRFWbVxZR9ZAXtyBUr/b1Icp78gPYuxuuwgZUPK3aXkaO0rZvmmLmwWadJ1FQNBqzjjf0R11b1EiKOUDaZ2+PjGTh+Gyy8SPHCoVl+k8KgBVVIUDGf4wPT9tIU4jIYZhH19GjCu5VhId18MJ7E/NkVqhgp12v8SEPk3IcO/ScP3EtqlcPCtWg18wfKKgYURcbCfieAs91mwe/e+3uQH4wweJ2636XrK7z7Vy+oXKLkYSfMv6e5/KNdkcMRVR/jGfoi6ErObffrjhryk5FbpeiXJkitw/hYkpkXMSFaXnsXYi7ArzdcvpAxvdH4cUOrRtB062uMCD4/Wn0uEgLch4L+n8AuYFh2a7JTNzYcqAKqdDiIPpmB5+8oswVDfxHeFF7ZBrUbOht5d5RtVykdud72XVglaJqOXPVcpBjarkayokG/lK1xVqzk9mQl6LWsw6YsfO+dpKwExN0+5KYqGYipoEw83/I6ol4MVF8rr2pHfd7g/iZo/0u1P0uS3Rdpfuf+5XCi0WNc0PDGl5SNJfuQa7aTSEih0xoS80E5YTJlpqJ2zy1ZEtoG0vsvqwJZ8+eG/EWPYHPkeRBPfCqFByo3bPnojj1FY3BSRyY/pOkF9RycB9Xi35DvpbLeUnnWlt0xYW4ErUIKrqHez3UckDZoDOsplbZNFHrJUK5Xi6t1ZMTjJD36Nbo/zd063KxIrePQn5tRf8PlqV0RnicY2BgYGQAgpOd+YYg+lw3kyOMBgA8PwUsAAB4nGNgZGBg4ANiCQYQYGJgBEIFIGYB8xgABaoAUwAAAHicY2BmYmCcwMDKwMHow5jGwMDgDqW/MkgytDAwMDGwMjPAgQCCyRCQ5prC4PCA4QMD44P/Dxj0GB8wKDQwMDDCFSgAISMAEEIMHwB4nGNgYGBmgGAZBkYGEPAB8hjBfBYGAyDNAYRMIIkHch8Y/v8HsxggLAUmAUaoLjBgZGNA5o5IAADrtAjMAAAAeJxjYGRgYADild0rzsfz23xl4GZiAIFz3UyOCPr/AyYGxgdALgcDWBoAMdIKXgAAeJxjYGRgYHzw/wGDHhMDA8M/BiAJFEEBzABt5wP2AAB4nGNigAAmBqxAgcEAiQ0hOdHUJDA4MDAAABelAT4AAAAAUAAAIQAAeJydj81Kw0AUhb9pk0LRTV3oNhS3iTMRXNR9F66lq4K0IYQsmoFJ8yo+iG/km3gSZyEoCB243I9zz/0Z4Jp3DOMzrLiPPGPJS+Q5BR+RE1YmjZxyZR4iL6S/yWmSpZT11DXyjBueIs/Z8xo5keczcsqtuYu8YG2eaanwnBSejpyegYYDQfrAkRrayp+87/J+aA6hGo6S/nD9qG6nWecpB/lqMkr9zCpvFP/v/PaVOFWd+nKxFT1quO/OWx+aOisLm22yX9dJK13ubF5aJ/9lH9xJD/K2U1em1eP57OrQt77LXGEvnPwFPSJZ7QB4nGNgZsALAAB9AAQ=) format('woff');
	font-weight: normal;
	font-style: normal;
}

body { margin: 3.5em 15% 5% 3.5em; color: #fff; background-color: #111; font-family: verdana,"dejavu sans",tahoma,arial,sans-serif; font-size: 12px; }
a { cursor: pointer; color: #46d; }
a:hover { color: #79f; }
a:active { color: #f70; }
a.link-internal, a.link-external, a.link-back, a.link-return { font-weight: bold; text-decoration: none; }
a.link-internal:hover, a.link-external:hover, a.link-back:hover, a.link-return:hover { text-decoration: underline; }
a.link-broken { padding: 3px; color: #000; background-color: red; font-weight: bold; text-decoration: none; }
input, textarea { min-width: 16em; color: #fff; background-color: #444; border: 1px solid #fff; }
input { padding: 2px 3px; }
input:focus, textarea:focus { border: 1px solid #292; }
input:hover, textarea:hover { border: 1px solid #f70; }
noscript { color: red; font-size: 210%; font-weight: bold; }
button
{
	cursor: pointer;
	padding: 4px 6px;
	color: #fff;
	background-color: #36c;
	border: 1px solid #58e;
	-webkit-border-radius: 4px;
	-moz-border-radius: 4px;
	border-radius: 4px;
	text-decoration: none;
	text-shadow: 1px 1px rgba(0, 0, 0, 0.4);
	-webkit-transition-duration: 200ms;
	-moz-transition-duration: 200ms;
	transition-duration: 200ms;
	-webkit-user-select: none;
	-khtml-user-select: none;
	-moz-user-select: none;
	-ms-user-select: none;
	-o-user-select: none;
	user-select: none;
}
button:hover { background-color: #58e; border: 1px solid #7af; }
button:active { background-color: #f70; border: 1px solid #f92; }
.error { margin: 0 12px 0 3px; padding: 3px 5px; color: #000; background-color: red; font-weight: bold; }
.highlight, .marked { color: yellow; font-weight: bold; font-style: italic; }
.transition-in { opacity: 0; }

#ui-bar { position: fixed; top: 3.5em; left: 3.5em; width: 14.5em; margin: 0; padding: 0 1.5em 0 0; border-right: 1px solid #fff; }
#ui-bar header, #ui-bar nav, #ui-bar footer { text-align: right; }
#ui-bar header, #ui-bar nav { font-weight: bold; }
#ui-bar nav, #ui-bar footer { margin-top: 3em; }
#ui-bar ul { list-style: none; }
#ui-bar li { margin-bottom: 1em; }
#ui-bar li a { text-decoration: none; }

#story-caption, #menu-story, #menu-rewind, #menu-options, #menu-share { display: none; }
#story-title { margin: 0; font-size: 210%; }
#story-subtitle { font-size: 111%; }
#story-author { font-size: 111%; }
#story-caption { margin-top: 3em; text-align: right; }
#menu-story { line-height: 1.2; }

[data-icon], a.link-back:before, a.link-return:after, a.link-external:after,
#menu-saves a:before, #menu-rewind a:before, #menu-restart a:before, #menu-options a:before, #menu-share a:before,
#ui-body.options a[id|="option-input"]:before, #ui-body.options a[id|="option-input"].enabled:before
{
	font-family: 'icomoon-sugarcube';
	speak: none;
	font-style: normal;
	font-weight: normal;
	font-variant: normal;
	text-transform: none;
	line-height: 1;
	-webkit-font-smoothing: antialiased;
	-moz-osx-font-smoothing: grayscale;
}
[data-icon]:before { content: attr(data-icon) "\00a0\00a0"; }
a.link-back:before { content: "\e00a\00a0\00a0"; }
a.link-return:after { content: "\00a0\00a0\e00b"; }
#passages a.link-external:after { content: "\00a0\e010"; }
#menu-saves a:before { content: "\e011\00a0\00a0"; }
#menu-rewind a:before { content: "\e012\00a0\00a0"; }
#menu-restart a:before { content: "\e013\00a0\00a0"; }
#menu-options a:before { content: "\e014\00a0\00a0"; }
#menu-share a:before { content: "\e015\00a0\00a0"; }

#credits, #version { margin-top: 1em; color: #999; font-weight: normal; font-size: 71%; }

/* Default menu styling */
body.ui-open { overflow: hidden; }
#ui-overlay
{
	display: none;
	z-index: 1000;
	opacity: 0.8;
	position: fixed;
	top: 0px;
	left: 0px;
	height: 100%;
	width: 100%;
	background-color: #000;
}
#ui-body
{
	display: none;
	z-index: 1100;
	opacity: 1;
	position: fixed;
	overflow: auto;
	min-width: 140px;
	max-width: 90%;
	max-height: 90%;
	color: #fff;
	background-color: #333;
	border: 1px solid #fff;
	text-align: left;
	line-height: 2;
}
#ui-body div
{
	padding: 0.2em;
}
#ui-body hr { height: 1px; border: none; background-color: #fff; }

/* Default menu button styling */
#ui-body > ul > li + li > button, #ui-body .controls > button + button
{
	margin-left: 12px;
}

/* Saves menu styling */
#ui-body.saves table
{
	border-spacing: 0;
	min-width: 320px;
	width: 100%;
}
#ui-body.saves tr:nth-child(even)
{
	background-color: #444;
}
#ui-body.saves td
{
	padding: 0.33em 0.33em;
	line-height: 1.2;
}
#ui-body.saves td:first-child
{
	min-width: 1.5em;
	text-align: center;
}
#ui-body.saves .empty
{
	color: #999;
}
#ui-body.saves ul { display: block; margin: 0; padding: 0; list-style: none; white-space: nowrap; }
#ui-body.saves li { display: inline-block; margin: 0; padding: 0.33em 0.33em 0.4em; }
#ui-body.saves > div:not(:first-child) { border-top: 1px solid #fff; }
#saves-import-label { margin: 0 6px; font-weight: bold; }
#saves-import-file { margin: 0 6px 6px; }

/* Rewind & Share menu styling */
#ui-body.share a { display: block; color: #fff; font-weight: normal; text-decoration: none; }
#ui-body.rewind div, #ui-body.share div, #ui-body.share a
{
	padding: 0.15em 0.75em;
	-webkit-user-select: none;
	-khtml-user-select: none;
	-moz-user-select: none;
	-ms-user-select: none;
	-o-user-select: none;
	user-select: none;
}
#ui-body.rewind div:nth-child(even), #ui-body.share div:nth-child(even), #ui-body.share a:nth-child(even)
{
	background-color: #444;
}
#ui-body.rewind div:hover, #ui-body.share div:hover, #ui-body.share a:hover
{
	cursor: pointer;
	color: #fff;
	background-color: #47b;
}
#ui-body.rewind div:active, #ui-body.share div:active, #ui-body.share a:active
{
	background-color: #47b;
}

/* Options & Restart menu styling */
#ui-body.options, #ui-body.restart
{
	min-width: 280px;
	padding: 0.33em 1em 0.66em;
}
/*
@media screen and (min-width: ???) { #ui-body.options { min-width: ???; } }
*/
#ui-body.options ul, #ui-body.restart ul { display: block; margin: 0; padding: 0; list-style: none; }
#ui-body.options li, #ui-body.restart li { display: inline-block; margin: 0; padding: 0.4em 0.4em 0.5em; }
#ui-body.options [id|="option-body"] { display: table; width: 100%; }
#ui-body.options div[id|="option-body"] + div[id|="option-body"],
#ui-body.options div[id|="option-body"] + br + div[id|="option-body"]
{
	margin-top: 0.5em;
}
#ui-body.options [id|="option-label"] { display: table-cell; width: 80%; padding: 0.33em 2em 0.4em 0.33em; }
#ui-body.options [id|="option-control"] { display: table-cell; padding: 0.33em 0.33em 0.4em; white-space: nowrap; }
#ui-body.options select[id|="option-input"]
{
	cursor: pointer;
	padding: 3px 6px;
	font-weight: normal;
	color: #fff;
	background-color: #36c;
	border: 1px solid #58e;
	-webkit-border-radius: 4px;
	-moz-border-radius: 4px;
	border-radius: 4px;
	text-decoration: none;
	text-shadow: 1px 1px rgba(0, 0, 0, 0.4);
	-webkit-transition-duration: 200ms;
	-moz-transition-duration: 200ms;
	transition-duration: 200ms;
	white-space: nowrap;
}
#ui-body.options a[id|="option-input"]
{
	cursor: pointer;
	padding: 4px 6px;
	font-weight: normal;
	color: #fff;
	background-color: #36c;
	border: 1px solid #58e;
	-webkit-border-radius: 4px;
	-moz-border-radius: 4px;
	border-radius: 4px;
	text-decoration: none;
	text-shadow: 1px 1px rgba(0, 0, 0, 0.4);
	-webkit-transition-duration: 200ms;
	-moz-transition-duration: 200ms;
	transition-duration: 200ms;
	-webkit-user-select: none;
	-khtml-user-select: none;
	-moz-user-select: none;
	-ms-user-select: none;
	-o-user-select: none;
	user-select: none;
	white-space: nowrap;
}
#ui-body.options a[id|="option-input"]:hover
{
	background-color: #58e;
	border: 1px solid #7af;
	text-decoration: none;
}
#ui-body.options a[id|="option-input"].enabled
{
	background-color: #292;
	border: 1px solid #4b4;
	text-decoration: none;
}
#ui-body.options a[id|="option-input"].enabled:hover
{
	background-color: #4b4;
	border: 1px solid #6d6;
	text-decoration: none;
}
#ui-body.options a[id|="option-input"]:before { content: "\e002\00a0\00a0"; }
#ui-body.options a[id|="option-input"].enabled:before { content: "\e003\00a0\00a0"; }

#passages { margin-left: 16em; padding-left: 1.5em; border-left: 1px solid #fff; }
.passage { line-height: 1.75; margin-bottom: 2em; text-align: left; transition: opacity 400ms ease-in; -webkit-transition: opacity 400ms ease-in; }
.passage .actions { list-style: none; padding-top: 1.3em; text-align: center; }
.passage .actions li { display: inline; margin-right: 6em; }
.passage ul, .passage ol { margin-left: 0.5em; padding-left: 1.5em; }
.passage table { margin: 0.8em 1.0em; border-collapse: collapse; font-size: 100%; }
.passage th, .passage td, .passage tr, .passage caption { padding: 3px; }
.passage hr { height: 1px; border: none; background-color: #fff; }

#store-area { display: none; }
</style>
</head>
<body id="body">
	<div id="loading-screen"><p>Loading Story Resources&hellip;<br /><progress></progress></p></div>
	<div id="ui-bar">
		<header id="title">
			<div id="story-banner"></div>
			<h1 id="story-title"></h1>
			<div id="story-subtitle"></div>
			<div id="story-title-separator"></div>
			<p id="story-author"></p>
		</header>
		<div id="story-caption"></div>
		<nav>
			<ul>
				<li id="menu-story"></li>
				<li id="menu-saves"><a>Saves</a></li>
				<li id="menu-rewind"><a>Rewind</a></li>
				<li id="menu-restart"><a>Restart</a></li>
				<li id="menu-options"><a>Options</a></li>
				<li id="menu-share"><a>Share</a></li>
			</ul>
		</nav>
		<footer>
			<p id="credits">This story was created with <a href="http://twinery.org/" target="_blank">Twine</a> and is powered by <a href="http://www.motoslave.net/sugarcube/" target="_blank">SugarCube</a>, which is based on <a href="http://tiddlywiki.com/" target="_blank">TiddlyWiki</a></p>
			<p id="version">SugarCube (&#x03b2;-2850)</p>
		</footer>
	</div>

	<div role="main" id="passages"><noscript>Please enable JavaScript to play this story!</noscript></div>

	<div id="store-area">
<div tiddler="" tags="" modified="201401161525" created="201401161525" modifier="twee">/%%%%%%%%%%%%%%%%%%%%%%%%%%\nTodo:\nResize all background images to 1440x900 (http://www.webmalama.com/the-best-full-screen-background-image-sizes-for-web-design/)\nUse smaller images with an overlay to mask image degradation: http://solemone.de/demos/fullsize-background-image-with-css3-background-size/\niOS resolutions: http://www.iosres.com/\nConsider conversion of some resources to data URIs: http://css-tricks.com/data-uris/\nCredits page for all images used (final passage?)\n\nImages\nhttps://farm8.staticflickr.com/7381/9729745463_1386659d7d_b.jpg\nJonathan C Williams - Beautiful clear beaches of Tarifa, Spain\n\nhttps://farm8.staticflickr.com/7365/9732663006_b3b2ea7a2a_h.jpg\nMartha Ann Babbitt - Looking out onto Lake Como, Italy\n\nhttps://farm6.staticflickr.com/5343/9732659004_da85071c30_h.jpg\nSushma Boppana - Hillside Door in Budapest, Hungary\n\nhttps://farm8.staticflickr.com/7361/9732971090_eaa34a3faf_h.jpg\nCaleb Pike Umlauf - Bridge to Giant's Eye, N. Ireland\n\nhttps://farm6.staticflickr.com/5459/9729744099_32bf049d97_h.jpg\nJohn Franklin Sims-Jones - Fields and mountains near the Incan ruins of Moray\n\nhttps://farm8.staticflickr.com/7434/9729769853_d1b836868f_h.jpg\nAbby Marie Pribish - Lake Geneva Through the Foliage, Switzerland\n\nhttps://farm3.staticflickr.com/2820/9732971742_371e8d78c9_h.jpg\nDanielle Antoinette Morrison - Rooftop View, Segovia, Spain\n\nhttps://farm4.staticflickr.com/3760/9732827666_cb167630e2_b.jpg\nCourtney Elizabeth Hyland - Heliconia flowers in Costa Rica.\n\nhttps://farm3.staticflickr.com/2856/9732986242_3b2842448e_h.jpg\nChristina Anne Helena Snider - Apartment Buildings in San Telmo Neighborhood, Buenos Aires, Argentina\n\nhttps://farm4.staticflickr.com/3671/9732835282_7235344936_h.jpg\nJoshua LouAllen Grubb - Checkered Lawn - Jardn Japons (Japanese Garden), Buenos Aires (Argentina)\n\n%%%%%%%%%%%%%%%%%%%%%%%%%%/</div><div tiddler="CSS for replacelinks macros" tags="stylesheet" modified="201401161525" created="201401161525" modifier="twee">.revision-span-in { opacity: 0; }\n.revision-span:not(.revision-span-out) { transition: 0.4s; -webkit-transition: 0.4s; }\n.revision-span-out { position: absolute; opacity: 0; }</div><div tiddler="Sidebar Title" tags="widget" modified="201401161525" created="201401161525" modifier="twee">/% Syntax:\n    &lt;&lt;sidebar [text]&gt;&gt; %/\s\n&lt;&lt;widget &quot;sidebar&quot;&gt;&gt;\s\n    &lt;hr class=&quot;sidebar&quot;&gt;\s\n    &lt;h4 class=&quot;sidebar&quot;&gt;Additional Information&lt;/h4&gt;\s\n    &lt;h1 class=&quot;sidebar&quot;&gt;&lt;&lt;print $args[0]&gt;&gt;&lt;/h1&gt;\s\n    &lt;hr class=&quot;sidebar&quot;&gt;\s\n    &lt;h6 class=&quot;sidebar&quot;&gt;&lt;&lt;back &quot;Back&quot;&gt;&gt;&lt;/h6&gt;\s\n&lt;&lt;/widget&gt;&gt;\s</div><div tiddler="Continue Button" tags="widget" modified="201401161525" created="201401161525" modifier="twee">/% Syntax:\n    &lt;&lt;continue&gt;&gt;  %/\s\n&lt;&lt;widget &quot;continue&quot;&gt;&gt;\s\n    &lt;span class='continue-button' style=&quot;clear:both;&quot;&gt;&lt;&lt;link &quot;Continue&quot; $args[0]&gt;&gt;&lt;span class=&quot;anim-wrapper&quot;&gt;&lt;span class='onward-arrow fade-bounce'&gt;&raquo;&lt;/span&gt;&lt;/span&gt;&emsp;&lt;/span&gt;\s\n&lt;&lt;/widget&gt;&gt;\s</div><div tiddler="Replace Links" tags="script" modified="201401161525" created="201401161525" modifier="twee">/*! &lt;&lt;replacelink&gt;&gt; macro set (SugarCube Edition) */\n(function(){&quot;use strict&quot;;var requiredSugarCubeBuild=2680;if(!version||!version.build||version.build&lt;requiredSugarCubeBuild)throw new Error(&quot;&lt;&lt;replacelink&gt;&gt; macro set requires SugarCube build &quot;+requiredSugarCubeBuild+&quot; or greater, disabling macro set&quot;);version.extensions[&quot;replacelinkMacroSet&quot;]={major:1,minor:1,revision:2};function showVer(n,notrans){n.innerHTML=&quot;&quot;;new Wikifier(n,n.tweecode);n.setAttribute(&quot;data-enabled&quot;,&quot;true&quot;);n.style.display=&quot;inline&quot;;n.classList.remove(&quot;revision-span-out&quot;);if(!notrans){n.classList.add(&quot;revision-span-in&quot;);\nif(n.timeout)clearTimeout(n.timeout);n.timeout=setTimeout(function(){n.classList.remove(&quot;revision-span-in&quot;);n=null},1)}}function hideVer(n,notrans){n.setAttribute(&quot;data-enabled&quot;,&quot;false&quot;);n.classList.remove(&quot;revision-span-in&quot;);if(n.timeout)clearTimeout(n.timeout);if(!notrans){n.classList.add(&quot;revision-span-out&quot;);n.timeout=setTimeout(function(){if(n.getAttribute(&quot;data-enabled&quot;)===&quot;false&quot;){n.classList.remove(&quot;revision-span-out&quot;);n.style.display=&quot;none&quot;;n.innerHTML=&quot;&quot;}n=null},1E3)}else{n.style.display=\n&quot;none&quot;;n.innerHTML=&quot;&quot;;n=null}}function tagcontents(b,starttags,desttags,endtags,k){function tagfound(i,e){for(var j=0;j&lt;e.length;j++)if(a.indexOf(&quot;&lt;&lt;&quot;+e[j],i)===i)return e[j]}var l=0,c=&quot;&quot;,tg,a=b.source.slice(k);for(var i=0;i&lt;a.length;i++){if(tg=tagfound(i,starttags))l++;else if((tg=tagfound(i,desttags))&&l===0){b.nextMatch=k+i+tg.length+4;return[c,tg]}else if(tg=tagfound(i,endtags)){l--;if(l&lt;0)return null}c+=a.charAt(i)}return null}function revisionSpanHandler(g,e,f,b){function mkspan(vtype){h=insertElement(m,\n&quot;span&quot;,null,&quot;revision-span &quot;+vtype);h.setAttribute(&quot;data-enabled&quot;,false);h.style.display=&quot;none&quot;;h.tweecode=&quot;&quot;;return h}var k=b.source.indexOf(&quot;&gt;&gt;&quot;,b.matchStart)+2,vsns=[],vtype=e,flen=f.length,becomes,c,cn,m,h,vsn;if(this.shorthand&&flen)while(f.length&gt;0)vsns.push([f.shift(),this.flavour===&quot;insert&quot;?&quot;gains&quot;:&quot;becomes&quot;]);else if(this.flavour===&quot;insert&quot;||this.flavour===&quot;continue&quot;&&this.trigger===&quot;time&quot;)vsns.push([&quot;&quot;,&quot;becomes&quot;]);if(this.flavour===&quot;continue&quot;&&flen){b.nextMatch=k+b.source.slice(k).length;\nvsns.push([b.source.slice(k),vtype])}else{becomes=[&quot;becomes&quot;,&quot;gains&quot;];c=tagcontents(b,begintags,becomes.concat(endtags),endtags,k);if(c&&endtags.indexOf(c[1])===-1){while(c){vsns.push(c);c=tagcontents(b,begintags,becomes,endtags,b.nextMatch)}c=tagcontents(b,begintags,[&quot;/&quot;+e,&quot;end&quot;+e],endtags,b.nextMatch)}if(!c){throwError(g,&quot;&lt;&lt;&quot;+e+&quot;&gt;&gt;: cannot find a matching close tag&quot;);return}vsns.push(c);if(this.flavour===&quot;continue&quot;){k=b.nextMatch;b.nextMatch=k+b.source.slice(k).length;vsns.push([b.source.slice(k),\n&quot;&quot;])}}if(this.flavour===&quot;remove&quot;)vsns.push([&quot;&quot;,&quot;becomes&quot;]);cn=0;m=insertElement(g,&quot;span&quot;,null,e);m.setAttribute(&quot;data-flavour&quot;,this.flavour);h=mkspan(&quot;initial&quot;);vsn=vsns.shift();h.tweecode=vsn[0];showVer(h,true);while(vsns.length&gt;0){if(vsn)vtype=vsn[1];vsn=vsns.shift();h=mkspan(vtype);h.tweecode=vsn[0]}if(typeof this.setup===&quot;function&quot;)this.setup(m,g,e,f)}function quantity(m){return m.children.length-1+(m.getAttribute(&quot;data-flavour&quot;)===&quot;remove&quot;?1:0)}function revisionSetup(m,g,e,f){m.className+=&quot; &quot;+\nf[0].replace(&quot; &quot;,&quot;_&quot;)}function keySetup(m,g,e,f){var fl=this.flavour,key=f[0];m.setEventListener(&quot;keydown&quot;,function l(e){var done=!revise(&quot;revise&quot;,m);if(done)m.removeEventListener(&quot;keydown&quot;,l)})}function timeSetup(m,g,e,f){function cssTimeUnit(s){if(typeof s===&quot;string&quot;)if(s.slice(-2).toLowerCase()===&quot;ms&quot;)return Number(s.slice(0,-2))||0;else if(s.slice(-1).toLowerCase()===&quot;s&quot;)return Number(s.slice(0,-1))*1E3||0;throwError(g,&quot;&lt;&lt;&quot;+e+'&gt;&gt;: &quot;'+s+'&quot; is not a valid CSS time unit');return 0}var fl=this.flavour;\nvar tm=cssTimeUnit(f[0]);setTimeout(function timefn(){var done=!revise(&quot;revise&quot;,m);if(!done)setTimeout(timefn,tm)},tm)}function hoverSetup(m){m.onmouseover=function(){revise(&quot;revise&quot;,this)};m.onmouseout=function(){revise(&quot;revert&quot;,this)};m=null}function mouseSetup(m){var fl=this.flavour,evt=window.onmouseenter===null?&quot;onmouseenter&quot;:&quot;onmouseover&quot;;m[evt]=function(){var done=!revise(&quot;revise&quot;,this);if(done)this[evt]=null};m=null}function linkSetup(m,g,e,f){var fl=this.flavour,l=Wikifier.createInternalLink(),\np=m.parentNode;l.className=&quot;link-internal replaceLink&quot;;p.insertBefore(l,m);l.insertBefore(m,null);l.onclick=function(){var p,done=false;if(m&&m.parentNode==this){done=!revise(&quot;revise&quot;,m);scrollWindowTo(m)}if(done){this.parentNode.insertBefore(m,this);this.parentNode.removeChild(this)}};l=null}function visitedSetup(m,g,e,f){var done,sav=state.active.variables,os=&quot;once seen&quot;,d=m.firstChild&&(this.flavour===&quot;insert&quot;?m.firstChild.nextSibling:m.firstChild).tweecode;sav[os]=sav[os]||{};if(d&&!sav[os].hasOwnProperty(d))sav[os][d]=\n1;else{for(var i=sav[os][d];i&gt;0&&!done;i--)done=!revise(&quot;revise&quot;,m,true);if(sav[os].hasOwnProperty(d))sav[os][d]+=1}}function insideDepartingSpan(elem){var r=elem.parentNode;while(!r.classList.contains(&quot;passage&quot;)){if(r.classList.contains(&quot;revision-span-out&quot;))return true;r=r.parentNode}}function reviseAll(rt,rname){var rall=document.querySelectorAll(&quot;.passage .&quot;+rname),ret=false;for(var i=0;i&lt;rall.length;i++)if(!insideDepartingSpan(rall[i]))ret=revise(rt,rall[i])||ret;return ret}function revise(rt,\nr,notrans){function doToGainerSpans(n,fn){for(var k=n-1;k&gt;=0;k--)if(rc[k+1].classList.contains(&quot;gains&quot;))fn(rc[k],notrans);else break}var ind2,curr,next,ind=-1,rev=rt===&quot;revert&quot;,rnd=rt.indexOf(&quot;random&quot;)&gt;-1,fl=r.getAttribute(&quot;data-flavour&quot;),rc=r.childNodes,cyc=fl===&quot;cycle&quot;,rcl=rc.length-1;for(var k=0;k&lt;=rcl;k++)if(rc[k].getAttribute(&quot;data-enabled&quot;)===&quot;true&quot;)ind=k;if(rev)ind-=1;curr=ind&gt;=0?rc[ind]:cyc?rc[rcl]:null;ind2=ind;if(rnd)ind2=(ind+Math.floor(Math.random()*rcl))%rcl;next=ind2&lt;rcl?rc[ind2+1]:\ncyc?rc[0]:null;var docurr=rev?showVer:hideVer;var donext=rev?hideVer:showVer;var currfn=function(){if(!(next&&next.classList.contains(&quot;gains&quot;))||rnd){docurr(curr,notrans);doToGainerSpans(ind,docurr,notrans)}};var nextfn=function(){donext(next,notrans);if(rnd)doToGainerSpans(ind2+1,donext,notrans)};if(!rev){currfn();nextfn()}else{nextfn();currfn()}return cyc?true:rev?ind&gt;0:ind2&lt;rcl-1}var begintags=[],endtags=[];[{name:&quot;insertlink&quot;,flavour:&quot;insert&quot;,trigger:&quot;link&quot;,setup:linkSetup},{name:&quot;timedinsert&quot;,\nflavour:&quot;insert&quot;,trigger:&quot;time&quot;,setup:timeSetup},{name:&quot;insertion&quot;,flavour:&quot;insert&quot;,trigger:&quot;revisemacro&quot;,setup:revisionSetup},{name:&quot;later&quot;,flavour:&quot;insert&quot;,trigger:&quot;visited&quot;,setup:visitedSetup},{name:&quot;keyinsert&quot;,flavour:&quot;insert&quot;,trigger:&quot;key&quot;,setup:keySetup},{name:&quot;replacelink&quot;,flavour:&quot;replace&quot;,trigger:&quot;link&quot;,setup:linkSetup},{name:&quot;timedreplace&quot;,flavour:&quot;replace&quot;,trigger:&quot;time&quot;,setup:timeSetup},{name:&quot;mousereplace&quot;,flavour:&quot;replace&quot;,trigger:&quot;mouse&quot;,setup:mouseSetup},{name:&quot;hoverreplace&quot;,flavour:&quot;replace&quot;,\ntrigger:&quot;hover&quot;,setup:hoverSetup},{name:&quot;revision&quot;,flavour:&quot;replace&quot;,trigger:&quot;revisemacro&quot;,setup:revisionSetup},{name:&quot;keyreplace&quot;,flavour:&quot;replace&quot;,trigger:&quot;key&quot;,setup:keySetup},{name:&quot;timedremove&quot;,flavour:&quot;remove&quot;,trigger:&quot;time&quot;,setup:timeSetup},{name:&quot;mouseremove&quot;,flavour:&quot;remove&quot;,trigger:&quot;mouse&quot;,setup:mouseSetup},{name:&quot;hoverremove&quot;,flavour:&quot;remove&quot;,trigger:&quot;hover&quot;,setup:hoverSetup},{name:&quot;removal&quot;,flavour:&quot;remove&quot;,trigger:&quot;revisemacro&quot;,setup:revisionSetup},{name:&quot;once&quot;,flavour:&quot;remove&quot;,trigger:&quot;visited&quot;,\nsetup:visitedSetup},{name:&quot;keyremove&quot;,flavour:&quot;remove&quot;,trigger:&quot;key&quot;,setup:keySetup},{name:&quot;continuelink&quot;,flavour:&quot;continue&quot;,trigger:&quot;link&quot;,setup:linkSetup},{name:&quot;timedcontinue&quot;,flavour:&quot;continue&quot;,trigger:&quot;time&quot;,setup:timeSetup},{name:&quot;mousecontinue&quot;,flavour:&quot;continue&quot;,trigger:&quot;mouse&quot;,setup:mouseSetup},{name:&quot;keycontinue&quot;,flavour:&quot;continue&quot;,trigger:&quot;key&quot;,setup:keySetup},{name:&quot;cycle&quot;,flavour:&quot;cycle&quot;,trigger:&quot;revisemacro&quot;,setup:revisionSetup},{name:&quot;mousecycle&quot;,flavour:&quot;cycle&quot;,trigger:&quot;mouse&quot;,setup:mouseSetup},\n{name:&quot;timedcycle&quot;,flavour:&quot;cycle&quot;,trigger:&quot;time&quot;,setup:timeSetup},{name:&quot;keycycle&quot;,flavour:&quot;replace&quot;,trigger:&quot;key&quot;,setup:keySetup}].forEach(function(e){e.handler=revisionSpanHandler;e.shorthand=[&quot;link&quot;,&quot;mouse&quot;,&quot;hover&quot;].indexOf(e.trigger)&gt;-1;macros[e.name]=e;macros.registerTags(e.name);begintags.push(e.name);endtags.push(&quot;/&quot;+e.name,&quot;end&quot;+e.name)});macros[&quot;revertlink&quot;]=macros[&quot;reviselink&quot;]=macros[&quot;randomiselink&quot;]=macros[&quot;randomizelink&quot;]={handler:function(a,b,c){function disableLink(l){l.style.display=\n&quot;none&quot;}function enableLink(l){l.style.display=&quot;inline&quot;}function updateLink(l){if(l.className.indexOf(&quot;random&quot;)&gt;-1){enableLink(l);return}var rall=document.querySelectorAll(&quot;.passage .&quot;+rname),cannext,canprev,ind,r,fl;for(var i=0;i&lt;rall.length;i++){r=rall[i],fl=r.getAttribute(&quot;data-flavour&quot;);if(insideDepartingSpan(r))continue;if(fl===&quot;cycle&quot;)cannext=canprev=true;else{if(r.firstChild.getAttribute(&quot;data-enabled&quot;)===&quot;false&quot;)canprev=true;if(r.lastChild.getAttribute(&quot;data-enabled&quot;)===&quot;false&quot;)cannext=true}}var can=\nl.classList.contains(&quot;revert&quot;)?canprev:cannext;(can?enableLink:disableLink)(l)}function toggleText(w){w.classList.toggle(rl+&quot;Enabled&quot;);w.classList.toggle(rl+&quot;Disabled&quot;);w.style.display=w.style.display===&quot;none&quot;?&quot;inline&quot;:&quot;none&quot;}if(c.length&lt;2){throwError(a,&quot;&lt;&lt;&quot;+b+&quot;&gt;&gt;: insufficient arguments (requires at least 2)&quot;);return}var l,rev,rname,rl=&quot;reviseLink&quot;,v=&quot;&quot;,end=false,out=false;rname=c.shift().replace(&quot; &quot;,&quot;_&quot;);l=Wikifier.createInternalLink(a,null);l.className=&quot;link-internal &quot;+rl+&quot; &quot;+rl+&quot;_&quot;+rname+&quot; &quot;+\nb;if(c.length&gt;1&&c[0][0]===&quot;$&quot;){v=c[0].slice(1);c.shift()}switch(c[c.length-1]){case &quot;end&quot;:end=true;c.pop();break;case &quot;out&quot;:out=true;c.pop();break}var h=state.active.variables;for(var i=0;i&lt;c.length;i++){var on=i===Math.max(c.indexOf(h[v]),0),d=insertElement(null,&quot;span&quot;,null,rl+(on?&quot;En&quot;:&quot;Dis&quot;)+&quot;abled&quot;);if(on){h[v]=c[i];l.setAttribute(&quot;data-cycle&quot;,i)}else d.style.display=&quot;none&quot;;insertText(d,c[i]);l.appendChild(d)}l.onclick=function(){reviseAll(b,rname);var t=this.childNodes,u=this.getAttribute(&quot;data-cycle&quot;)-\n0,m=t.length,lall;if((end||out)&&u===m-(end?2:1))if(end){var n=this.removeChild(t[u+1]);n.className=rl+&quot;End&quot;;n.style.display=&quot;inline&quot;;this.parentNode.replaceChild(n,this)}else{this.parentNode.removeChild(this);return}else{toggleText(t[u]);u=(u+1)%m;if(v)h[v]=c[u];toggleText(t[u]);this.setAttribute(&quot;data-cycle&quot;,u)}lall=document.getElementsByClassName(rl+&quot;_&quot;+rname);for(var i=0;i&lt;lall.length;i++)updateLink(lall[i])};l=null}};macros[&quot;mouserevise&quot;]=macros[&quot;hoverrevise&quot;]={handler:function(a,b,c,d){var endtags=\n[&quot;/&quot;+b,&quot;end&quot;+b],evt=window.onmouseenter===null?&quot;onmouseenter&quot;:&quot;onmouseover&quot;,t=tagcontents(d,[b],endtags,endtags,d.source.indexOf(&quot;&gt;&gt;&quot;,d.matchStart)+2);if(t){var rname=c[0].replace(&quot; &quot;,&quot;_&quot;),h=insertElement(a,&quot;span&quot;,null,&quot;hoverrevise hoverrevise_&quot;+rname),f=function(){var done=!reviseAll(&quot;revise&quot;,rname);if(b!=&quot;hoverrevise&quot;&&done)this[evt]=null};new Wikifier(h,t[0]);if(b===&quot;hoverrevise&quot;){h.onmouseover=f;h.onmouseout=function(){reviseAll(&quot;revert&quot;,rname)}}else h[evt]=f;h=null}}};macros.registerTags(&quot;mouserevise&quot;);\nmacros.registerTags(&quot;hoverrevise&quot;);macros[&quot;instantrevise&quot;]={handler:function(a,b,c,d){reviseAll(&quot;revise&quot;,c[0].replace(&quot; &quot;,&quot;_&quot;))}}})();</div><div tiddler="PassageReady" tags="nobr" modified="201401161525" created="201401161525" modifier="twee">/% Runs just before each passage is rendered. %/\n&lt;&lt;set $autoplaySound to &quot;&quot;&gt;&gt;\n&lt;&lt;set $autoplayDestination to &quot;&quot;&gt;&gt;\n&lt;&lt;stopAllSounds&gt;&gt;\n&lt;&lt;script&gt;&gt;\n    var passage = tale.get(state.active.title);\n    if (passage.tags.indexOf(&quot;sidebar&quot;) &gt; -1) {\n        //we are going from main flow to a sidebar\n        $(&quot;#passages&quot;).addClass(&quot;sidebar&quot;);\n        $(&quot;.passage&quot;).addClass(&quot;flip&quot;);//add class to outgoing passage\n        passage.classes.add(&quot;flip&quot;);//add class to incoming passage\n    }\n    else if ($(&quot;#passages&quot;).hasClass(&quot;sidebar&quot;)) {\n        //we are transitioning from a sidebar to the main flow\n        passage.classes.add(&quot;flip&quot;);//add class to incoming passage\n        $(&quot;.passage&quot;).addClass(&quot;flip&quot;);//add class to outgoing passage\n    }\n&lt;&lt;/script&gt;&gt;</div><div tiddler="Passage Transition CSS" tags="stylesheet" modified="201401161525" created="201401161525" modifier="twee">/* disable SugarCube's default passage transition */\n.passage { transition: none; -webkit-transition: none; }\n\n/* setup the new passage transition(s) */\n/* this is a simple 3-step fade out \n.transition-in { opacity: 0; position: absolute; }\n.passage:not(.transition-out) { transition: 0s 1100ms; -webkit-transition: 0s 1100ms; }\n.transition-out { opacity:0; position: absolute; transition: 1000ms steps(3); -webkit-transition: 1000ms steps(3); }\n*/\n\n/* Fast scroll (normal flow) */\n\n.transition-in:not(.flip) {\n    opacity:0;\n    transform: translate(0,-100rem);\n    -webkit-transform: translate(0,-100rem);\n    position:absolute;\n}\n.passage {\n    transition: 0.7s;\n    -webkit-transition: 0.7s;\n}\n.transition-out:not(.flip) {\n    opacity:0;\n    transform: translate(0,100rem);\n    -webkit-transform: translate(0,100rem);\n    position:absolute;\n}\n\n\n/* Page-flipping for sidebars */\n\n.flip.transition-in {\n    opacity:0;\n    position:absolute;\n    transform: rotateY(90deg);\n    -webkit-transform: rotateY(90deg);    \n}\n\n.flip.transition-out {\n    opacity:0;\n    transform: rotateY(-90deg);\n    -webkit-transform: rotateY(-90deg);\n    position:absolute;\n}\n\n#passages {\n    transition: background-color 0.4s cubic-bezier(0.95, 0.05, 0.795, 0.035);\n    -webkit-transition: background-color 0.4s cubic-bezier(0.95, 0.05, 0.795, 0.035);\n}</div><div tiddler="Change background image" tags="script" modified="201401161525" created="201401161525" modifier="twee">(function () {\n    macros.add([&quot;imageRotate&quot;],  {\n        version: {\n            major: 1,\n            minor: 0,\n            revision: 0\n        },\n        handler: function() {\n        	try {\n                var imageName = &quot;&quot;;\n                imageName = state.active.variables.backgrounds[state.active.title];\n                if (imageName) {\n                	$(&quot;#img-occluder&quot;).fadeIn(&quot;fast&quot;, function() {\n                		$(&quot;body&quot;).css(&quot;background-image&quot;, &quot;url(&quot; + imageName +&quot;)&quot;);\n                		$(&quot;#img-occluder&quot;).fadeOut(&quot;slow&quot;);\n                	});                   \n                }\n            } catch (e) {\n                return this.error(&quot;Error: &quot; + e.message);\n            }\n        }\n    });\n\n    //Preload images, from http://www.glorioustrainwrecks.com/node/4982\n    var r = &quot;&quot;;\n    var s = Wikifier.formatters;\n    for (var j = 0; j &lt; s.length; j++) {\n        if (s[j].name == &quot;image&quot;) {\n            r = s[j].lookahead;\n            break;\n        }\n    }\n    var div = document.getElementById(&quot;store-area&quot;).firstChild.nextSibling;\n    while (div) {\n        if (r) {\n            k(new RegExp(r, &quot;mg&quot;), 4);\n        }\n        var b = String.fromCharCode(92);\n        var u = b + &quot;s*?['&quot; + '&quot;]?([^&quot;' + &quot;']+?(jpe?g|a?png|gif|bmp))['&quot; + '&quot;]?' + b + &quot;s*&quot;;\n        k(/['&quot;]([^&quot;']*\s.(jpe?g|a?png|gif|bmp))['&quot;]/mig, 1);\n        k(new RegExp(&quot;url&quot; + b + &quot;(&quot; + u + b + &quot;)&quot;, &quot;mig&quot;), 1);\n        //k(new RegExp(&quot;src&quot; + b + &quot;s*=&quot; + u, &quot;mig&quot;), 1);\n        div = div.nextSibling;\n    }\n\n    function k(c, e) {\n        \n        do {\n            var d = c.exec(div.innerHTML);\n            if (d) {\n                var i = new Image();\n                i.src = d[e];\n                console.log(&quot;Preloaded &quot; + i.src);\n            }\n        } while (d);\n    }\n}());\n\n\njQuery.preloadCssImages = function(){\n    var allImgs = [];//new array for all the image urls  \n    var k = 0; //iterator for adding images\n    var sheets = document.styleSheets;//array of stylesheets\n    \n    for(var i = 0; i&lt;sheets .length; i++){//loop through each stylesheet\n        var cssPile = '';//create large string of all css rules in sheet\n        var csshref = (sheets[i].href) ? sheets[i].href : 'window.location.href';\n        var baseURLarr = csshref.split('/');//split href at / to make array\n        baseURLarr.pop();//remove file path from baseURL array\n        var baseURL = baseURLarr.join('/');//create base url for the images in this sheet (css file's dir)\n        if(baseURL!=&quot;&quot;) baseURL+='/'; //tack on a / if needed\n        if(document.styleSheets[i].cssRules){//w3\n            var thisSheetRules = document.styleSheets[i].cssRules; //w3\n            for(var j = 0; j&lt;thisSheetRules.length; j++){\n                cssPile+= thisSheetRules[j].cssText;\n            }\n        }\n        else {\n            cssPile+= document.styleSheets[i].cssText;\n        }\n        \n        //parse cssPile for image urls and load them into the DOM\n        var imgUrls = cssPile.match(/[^\s(]+\s.(gif|jpg|jpeg|png)/g);//reg ex to get a string of between a &quot;(&quot; and a &quot;.filename&quot;\n        if(imgUrls != null && imgUrls.length&gt;0 && imgUrls != ''){//loop array\n            var arr = jQuery.makeArray(imgUrls);//create array from regex obj    \n            jQuery(arr).each(function(){\n                allImgs[k] = new Image(); //new img obj\n                allImgs[k].src = (this[0] == '/' || this.match('http://')) ? this : baseURL + this; //set src either absolute or rel to css dir\n                k++;\n            });\n        }\n    }//loop\n    return allImgs;\n}</div><div tiddler="Start" tags="nosave" modified="201401161525" created="201401161525" modifier="twee">&lt;&lt;section &quot;intros&quot; &quot;images/imagetest.jpg&quot;&gt;&gt;\s\n&lt;&lt;if \n    SaveSystem.autosaveOK \n    && storage.getItem(&quot;saves&quot;).autosave !== null \n&gt;&gt;\s\nYou have a session already in progress. Continue where you left off? \n&lt;&lt;script&gt;&gt; \n    var resumeBtn = insertElement( \n        output, \n        &quot;button&quot;, \n        &quot;resume-button&quot;, \n        &quot;ui-autostart-button&quot;, \n        &quot;Resume where I left off&quot; \n    ); \n    var restartBtn = insertElement( \n        output, \n        &quot;button&quot;, \n        &quot;restart-button&quot;, \n        &quot;ui-autostart-button&quot;, \n        &quot;Start over&quot; \n    ); \n    $(resumeBtn).click(function() {\n        SaveSystem.loadAuto();\n    }); \n    $(restartBtn).click(function() { \n        SaveSystem.deleteAuto();\n        state.display(&quot;About the Presentation&quot;);\n    });\n&lt;&lt;/script&gt;&gt;\s\n&lt;&lt;else&gt;&gt;\s\n	&lt;&lt;display &quot;About the Presentation&quot;&gt;&gt;\s\n&lt;&lt;/if&gt;&gt;\s\n\n/%%%%%%%%%%%\n&lt;&lt;timedgoto &quot;About the Presentation&quot; 0 &gt;&gt;\nTo open a window without back and forward buttons (for launching the presentation):\nwindow.open(url,name,&quot;menubar=no,toolbar=no[, additional options]&quot;,true)\n\nAPI info\n\n$variable = state.active.variables.NAME\nprint name of active passage = state.active.title\n%%%%%%%%%%%/</div><div tiddler="Nano Scroller" tags="stylesheet" modified="201401161525" created="201401161525" modifier="twee">/** initial setup **/\n.nano {\n  position : relative;\n  width    : 100%;\n  height   : 100%;\n  overflow : hidden;\n}\n.nano .content {\n  position      : absolute;\n  overflow      : scroll;\n  overflow-x    : hidden;\n  top           : 0;\n  right         : 0;\n  bottom        : 0;\n  left          : 0;\n}\n.nano .content:focus {\n  outline: thin dotted;\n}\n.nano .content::-webkit-scrollbar {\n  visibility: hidden;\n}\n.has-scrollbar .content::-webkit-scrollbar {\n  visibility: visible;\n}\n.nano &gt; .pane {\n  background : rgba(0,0,0,.25);\n  position   : absolute;\n  width      : 10px;\n  right      : 0;\n  top        : 0;\n  bottom     : 0;\n  visibility : hidden\s9; /* Target only IE7 and IE8 with this hack */\n  opacity    : .01; \n  -webkit-transition    : .2s;\n  -moz-transition       : .2s;\n  -o-transition         : .2s;\n  transition            : .2s;\n  -moz-border-radius    : 5px;\n  -webkit-border-radius : 5px;  \n  border-radius         : 5px;\n}\n.nano &gt; .pane &gt; .slider {\n  background: #444;\n  background: rgba(0,0,0,.5);\n  position              : relative;\n  margin                : 0 1px;\n  -moz-border-radius    : 3px;\n  -webkit-border-radius : 3px;  \n  border-radius         : 3px;\n}\n.nano:hover &gt; .pane, .pane.active, .pane.flashed {\n  visibility : visible\s9; /* Target only IE7 and IE8 with this hack */\n  opacity    : 0.99;\n}</div><div tiddler="Go To Link On Timer" tags="script" modified="201401161525" created="201401161525" modifier="twee">(function () {\n    version.extensions.timedgotoMacro = {\n        major: 1,\n        minor: 2,\n        revision: 0\n    };\n    macros[&quot;goto&quot;] = macros.timedgoto = {\n        timer: null,\n        handler: function (a, b, c, d) {\n            function cssTimeUnit(s) {\n                if (typeof s == &quot;string&quot;) {\n                    if (s.slice(-2).toLowerCase() == &quot;ms&quot;) {\n                        return +(s.slice(0, -2)) || 0\n                    } else {\n                        if (s.slice(-1).toLowerCase() == &quot;s&quot;) {\n                            return +(s.slice(0, -1)) * 1000 || 0\n                        }\n                    }\n                }\n                throwError(a, s + &quot; isn't a CSS time unit&quot;);\n                return 0\n            }\n            var t, d, m, s;\n            t = c[c.length - 1];\n            d = d.fullArgs();\n            m = 0;\n            if (b != &quot;goto&quot;) {\n                d = d.slice(0, d.lastIndexOf(t));\n                m = cssTimeUnit(t)\n            }\n            d = eval(Wikifier.parse(d));\n            if (d + &quot;&quot; && state && state.init) {\n                if (macros[&quot;goto&quot;].timer) {\n                    clearTimeout(macros[&quot;goto&quot;].timer)\n                }\n                //s = state.history[0].passage.title;\n                macros[&quot;goto&quot;].timer = setTimeout(function () {\n                    state.display(d, a);\n                }, m)\n            }\n        }\n    };\n}());</div><div tiddler="Play Sounds" tags="script" modified="201401161525" created="201401161525" modifier="twee">//based on http://www.glorioustrainwrecks.com/node/5061\n(function () {\n    macros.add([&quot;playSound&quot;, &quot;playSoundDelay&quot;, &quot;stopSound&quot;, &quot;pauseSound&quot;],  {\n        version: {\n            major: 1,\n            minor: 0,\n            revision: 0\n        },\n        soundtracks: {},\n        handler: function () {\n            try {\n                var soundName = this.args[0];\n                if (soundName) {\n                    soundName = soundName.toString(); //necessary?\n                    var sound = macros.get(&quot;playSound&quot;).soundtracks[soundName.slice(0, soundName.lastIndexOf(&quot;.&quot;))];\n                    if (sound) {\n                        if (this.name == &quot;playSoundDelay&quot;) {\n                            var delay = this.args[1];\n                            if (delay) {\n                                setTimeout(function() {\n                                    sound.play()\n                                }, delay);\n                            }\n                            else { sound.play() }\n                        }\n                        if (this.name == &quot;playSound&quot;) {\n                            sound.play();\n                        }\n                        if (this.name == &quot;playSoundDelay&quot; || this.name == &quot;playSound&quot;) {\n                            var passage = this.args.length &gt; 2 ? this.args[2] : undefined;\n                            if (passage) {\n                                $(sound).on(&quot;ended&quot;, function () {\n                                    state.display(passage)\n                                });\n                            }\n                        }\n                        if (this.name == &quot;pauseSound&quot;) {\n                            sound.pause();\n                        }\n                        if (this.name == &quot;stopSound&quot;) {\n                            sound.pause();\n                            sound.currentTime = 0;\n                        }\n                    }\n                }\n            } catch (e) {\n                return this.error(&quot;Error: &quot; + e.message);\n            }\n        }\n    });\n\n    var div = document.getElementById(&quot;store-area&quot;).firstChild;\n    var sourceTypes = [&quot;mp3&quot;, &quot;ogg&quot;];\n    while (div) {\n        var b = String.fromCharCode(92);\n        var q = '&quot;';\n        var re = &quot;['&quot; + q + &quot;]([^&quot; + q + &quot;']*?)&quot; + b + &quot;.audio['&quot; + q + &quot;]&quot;;\n        preloadSounds(new RegExp(re, &quot;gi&quot;));\n        div = div.nextSibling;\n    }\n\n    function preloadSounds(search, e) {\n        do {\n          var fileName = search.exec(div.innerHTML);\n          if (fileName) {\n            var sound = new Audio();\n            if (sound.canPlayType) {\n              for (var i = 0; i &lt; sourceTypes.length; i++) {\n                fileName[2] = sourceTypes[i];\n                if (sound.canPlayType(&quot;audio/&quot; + fileName[2])) break;\n              }\n              if (i &lt; sourceTypes.length) {\n                sound.setAttribute(&quot;src&quot;, fileName[1] + &quot;.&quot; + fileName[2]);\n                sound.interval = null;\n                macros.get(&quot;playSound&quot;).soundtracks[fileName[1]] = sound;\n              } else console.log(&quot;Browser can't play '&quot; + fileName[1] + &quot;'&quot;);\n            }\n          }\n        } while (fileName);\n    }\n\n}());</div><div tiddler="Continue arrow & animation" tags="stylesheet" modified="201401161525" created="201401161525" modifier="twee">span.continue-button {\n    background:-webkit-gradient(linear, left top, left bottom, color-stop(0.05, #2dabf9), color-stop(1, #0688fa));\n    background:-moz-linear-gradient(top, #2dabf9 5%, #0688fa 100%);\n    background:-webkit-linear-gradient(top, #2dabf9 5%, #0688fa 100%);\n    background:-o-linear-gradient(top, #2dabf9 5%, #0688fa 100%);\n    background:-ms-linear-gradient(top, #2dabf9 5%, #0688fa 100%);\n    background:linear-gradient(to bottom, #2dabf9 5%, #0688fa 100%);\n    filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#2dabf9', endColorstr='#0688fa',GradientType=0);\n    background-color:#2dabf9;\n    -moz-border-radius:28px;\n    -webkit-border-radius:28px;\n    border-radius:28px;\n    border:1px solid #c4ccff;\n    display:inline;\n    cursor:pointer;\n    color:#ffffff;\n    font-size:17px;\n    padding:0px 15px 1px 10px;\n    text-decoration:none;\n    text-shadow:0px 1px 5px #2b4487;\n}\nspan.continue-button:hover {\n    background:-webkit-gradient(linear, left top, left bottom, color-stop(0.05, #0688fa), color-stop(1, #2dabf9));\n    background:-moz-linear-gradient(top, #0688fa 5%, #2dabf9 100%);\n    background:-webkit-linear-gradient(top, #0688fa 5%, #2dabf9 100%);\n    background:-o-linear-gradient(top, #0688fa 5%, #2dabf9 100%);\n    background:-ms-linear-gradient(top, #0688fa 5%, #2dabf9 100%);\n    background:linear-gradient(to bottom, #0688fa 5%, #2dabf9 100%);\n    filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#0688fa', endColorstr='#2dabf9',GradientType=0);\n    background-color:#0688fa;\n}\n.continue-button a {\n    color: #fff!important;\n}\n.continue-button a:hover {\n    text-decoration:none!important;\n}\n.continue-button a.link-internal,\n.continue-button a.link-external,\n.continue-button a.link-back,\n.continue-button a.link-return {\n    font-weight:normal;\n    margin:0;\n    padding:0;\n}\n.onward-arrow {\n    position: relative;\n    left:0;\n    display:inline-block;\n}\n.fade-bounce {\n -webkit-animation-name: fade-bounce;\n -moz-animation-name: fade-bounce;\n -webkit-animation-duration: 1s;\n -moz-animation-duration: 1s;\n -webkit-animation-iteration-count: infinite;\n -moz-animation-iteration-count: infinite;\n -webkit-animation-direction: normal;\n -moz-animation-direction: normal;\n -webkit-animation-timing-function: ease-in;\n -moz-animation-timing-function: ease-in;\n }\n @-webkit-keyframes fade-bounce {\n    0%   { left: 0; opacity:1.0; }\n    35%  { left: 0.75em; opacity:1.0; }\n    100% { left: 0.35em; opacity:0.25; }\n }\n@-moz-keyframes fade-bounce {\n    0%   { left: 0; opacity:1.0; }\n    35%  { left: 0.75em; opacity:1.0; }\n    100% { left: 0.35em; opacity:0.25; }\n}\n\n#section-title {\n    position: fixed;\n    display:none;\n    background-color:rgba(0,0,0,0.8);\n    padding:15px;\n    z-index:999;\n    color:#fff;\n    font-weight:bold;\n    margin: auto;\n    position: absolute;\n    top: 40%;\n    left: 50%;\n    -webkit-transform: translate(-50%,-50%);\n    -ms-transform: translate(-50%,-50%);\n    transform: translate(-50%,-50%);\n}</div><div tiddler="Section Break" tags="script" modified="201401161525" created="201401161525" modifier="twee">//  Use this macro to mark the transition to a new section,\n//  and to provide a background image.\n//    &lt;&lt;section [name of section] [path to background image]&gt;&gt;\n(function () {\n    macros.add(&quot;section&quot;, {\n        version: {\n            major: 1,\n            minor: 0,\n            revision: 0\n        },\n        handler: function () {\n            try {\n                var index = state.active.variables.index;\n                var backgrounds = state.active.variables.backgrounds;\n                var sectionName = &quot;&quot;;\n                sectionName = this.args[0];\n                var passage = state.active.title;\n                if (sectionName === &quot;&quot;) { throw &quot;You must supply a section name.&quot;}\n                var url = &quot;&quot;;\n                url = this.args[1].length ? this.args[1] : &quot;&quot;;\n                if (sectionName === &quot;&quot;) { throw &quot;You must supply a short url for the background image.&quot;}\n                if (!index.hasOwnProperty(passage)) { //if the passage isn't in the index, add it.\n                    index[passage] = {};\n                }\n                index[passage].section = sectionName;\n\n                if (!backgrounds.hasOwnProperty(sectionName)) {\n                    backgrounds[sectionName] = {};\n                }\n                backgrounds[sectionName].url = url;\n\n                //update stored section name\n                state.active.variables.section = sectionName;\n            } catch(e) {\n                return this.error(&quot;Error: &quot; + e.message);\n            }\n        }\n    });\n}());</div><div tiddler="Cycling Links" tags="script" modified="201401161525" created="201401161525" modifier="twee">/*! &lt;&lt;cyclinglink&gt;&gt; (SugarCube Edition) */\n(function(){&quot;use strict&quot;;var requiredSugarCubeBuild=2680;if(!version||!version.build||version.build&lt;requiredSugarCubeBuild)throw new Error(&quot;&lt;&lt;cyclinglink&gt;&gt; macro requires SugarCube build &quot;+requiredSugarCubeBuild+&quot; or greater, disabling macro&quot;);version.extensions[&quot;cyclinglinkMacro&quot;]={major:3,minor:3,revision:1};macros[&quot;cyclinglink&quot;]={handler:function(a,b,c){function toggleText(w){w.classList.remove(&quot;cyclingLinkInit&quot;);w.classList.toggle(rl+&quot;Enabled&quot;);w.classList.toggle(rl+&quot;Disabled&quot;);w.style.display=w.style.display===\n&quot;none&quot;?&quot;inline&quot;:&quot;none&quot;}var rl=&quot;cyclingLink&quot;;switch(c[c.length-1]){case &quot;end&quot;:var end=true;c.pop();break;case &quot;out&quot;:var out=true;c.pop();break}var v=&quot;&quot;;if(c.length&&c[0][0]===&quot;$&quot;){v=c[0].slice(1);c.shift()}var h=state.active.variables;if(out&&h[v]===&quot;&quot;)return;var l=Wikifier.createInternalLink(a,null);l.className=&quot;link-internal cyclingLink&quot;;l.setAttribute(&quot;data-cycle&quot;,0);for(var i=0;i&lt;c.length;i++){var on=i===Math.max(c.indexOf(h[v]),0);var d=insertElement(null,&quot;span&quot;,null,&quot;cyclingLinkInit cyclingLink&quot;+\n(on?&quot;En&quot;:&quot;Dis&quot;)+&quot;abled&quot;);if(on){h[v]=c[i];l.setAttribute(&quot;data-cycle&quot;,i)}else d.style.display=&quot;none&quot;;insertText(d,c[i]);if(on&&end&&i===c.length-1)l.parentNode.replaceChild(d,l);else l.appendChild(d)}l.onclick=function(){var t=this.childNodes;var u=this.getAttribute(&quot;data-cycle&quot;)-0;var m=t.length;toggleText(t[u]);u=u+1;if(!(out&&u===m)){u%=m;if(v)h[v]=c[u]}else h[v]=&quot;&quot;;if((end||out)&&u===m-(end?1:0)){if(end){var n=this.removeChild(t[u]);n.className=rl+&quot;End&quot;;n.style.display=&quot;inline&quot;;this.parentNode.replaceChild(n,\nthis)}else{this.parentNode.removeChild(this);return}return}toggleText(t[u]);this.setAttribute(&quot;data-cycle&quot;,u)}}}})();</div><div tiddler="Stop All Sounds" tags="script" modified="201401161525" created="201401161525" modifier="twee">//based on http://www.glorioustrainwrecks.com/node/5061\n(function () {\n    macros.add([&quot;stopAllSounds&quot;, &quot;pauseAllSounds&quot;], {\n        version: {\n            major: 1,\n            minor: 0,\n            revision: 0\n        },\n        handler: function () {\n            var sounds = macros.get(&quot;playSound&quot;).soundtracks;\n            for (var i in sounds) {\n                if (sounds.hasOwnProperty(i)) {\n                    sounds[i].pause();\n                    if (this.name == &quot;stopAllSounds&quot; && sounds[i].currentTime) {\n                        sounds[i].currentTime = 0;\n                    }\n                }\n            }\n        }\n    });\n}());</div><div tiddler="Autoplay interface" tags="widget" modified="201401161525" created="201401161525" modifier="twee">/%%%%%%%%%%%%%\n&lt;&lt;autoPlay filename [passage]&gt;&gt;\nIf you pass the title of a passage into the widget, things will automatically\nforward to that passage when the sound completes playing.\n\nIf no passage title is included, then the sound will simply play and stop.\nThis should be used for times when the reader has e.g. clicked on an\noptional link, or if some further interaction is called for.\n%%%%%%%%%%%%%%/\n&lt;&lt;widget &quot;autoPlay&quot;&gt;&gt;\s\n    &lt;&lt;set $autoplaySound to $args[0]&gt;&gt;\s\n        &lt;&lt;if  $args[1]&gt;&gt;\s\n            &lt;&lt;set $autoplayDestination to $args[1]&gt;&gt;\s\n        &lt;&lt;/if&gt;&gt;\s\n&lt;&lt;/widget&gt;&gt;\s</div><div tiddler="About the Presentation" tags="nosave" modified="201401161525" created="201401161525" modifier="twee">!About This Presentation\n!!!!Choose mode to continue\nThis presentation can be viewed in Automatic Mode, with a narrator speaking the text, or in Manual Mode. You can turn Automatic Mode on or off at any time using the button in the upper right.\n\nYou can always hit the &lt;span class='continue-button' style=&quot;clear:both;&quot;&gt;&lt;&lt;click &quot;Continue&quot; &quot;Passport Check&quot;&gt;&gt;&lt;&lt;set options.autoplay to true&gt;&gt;&lt;&lt;updateAutoplay&gt;&gt;&lt;&lt;saveoptions&gt;&gt;&lt;&lt;/click&gt;&gt;&lt;span class=&quot;anim-wrapper&quot;&gt;&lt;span class='onward-arrow fade-bounce'&gt;&raquo;&lt;/span&gt;&lt;/span&gt;&ensp;&lt;/span&gt; button at any time to advance.\n\n&lt;&lt;click &quot;Continue in Automatic Mode&quot; &quot;Passport Check&quot;&gt;&gt;\s\n	&lt;&lt;set options.autoplay to true&gt;&gt;\s\n	&lt;&lt;updateAutoplay&gt;&gt;\s\n	&lt;&lt;saveoptions&gt;&gt;\s\n&lt;&lt;/click&gt;&gt;\n&lt;&lt;click &quot;Continue in Manual Mode&quot; &quot;Passport Check&quot;&gt;&gt;\s\n	&lt;&lt;set options.autoplay to false&gt;&gt;\s\n	&lt;&lt;updateAutoplay&gt;&gt;\s\n	&lt;&lt;saveoptions&gt;&gt;\s\n&lt;&lt;/click&gt;&gt;\s\n&lt;&lt;stopAllSounds&gt;&gt;\s\n&lt;&lt;set options.autoplaydelay to 1000 &gt;&gt;\s</div><div tiddler="Update Autoplay Button" tags="widget" modified="201401161525" created="201401161525" modifier="twee">/%%%%%%%%%%%%%\n&lt;&lt;updateAutoplay&gt;&gt;\n\nThis updates the on-screen button for autoplay/sounds. Use this macro\nwhenever changing the state of the options.autoplay variable. \n%%%%%%%%%%%%%%/\n&lt;&lt;widget &quot;updateAutoplay&quot;&gt;&gt;\s\n    &lt;&lt;if options.autoplay&gt;&gt;\s\n        &lt;&lt;script&gt;&gt;$(&quot;#autoplay-switch&quot;).addClass(&quot;switchedon&quot;);&lt;&lt;/script&gt;&gt;\s\n    &lt;&lt;else&gt;&gt;\s\n        &lt;&lt;script&gt;&gt;$(&quot;#autoplay-switch&quot;).removeClass(&quot;switchedon&quot;);&lt;&lt;/script&gt;&gt;\s\n    &lt;&lt;/if&gt;&gt;\s\n&lt;&lt;/widget&gt;&gt;\s</div><div tiddler="PassageDone" tags="nobr" modified="201401161525" created="201401161525" modifier="twee">/% Runs once the passage has completely rendered. %/\n&lt;&lt;if options.autoplay&gt;&gt;\n    &lt;&lt;autoplay $autoplaySound $autoplayDestination&gt;&gt;\n&lt;&lt;/if&gt;&gt;\n&lt;&lt;script&gt;&gt;\n    var index = state.active.variables.index;\n    var passage = state.active.title;\n    var sectionName = state.active.variables.section;\n    if (!index.hasOwnProperty(passage)) { //if the passage isn't in the index, add it.\n        index[passage] = {};\n        index[passage].section = sectionName;\n    }\n    //update image if necessary\n    var currentImage = getBackgroundImage(&quot;.img-anchor&quot;);\n    var url = state.active.variables.backgrounds[sectionName].url;\n    url = url.substring(url.lastIndexOf('/', url.lastIndexOf('/') - 1) + 1);\n    if (url !== currentImage) {\n        var $active = $(&quot;.img-anchor&quot;);\n        var $passive = $(&quot;.img-fader&quot;);\n        $(&quot;.img-container&quot;).toggleClass('img-anchor img-fader');\n        $passive.css(&quot;background-image&quot;, &quot;url(&quot; + url + &quot;)&quot;);\n        $passive.removeClass('background-fade');\n        $active.addClass(&quot;background-fade&quot;);\n    }\n\n    var passage = tale.get(state.active.title);\n    if (passage.tags.indexOf(&quot;sidebar&quot;) === -1 && $(&quot;#passages&quot;).hasClass(&quot;sidebar&quot;)) {\n        //we are going from a sidebar to the main flow of the presentation\n        passage.classes.purge(&quot;flip&quot;);\n        $(&quot;#passages&quot;).removeClass(&quot;sidebar&quot;);\n    }\n    else if (!$(&quot;#passages&quot;).hasClass(&quot;sidebar&quot;)) {\n        $(&quot;.passage&quot;).removeClass(&quot;flip&quot;);\n    }\n    // Display for controls\n    if (tale.get(state.active.title).tags.indexOf(&quot;nosave&quot;) === -1 && $(&quot;#custom&quot;).is(&quot;:hidden&quot;)) {\n        $(&quot;#custom&quot;).slideDown(&quot;fast&quot;);\n    }\n    else if (tale.get(state.active.title).tags.indexOf(&quot;nosave&quot;) !== -1) {\n        console.log(&quot;Hiding controls. tag: &quot; + tale.get(state.active.title).tags.indexOf(&quot;nosave&quot;) + &quot;, hidden? &quot;+ $(&quot;#custom&quot;).is(&quot;:hidden&quot;));\n        $(&quot;#custom&quot;).slideUp(&quot;fast&quot;);\n    }\n&lt;&lt;/script&gt;&gt;</div><div tiddler="CSS for Sidebars" tags="stylesheet" modified="201401161525" created="201401161525" modifier="twee">#passages.sidebar {\n    background-color: #FAF3E8;\n}\n\n.passage h1.sidebar {\n    color:black;\n}\n\n.passage h4.sidebar {\n    margin-bottom:0;\n}\n\n.passage h6.sidebar {\n    margin:-0.4em 0 0 0;\n}\n\n.passage h6.sidebar a {\n    color:#a8a8a8;\n}\n\n.passage hr.sidebar {\n    background-color:black;\n}\n\n\n.sidebar-head {\n    background-color:#dd3b2a;\n    border:1px solid #dd3b2a;\n    border-radius:5px 0 0 5px;\n    color:white;\n    padding:3px 10px;\n}\n\n.sidebar-link {\n    border:1px solid #dd3b2a;\n    border-radius:0 5px 5px 0;\n    padding:3px 10px 3px 5px;\n}\n\n.sidebar-link a, sidebar-link a:hover {\n    text-decoration:underline;\n    color:#dd3b2a;\n}</div><div tiddler="StoryTitle" tags="" modified="201401161525" created="201401161525" modifier="twee">Predeparture Orientation</div><div tiddler="MenuOptions" tags="" modified="201401161525" created="201401161525" modifier="twee">&lt;&lt;optiontoggle &quot;autoplay&quot;&gt;&gt;Autoplay&lt;&lt;/optiontoggle&gt;&gt;</div><div tiddler="Configuration" tags="script" modified="201401161525" created="201401161525" modifier="twee">config.saves.autosave = true;\nconfig.saves.slots = 0;\n//config.disableHistoryControls = true;\n\nconfig.saves.isAllowed = function () {\n    if (tale.get(state.active.title).tags.indexOf(&quot;nosave&quot;) === -1) { \n       return true; \n    }\n    return false; \n};</div><div tiddler="Outgoing Passage Transition Config" tags="script" modified="201401161525" created="201401161525" modifier="twee">// # of milliseconds before outgoing elements are removed\nconfig.passageTransitionOut = 780; // it's probably best if it's just slightly longer (say 10ms or so) than your outgoing transition delay</div><div tiddler="AutoPlay Sound widget" tags="widget" modified="201401161525" created="201401161525" modifier="twee">/%%%%%%%%%%%%%\n&lt;&lt;autoplay filename [passage]&gt;&gt;\n\nThis widget is called automatically during the PassageDone phase\n(i.e., right after the passage has rendered), to prevent the voiceover\nfrom beginning before there is text on the page. It uses the values\nset by the &quot;autoPlay&quot; widget.\n\nA delay (in milliseconds) can be set in options.autoplaydelay; the sound\nwill begin playing only after at least this much time has passed since\nthe passage rendered. \n%%%%%%%%%%%%%%/\n&lt;&lt;widget &quot;autoplay&quot;&gt;&gt;\s\n    &lt;&lt;if options.autoplay&gt;&gt;\s\n            &lt;&lt;if $args[0] neq $autoplaySound&gt;&gt;\s\n                &lt;&lt;stopAllSounds&gt;&gt;\s\n            &lt;&lt;/if&gt;&gt;\s\n            &lt;&lt;set $args[2] to options.autoplaydelay&gt;&gt;\s\n            &lt;&lt;if $args[1]&gt;&gt;\s\n                &lt;&lt;playSoundDelay $args[0] $args[2] $args[1]&gt;&gt;\s\n            &lt;&lt;else&gt;&gt;\s\n                &lt;&lt;playSoundDelay $args[0] $args[2] &gt;&gt;\s\n            &lt;&lt;set $autoplay to $args[0]&gt;&gt;\s\n        &lt;&lt;/if&gt;&gt;\s\n    &lt;&lt;/if&gt;&gt;\s\n&lt;&lt;/widget&gt;&gt;\s</div><div tiddler="StoryMenu" tags="" modified="201401161525" created="201401161525" modifier="twee">/% &lt;a id=&quot;audio-control&quot; href=&quot;#&quot;&gt;[ &gt; ]&lt;/a&gt; %/</div><div tiddler="Time values support" tags="script" modified="201401161525" created="201401161525" modifier="twee">//adapted from http://www.glorioustrainwrecks.com/files/TwineMacro-TimedLoop-1.1.0.txt\nString.prototype.cssTimeUnit = function() {\n    if (typeof this == &quot;string&quot;) {\n          if (this.slice(-2).toLowerCase() == &quot;ms&quot;) {\n            return Number(this.slice(0, -2)) || 0;\n          }\n          else if (this.slice(-1).toLowerCase() == &quot;s&quot;) {\n            return Number(this.slice(0, -1)) * 1000 || 0;\n          }\n        }\n        throw new Error(this + &quot; isn't a CSS this unit&quot;);\n        return 0;\n}</div><div tiddler="Fonts" tags="stylesheet" modified="201401161525" created="201401161525" modifier="twee">/*@import url(http://fonts.googleapis.com/css?family=Bevan);*/\n@import url(https://fonts.googleapis.com/css?family=Arvo:400,700);\n@import url(https://fonts.googleapis.com/css?family=Open+Sans:400italic,400,600,700);</div><div tiddler="Custom UI styles" tags="stylesheet" modified="201401161525" created="201401161525" modifier="twee">header#custom {\n    position:fixed;\n    top:0;\n    margin:0 auto 0 20%;\n    height:24px;\n    width:60%;\n    background-color:#555;\n    border-bottom:1px solid #333;\n    -moz-box-shadow: 0 0 10px black;\n    -webkit-box-shadow: 0 0 10px black;\n    box-shadow: 0 0 10px black;\n    z-index:10;\n    display:none;\n}\n\n#custom h2 {\n    margin:2px 0 0 8px;\n    display:inline-block;\n    font-family: verdana,&quot;dejavu sans&quot;,tahoma,arial,sans-serif;\n    color:#bbb;\n    font-size:16px;\n}\n\n#controls {\n    display:inline-block;\n    position:absolute;\n    top:3px;\n    right:5px;\n}\n\nlabel.autoplay-switch {\n    color: #bbb;\n    font-family: Arial, sans-serif;\n    font-size: 13px;\n    margin-right: 6px;\n    font-family: 'Open Sans', serif;\n}\n\n\nbutton:focus {outline:none;}\nbutton::-moz-focus-inner {border:0;}\n\nbutton#autoplay-switch {\n    display:inline-block;\n    width:19px;\n    height:19px;\n    margin:-1px 4px 0 0;\n    vertical-align:middle;\n    background:url(ui/check_radio_sheet.png) -38px top no-repeat;\n    cursor:pointer;\n    border:none;\n    -webkit-transition-duration: 0s;\n    -moz-transition-duration: 0s;\n    -o-transition-duration: 0s;\n    transition-duration: 0s;\n}\n\nbutton.switchedon {\n    background:url(ui/check_radio_sheet.png) -57px top no-repeat!important;\n    border:none;\n}</div><div tiddler="Copying Documents" tags="" modified="201401161525" created="201401161525" modifier="twee">!Copying Documents\n!!!!A &quot;Plan B&quot; for when you lose your passport or other important documents\nYou will be taking every precaution to keep your important documents safe, but also make sure you have a Plan B to fall back on.\n\nIt is much easier to replace a lost passport if you can show a photocopy of your missing document. So keep ''multiple copies'' of your passport and other key documents (visa or residence permit, credit cards, insurance cards, trip itineraries). Never keep a copy in the same place as the original--if one gets stolen, they both will!\n\nGEO recommends that you:\n#Scan your documents and email them to yourself, or store them in the cloud.\n#Leave a photocopy at home with your family.\n#Keep a photocopy in your luggage, in a //different bag// from the original.\n#Leave your original passport in a safe place when you're out and about; carry a photocopy!\n\nIf you do lose your passport while abroad, you will need to ''get in touch with the nearest embassy'' or consulate (you may want to program the contact info into your phone). You should also ''notify your resident director'' or designated contact person.\n\n&lt;&lt;autoPlay &quot;sounds/Copying Documents.audio&quot;&gt;&gt;\s\n&lt;&lt;section &quot;copying&quot; &quot;images/imagetest.jpg&quot;&gt;&gt;</div><div tiddler="Sidebar Button" tags="widget" modified="201401161525" created="201401161525" modifier="twee">/% Syntax:\n    &lt;&lt;sidebar-link [text] [passage name] [optional:text to replace &quot;more info&quot;]&gt;&gt; %/\s\n&lt;&lt;widget &quot;sidebar-link&quot;&gt;&gt;\s\n    &lt;div class=&quot;sidebar-box&quot;&gt;\s\n        &lt;span class=&quot;sidebar-head&quot;&gt;\s\n            &lt;&lt;if $args[2] eq &quot;&quot;&gt;&gt;&lt;&lt;set $args[2] to &quot;More&quot;&gt;&gt;&lt;&lt;/if&gt;&gt;\s\n            &lt;&lt;print $args[2]&gt;&gt;\s\n        &lt;/span&gt;\s\n        &lt;span class=&quot;sidebar-link&quot;&gt;\s\n            &lt;&lt;link $args[0] $args[1]&gt;&gt;\s\n        &lt;/span&gt;\s\n    &lt;/div&gt;\s\n&lt;&lt;/widget&gt;&gt;\s</div><div tiddler="Passport Acquisition" tags="sidebar" modified="201401161525" created="201401161525" modifier="twee">&lt;&lt;sidebar &quot;Getting a New Passport&quot;&gt;&gt;\nTo get a new passport, or to renew an old one, you will need to contact the proper issuing authority for your home country.\n\nU.S. citizens should visit the State Department's website for [[passport services|http://travel.state.gov/passport/]] to view requirements and to check on [[current processing times|http://travel.state.gov/passport/processing/processing_1740.html]]. Be sure that you will receive your new passport in time to complete any visa or resident permit applications!\n\nIn Nashville, locations near Vanderbilt where you can apply for a passport include:\n\n|alternating-rows|k\n|!Church Street Post Office|Midtown&lt;br /&gt;1718 Church Street|(615) 321-0172|\n|!Acklen Post Office|Hillsboro Village&lt;br /&gt;2006 Acklen Ave|(615) 383-5396|\n|!Broadway Post Office|Downtown&lt;br /&gt;901 Broadway|(615) 255-3613|\n|![[Davidson County Clerk|http://www.nashvilleclerk.com/living/passports/]]|Downtown &lt;br /&gt;700 2nd Ave South, Suite 101|(615) 862-6223|\n\nYou may need to ''call in advance'' for an appointment!\n\nYou'll also need to get ''passport photos'' taken before you can apply. FedEx Kinko's, Walgreens, and CVS are locations near to Vandy that can take passport photos.\n\n&lt;&lt;continue &quot;Passport Security&quot;&gt;&gt;\s\n&lt;&lt;autoPlay &quot;sounds/Passport Acquisition.audio&quot;&gt;&gt;\s</div><div tiddler="Image Utilities" tags="script" modified="201401161525" created="201401161525" modifier="twee">window.getBackgroundImage = function (element) {\n	var url = $(element).css('background-image');\n	if (url == &quot;&quot; || url == &quot;none&quot;) return url;\n	url = /^url\s((['&quot;]?)(.*)\s1\s)$/.exec(url);\n	url = url[2];//continue with only the filepath portion\n	var filename = url.substring(url.lastIndexOf('/', url.lastIndexOf('/') - 1) + 1);\n	filename = filename ? filename : &quot;&quot;;\n	return filename;\n};</div><div tiddler="CSS" tags="stylesheet" modified="201401161525" created="201401161525" modifier="twee">/* Change box-sizing model for all elements */\n/*\n*, *:before, *:after {\n    -moz-box-sizing: border-box;\n    -webkit-box-sizing: border-box;\n    box-sizing:border-box;\n}\n*/\n/* Override SugarCube button animations & styles\nbutton\n{\n    -webkit-transition-duration: 0s;\n    -moz-transition-duration: 0s;\n    transition-duration: 0s;\n}\nbutton:hover {\n    background-color: #58e;\n    border: 1px solid #7af;\n}\nbutton:active {\n    background-color: #f70;\n    border: 1px solid #f92;\n}\n*/\n\nhtml {\n  height:100%;\n}\nfigcaption {\n    font-size:80%;\n    font-style:italic;\n}\n.inline {\n    display: inline-block;\n}\n.left {\n    float: left;\n}\n.right {\n    float:right;\n}\nbody {\n    color: #000;\n    font-family: 'Open Sans',serif;\n    margin:0;\n    height:100%;\n    overflow:auto;\n    position:relative;\n    z-index: 3;\n}\nh1 {\n    font-family: 'Arvo',serif;\n    font-weight:700;\n    font-size: 36px;\n    line-height: 38px;\n    margin: 0 0 10px 0;\n    color: #dd3b2a;\n}\nh4 {\n    font-family: 'Arvo',serif;\n    font-weight:700;\n    font-size:18px;\n    margin-top:0;\n}\nh6 {\n    font-family: 'Arvo',serif;\n    font-weight:700;\n    font-size:14px;\n    margin:0;\n}\n.img-container {\n    position:fixed;\n    top:0;\n    left:0;\n    background-repeat: no-repeat;\n    background-position: center;\n    background-attachment: fixed; \n    -webkit-background-size: cover;\n    -moz-background-size: cover;\n    -o-background-size: cover;\n    background-size: cover;\n    height:100%;\n    width:100%;\n    -webkit-transition: opacity 1s ease-in-out;\n    -moz-transition: opacity 1s ease-in-out;\n    -o-transition: opacity 1s ease-in-out;\n    transition: opacity 1s ease-in-out;\n}\n.img-anchor {\n    background-image: url(images/imagetest.jpg);\n    opacity:1;\n    z-index:1;\n}\n.img-fader {\n    z-index:2;\n    \n}\n.background-fade {\n    opacity:0;\n}\n\n\n/* Make link font slightly smaller to compensate for boldface */\n.content a.link-internal,\n.content a.link-external,\n.content a.link-back,\n.content a.link-return {\n    font-size: 90%;\n}\n.content strong {\n    font-size: 90%;\n}\n#passages {\n    color: #000;\n    font-size:15px;\n    background-color:#fefefe;\n    width:60%;\n    min-height:100%;\n    margin: 0 auto;\n    border-left:none;\n    padding: 3em 2em;\n    -moz-box-shadow: 0 0 20px black;\n    -webkit-box-shadow: 0 0 20px black;\n    box-shadow: 0 0 20px black;\n    -moz-box-sizing: border-box;\n    -webkit-box-sizing: border-box;\n    box-sizing:border-box;\n    padding-top: 34px;\n    position:relative;\n}\n.passage {\n    line-height: 1.75;\n    margin-bottom: 0;\n    text-align: left;\n    height:100%;\n}\n#ui-bar {\n    display:none;\n}\n#passages table.alternating-rows tr:nth-child(odd) {\n    background-color:#EEEEEE;/*Fallback*/\n    background-color:rgba(221,221,221,0.5);\n}\n#passages table.alternating-rows tr:nth-child(even) {\n    background-color:#DDDDDD;/*Fallback*/\n    background-color:rgba(204,204,204,0.5);\n}\n#passages table.box {\n    background-color:#EEEEEE;/*Fallback*/\n    background-color:rgba(221,221,221,0.5);\n}\n#passages table.box th {\n    background-color:#DDDDDD;/*Fallback*/\n    background-color:rgba(204,204,204,0.5);\n}\n#passages table.box tr:first-child td,\n#passages table.box tr:first-child th {\n    padding-top:10px;\n}\n#passages table.box tr:last-child td {\n    padding-bottom:10px;\n}\n#passages table {\n    font-size: 80%;\n    border-collapse: collapse;\n    line-height:145%;\n}\n#passages th, #passages td {\n    padding: 0.5em 1em;\n}\ntable a.link-internal, a.link-external, a.link-back, a.link-return {\n    font-size: 100%!important;\n}</div><div tiddler="External Script Loader" tags="script" modified="201401161525" created="201401161525" modifier="twee">//adapted from http://videlais.com/2013/03/05/twine-tuesday-loading-external-javascript/\n(function () {\n    macros.add(&quot;loadJS&quot;, {\n        version: {\n            major: 1,\n            minor: 0,\n            revision: 0\n        },\n        handler: function () {\n            try {\n                var se = document.createElement(&quot;script&quot;);\n                se.type = 'text/javascript';\n                se.src = this.args[0];\n                $(&quot;head&quot;).append(se);\n                if(se.innerText) {eval(se.innerText);}\n                else {eval(se.textContent);} \n            } \n            catch (e) {\n                return this.error(&quot;LoadJS: &quot; + e.message);\n            }\n        }\n    });\n}());</div><div tiddler="StoryInit" tags="nobr" modified="201401161525" created="201401161525" modifier="twee">/% Add the header & controls to the document when the story first loads. %/\n&lt;&lt;set options.autoplaydelay to 0&gt;&gt;\n&lt;&lt;script&gt;&gt;\n    var header = insertElement(document.html, &quot;header&quot;, &quot;custom&quot;);\n    var banner = insertElement(header, &quot;h2&quot;, &quot;section-name&quot;, &quot;&quot;, &quot;GEO Predeparture Information&quot;);\n    var controls = insertElement(header, &quot;div&quot;, &quot;controls&quot;);\n    var label = insertElement(controls, &quot;label&quot;, &quot;&quot;, &quot;autoplay-switch&quot;, &quot;Autoplay + Sound&quot;);\n    var toggle = insertElement(controls, &quot;button&quot;, &quot;autoplay-switch&quot;);\n    var backgrounds = insertElement(document.body, &quot;div&quot;, &quot;backgrounds&quot;);\n    var image_container_1 = insertElement(backgrounds, &quot;div&quot;, &quot;bkgd-1&quot;);\n    var image_container_2 = insertElement(backgrounds, &quot;div&quot;, &quot;bkgd-2&quot;);\n\n    $(&quot;body&quot;).before(backgrounds);\n    $(&quot;body&quot;).before(header);\n    $(&quot;#custom&quot;).css(&quot;display&quot;,&quot;none&quot;);\n    $(image_container_1).addClass(&quot;img-anchor img-container&quot;);\n    $(image_container_2).addClass(&quot;img-fader img-container&quot;);\n\n    $(toggle)\n        .attr(&quot;type&quot;, &quot;button&quot;)\n        .addClass(function() {\n            if (options.autoplay) { return &quot;switchedon&quot; }\n        })\n        .click(function() {\n            $(toggle).toggleClass(&quot;switchedon&quot;);\n            if ( $(toggle).hasClass(&quot;switchedon&quot;) ) {\n                var soundName = state.active.variables.autoplaySound;\n                options.autoplay = true;\n                var sound = macros.get(&quot;playSound&quot;).soundtracks[soundName.slice(0, soundName.lastIndexOf(&quot;.&quot;))];\n                if (sound) { sound.play() }\n            }\n            else {\n                options.autoplay = false;\n                var sounds = macros.get(&quot;playSound&quot;).soundtracks;\n                for (var i in sounds) {\n                    if (sounds.hasOwnProperty(i)) {\n                        sounds[i].pause();\n                        sounds[i].currentTime = 0;\n                    }\n                }\n            }\n        });\n    \n    //Replace text in loading screen\n    $(&quot;#loading-screen p&quot;).html(&quot;Loading&hellip;&lt;br /&gt;&lt;progress&gt;&lt;/progress&gt;&quot;);\n    // Prep first background image object with inline CSS for background image\n    $(&quot;.img-anchor&quot;).css(&quot;background-image&quot;, &quot;url(&quot;+ getBackgroundImage(&quot;.img-anchor&quot;) +&quot;)&quot;);\n&lt;&lt;/script&gt;&gt;\n\n/% Initialize variables %/\n&lt;&lt;set $index to {}&gt;&gt;\n&lt;&lt;set $section to &quot;&quot;&gt;&gt;\n&lt;&lt;set $backgrounds to {}&gt;&gt;\n/% Custom scrollbar %/\s\n&lt;&lt;loadJS &quot;jquery.nicescroll.js&quot;&gt;&gt;\s\n/% CSS Transition commands %/\n&lt;&lt;loadJS &quot;jquery.transit.min.js&quot;&gt;&gt;\s\n&lt;&lt;script&gt;&gt;\n$(document).ready(\n    function() {  \n        $(&quot;body&quot;).niceScroll({\n            cursorwidth: &quot;8px&quot;, \n            railpadding:{top:0,right:5,left:0,bottom:0}\n        });\n    }\n);\n&lt;&lt;/script&gt;&gt;\s</div><div tiddler="Array Utilities" tags="script" modified="201401161525" created="201401161525" modifier="twee">Array.prototype.purge = function (element) {\n	var i = this.indexOf(element);\n	while (i &gt; -1) {\n		this.splice(i);\n		i = this.indexOf(element);\n	}\n	return this;\n};\n\nArray.prototype.add = function (element) {\n	if (this.indexOf(element) === -1) {\n		this.push(element);\n	}\n	return this;\n};</div><div tiddler="Image with Caption" tags="widget" modified="201401161525" created="201401161525" modifier="twee">/% Syntax:\n       &lt;&lt;figure [image url] \n                [caption text]\n                [optional: &quot;left&quot; or &quot;right&quot;, to float figure container; other classes could be given here as well]&gt;&gt;  %/\s\n&lt;&lt;widget &quot;figure&quot;&gt;&gt;\s\n    &lt;&lt;script&gt;&gt;\n        (function () {\n            var url = &quot;&quot;;\n            url = state.active.variables.args[0];\n            var text = &quot;&quot;;\n            text = state.active.variables.args[1];\n            var positioning = &quot;&quot;;\n            positioning = state.active.variables.args[2].length ? state.active.variables.args[2] : &quot;&quot;;\n            var container = insertElement( \n                output, \n                &quot;figure&quot;, \n                &quot;&quot;, \n                positioning \n            );\n            var image = insertElement(\n                container,\n                &quot;img&quot;\n            );\n            var figurecaption = insertElement(\n                container,\n                &quot;figcaption&quot;,\n                &quot;&quot;,\n                &quot;&quot;,\n                text\n            );\n            image.src = url;\n        }());\n    &lt;&lt;/script&gt;&gt;\s\n&lt;&lt;/widget&gt;&gt;\s</div><div tiddler="Passport Security" tags="" modified="201401161525" created="201401161525" modifier="twee">!Passport Security\n!!!!Keep your passport safe\nWhen you are abroad, no single document is more important than your passport. Without it, ''you will not be able to cross international borders'', and other tasks--such as transferring funds--may also be made difficult or impossible. Losing your passport can be a major headache, and might even cost you thousands of dollars in airfare for missed flights. Do everything you can to keep it safe!\n\nIn general, you should only keep your passport on your person when you are traveling across borders. Otherwise, ''find a safe place for it and leave it there.'' Make a photocopy and carry that on you when you are out and about.\n&lt;img src=&quot;images/passport wallet.jpg&quot; class=&quot;right&quot; style=&quot;height: 250px;&quot; /&gt;\s\n\nIf you must carry your passport with you, keep it in a special ''passport wallet'' under your clothes.\n\n|box|k\n|!Potentially Good Places to Keep Your Passport|\n|Hidden in the room of your homestay or residence hall|\n|In your hotel's safe (//not// the room safe)|\n|With your study abroad provider, if they offer such a service|\n\n&lt;&lt;continue &quot;Copying Documents&quot;&gt;&gt;\s\n&lt;&lt;autoPlay &quot;sounds/Passport Security.audio&quot; &quot;Copying Documents&quot;&gt;&gt;\s</div><div tiddler="Passport Check" tags="" modified="201401161525" created="201401161525" modifier="twee">&lt;img src=&quot;images/warning.png&quot; class=&quot;left inline&quot; style=&quot;width:40px; margin-right:10px;&quot; /&gt;\s\n!Passport Check\n!!!!Be sure that you have a valid passport, and that it will not be expiring within the next year or so.\nBefore we begin, take a moment to check your passport's expiration date.\n\n&lt;&lt;figure &quot;images/passport_expiration.jpg&quot; &quot;Where to find the expiration date on your main passport page.&quot; &quot;right&quot;&gt;&gt;Most countries will not allow you to get a student visa or residence permit if your passport is near its expiration date. Be sure that your passport does not expire until at least 6 months after your program ends!\n\n&lt;&lt;sidebar-link &quot;It looks like I need a new passport!&quot; &quot;Passport Acquisition&quot; &quot;Help!&quot;&gt;&gt;\n\n&lt;&lt;continue &quot;Passport Security&quot;&gt;&gt;\n&lt;&lt;autoPlay &quot;sounds/Passport Check.audio&quot; &quot;Passport Security&quot;&gt;&gt;\s\n&lt;&lt;section &quot;Travel Documents&quot; &quot;images/9732976450_d91248889d_h.jpg&quot;&gt;&gt;\s</div>
</div></html>
