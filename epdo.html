<!DOCTYPE html>
<html class="init-no-js">
<head>
<meta charset="UTF-8" />
<title>ePDO</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<!--

SugarCube (v0.9.5-ALPHA.1): A free (gratis and libre) header for Twine/Twee, based on TiddlyWiki.
Copyright © 2013–2014 Thomas Michael Edwards.

-->
<!--

Build Info:
  * Built on 03 Jul 2014 at 16:41:33, -0600
  * Made in Twine 1.4.2 (running on Windows 7)

-->
<script type="text/javascript">
/* init screen routing */
(function(){"use strict";document.documentElement.className=(!document.head||!document.querySelector||!document.addEventListener||!window.JSON||!Object.freeze)?"init-lacking":"init-loading";}());
</script>
<script type="text/javascript">
/*! jQuery v2.1.0 | (c) 2005, 2014 jQuery Foundation, Inc. | jquery.org/license */
!function(a,b){"object"==typeof module&&"object"==typeof module.exports?module.exports=a.document?b(a,!0):function(a){if(!a.document)throw new Error("jQuery requires a window with a document");return b(a)}:b(a)}("undefined"!=typeof window?window:this,function(a,b){var c=[],d=c.slice,e=c.concat,f=c.push,g=c.indexOf,h={},i=h.toString,j=h.hasOwnProperty,k="".trim,l={},m=a.document,n="2.1.0",o=function(a,b){return new o.fn.init(a,b)},p=/^-ms-/,q=/-([\da-z])/gi,r=function(a,b){return b.toUpperCase()};o.fn=o.prototype={jquery:n,constructor:o,selector:"",length:0,toArray:function(){return d.call(this)},get:function(a){return null!=a?0>a?this[a+this.length]:this[a]:d.call(this)},pushStack:function(a){var b=o.merge(this.constructor(),a);return b.prevObject=this,b.context=this.context,b},each:function(a,b){return o.each(this,a,b)},map:function(a){return this.pushStack(o.map(this,function(b,c){return a.call(b,c,b)}))},slice:function(){return this.pushStack(d.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(a){var b=this.length,c=+a+(0>a?b:0);return this.pushStack(c>=0&&b>c?[this[c]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:f,sort:c.sort,splice:c.splice},o.extend=o.fn.extend=function(){var a,b,c,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!1;for("boolean"==typeof g&&(j=g,g=arguments[h]||{},h++),"object"==typeof g||o.isFunction(g)||(g={}),h===i&&(g=this,h--);i>h;h++)if(null!=(a=arguments[h]))for(b in a)c=g[b],d=a[b],g!==d&&(j&&d&&(o.isPlainObject(d)||(e=o.isArray(d)))?(e?(e=!1,f=c&&o.isArray(c)?c:[]):f=c&&o.isPlainObject(c)?c:{},g[b]=o.extend(j,f,d)):void 0!==d&&(g[b]=d));return g},o.extend({expando:"jQuery"+(n+Math.random()).replace(/\D/g,""),isReady:!0,error:function(a){throw new Error(a)},noop:function(){},isFunction:function(a){return"function"===o.type(a)},isArray:Array.isArray,isWindow:function(a){return null!=a&&a===a.window},isNumeric:function(a){return a-parseFloat(a)>=0},isPlainObject:function(a){if("object"!==o.type(a)||a.nodeType||o.isWindow(a))return!1;try{if(a.constructor&&!j.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(b){return!1}return!0},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},type:function(a){return null==a?a+"":"object"==typeof a||"function"==typeof a?h[i.call(a)]||"object":typeof a},globalEval:function(a){var b,c=eval;a=o.trim(a),a&&(1===a.indexOf("use strict")?(b=m.createElement("script"),b.text=a,m.head.appendChild(b).parentNode.removeChild(b)):c(a))},camelCase:function(a){return a.replace(p,"ms-").replace(q,r)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()},each:function(a,b,c){var d,e=0,f=a.length,g=s(a);if(c){if(g){for(;f>e;e++)if(d=b.apply(a[e],c),d===!1)break}else for(e in a)if(d=b.apply(a[e],c),d===!1)break}else if(g){for(;f>e;e++)if(d=b.call(a[e],e,a[e]),d===!1)break}else for(e in a)if(d=b.call(a[e],e,a[e]),d===!1)break;return a},trim:function(a){return null==a?"":k.call(a)},makeArray:function(a,b){var c=b||[];return null!=a&&(s(Object(a))?o.merge(c,"string"==typeof a?[a]:a):f.call(c,a)),c},inArray:function(a,b,c){return null==b?-1:g.call(b,a,c)},merge:function(a,b){for(var c=+b.length,d=0,e=a.length;c>d;d++)a[e++]=b[d];return a.length=e,a},grep:function(a,b,c){for(var d,e=[],f=0,g=a.length,h=!c;g>f;f++)d=!b(a[f],f),d!==h&&e.push(a[f]);return e},map:function(a,b,c){var d,f=0,g=a.length,h=s(a),i=[];if(h)for(;g>f;f++)d=b(a[f],f,c),null!=d&&i.push(d);else for(f in a)d=b(a[f],f,c),null!=d&&i.push(d);return e.apply([],i)},guid:1,proxy:function(a,b){var c,e,f;return"string"==typeof b&&(c=a[b],b=a,a=c),o.isFunction(a)?(e=d.call(arguments,2),f=function(){return a.apply(b||this,e.concat(d.call(arguments)))},f.guid=a.guid=a.guid||o.guid++,f):void 0},now:Date.now,support:l}),o.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(a,b){h["[object "+b+"]"]=b.toLowerCase()});function s(a){var b=a.length,c=o.type(a);return"function"===c||o.isWindow(a)?!1:1===a.nodeType&&b?!0:"array"===c||0===b||"number"==typeof b&&b>0&&b-1 in a}var t=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s="sizzle"+-new Date,t=a.document,u=0,v=0,w=eb(),x=eb(),y=eb(),z=function(a,b){return a===b&&(j=!0),0},A="undefined",B=1<<31,C={}.hasOwnProperty,D=[],E=D.pop,F=D.push,G=D.push,H=D.slice,I=D.indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(this[b]===a)return b;return-1},J="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",K="[\\x20\\t\\r\\n\\f]",L="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",M=L.replace("w","w#"),N="\\["+K+"*("+L+")"+K+"*(?:([*^$|!~]?=)"+K+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+M+")|)|)"+K+"*\\]",O=":("+L+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+N.replace(3,8)+")*)|.*)\\)|)",P=new RegExp("^"+K+"+|((?:^|[^\\\\])(?:\\\\.)*)"+K+"+$","g"),Q=new RegExp("^"+K+"*,"+K+"*"),R=new RegExp("^"+K+"*([>+~]|"+K+")"+K+"*"),S=new RegExp("="+K+"*([^\\]'\"]*?)"+K+"*\\]","g"),T=new RegExp(O),U=new RegExp("^"+M+"$"),V={ID:new RegExp("^#("+L+")"),CLASS:new RegExp("^\\.("+L+")"),TAG:new RegExp("^("+L.replace("w","w*")+")"),ATTR:new RegExp("^"+N),PSEUDO:new RegExp("^"+O),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+K+"*(even|odd|(([+-]|)(\\d*)n|)"+K+"*(?:([+-]|)"+K+"*(\\d+)|))"+K+"*\\)|)","i"),bool:new RegExp("^(?:"+J+")$","i"),needsContext:new RegExp("^"+K+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+K+"*((?:-\\d)?\\d*)"+K+"*\\)|)(?=[^-]|$)","i")},W=/^(?:input|select|textarea|button)$/i,X=/^h\d$/i,Y=/^[^{]+\{\s*\[native \w/,Z=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,$=/[+~]/,_=/'|\\/g,ab=new RegExp("\\\\([\\da-f]{1,6}"+K+"?|("+K+")|.)","ig"),bb=function(a,b,c){var d="0x"+b-65536;return d!==d||c?b:0>d?String.fromCharCode(d+65536):String.fromCharCode(d>>10|55296,1023&d|56320)};try{G.apply(D=H.call(t.childNodes),t.childNodes),D[t.childNodes.length].nodeType}catch(cb){G={apply:D.length?function(a,b){F.apply(a,H.call(b))}:function(a,b){var c=a.length,d=0;while(a[c++]=b[d++]);a.length=c-1}}}function db(a,b,d,e){var f,g,h,i,j,m,p,q,u,v;if((b?b.ownerDocument||b:t)!==l&&k(b),b=b||l,d=d||[],!a||"string"!=typeof a)return d;if(1!==(i=b.nodeType)&&9!==i)return[];if(n&&!e){if(f=Z.exec(a))if(h=f[1]){if(9===i){if(g=b.getElementById(h),!g||!g.parentNode)return d;if(g.id===h)return d.push(g),d}else if(b.ownerDocument&&(g=b.ownerDocument.getElementById(h))&&r(b,g)&&g.id===h)return d.push(g),d}else{if(f[2])return G.apply(d,b.getElementsByTagName(a)),d;if((h=f[3])&&c.getElementsByClassName&&b.getElementsByClassName)return G.apply(d,b.getElementsByClassName(h)),d}if(c.qsa&&(!o||!o.test(a))){if(q=p=s,u=b,v=9===i&&a,1===i&&"object"!==b.nodeName.toLowerCase()){m=ob(a),(p=b.getAttribute("id"))?q=p.replace(_,"\\$&"):b.setAttribute("id",q),q="[id='"+q+"'] ",j=m.length;while(j--)m[j]=q+pb(m[j]);u=$.test(a)&&mb(b.parentNode)||b,v=m.join(",")}if(v)try{return G.apply(d,u.querySelectorAll(v)),d}catch(w){}finally{p||b.removeAttribute("id")}}}return xb(a.replace(P,"$1"),b,d,e)}function eb(){var a=[];function b(c,e){return a.push(c+" ")>d.cacheLength&&delete b[a.shift()],b[c+" "]=e}return b}function fb(a){return a[s]=!0,a}function gb(a){var b=l.createElement("div");try{return!!a(b)}catch(c){return!1}finally{b.parentNode&&b.parentNode.removeChild(b),b=null}}function hb(a,b){var c=a.split("|"),e=a.length;while(e--)d.attrHandle[c[e]]=b}function ib(a,b){var c=b&&a,d=c&&1===a.nodeType&&1===b.nodeType&&(~b.sourceIndex||B)-(~a.sourceIndex||B);if(d)return d;if(c)while(c=c.nextSibling)if(c===b)return-1;return a?1:-1}function jb(a){return function(b){var c=b.nodeName.toLowerCase();return"input"===c&&b.type===a}}function kb(a){return function(b){var c=b.nodeName.toLowerCase();return("input"===c||"button"===c)&&b.type===a}}function lb(a){return fb(function(b){return b=+b,fb(function(c,d){var e,f=a([],c.length,b),g=f.length;while(g--)c[e=f[g]]&&(c[e]=!(d[e]=c[e]))})})}function mb(a){return a&&typeof a.getElementsByTagName!==A&&a}c=db.support={},f=db.isXML=function(a){var b=a&&(a.ownerDocument||a).documentElement;return b?"HTML"!==b.nodeName:!1},k=db.setDocument=function(a){var b,e=a?a.ownerDocument||a:t,g=e.defaultView;return e!==l&&9===e.nodeType&&e.documentElement?(l=e,m=e.documentElement,n=!f(e),g&&g!==g.top&&(g.addEventListener?g.addEventListener("unload",function(){k()},!1):g.attachEvent&&g.attachEvent("onunload",function(){k()})),c.attributes=gb(function(a){return a.className="i",!a.getAttribute("className")}),c.getElementsByTagName=gb(function(a){return a.appendChild(e.createComment("")),!a.getElementsByTagName("*").length}),c.getElementsByClassName=Y.test(e.getElementsByClassName)&&gb(function(a){return a.innerHTML="<div class='a'></div><div class='a i'></div>",a.firstChild.className="i",2===a.getElementsByClassName("i").length}),c.getById=gb(function(a){return m.appendChild(a).id=s,!e.getElementsByName||!e.getElementsByName(s).length}),c.getById?(d.find.ID=function(a,b){if(typeof b.getElementById!==A&&n){var c=b.getElementById(a);return c&&c.parentNode?[c]:[]}},d.filter.ID=function(a){var b=a.replace(ab,bb);return function(a){return a.getAttribute("id")===b}}):(delete d.find.ID,d.filter.ID=function(a){var b=a.replace(ab,bb);return function(a){var c=typeof a.getAttributeNode!==A&&a.getAttributeNode("id");return c&&c.value===b}}),d.find.TAG=c.getElementsByTagName?function(a,b){return typeof b.getElementsByTagName!==A?b.getElementsByTagName(a):void 0}:function(a,b){var c,d=[],e=0,f=b.getElementsByTagName(a);if("*"===a){while(c=f[e++])1===c.nodeType&&d.push(c);return d}return f},d.find.CLASS=c.getElementsByClassName&&function(a,b){return typeof b.getElementsByClassName!==A&&n?b.getElementsByClassName(a):void 0},p=[],o=[],(c.qsa=Y.test(e.querySelectorAll))&&(gb(function(a){a.innerHTML="<select t=''><option selected=''></option></select>",a.querySelectorAll("[t^='']").length&&o.push("[*^$]="+K+"*(?:''|\"\")"),a.querySelectorAll("[selected]").length||o.push("\\["+K+"*(?:value|"+J+")"),a.querySelectorAll(":checked").length||o.push(":checked")}),gb(function(a){var b=e.createElement("input");b.setAttribute("type","hidden"),a.appendChild(b).setAttribute("name","D"),a.querySelectorAll("[name=d]").length&&o.push("name"+K+"*[*^$|!~]?="),a.querySelectorAll(":enabled").length||o.push(":enabled",":disabled"),a.querySelectorAll("*,:x"),o.push(",.*:")})),(c.matchesSelector=Y.test(q=m.webkitMatchesSelector||m.mozMatchesSelector||m.oMatchesSelector||m.msMatchesSelector))&&gb(function(a){c.disconnectedMatch=q.call(a,"div"),q.call(a,"[s!='']:x"),p.push("!=",O)}),o=o.length&&new RegExp(o.join("|")),p=p.length&&new RegExp(p.join("|")),b=Y.test(m.compareDocumentPosition),r=b||Y.test(m.contains)?function(a,b){var c=9===a.nodeType?a.documentElement:a,d=b&&b.parentNode;return a===d||!(!d||1!==d.nodeType||!(c.contains?c.contains(d):a.compareDocumentPosition&&16&a.compareDocumentPosition(d)))}:function(a,b){if(b)while(b=b.parentNode)if(b===a)return!0;return!1},z=b?function(a,b){if(a===b)return j=!0,0;var d=!a.compareDocumentPosition-!b.compareDocumentPosition;return d?d:(d=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1,1&d||!c.sortDetached&&b.compareDocumentPosition(a)===d?a===e||a.ownerDocument===t&&r(t,a)?-1:b===e||b.ownerDocument===t&&r(t,b)?1:i?I.call(i,a)-I.call(i,b):0:4&d?-1:1)}:function(a,b){if(a===b)return j=!0,0;var c,d=0,f=a.parentNode,g=b.parentNode,h=[a],k=[b];if(!f||!g)return a===e?-1:b===e?1:f?-1:g?1:i?I.call(i,a)-I.call(i,b):0;if(f===g)return ib(a,b);c=a;while(c=c.parentNode)h.unshift(c);c=b;while(c=c.parentNode)k.unshift(c);while(h[d]===k[d])d++;return d?ib(h[d],k[d]):h[d]===t?-1:k[d]===t?1:0},e):l},db.matches=function(a,b){return db(a,null,null,b)},db.matchesSelector=function(a,b){if((a.ownerDocument||a)!==l&&k(a),b=b.replace(S,"='$1']"),!(!c.matchesSelector||!n||p&&p.test(b)||o&&o.test(b)))try{var d=q.call(a,b);if(d||c.disconnectedMatch||a.document&&11!==a.document.nodeType)return d}catch(e){}return db(b,l,null,[a]).length>0},db.contains=function(a,b){return(a.ownerDocument||a)!==l&&k(a),r(a,b)},db.attr=function(a,b){(a.ownerDocument||a)!==l&&k(a);var e=d.attrHandle[b.toLowerCase()],f=e&&C.call(d.attrHandle,b.toLowerCase())?e(a,b,!n):void 0;return void 0!==f?f:c.attributes||!n?a.getAttribute(b):(f=a.getAttributeNode(b))&&f.specified?f.value:null},db.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)},db.uniqueSort=function(a){var b,d=[],e=0,f=0;if(j=!c.detectDuplicates,i=!c.sortStable&&a.slice(0),a.sort(z),j){while(b=a[f++])b===a[f]&&(e=d.push(f));while(e--)a.splice(d[e],1)}return i=null,a},e=db.getText=function(a){var b,c="",d=0,f=a.nodeType;if(f){if(1===f||9===f||11===f){if("string"==typeof a.textContent)return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=e(a)}else if(3===f||4===f)return a.nodeValue}else while(b=a[d++])c+=e(b);return c},d=db.selectors={cacheLength:50,createPseudo:fb,match:V,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){return a[1]=a[1].replace(ab,bb),a[3]=(a[4]||a[5]||"").replace(ab,bb),"~="===a[2]&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),"nth"===a[1].slice(0,3)?(a[3]||db.error(a[0]),a[4]=+(a[4]?a[5]+(a[6]||1):2*("even"===a[3]||"odd"===a[3])),a[5]=+(a[7]+a[8]||"odd"===a[3])):a[3]&&db.error(a[0]),a},PSEUDO:function(a){var b,c=!a[5]&&a[2];return V.CHILD.test(a[0])?null:(a[3]&&void 0!==a[4]?a[2]=a[4]:c&&T.test(c)&&(b=ob(c,!0))&&(b=c.indexOf(")",c.length-b)-c.length)&&(a[0]=a[0].slice(0,b),a[2]=c.slice(0,b)),a.slice(0,3))}},filter:{TAG:function(a){var b=a.replace(ab,bb).toLowerCase();return"*"===a?function(){return!0}:function(a){return a.nodeName&&a.nodeName.toLowerCase()===b}},CLASS:function(a){var b=w[a+" "];return b||(b=new RegExp("(^|"+K+")"+a+"("+K+"|$)"))&&w(a,function(a){return b.test("string"==typeof a.className&&a.className||typeof a.getAttribute!==A&&a.getAttribute("class")||"")})},ATTR:function(a,b,c){return function(d){var e=db.attr(d,a);return null==e?"!="===b:b?(e+="","="===b?e===c:"!="===b?e!==c:"^="===b?c&&0===e.indexOf(c):"*="===b?c&&e.indexOf(c)>-1:"$="===b?c&&e.slice(-c.length)===c:"~="===b?(" "+e+" ").indexOf(c)>-1:"|="===b?e===c||e.slice(0,c.length+1)===c+"-":!1):!0}},CHILD:function(a,b,c,d,e){var f="nth"!==a.slice(0,3),g="last"!==a.slice(-4),h="of-type"===b;return 1===d&&0===e?function(a){return!!a.parentNode}:function(b,c,i){var j,k,l,m,n,o,p=f!==g?"nextSibling":"previousSibling",q=b.parentNode,r=h&&b.nodeName.toLowerCase(),t=!i&&!h;if(q){if(f){while(p){l=b;while(l=l[p])if(h?l.nodeName.toLowerCase()===r:1===l.nodeType)return!1;o=p="only"===a&&!o&&"nextSibling"}return!0}if(o=[g?q.firstChild:q.lastChild],g&&t){k=q[s]||(q[s]={}),j=k[a]||[],n=j[0]===u&&j[1],m=j[0]===u&&j[2],l=n&&q.childNodes[n];while(l=++n&&l&&l[p]||(m=n=0)||o.pop())if(1===l.nodeType&&++m&&l===b){k[a]=[u,n,m];break}}else if(t&&(j=(b[s]||(b[s]={}))[a])&&j[0]===u)m=j[1];else while(l=++n&&l&&l[p]||(m=n=0)||o.pop())if((h?l.nodeName.toLowerCase()===r:1===l.nodeType)&&++m&&(t&&((l[s]||(l[s]={}))[a]=[u,m]),l===b))break;return m-=e,m===d||m%d===0&&m/d>=0}}},PSEUDO:function(a,b){var c,e=d.pseudos[a]||d.setFilters[a.toLowerCase()]||db.error("unsupported pseudo: "+a);return e[s]?e(b):e.length>1?(c=[a,a,"",b],d.setFilters.hasOwnProperty(a.toLowerCase())?fb(function(a,c){var d,f=e(a,b),g=f.length;while(g--)d=I.call(a,f[g]),a[d]=!(c[d]=f[g])}):function(a){return e(a,0,c)}):e}},pseudos:{not:fb(function(a){var b=[],c=[],d=g(a.replace(P,"$1"));return d[s]?fb(function(a,b,c,e){var f,g=d(a,null,e,[]),h=a.length;while(h--)(f=g[h])&&(a[h]=!(b[h]=f))}):function(a,e,f){return b[0]=a,d(b,null,f,c),!c.pop()}}),has:fb(function(a){return function(b){return db(a,b).length>0}}),contains:fb(function(a){return function(b){return(b.textContent||b.innerText||e(b)).indexOf(a)>-1}}),lang:fb(function(a){return U.test(a||"")||db.error("unsupported lang: "+a),a=a.replace(ab,bb).toLowerCase(),function(b){var c;do if(c=n?b.lang:b.getAttribute("xml:lang")||b.getAttribute("lang"))return c=c.toLowerCase(),c===a||0===c.indexOf(a+"-");while((b=b.parentNode)&&1===b.nodeType);return!1}}),target:function(b){var c=a.location&&a.location.hash;return c&&c.slice(1)===b.id},root:function(a){return a===m},focus:function(a){return a===l.activeElement&&(!l.hasFocus||l.hasFocus())&&!!(a.type||a.href||~a.tabIndex)},enabled:function(a){return a.disabled===!1},disabled:function(a){return a.disabled===!0},checked:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&!!a.checked||"option"===b&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,a.selected===!0},empty:function(a){for(a=a.firstChild;a;a=a.nextSibling)if(a.nodeType<6)return!1;return!0},parent:function(a){return!d.pseudos.empty(a)},header:function(a){return X.test(a.nodeName)},input:function(a){return W.test(a.nodeName)},button:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&"button"===a.type||"button"===b},text:function(a){var b;return"input"===a.nodeName.toLowerCase()&&"text"===a.type&&(null==(b=a.getAttribute("type"))||"text"===b.toLowerCase())},first:lb(function(){return[0]}),last:lb(function(a,b){return[b-1]}),eq:lb(function(a,b,c){return[0>c?c+b:c]}),even:lb(function(a,b){for(var c=0;b>c;c+=2)a.push(c);return a}),odd:lb(function(a,b){for(var c=1;b>c;c+=2)a.push(c);return a}),lt:lb(function(a,b,c){for(var d=0>c?c+b:c;--d>=0;)a.push(d);return a}),gt:lb(function(a,b,c){for(var d=0>c?c+b:c;++d<b;)a.push(d);return a})}},d.pseudos.nth=d.pseudos.eq;for(b in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})d.pseudos[b]=jb(b);for(b in{submit:!0,reset:!0})d.pseudos[b]=kb(b);function nb(){}nb.prototype=d.filters=d.pseudos,d.setFilters=new nb;function ob(a,b){var c,e,f,g,h,i,j,k=x[a+" "];if(k)return b?0:k.slice(0);h=a,i=[],j=d.preFilter;while(h){(!c||(e=Q.exec(h)))&&(e&&(h=h.slice(e[0].length)||h),i.push(f=[])),c=!1,(e=R.exec(h))&&(c=e.shift(),f.push({value:c,type:e[0].replace(P," ")}),h=h.slice(c.length));for(g in d.filter)!(e=V[g].exec(h))||j[g]&&!(e=j[g](e))||(c=e.shift(),f.push({value:c,type:g,matches:e}),h=h.slice(c.length));if(!c)break}return b?h.length:h?db.error(a):x(a,i).slice(0)}function pb(a){for(var b=0,c=a.length,d="";c>b;b++)d+=a[b].value;return d}function qb(a,b,c){var d=b.dir,e=c&&"parentNode"===d,f=v++;return b.first?function(b,c,f){while(b=b[d])if(1===b.nodeType||e)return a(b,c,f)}:function(b,c,g){var h,i,j=[u,f];if(g){while(b=b[d])if((1===b.nodeType||e)&&a(b,c,g))return!0}else while(b=b[d])if(1===b.nodeType||e){if(i=b[s]||(b[s]={}),(h=i[d])&&h[0]===u&&h[1]===f)return j[2]=h[2];if(i[d]=j,j[2]=a(b,c,g))return!0}}}function rb(a){return a.length>1?function(b,c,d){var e=a.length;while(e--)if(!a[e](b,c,d))return!1;return!0}:a[0]}function sb(a,b,c,d,e){for(var f,g=[],h=0,i=a.length,j=null!=b;i>h;h++)(f=a[h])&&(!c||c(f,d,e))&&(g.push(f),j&&b.push(h));return g}function tb(a,b,c,d,e,f){return d&&!d[s]&&(d=tb(d)),e&&!e[s]&&(e=tb(e,f)),fb(function(f,g,h,i){var j,k,l,m=[],n=[],o=g.length,p=f||wb(b||"*",h.nodeType?[h]:h,[]),q=!a||!f&&b?p:sb(p,m,a,h,i),r=c?e||(f?a:o||d)?[]:g:q;if(c&&c(q,r,h,i),d){j=sb(r,n),d(j,[],h,i),k=j.length;while(k--)(l=j[k])&&(r[n[k]]=!(q[n[k]]=l))}if(f){if(e||a){if(e){j=[],k=r.length;while(k--)(l=r[k])&&j.push(q[k]=l);e(null,r=[],j,i)}k=r.length;while(k--)(l=r[k])&&(j=e?I.call(f,l):m[k])>-1&&(f[j]=!(g[j]=l))}}else r=sb(r===g?r.splice(o,r.length):r),e?e(null,g,r,i):G.apply(g,r)})}function ub(a){for(var b,c,e,f=a.length,g=d.relative[a[0].type],i=g||d.relative[" "],j=g?1:0,k=qb(function(a){return a===b},i,!0),l=qb(function(a){return I.call(b,a)>-1},i,!0),m=[function(a,c,d){return!g&&(d||c!==h)||((b=c).nodeType?k(a,c,d):l(a,c,d))}];f>j;j++)if(c=d.relative[a[j].type])m=[qb(rb(m),c)];else{if(c=d.filter[a[j].type].apply(null,a[j].matches),c[s]){for(e=++j;f>e;e++)if(d.relative[a[e].type])break;return tb(j>1&&rb(m),j>1&&pb(a.slice(0,j-1).concat({value:" "===a[j-2].type?"*":""})).replace(P,"$1"),c,e>j&&ub(a.slice(j,e)),f>e&&ub(a=a.slice(e)),f>e&&pb(a))}m.push(c)}return rb(m)}function vb(a,b){var c=b.length>0,e=a.length>0,f=function(f,g,i,j,k){var m,n,o,p=0,q="0",r=f&&[],s=[],t=h,v=f||e&&d.find.TAG("*",k),w=u+=null==t?1:Math.random()||.1,x=v.length;for(k&&(h=g!==l&&g);q!==x&&null!=(m=v[q]);q++){if(e&&m){n=0;while(o=a[n++])if(o(m,g,i)){j.push(m);break}k&&(u=w)}c&&((m=!o&&m)&&p--,f&&r.push(m))}if(p+=q,c&&q!==p){n=0;while(o=b[n++])o(r,s,g,i);if(f){if(p>0)while(q--)r[q]||s[q]||(s[q]=E.call(j));s=sb(s)}G.apply(j,s),k&&!f&&s.length>0&&p+b.length>1&&db.uniqueSort(j)}return k&&(u=w,h=t),r};return c?fb(f):f}g=db.compile=function(a,b){var c,d=[],e=[],f=y[a+" "];if(!f){b||(b=ob(a)),c=b.length;while(c--)f=ub(b[c]),f[s]?d.push(f):e.push(f);f=y(a,vb(e,d))}return f};function wb(a,b,c){for(var d=0,e=b.length;e>d;d++)db(a,b[d],c);return c}function xb(a,b,e,f){var h,i,j,k,l,m=ob(a);if(!f&&1===m.length){if(i=m[0]=m[0].slice(0),i.length>2&&"ID"===(j=i[0]).type&&c.getById&&9===b.nodeType&&n&&d.relative[i[1].type]){if(b=(d.find.ID(j.matches[0].replace(ab,bb),b)||[])[0],!b)return e;a=a.slice(i.shift().value.length)}h=V.needsContext.test(a)?0:i.length;while(h--){if(j=i[h],d.relative[k=j.type])break;if((l=d.find[k])&&(f=l(j.matches[0].replace(ab,bb),$.test(i[0].type)&&mb(b.parentNode)||b))){if(i.splice(h,1),a=f.length&&pb(i),!a)return G.apply(e,f),e;break}}}return g(a,m)(f,b,!n,e,$.test(a)&&mb(b.parentNode)||b),e}return c.sortStable=s.split("").sort(z).join("")===s,c.detectDuplicates=!!j,k(),c.sortDetached=gb(function(a){return 1&a.compareDocumentPosition(l.createElement("div"))}),gb(function(a){return a.innerHTML="<a href='#'></a>","#"===a.firstChild.getAttribute("href")})||hb("type|href|height|width",function(a,b,c){return c?void 0:a.getAttribute(b,"type"===b.toLowerCase()?1:2)}),c.attributes&&gb(function(a){return a.innerHTML="<input/>",a.firstChild.setAttribute("value",""),""===a.firstChild.getAttribute("value")})||hb("value",function(a,b,c){return c||"input"!==a.nodeName.toLowerCase()?void 0:a.defaultValue}),gb(function(a){return null==a.getAttribute("disabled")})||hb(J,function(a,b,c){var d;return c?void 0:a[b]===!0?b.toLowerCase():(d=a.getAttributeNode(b))&&d.specified?d.value:null}),db}(a);o.find=t,o.expr=t.selectors,o.expr[":"]=o.expr.pseudos,o.unique=t.uniqueSort,o.text=t.getText,o.isXMLDoc=t.isXML,o.contains=t.contains;var u=o.expr.match.needsContext,v=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,w=/^.[^:#\[\.,]*$/;function x(a,b,c){if(o.isFunction(b))return o.grep(a,function(a,d){return!!b.call(a,d,a)!==c});if(b.nodeType)return o.grep(a,function(a){return a===b!==c});if("string"==typeof b){if(w.test(b))return o.filter(b,a,c);b=o.filter(b,a)}return o.grep(a,function(a){return g.call(b,a)>=0!==c})}o.filter=function(a,b,c){var d=b[0];return c&&(a=":not("+a+")"),1===b.length&&1===d.nodeType?o.find.matchesSelector(d,a)?[d]:[]:o.find.matches(a,o.grep(b,function(a){return 1===a.nodeType}))},o.fn.extend({find:function(a){var b,c=this.length,d=[],e=this;if("string"!=typeof a)return this.pushStack(o(a).filter(function(){for(b=0;c>b;b++)if(o.contains(e[b],this))return!0}));for(b=0;c>b;b++)o.find(a,e[b],d);return d=this.pushStack(c>1?o.unique(d):d),d.selector=this.selector?this.selector+" "+a:a,d},filter:function(a){return this.pushStack(x(this,a||[],!1))},not:function(a){return this.pushStack(x(this,a||[],!0))},is:function(a){return!!x(this,"string"==typeof a&&u.test(a)?o(a):a||[],!1).length}});var y,z=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,A=o.fn.init=function(a,b){var c,d;if(!a)return this;if("string"==typeof a){if(c="<"===a[0]&&">"===a[a.length-1]&&a.length>=3?[null,a,null]:z.exec(a),!c||!c[1]&&b)return!b||b.jquery?(b||y).find(a):this.constructor(b).find(a);if(c[1]){if(b=b instanceof o?b[0]:b,o.merge(this,o.parseHTML(c[1],b&&b.nodeType?b.ownerDocument||b:m,!0)),v.test(c[1])&&o.isPlainObject(b))for(c in b)o.isFunction(this[c])?this[c](b[c]):this.attr(c,b[c]);return this}return d=m.getElementById(c[2]),d&&d.parentNode&&(this.length=1,this[0]=d),this.context=m,this.selector=a,this}return a.nodeType?(this.context=this[0]=a,this.length=1,this):o.isFunction(a)?"undefined"!=typeof y.ready?y.ready(a):a(o):(void 0!==a.selector&&(this.selector=a.selector,this.context=a.context),o.makeArray(a,this))};A.prototype=o.fn,y=o(m);var B=/^(?:parents|prev(?:Until|All))/,C={children:!0,contents:!0,next:!0,prev:!0};o.extend({dir:function(a,b,c){var d=[],e=void 0!==c;while((a=a[b])&&9!==a.nodeType)if(1===a.nodeType){if(e&&o(a).is(c))break;d.push(a)}return d},sibling:function(a,b){for(var c=[];a;a=a.nextSibling)1===a.nodeType&&a!==b&&c.push(a);return c}}),o.fn.extend({has:function(a){var b=o(a,this),c=b.length;return this.filter(function(){for(var a=0;c>a;a++)if(o.contains(this,b[a]))return!0})},closest:function(a,b){for(var c,d=0,e=this.length,f=[],g=u.test(a)||"string"!=typeof a?o(a,b||this.context):0;e>d;d++)for(c=this[d];c&&c!==b;c=c.parentNode)if(c.nodeType<11&&(g?g.index(c)>-1:1===c.nodeType&&o.find.matchesSelector(c,a))){f.push(c);break}return this.pushStack(f.length>1?o.unique(f):f)},index:function(a){return a?"string"==typeof a?g.call(o(a),this[0]):g.call(this,a.jquery?a[0]:a):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(a,b){return this.pushStack(o.unique(o.merge(this.get(),o(a,b))))},addBack:function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}});function D(a,b){while((a=a[b])&&1!==a.nodeType);return a}o.each({parent:function(a){var b=a.parentNode;return b&&11!==b.nodeType?b:null},parents:function(a){return o.dir(a,"parentNode")},parentsUntil:function(a,b,c){return o.dir(a,"parentNode",c)},next:function(a){return D(a,"nextSibling")},prev:function(a){return D(a,"previousSibling")},nextAll:function(a){return o.dir(a,"nextSibling")},prevAll:function(a){return o.dir(a,"previousSibling")},nextUntil:function(a,b,c){return o.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return o.dir(a,"previousSibling",c)},siblings:function(a){return o.sibling((a.parentNode||{}).firstChild,a)},children:function(a){return o.sibling(a.firstChild)},contents:function(a){return a.contentDocument||o.merge([],a.childNodes)}},function(a,b){o.fn[a]=function(c,d){var e=o.map(this,b,c);return"Until"!==a.slice(-5)&&(d=c),d&&"string"==typeof d&&(e=o.filter(d,e)),this.length>1&&(C[a]||o.unique(e),B.test(a)&&e.reverse()),this.pushStack(e)}});var E=/\S+/g,F={};function G(a){var b=F[a]={};return o.each(a.match(E)||[],function(a,c){b[c]=!0}),b}o.Callbacks=function(a){a="string"==typeof a?F[a]||G(a):o.extend({},a);var b,c,d,e,f,g,h=[],i=!a.once&&[],j=function(l){for(b=a.memory&&l,c=!0,g=e||0,e=0,f=h.length,d=!0;h&&f>g;g++)if(h[g].apply(l[0],l[1])===!1&&a.stopOnFalse){b=!1;break}d=!1,h&&(i?i.length&&j(i.shift()):b?h=[]:k.disable())},k={add:function(){if(h){var c=h.length;!function g(b){o.each(b,function(b,c){var d=o.type(c);"function"===d?a.unique&&k.has(c)||h.push(c):c&&c.length&&"string"!==d&&g(c)})}(arguments),d?f=h.length:b&&(e=c,j(b))}return this},remove:function(){return h&&o.each(arguments,function(a,b){var c;while((c=o.inArray(b,h,c))>-1)h.splice(c,1),d&&(f>=c&&f--,g>=c&&g--)}),this},has:function(a){return a?o.inArray(a,h)>-1:!(!h||!h.length)},empty:function(){return h=[],f=0,this},disable:function(){return h=i=b=void 0,this},disabled:function(){return!h},lock:function(){return i=void 0,b||k.disable(),this},locked:function(){return!i},fireWith:function(a,b){return!h||c&&!i||(b=b||[],b=[a,b.slice?b.slice():b],d?i.push(b):j(b)),this},fire:function(){return k.fireWith(this,arguments),this},fired:function(){return!!c}};return k},o.extend({Deferred:function(a){var b=[["resolve","done",o.Callbacks("once memory"),"resolved"],["reject","fail",o.Callbacks("once memory"),"rejected"],["notify","progress",o.Callbacks("memory")]],c="pending",d={state:function(){return c},always:function(){return e.done(arguments).fail(arguments),this},then:function(){var a=arguments;return o.Deferred(function(c){o.each(b,function(b,f){var g=o.isFunction(a[b])&&a[b];e[f[1]](function(){var a=g&&g.apply(this,arguments);a&&o.isFunction(a.promise)?a.promise().done(c.resolve).fail(c.reject).progress(c.notify):c[f[0]+"With"](this===d?c.promise():this,g?[a]:arguments)})}),a=null}).promise()},promise:function(a){return null!=a?o.extend(a,d):d}},e={};return d.pipe=d.then,o.each(b,function(a,f){var g=f[2],h=f[3];d[f[1]]=g.add,h&&g.add(function(){c=h},b[1^a][2].disable,b[2][2].lock),e[f[0]]=function(){return e[f[0]+"With"](this===e?d:this,arguments),this},e[f[0]+"With"]=g.fireWith}),d.promise(e),a&&a.call(e,e),e},when:function(a){var b=0,c=d.call(arguments),e=c.length,f=1!==e||a&&o.isFunction(a.promise)?e:0,g=1===f?a:o.Deferred(),h=function(a,b,c){return function(e){b[a]=this,c[a]=arguments.length>1?d.call(arguments):e,c===i?g.notifyWith(b,c):--f||g.resolveWith(b,c)}},i,j,k;if(e>1)for(i=new Array(e),j=new Array(e),k=new Array(e);e>b;b++)c[b]&&o.isFunction(c[b].promise)?c[b].promise().done(h(b,k,c)).fail(g.reject).progress(h(b,j,i)):--f;return f||g.resolveWith(k,c),g.promise()}});var H;o.fn.ready=function(a){return o.ready.promise().done(a),this},o.extend({isReady:!1,readyWait:1,holdReady:function(a){a?o.readyWait++:o.ready(!0)},ready:function(a){(a===!0?--o.readyWait:o.isReady)||(o.isReady=!0,a!==!0&&--o.readyWait>0||(H.resolveWith(m,[o]),o.fn.trigger&&o(m).trigger("ready").off("ready")))}});function I(){m.removeEventListener("DOMContentLoaded",I,!1),a.removeEventListener("load",I,!1),o.ready()}o.ready.promise=function(b){return H||(H=o.Deferred(),"complete"===m.readyState?setTimeout(o.ready):(m.addEventListener("DOMContentLoaded",I,!1),a.addEventListener("load",I,!1))),H.promise(b)},o.ready.promise();var J=o.access=function(a,b,c,d,e,f,g){var h=0,i=a.length,j=null==c;if("object"===o.type(c)){e=!0;for(h in c)o.access(a,b,h,c[h],!0,f,g)}else if(void 0!==d&&(e=!0,o.isFunction(d)||(g=!0),j&&(g?(b.call(a,d),b=null):(j=b,b=function(a,b,c){return j.call(o(a),c)})),b))for(;i>h;h++)b(a[h],c,g?d:d.call(a[h],h,b(a[h],c)));return e?a:j?b.call(a):i?b(a[0],c):f};o.acceptData=function(a){return 1===a.nodeType||9===a.nodeType||!+a.nodeType};function K(){Object.defineProperty(this.cache={},0,{get:function(){return{}}}),this.expando=o.expando+Math.random()}K.uid=1,K.accepts=o.acceptData,K.prototype={key:function(a){if(!K.accepts(a))return 0;var b={},c=a[this.expando];if(!c){c=K.uid++;try{b[this.expando]={value:c},Object.defineProperties(a,b)}catch(d){b[this.expando]=c,o.extend(a,b)}}return this.cache[c]||(this.cache[c]={}),c},set:function(a,b,c){var d,e=this.key(a),f=this.cache[e];if("string"==typeof b)f[b]=c;else if(o.isEmptyObject(f))o.extend(this.cache[e],b);else for(d in b)f[d]=b[d];return f},get:function(a,b){var c=this.cache[this.key(a)];return void 0===b?c:c[b]},access:function(a,b,c){var d;return void 0===b||b&&"string"==typeof b&&void 0===c?(d=this.get(a,b),void 0!==d?d:this.get(a,o.camelCase(b))):(this.set(a,b,c),void 0!==c?c:b)},remove:function(a,b){var c,d,e,f=this.key(a),g=this.cache[f];if(void 0===b)this.cache[f]={};else{o.isArray(b)?d=b.concat(b.map(o.camelCase)):(e=o.camelCase(b),b in g?d=[b,e]:(d=e,d=d in g?[d]:d.match(E)||[])),c=d.length;while(c--)delete g[d[c]]}},hasData:function(a){return!o.isEmptyObject(this.cache[a[this.expando]]||{})},discard:function(a){a[this.expando]&&delete this.cache[a[this.expando]]}};var L=new K,M=new K,N=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,O=/([A-Z])/g;function P(a,b,c){var d;if(void 0===c&&1===a.nodeType)if(d="data-"+b.replace(O,"-$1").toLowerCase(),c=a.getAttribute(d),"string"==typeof c){try{c="true"===c?!0:"false"===c?!1:"null"===c?null:+c+""===c?+c:N.test(c)?o.parseJSON(c):c}catch(e){}M.set(a,b,c)}else c=void 0;return c}o.extend({hasData:function(a){return M.hasData(a)||L.hasData(a)},data:function(a,b,c){return M.access(a,b,c)},removeData:function(a,b){M.remove(a,b)},_data:function(a,b,c){return L.access(a,b,c)},_removeData:function(a,b){L.remove(a,b)}}),o.fn.extend({data:function(a,b){var c,d,e,f=this[0],g=f&&f.attributes;if(void 0===a){if(this.length&&(e=M.get(f),1===f.nodeType&&!L.get(f,"hasDataAttrs"))){c=g.length;
while(c--)d=g[c].name,0===d.indexOf("data-")&&(d=o.camelCase(d.slice(5)),P(f,d,e[d]));L.set(f,"hasDataAttrs",!0)}return e}return"object"==typeof a?this.each(function(){M.set(this,a)}):J(this,function(b){var c,d=o.camelCase(a);if(f&&void 0===b){if(c=M.get(f,a),void 0!==c)return c;if(c=M.get(f,d),void 0!==c)return c;if(c=P(f,d,void 0),void 0!==c)return c}else this.each(function(){var c=M.get(this,d);M.set(this,d,b),-1!==a.indexOf("-")&&void 0!==c&&M.set(this,a,b)})},null,b,arguments.length>1,null,!0)},removeData:function(a){return this.each(function(){M.remove(this,a)})}}),o.extend({queue:function(a,b,c){var d;return a?(b=(b||"fx")+"queue",d=L.get(a,b),c&&(!d||o.isArray(c)?d=L.access(a,b,o.makeArray(c)):d.push(c)),d||[]):void 0},dequeue:function(a,b){b=b||"fx";var c=o.queue(a,b),d=c.length,e=c.shift(),f=o._queueHooks(a,b),g=function(){o.dequeue(a,b)};"inprogress"===e&&(e=c.shift(),d--),e&&("fx"===b&&c.unshift("inprogress"),delete f.stop,e.call(a,g,f)),!d&&f&&f.empty.fire()},_queueHooks:function(a,b){var c=b+"queueHooks";return L.get(a,c)||L.access(a,c,{empty:o.Callbacks("once memory").add(function(){L.remove(a,[b+"queue",c])})})}}),o.fn.extend({queue:function(a,b){var c=2;return"string"!=typeof a&&(b=a,a="fx",c--),arguments.length<c?o.queue(this[0],a):void 0===b?this:this.each(function(){var c=o.queue(this,a,b);o._queueHooks(this,a),"fx"===a&&"inprogress"!==c[0]&&o.dequeue(this,a)})},dequeue:function(a){return this.each(function(){o.dequeue(this,a)})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,b){var c,d=1,e=o.Deferred(),f=this,g=this.length,h=function(){--d||e.resolveWith(f,[f])};"string"!=typeof a&&(b=a,a=void 0),a=a||"fx";while(g--)c=L.get(f[g],a+"queueHooks"),c&&c.empty&&(d++,c.empty.add(h));return h(),e.promise(b)}});var Q=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,R=["Top","Right","Bottom","Left"],S=function(a,b){return a=b||a,"none"===o.css(a,"display")||!o.contains(a.ownerDocument,a)},T=/^(?:checkbox|radio)$/i;!function(){var a=m.createDocumentFragment(),b=a.appendChild(m.createElement("div"));b.innerHTML="<input type='radio' checked='checked' name='t'/>",l.checkClone=b.cloneNode(!0).cloneNode(!0).lastChild.checked,b.innerHTML="<textarea>x</textarea>",l.noCloneChecked=!!b.cloneNode(!0).lastChild.defaultValue}();var U="undefined";l.focusinBubbles="onfocusin"in a;var V=/^key/,W=/^(?:mouse|contextmenu)|click/,X=/^(?:focusinfocus|focusoutblur)$/,Y=/^([^.]*)(?:\.(.+)|)$/;function Z(){return!0}function $(){return!1}function _(){try{return m.activeElement}catch(a){}}o.event={global:{},add:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,p,q,r=L.get(a);if(r){c.handler&&(f=c,c=f.handler,e=f.selector),c.guid||(c.guid=o.guid++),(i=r.events)||(i=r.events={}),(g=r.handle)||(g=r.handle=function(b){return typeof o!==U&&o.event.triggered!==b.type?o.event.dispatch.apply(a,arguments):void 0}),b=(b||"").match(E)||[""],j=b.length;while(j--)h=Y.exec(b[j])||[],n=q=h[1],p=(h[2]||"").split(".").sort(),n&&(l=o.event.special[n]||{},n=(e?l.delegateType:l.bindType)||n,l=o.event.special[n]||{},k=o.extend({type:n,origType:q,data:d,handler:c,guid:c.guid,selector:e,needsContext:e&&o.expr.match.needsContext.test(e),namespace:p.join(".")},f),(m=i[n])||(m=i[n]=[],m.delegateCount=0,l.setup&&l.setup.call(a,d,p,g)!==!1||a.addEventListener&&a.addEventListener(n,g,!1)),l.add&&(l.add.call(a,k),k.handler.guid||(k.handler.guid=c.guid)),e?m.splice(m.delegateCount++,0,k):m.push(k),o.event.global[n]=!0)}},remove:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,p,q,r=L.hasData(a)&&L.get(a);if(r&&(i=r.events)){b=(b||"").match(E)||[""],j=b.length;while(j--)if(h=Y.exec(b[j])||[],n=q=h[1],p=(h[2]||"").split(".").sort(),n){l=o.event.special[n]||{},n=(d?l.delegateType:l.bindType)||n,m=i[n]||[],h=h[2]&&new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"),g=f=m.length;while(f--)k=m[f],!e&&q!==k.origType||c&&c.guid!==k.guid||h&&!h.test(k.namespace)||d&&d!==k.selector&&("**"!==d||!k.selector)||(m.splice(f,1),k.selector&&m.delegateCount--,l.remove&&l.remove.call(a,k));g&&!m.length&&(l.teardown&&l.teardown.call(a,p,r.handle)!==!1||o.removeEvent(a,n,r.handle),delete i[n])}else for(n in i)o.event.remove(a,n+b[j],c,d,!0);o.isEmptyObject(i)&&(delete r.handle,L.remove(a,"events"))}},trigger:function(b,c,d,e){var f,g,h,i,k,l,n,p=[d||m],q=j.call(b,"type")?b.type:b,r=j.call(b,"namespace")?b.namespace.split("."):[];if(g=h=d=d||m,3!==d.nodeType&&8!==d.nodeType&&!X.test(q+o.event.triggered)&&(q.indexOf(".")>=0&&(r=q.split("."),q=r.shift(),r.sort()),k=q.indexOf(":")<0&&"on"+q,b=b[o.expando]?b:new o.Event(q,"object"==typeof b&&b),b.isTrigger=e?2:3,b.namespace=r.join("."),b.namespace_re=b.namespace?new RegExp("(^|\\.)"+r.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,b.result=void 0,b.target||(b.target=d),c=null==c?[b]:o.makeArray(c,[b]),n=o.event.special[q]||{},e||!n.trigger||n.trigger.apply(d,c)!==!1)){if(!e&&!n.noBubble&&!o.isWindow(d)){for(i=n.delegateType||q,X.test(i+q)||(g=g.parentNode);g;g=g.parentNode)p.push(g),h=g;h===(d.ownerDocument||m)&&p.push(h.defaultView||h.parentWindow||a)}f=0;while((g=p[f++])&&!b.isPropagationStopped())b.type=f>1?i:n.bindType||q,l=(L.get(g,"events")||{})[b.type]&&L.get(g,"handle"),l&&l.apply(g,c),l=k&&g[k],l&&l.apply&&o.acceptData(g)&&(b.result=l.apply(g,c),b.result===!1&&b.preventDefault());return b.type=q,e||b.isDefaultPrevented()||n._default&&n._default.apply(p.pop(),c)!==!1||!o.acceptData(d)||k&&o.isFunction(d[q])&&!o.isWindow(d)&&(h=d[k],h&&(d[k]=null),o.event.triggered=q,d[q](),o.event.triggered=void 0,h&&(d[k]=h)),b.result}},dispatch:function(a){a=o.event.fix(a);var b,c,e,f,g,h=[],i=d.call(arguments),j=(L.get(this,"events")||{})[a.type]||[],k=o.event.special[a.type]||{};if(i[0]=a,a.delegateTarget=this,!k.preDispatch||k.preDispatch.call(this,a)!==!1){h=o.event.handlers.call(this,a,j),b=0;while((f=h[b++])&&!a.isPropagationStopped()){a.currentTarget=f.elem,c=0;while((g=f.handlers[c++])&&!a.isImmediatePropagationStopped())(!a.namespace_re||a.namespace_re.test(g.namespace))&&(a.handleObj=g,a.data=g.data,e=((o.event.special[g.origType]||{}).handle||g.handler).apply(f.elem,i),void 0!==e&&(a.result=e)===!1&&(a.preventDefault(),a.stopPropagation()))}return k.postDispatch&&k.postDispatch.call(this,a),a.result}},handlers:function(a,b){var c,d,e,f,g=[],h=b.delegateCount,i=a.target;if(h&&i.nodeType&&(!a.button||"click"!==a.type))for(;i!==this;i=i.parentNode||this)if(i.disabled!==!0||"click"!==a.type){for(d=[],c=0;h>c;c++)f=b[c],e=f.selector+" ",void 0===d[e]&&(d[e]=f.needsContext?o(e,this).index(i)>=0:o.find(e,this,null,[i]).length),d[e]&&d.push(f);d.length&&g.push({elem:i,handlers:d})}return h<b.length&&g.push({elem:this,handlers:b.slice(h)}),g},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){return null==a.which&&(a.which=null!=b.charCode?b.charCode:b.keyCode),a}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,b){var c,d,e,f=b.button;return null==a.pageX&&null!=b.clientX&&(c=a.target.ownerDocument||m,d=c.documentElement,e=c.body,a.pageX=b.clientX+(d&&d.scrollLeft||e&&e.scrollLeft||0)-(d&&d.clientLeft||e&&e.clientLeft||0),a.pageY=b.clientY+(d&&d.scrollTop||e&&e.scrollTop||0)-(d&&d.clientTop||e&&e.clientTop||0)),a.which||void 0===f||(a.which=1&f?1:2&f?3:4&f?2:0),a}},fix:function(a){if(a[o.expando])return a;var b,c,d,e=a.type,f=a,g=this.fixHooks[e];g||(this.fixHooks[e]=g=W.test(e)?this.mouseHooks:V.test(e)?this.keyHooks:{}),d=g.props?this.props.concat(g.props):this.props,a=new o.Event(f),b=d.length;while(b--)c=d[b],a[c]=f[c];return a.target||(a.target=m),3===a.target.nodeType&&(a.target=a.target.parentNode),g.filter?g.filter(a,f):a},special:{load:{noBubble:!0},focus:{trigger:function(){return this!==_()&&this.focus?(this.focus(),!1):void 0},delegateType:"focusin"},blur:{trigger:function(){return this===_()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return"checkbox"===this.type&&this.click&&o.nodeName(this,"input")?(this.click(),!1):void 0},_default:function(a){return o.nodeName(a.target,"a")}},beforeunload:{postDispatch:function(a){void 0!==a.result&&(a.originalEvent.returnValue=a.result)}}},simulate:function(a,b,c,d){var e=o.extend(new o.Event,c,{type:a,isSimulated:!0,originalEvent:{}});d?o.event.trigger(e,null,b):o.event.dispatch.call(b,e),e.isDefaultPrevented()&&c.preventDefault()}},o.removeEvent=function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)},o.Event=function(a,b){return this instanceof o.Event?(a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||void 0===a.defaultPrevented&&a.getPreventDefault&&a.getPreventDefault()?Z:$):this.type=a,b&&o.extend(this,b),this.timeStamp=a&&a.timeStamp||o.now(),void(this[o.expando]=!0)):new o.Event(a,b)},o.Event.prototype={isDefaultPrevented:$,isPropagationStopped:$,isImmediatePropagationStopped:$,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=Z,a&&a.preventDefault&&a.preventDefault()},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=Z,a&&a.stopPropagation&&a.stopPropagation()},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=Z,this.stopPropagation()}},o.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,b){o.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,d=this,e=a.relatedTarget,f=a.handleObj;return(!e||e!==d&&!o.contains(d,e))&&(a.type=f.origType,c=f.handler.apply(this,arguments),a.type=b),c}}}),l.focusinBubbles||o.each({focus:"focusin",blur:"focusout"},function(a,b){var c=function(a){o.event.simulate(b,a.target,o.event.fix(a),!0)};o.event.special[b]={setup:function(){var d=this.ownerDocument||this,e=L.access(d,b);e||d.addEventListener(a,c,!0),L.access(d,b,(e||0)+1)},teardown:function(){var d=this.ownerDocument||this,e=L.access(d,b)-1;e?L.access(d,b,e):(d.removeEventListener(a,c,!0),L.remove(d,b))}}}),o.fn.extend({on:function(a,b,c,d,e){var f,g;if("object"==typeof a){"string"!=typeof b&&(c=c||b,b=void 0);for(g in a)this.on(g,b,c,a[g],e);return this}if(null==c&&null==d?(d=b,c=b=void 0):null==d&&("string"==typeof b?(d=c,c=void 0):(d=c,c=b,b=void 0)),d===!1)d=$;else if(!d)return this;return 1===e&&(f=d,d=function(a){return o().off(a),f.apply(this,arguments)},d.guid=f.guid||(f.guid=o.guid++)),this.each(function(){o.event.add(this,a,d,c,b)})},one:function(a,b,c,d){return this.on(a,b,c,d,1)},off:function(a,b,c){var d,e;if(a&&a.preventDefault&&a.handleObj)return d=a.handleObj,o(a.delegateTarget).off(d.namespace?d.origType+"."+d.namespace:d.origType,d.selector,d.handler),this;if("object"==typeof a){for(e in a)this.off(e,b,a[e]);return this}return(b===!1||"function"==typeof b)&&(c=b,b=void 0),c===!1&&(c=$),this.each(function(){o.event.remove(this,a,c,b)})},trigger:function(a,b){return this.each(function(){o.event.trigger(a,b,this)})},triggerHandler:function(a,b){var c=this[0];return c?o.event.trigger(a,b,c,!0):void 0}});var ab=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,bb=/<([\w:]+)/,cb=/<|&#?\w+;/,db=/<(?:script|style|link)/i,eb=/checked\s*(?:[^=]|=\s*.checked.)/i,fb=/^$|\/(?:java|ecma)script/i,gb=/^true\/(.*)/,hb=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,ib={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};ib.optgroup=ib.option,ib.tbody=ib.tfoot=ib.colgroup=ib.caption=ib.thead,ib.th=ib.td;function jb(a,b){return o.nodeName(a,"table")&&o.nodeName(11!==b.nodeType?b:b.firstChild,"tr")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function kb(a){return a.type=(null!==a.getAttribute("type"))+"/"+a.type,a}function lb(a){var b=gb.exec(a.type);return b?a.type=b[1]:a.removeAttribute("type"),a}function mb(a,b){for(var c=0,d=a.length;d>c;c++)L.set(a[c],"globalEval",!b||L.get(b[c],"globalEval"))}function nb(a,b){var c,d,e,f,g,h,i,j;if(1===b.nodeType){if(L.hasData(a)&&(f=L.access(a),g=L.set(b,f),j=f.events)){delete g.handle,g.events={};for(e in j)for(c=0,d=j[e].length;d>c;c++)o.event.add(b,e,j[e][c])}M.hasData(a)&&(h=M.access(a),i=o.extend({},h),M.set(b,i))}}function ob(a,b){var c=a.getElementsByTagName?a.getElementsByTagName(b||"*"):a.querySelectorAll?a.querySelectorAll(b||"*"):[];return void 0===b||b&&o.nodeName(a,b)?o.merge([a],c):c}function pb(a,b){var c=b.nodeName.toLowerCase();"input"===c&&T.test(a.type)?b.checked=a.checked:("input"===c||"textarea"===c)&&(b.defaultValue=a.defaultValue)}o.extend({clone:function(a,b,c){var d,e,f,g,h=a.cloneNode(!0),i=o.contains(a.ownerDocument,a);if(!(l.noCloneChecked||1!==a.nodeType&&11!==a.nodeType||o.isXMLDoc(a)))for(g=ob(h),f=ob(a),d=0,e=f.length;e>d;d++)pb(f[d],g[d]);if(b)if(c)for(f=f||ob(a),g=g||ob(h),d=0,e=f.length;e>d;d++)nb(f[d],g[d]);else nb(a,h);return g=ob(h,"script"),g.length>0&&mb(g,!i&&ob(a,"script")),h},buildFragment:function(a,b,c,d){for(var e,f,g,h,i,j,k=b.createDocumentFragment(),l=[],m=0,n=a.length;n>m;m++)if(e=a[m],e||0===e)if("object"===o.type(e))o.merge(l,e.nodeType?[e]:e);else if(cb.test(e)){f=f||k.appendChild(b.createElement("div")),g=(bb.exec(e)||["",""])[1].toLowerCase(),h=ib[g]||ib._default,f.innerHTML=h[1]+e.replace(ab,"<$1></$2>")+h[2],j=h[0];while(j--)f=f.lastChild;o.merge(l,f.childNodes),f=k.firstChild,f.textContent=""}else l.push(b.createTextNode(e));k.textContent="",m=0;while(e=l[m++])if((!d||-1===o.inArray(e,d))&&(i=o.contains(e.ownerDocument,e),f=ob(k.appendChild(e),"script"),i&&mb(f),c)){j=0;while(e=f[j++])fb.test(e.type||"")&&c.push(e)}return k},cleanData:function(a){for(var b,c,d,e,f,g,h=o.event.special,i=0;void 0!==(c=a[i]);i++){if(o.acceptData(c)&&(f=c[L.expando],f&&(b=L.cache[f]))){if(d=Object.keys(b.events||{}),d.length)for(g=0;void 0!==(e=d[g]);g++)h[e]?o.event.remove(c,e):o.removeEvent(c,e,b.handle);L.cache[f]&&delete L.cache[f]}delete M.cache[c[M.expando]]}}}),o.fn.extend({text:function(a){return J(this,function(a){return void 0===a?o.text(this):this.empty().each(function(){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&(this.textContent=a)})},null,a,arguments.length)},append:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=jb(this,a);b.appendChild(a)}})},prepend:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=jb(this,a);b.insertBefore(a,b.firstChild)}})},before:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this)})},after:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this.nextSibling)})},remove:function(a,b){for(var c,d=a?o.filter(a,this):this,e=0;null!=(c=d[e]);e++)b||1!==c.nodeType||o.cleanData(ob(c)),c.parentNode&&(b&&o.contains(c.ownerDocument,c)&&mb(ob(c,"script")),c.parentNode.removeChild(c));return this},empty:function(){for(var a,b=0;null!=(a=this[b]);b++)1===a.nodeType&&(o.cleanData(ob(a,!1)),a.textContent="");return this},clone:function(a,b){return a=null==a?!1:a,b=null==b?a:b,this.map(function(){return o.clone(this,a,b)})},html:function(a){return J(this,function(a){var b=this[0]||{},c=0,d=this.length;if(void 0===a&&1===b.nodeType)return b.innerHTML;if("string"==typeof a&&!db.test(a)&&!ib[(bb.exec(a)||["",""])[1].toLowerCase()]){a=a.replace(ab,"<$1></$2>");try{for(;d>c;c++)b=this[c]||{},1===b.nodeType&&(o.cleanData(ob(b,!1)),b.innerHTML=a);b=0}catch(e){}}b&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(){var a=arguments[0];return this.domManip(arguments,function(b){a=this.parentNode,o.cleanData(ob(this)),a&&a.replaceChild(b,this)}),a&&(a.length||a.nodeType)?this:this.remove()},detach:function(a){return this.remove(a,!0)},domManip:function(a,b){a=e.apply([],a);var c,d,f,g,h,i,j=0,k=this.length,m=this,n=k-1,p=a[0],q=o.isFunction(p);if(q||k>1&&"string"==typeof p&&!l.checkClone&&eb.test(p))return this.each(function(c){var d=m.eq(c);q&&(a[0]=p.call(this,c,d.html())),d.domManip(a,b)});if(k&&(c=o.buildFragment(a,this[0].ownerDocument,!1,this),d=c.firstChild,1===c.childNodes.length&&(c=d),d)){for(f=o.map(ob(c,"script"),kb),g=f.length;k>j;j++)h=c,j!==n&&(h=o.clone(h,!0,!0),g&&o.merge(f,ob(h,"script"))),b.call(this[j],h,j);if(g)for(i=f[f.length-1].ownerDocument,o.map(f,lb),j=0;g>j;j++)h=f[j],fb.test(h.type||"")&&!L.access(h,"globalEval")&&o.contains(i,h)&&(h.src?o._evalUrl&&o._evalUrl(h.src):o.globalEval(h.textContent.replace(hb,"")))}return this}}),o.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){o.fn[a]=function(a){for(var c,d=[],e=o(a),g=e.length-1,h=0;g>=h;h++)c=h===g?this:this.clone(!0),o(e[h])[b](c),f.apply(d,c.get());return this.pushStack(d)}});var qb,rb={};function sb(b,c){var d=o(c.createElement(b)).appendTo(c.body),e=a.getDefaultComputedStyle?a.getDefaultComputedStyle(d[0]).display:o.css(d[0],"display");return d.detach(),e}function tb(a){var b=m,c=rb[a];return c||(c=sb(a,b),"none"!==c&&c||(qb=(qb||o("<iframe frameborder='0' width='0' height='0'/>")).appendTo(b.documentElement),b=qb[0].contentDocument,b.write(),b.close(),c=sb(a,b),qb.detach()),rb[a]=c),c}var ub=/^margin/,vb=new RegExp("^("+Q+")(?!px)[a-z%]+$","i"),wb=function(a){return a.ownerDocument.defaultView.getComputedStyle(a,null)};function xb(a,b,c){var d,e,f,g,h=a.style;return c=c||wb(a),c&&(g=c.getPropertyValue(b)||c[b]),c&&(""!==g||o.contains(a.ownerDocument,a)||(g=o.style(a,b)),vb.test(g)&&ub.test(b)&&(d=h.width,e=h.minWidth,f=h.maxWidth,h.minWidth=h.maxWidth=h.width=g,g=c.width,h.width=d,h.minWidth=e,h.maxWidth=f)),void 0!==g?g+"":g}function yb(a,b){return{get:function(){return a()?void delete this.get:(this.get=b).apply(this,arguments)}}}!function(){var b,c,d="padding:0;margin:0;border:0;display:block;-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box",e=m.documentElement,f=m.createElement("div"),g=m.createElement("div");g.style.backgroundClip="content-box",g.cloneNode(!0).style.backgroundClip="",l.clearCloneStyle="content-box"===g.style.backgroundClip,f.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",f.appendChild(g);function h(){g.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%",e.appendChild(f);var d=a.getComputedStyle(g,null);b="1%"!==d.top,c="4px"===d.width,e.removeChild(f)}a.getComputedStyle&&o.extend(l,{pixelPosition:function(){return h(),b},boxSizingReliable:function(){return null==c&&h(),c},reliableMarginRight:function(){var b,c=g.appendChild(m.createElement("div"));return c.style.cssText=g.style.cssText=d,c.style.marginRight=c.style.width="0",g.style.width="1px",e.appendChild(f),b=!parseFloat(a.getComputedStyle(c,null).marginRight),e.removeChild(f),g.innerHTML="",b}})}(),o.swap=function(a,b,c,d){var e,f,g={};for(f in b)g[f]=a.style[f],a.style[f]=b[f];e=c.apply(a,d||[]);for(f in b)a.style[f]=g[f];return e};var zb=/^(none|table(?!-c[ea]).+)/,Ab=new RegExp("^("+Q+")(.*)$","i"),Bb=new RegExp("^([+-])=("+Q+")","i"),Cb={position:"absolute",visibility:"hidden",display:"block"},Db={letterSpacing:0,fontWeight:400},Eb=["Webkit","O","Moz","ms"];function Fb(a,b){if(b in a)return b;var c=b[0].toUpperCase()+b.slice(1),d=b,e=Eb.length;while(e--)if(b=Eb[e]+c,b in a)return b;return d}function Gb(a,b,c){var d=Ab.exec(b);return d?Math.max(0,d[1]-(c||0))+(d[2]||"px"):b}function Hb(a,b,c,d,e){for(var f=c===(d?"border":"content")?4:"width"===b?1:0,g=0;4>f;f+=2)"margin"===c&&(g+=o.css(a,c+R[f],!0,e)),d?("content"===c&&(g-=o.css(a,"padding"+R[f],!0,e)),"margin"!==c&&(g-=o.css(a,"border"+R[f]+"Width",!0,e))):(g+=o.css(a,"padding"+R[f],!0,e),"padding"!==c&&(g+=o.css(a,"border"+R[f]+"Width",!0,e)));return g}function Ib(a,b,c){var d=!0,e="width"===b?a.offsetWidth:a.offsetHeight,f=wb(a),g="border-box"===o.css(a,"boxSizing",!1,f);if(0>=e||null==e){if(e=xb(a,b,f),(0>e||null==e)&&(e=a.style[b]),vb.test(e))return e;d=g&&(l.boxSizingReliable()||e===a.style[b]),e=parseFloat(e)||0}return e+Hb(a,b,c||(g?"border":"content"),d,f)+"px"}function Jb(a,b){for(var c,d,e,f=[],g=0,h=a.length;h>g;g++)d=a[g],d.style&&(f[g]=L.get(d,"olddisplay"),c=d.style.display,b?(f[g]||"none"!==c||(d.style.display=""),""===d.style.display&&S(d)&&(f[g]=L.access(d,"olddisplay",tb(d.nodeName)))):f[g]||(e=S(d),(c&&"none"!==c||!e)&&L.set(d,"olddisplay",e?c:o.css(d,"display"))));for(g=0;h>g;g++)d=a[g],d.style&&(b&&"none"!==d.style.display&&""!==d.style.display||(d.style.display=b?f[g]||"":"none"));return a}o.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=xb(a,"opacity");return""===c?"1":c}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(a,b,c,d){if(a&&3!==a.nodeType&&8!==a.nodeType&&a.style){var e,f,g,h=o.camelCase(b),i=a.style;return b=o.cssProps[h]||(o.cssProps[h]=Fb(i,h)),g=o.cssHooks[b]||o.cssHooks[h],void 0===c?g&&"get"in g&&void 0!==(e=g.get(a,!1,d))?e:i[b]:(f=typeof c,"string"===f&&(e=Bb.exec(c))&&(c=(e[1]+1)*e[2]+parseFloat(o.css(a,b)),f="number"),null!=c&&c===c&&("number"!==f||o.cssNumber[h]||(c+="px"),l.clearCloneStyle||""!==c||0!==b.indexOf("background")||(i[b]="inherit"),g&&"set"in g&&void 0===(c=g.set(a,c,d))||(i[b]="",i[b]=c)),void 0)}},css:function(a,b,c,d){var e,f,g,h=o.camelCase(b);return b=o.cssProps[h]||(o.cssProps[h]=Fb(a.style,h)),g=o.cssHooks[b]||o.cssHooks[h],g&&"get"in g&&(e=g.get(a,!0,c)),void 0===e&&(e=xb(a,b,d)),"normal"===e&&b in Db&&(e=Db[b]),""===c||c?(f=parseFloat(e),c===!0||o.isNumeric(f)?f||0:e):e}}),o.each(["height","width"],function(a,b){o.cssHooks[b]={get:function(a,c,d){return c?0===a.offsetWidth&&zb.test(o.css(a,"display"))?o.swap(a,Cb,function(){return Ib(a,b,d)}):Ib(a,b,d):void 0},set:function(a,c,d){var e=d&&wb(a);return Gb(a,c,d?Hb(a,b,d,"border-box"===o.css(a,"boxSizing",!1,e),e):0)}}}),o.cssHooks.marginRight=yb(l.reliableMarginRight,function(a,b){return b?o.swap(a,{display:"inline-block"},xb,[a,"marginRight"]):void 0}),o.each({margin:"",padding:"",border:"Width"},function(a,b){o.cssHooks[a+b]={expand:function(c){for(var d=0,e={},f="string"==typeof c?c.split(" "):[c];4>d;d++)e[a+R[d]+b]=f[d]||f[d-2]||f[0];return e}},ub.test(a)||(o.cssHooks[a+b].set=Gb)}),o.fn.extend({css:function(a,b){return J(this,function(a,b,c){var d,e,f={},g=0;if(o.isArray(b)){for(d=wb(a),e=b.length;e>g;g++)f[b[g]]=o.css(a,b[g],!1,d);return f}return void 0!==c?o.style(a,b,c):o.css(a,b)},a,b,arguments.length>1)},show:function(){return Jb(this,!0)},hide:function(){return Jb(this)},toggle:function(a){return"boolean"==typeof a?a?this.show():this.hide():this.each(function(){S(this)?o(this).show():o(this).hide()})}});function Kb(a,b,c,d,e){return new Kb.prototype.init(a,b,c,d,e)}o.Tween=Kb,Kb.prototype={constructor:Kb,init:function(a,b,c,d,e,f){this.elem=a,this.prop=c,this.easing=e||"swing",this.options=b,this.start=this.now=this.cur(),this.end=d,this.unit=f||(o.cssNumber[c]?"":"px")},cur:function(){var a=Kb.propHooks[this.prop];return a&&a.get?a.get(this):Kb.propHooks._default.get(this)},run:function(a){var b,c=Kb.propHooks[this.prop];return this.pos=b=this.options.duration?o.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):a,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):Kb.propHooks._default.set(this),this}},Kb.prototype.init.prototype=Kb.prototype,Kb.propHooks={_default:{get:function(a){var b;return null==a.elem[a.prop]||a.elem.style&&null!=a.elem.style[a.prop]?(b=o.css(a.elem,a.prop,""),b&&"auto"!==b?b:0):a.elem[a.prop]},set:function(a){o.fx.step[a.prop]?o.fx.step[a.prop](a):a.elem.style&&(null!=a.elem.style[o.cssProps[a.prop]]||o.cssHooks[a.prop])?o.style(a.elem,a.prop,a.now+a.unit):a.elem[a.prop]=a.now}}},Kb.propHooks.scrollTop=Kb.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}},o.easing={linear:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2}},o.fx=Kb.prototype.init,o.fx.step={};var Lb,Mb,Nb=/^(?:toggle|show|hide)$/,Ob=new RegExp("^(?:([+-])=|)("+Q+")([a-z%]*)$","i"),Pb=/queueHooks$/,Qb=[Vb],Rb={"*":[function(a,b){var c=this.createTween(a,b),d=c.cur(),e=Ob.exec(b),f=e&&e[3]||(o.cssNumber[a]?"":"px"),g=(o.cssNumber[a]||"px"!==f&&+d)&&Ob.exec(o.css(c.elem,a)),h=1,i=20;if(g&&g[3]!==f){f=f||g[3],e=e||[],g=+d||1;do h=h||".5",g/=h,o.style(c.elem,a,g+f);while(h!==(h=c.cur()/d)&&1!==h&&--i)}return e&&(g=c.start=+g||+d||0,c.unit=f,c.end=e[1]?g+(e[1]+1)*e[2]:+e[2]),c}]};function Sb(){return setTimeout(function(){Lb=void 0}),Lb=o.now()}function Tb(a,b){var c,d=0,e={height:a};for(b=b?1:0;4>d;d+=2-b)c=R[d],e["margin"+c]=e["padding"+c]=a;return b&&(e.opacity=e.width=a),e}function Ub(a,b,c){for(var d,e=(Rb[b]||[]).concat(Rb["*"]),f=0,g=e.length;g>f;f++)if(d=e[f].call(c,b,a))return d}function Vb(a,b,c){var d,e,f,g,h,i,j,k=this,l={},m=a.style,n=a.nodeType&&S(a),p=L.get(a,"fxshow");c.queue||(h=o._queueHooks(a,"fx"),null==h.unqueued&&(h.unqueued=0,i=h.empty.fire,h.empty.fire=function(){h.unqueued||i()}),h.unqueued++,k.always(function(){k.always(function(){h.unqueued--,o.queue(a,"fx").length||h.empty.fire()})})),1===a.nodeType&&("height"in b||"width"in b)&&(c.overflow=[m.overflow,m.overflowX,m.overflowY],j=o.css(a,"display"),"none"===j&&(j=tb(a.nodeName)),"inline"===j&&"none"===o.css(a,"float")&&(m.display="inline-block")),c.overflow&&(m.overflow="hidden",k.always(function(){m.overflow=c.overflow[0],m.overflowX=c.overflow[1],m.overflowY=c.overflow[2]}));for(d in b)if(e=b[d],Nb.exec(e)){if(delete b[d],f=f||"toggle"===e,e===(n?"hide":"show")){if("show"!==e||!p||void 0===p[d])continue;n=!0}l[d]=p&&p[d]||o.style(a,d)}if(!o.isEmptyObject(l)){p?"hidden"in p&&(n=p.hidden):p=L.access(a,"fxshow",{}),f&&(p.hidden=!n),n?o(a).show():k.done(function(){o(a).hide()}),k.done(function(){var b;L.remove(a,"fxshow");for(b in l)o.style(a,b,l[b])});for(d in l)g=Ub(n?p[d]:0,d,k),d in p||(p[d]=g.start,n&&(g.end=g.start,g.start="width"===d||"height"===d?1:0))}}function Wb(a,b){var c,d,e,f,g;for(c in a)if(d=o.camelCase(c),e=b[d],f=a[c],o.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),g=o.cssHooks[d],g&&"expand"in g){f=g.expand(f),delete a[d];for(c in f)c in a||(a[c]=f[c],b[c]=e)}else b[d]=e}function Xb(a,b,c){var d,e,f=0,g=Qb.length,h=o.Deferred().always(function(){delete i.elem}),i=function(){if(e)return!1;for(var b=Lb||Sb(),c=Math.max(0,j.startTime+j.duration-b),d=c/j.duration||0,f=1-d,g=0,i=j.tweens.length;i>g;g++)j.tweens[g].run(f);return h.notifyWith(a,[j,f,c]),1>f&&i?c:(h.resolveWith(a,[j]),!1)},j=h.promise({elem:a,props:o.extend({},b),opts:o.extend(!0,{specialEasing:{}},c),originalProperties:b,originalOptions:c,startTime:Lb||Sb(),duration:c.duration,tweens:[],createTween:function(b,c){var d=o.Tween(a,j.opts,b,c,j.opts.specialEasing[b]||j.opts.easing);return j.tweens.push(d),d},stop:function(b){var c=0,d=b?j.tweens.length:0;if(e)return this;for(e=!0;d>c;c++)j.tweens[c].run(1);return b?h.resolveWith(a,[j,b]):h.rejectWith(a,[j,b]),this}}),k=j.props;for(Wb(k,j.opts.specialEasing);g>f;f++)if(d=Qb[f].call(j,a,k,j.opts))return d;return o.map(k,Ub,j),o.isFunction(j.opts.start)&&j.opts.start.call(a,j),o.fx.timer(o.extend(i,{elem:a,anim:j,queue:j.opts.queue})),j.progress(j.opts.progress).done(j.opts.done,j.opts.complete).fail(j.opts.fail).always(j.opts.always)}o.Animation=o.extend(Xb,{tweener:function(a,b){o.isFunction(a)?(b=a,a=["*"]):a=a.split(" ");for(var c,d=0,e=a.length;e>d;d++)c=a[d],Rb[c]=Rb[c]||[],Rb[c].unshift(b)},prefilter:function(a,b){b?Qb.unshift(a):Qb.push(a)}}),o.speed=function(a,b,c){var d=a&&"object"==typeof a?o.extend({},a):{complete:c||!c&&b||o.isFunction(a)&&a,duration:a,easing:c&&b||b&&!o.isFunction(b)&&b};return d.duration=o.fx.off?0:"number"==typeof d.duration?d.duration:d.duration in o.fx.speeds?o.fx.speeds[d.duration]:o.fx.speeds._default,(null==d.queue||d.queue===!0)&&(d.queue="fx"),d.old=d.complete,d.complete=function(){o.isFunction(d.old)&&d.old.call(this),d.queue&&o.dequeue(this,d.queue)},d},o.fn.extend({fadeTo:function(a,b,c,d){return this.filter(S).css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=o.isEmptyObject(a),f=o.speed(b,c,d),g=function(){var b=Xb(this,o.extend({},a),f);(e||L.get(this,"finish"))&&b.stop(!0)};return g.finish=g,e||f.queue===!1?this.each(g):this.queue(f.queue,g)},stop:function(a,b,c){var d=function(a){var b=a.stop;delete a.stop,b(c)};return"string"!=typeof a&&(c=b,b=a,a=void 0),b&&a!==!1&&this.queue(a||"fx",[]),this.each(function(){var b=!0,e=null!=a&&a+"queueHooks",f=o.timers,g=L.get(this);if(e)g[e]&&g[e].stop&&d(g[e]);else for(e in g)g[e]&&g[e].stop&&Pb.test(e)&&d(g[e]);for(e=f.length;e--;)f[e].elem!==this||null!=a&&f[e].queue!==a||(f[e].anim.stop(c),b=!1,f.splice(e,1));(b||!c)&&o.dequeue(this,a)})},finish:function(a){return a!==!1&&(a=a||"fx"),this.each(function(){var b,c=L.get(this),d=c[a+"queue"],e=c[a+"queueHooks"],f=o.timers,g=d?d.length:0;for(c.finish=!0,o.queue(this,a,[]),e&&e.stop&&e.stop.call(this,!0),b=f.length;b--;)f[b].elem===this&&f[b].queue===a&&(f[b].anim.stop(!0),f.splice(b,1));for(b=0;g>b;b++)d[b]&&d[b].finish&&d[b].finish.call(this);delete c.finish})}}),o.each(["toggle","show","hide"],function(a,b){var c=o.fn[b];o.fn[b]=function(a,d,e){return null==a||"boolean"==typeof a?c.apply(this,arguments):this.animate(Tb(b,!0),a,d,e)}}),o.each({slideDown:Tb("show"),slideUp:Tb("hide"),slideToggle:Tb("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){o.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),o.timers=[],o.fx.tick=function(){var a,b=0,c=o.timers;for(Lb=o.now();b<c.length;b++)a=c[b],a()||c[b]!==a||c.splice(b--,1);c.length||o.fx.stop(),Lb=void 0},o.fx.timer=function(a){o.timers.push(a),a()?o.fx.start():o.timers.pop()},o.fx.interval=13,o.fx.start=function(){Mb||(Mb=setInterval(o.fx.tick,o.fx.interval))},o.fx.stop=function(){clearInterval(Mb),Mb=null},o.fx.speeds={slow:600,fast:200,_default:400},o.fn.delay=function(a,b){return a=o.fx?o.fx.speeds[a]||a:a,b=b||"fx",this.queue(b,function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},function(){var a=m.createElement("input"),b=m.createElement("select"),c=b.appendChild(m.createElement("option"));a.type="checkbox",l.checkOn=""!==a.value,l.optSelected=c.selected,b.disabled=!0,l.optDisabled=!c.disabled,a=m.createElement("input"),a.value="t",a.type="radio",l.radioValue="t"===a.value}();var Yb,Zb,$b=o.expr.attrHandle;o.fn.extend({attr:function(a,b){return J(this,o.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){o.removeAttr(this,a)})}}),o.extend({attr:function(a,b,c){var d,e,f=a.nodeType;if(a&&3!==f&&8!==f&&2!==f)return typeof a.getAttribute===U?o.prop(a,b,c):(1===f&&o.isXMLDoc(a)||(b=b.toLowerCase(),d=o.attrHooks[b]||(o.expr.match.bool.test(b)?Zb:Yb)),void 0===c?d&&"get"in d&&null!==(e=d.get(a,b))?e:(e=o.find.attr(a,b),null==e?void 0:e):null!==c?d&&"set"in d&&void 0!==(e=d.set(a,c,b))?e:(a.setAttribute(b,c+""),c):void o.removeAttr(a,b))},removeAttr:function(a,b){var c,d,e=0,f=b&&b.match(E);if(f&&1===a.nodeType)while(c=f[e++])d=o.propFix[c]||c,o.expr.match.bool.test(c)&&(a[d]=!1),a.removeAttribute(c)},attrHooks:{type:{set:function(a,b){if(!l.radioValue&&"radio"===b&&o.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}}}}),Zb={set:function(a,b,c){return b===!1?o.removeAttr(a,c):a.setAttribute(c,c),c}},o.each(o.expr.match.bool.source.match(/\w+/g),function(a,b){var c=$b[b]||o.find.attr;$b[b]=function(a,b,d){var e,f;
return d||(f=$b[b],$b[b]=e,e=null!=c(a,b,d)?b.toLowerCase():null,$b[b]=f),e}});var _b=/^(?:input|select|textarea|button)$/i;o.fn.extend({prop:function(a,b){return J(this,o.prop,a,b,arguments.length>1)},removeProp:function(a){return this.each(function(){delete this[o.propFix[a]||a]})}}),o.extend({propFix:{"for":"htmlFor","class":"className"},prop:function(a,b,c){var d,e,f,g=a.nodeType;if(a&&3!==g&&8!==g&&2!==g)return f=1!==g||!o.isXMLDoc(a),f&&(b=o.propFix[b]||b,e=o.propHooks[b]),void 0!==c?e&&"set"in e&&void 0!==(d=e.set(a,c,b))?d:a[b]=c:e&&"get"in e&&null!==(d=e.get(a,b))?d:a[b]},propHooks:{tabIndex:{get:function(a){return a.hasAttribute("tabindex")||_b.test(a.nodeName)||a.href?a.tabIndex:-1}}}}),l.optSelected||(o.propHooks.selected={get:function(a){var b=a.parentNode;return b&&b.parentNode&&b.parentNode.selectedIndex,null}}),o.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){o.propFix[this.toLowerCase()]=this});var ac=/[\t\r\n\f]/g;o.fn.extend({addClass:function(a){var b,c,d,e,f,g,h="string"==typeof a&&a,i=0,j=this.length;if(o.isFunction(a))return this.each(function(b){o(this).addClass(a.call(this,b,this.className))});if(h)for(b=(a||"").match(E)||[];j>i;i++)if(c=this[i],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(ac," "):" ")){f=0;while(e=b[f++])d.indexOf(" "+e+" ")<0&&(d+=e+" ");g=o.trim(d),c.className!==g&&(c.className=g)}return this},removeClass:function(a){var b,c,d,e,f,g,h=0===arguments.length||"string"==typeof a&&a,i=0,j=this.length;if(o.isFunction(a))return this.each(function(b){o(this).removeClass(a.call(this,b,this.className))});if(h)for(b=(a||"").match(E)||[];j>i;i++)if(c=this[i],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(ac," "):"")){f=0;while(e=b[f++])while(d.indexOf(" "+e+" ")>=0)d=d.replace(" "+e+" "," ");g=a?o.trim(d):"",c.className!==g&&(c.className=g)}return this},toggleClass:function(a,b){var c=typeof a;return"boolean"==typeof b&&"string"===c?b?this.addClass(a):this.removeClass(a):this.each(o.isFunction(a)?function(c){o(this).toggleClass(a.call(this,c,this.className,b),b)}:function(){if("string"===c){var b,d=0,e=o(this),f=a.match(E)||[];while(b=f[d++])e.hasClass(b)?e.removeClass(b):e.addClass(b)}else(c===U||"boolean"===c)&&(this.className&&L.set(this,"__className__",this.className),this.className=this.className||a===!1?"":L.get(this,"__className__")||"")})},hasClass:function(a){for(var b=" "+a+" ",c=0,d=this.length;d>c;c++)if(1===this[c].nodeType&&(" "+this[c].className+" ").replace(ac," ").indexOf(b)>=0)return!0;return!1}});var bc=/\r/g;o.fn.extend({val:function(a){var b,c,d,e=this[0];{if(arguments.length)return d=o.isFunction(a),this.each(function(c){var e;1===this.nodeType&&(e=d?a.call(this,c,o(this).val()):a,null==e?e="":"number"==typeof e?e+="":o.isArray(e)&&(e=o.map(e,function(a){return null==a?"":a+""})),b=o.valHooks[this.type]||o.valHooks[this.nodeName.toLowerCase()],b&&"set"in b&&void 0!==b.set(this,e,"value")||(this.value=e))});if(e)return b=o.valHooks[e.type]||o.valHooks[e.nodeName.toLowerCase()],b&&"get"in b&&void 0!==(c=b.get(e,"value"))?c:(c=e.value,"string"==typeof c?c.replace(bc,""):null==c?"":c)}}}),o.extend({valHooks:{select:{get:function(a){for(var b,c,d=a.options,e=a.selectedIndex,f="select-one"===a.type||0>e,g=f?null:[],h=f?e+1:d.length,i=0>e?h:f?e:0;h>i;i++)if(c=d[i],!(!c.selected&&i!==e||(l.optDisabled?c.disabled:null!==c.getAttribute("disabled"))||c.parentNode.disabled&&o.nodeName(c.parentNode,"optgroup"))){if(b=o(c).val(),f)return b;g.push(b)}return g},set:function(a,b){var c,d,e=a.options,f=o.makeArray(b),g=e.length;while(g--)d=e[g],(d.selected=o.inArray(o(d).val(),f)>=0)&&(c=!0);return c||(a.selectedIndex=-1),f}}}}),o.each(["radio","checkbox"],function(){o.valHooks[this]={set:function(a,b){return o.isArray(b)?a.checked=o.inArray(o(a).val(),b)>=0:void 0}},l.checkOn||(o.valHooks[this].get=function(a){return null===a.getAttribute("value")?"on":a.value})}),o.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){o.fn[b]=function(a,c){return arguments.length>0?this.on(b,null,a,c):this.trigger(b)}}),o.fn.extend({hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return 1===arguments.length?this.off(a,"**"):this.off(b,a||"**",c)}});var cc=o.now(),dc=/\?/;o.parseJSON=function(a){return JSON.parse(a+"")},o.parseXML=function(a){var b,c;if(!a||"string"!=typeof a)return null;try{c=new DOMParser,b=c.parseFromString(a,"text/xml")}catch(d){b=void 0}return(!b||b.getElementsByTagName("parsererror").length)&&o.error("Invalid XML: "+a),b};var ec,fc,gc=/#.*$/,hc=/([?&])_=[^&]*/,ic=/^(.*?):[ \t]*([^\r\n]*)$/gm,jc=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,kc=/^(?:GET|HEAD)$/,lc=/^\/\//,mc=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,nc={},oc={},pc="*/".concat("*");try{fc=location.href}catch(qc){fc=m.createElement("a"),fc.href="",fc=fc.href}ec=mc.exec(fc.toLowerCase())||[];function rc(a){return function(b,c){"string"!=typeof b&&(c=b,b="*");var d,e=0,f=b.toLowerCase().match(E)||[];if(o.isFunction(c))while(d=f[e++])"+"===d[0]?(d=d.slice(1)||"*",(a[d]=a[d]||[]).unshift(c)):(a[d]=a[d]||[]).push(c)}}function sc(a,b,c,d){var e={},f=a===oc;function g(h){var i;return e[h]=!0,o.each(a[h]||[],function(a,h){var j=h(b,c,d);return"string"!=typeof j||f||e[j]?f?!(i=j):void 0:(b.dataTypes.unshift(j),g(j),!1)}),i}return g(b.dataTypes[0])||!e["*"]&&g("*")}function tc(a,b){var c,d,e=o.ajaxSettings.flatOptions||{};for(c in b)void 0!==b[c]&&((e[c]?a:d||(d={}))[c]=b[c]);return d&&o.extend(!0,a,d),a}function uc(a,b,c){var d,e,f,g,h=a.contents,i=a.dataTypes;while("*"===i[0])i.shift(),void 0===d&&(d=a.mimeType||b.getResponseHeader("Content-Type"));if(d)for(e in h)if(h[e]&&h[e].test(d)){i.unshift(e);break}if(i[0]in c)f=i[0];else{for(e in c){if(!i[0]||a.converters[e+" "+i[0]]){f=e;break}g||(g=e)}f=f||g}return f?(f!==i[0]&&i.unshift(f),c[f]):void 0}function vc(a,b,c,d){var e,f,g,h,i,j={},k=a.dataTypes.slice();if(k[1])for(g in a.converters)j[g.toLowerCase()]=a.converters[g];f=k.shift();while(f)if(a.responseFields[f]&&(c[a.responseFields[f]]=b),!i&&d&&a.dataFilter&&(b=a.dataFilter(b,a.dataType)),i=f,f=k.shift())if("*"===f)f=i;else if("*"!==i&&i!==f){if(g=j[i+" "+f]||j["* "+f],!g)for(e in j)if(h=e.split(" "),h[1]===f&&(g=j[i+" "+h[0]]||j["* "+h[0]])){g===!0?g=j[e]:j[e]!==!0&&(f=h[0],k.unshift(h[1]));break}if(g!==!0)if(g&&a["throws"])b=g(b);else try{b=g(b)}catch(l){return{state:"parsererror",error:g?l:"No conversion from "+i+" to "+f}}}return{state:"success",data:b}}o.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:fc,type:"GET",isLocal:jc.test(ec[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":pc,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":o.parseJSON,"text xml":o.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(a,b){return b?tc(tc(a,o.ajaxSettings),b):tc(o.ajaxSettings,a)},ajaxPrefilter:rc(nc),ajaxTransport:rc(oc),ajax:function(a,b){"object"==typeof a&&(b=a,a=void 0),b=b||{};var c,d,e,f,g,h,i,j,k=o.ajaxSetup({},b),l=k.context||k,m=k.context&&(l.nodeType||l.jquery)?o(l):o.event,n=o.Deferred(),p=o.Callbacks("once memory"),q=k.statusCode||{},r={},s={},t=0,u="canceled",v={readyState:0,getResponseHeader:function(a){var b;if(2===t){if(!f){f={};while(b=ic.exec(e))f[b[1].toLowerCase()]=b[2]}b=f[a.toLowerCase()]}return null==b?null:b},getAllResponseHeaders:function(){return 2===t?e:null},setRequestHeader:function(a,b){var c=a.toLowerCase();return t||(a=s[c]=s[c]||a,r[a]=b),this},overrideMimeType:function(a){return t||(k.mimeType=a),this},statusCode:function(a){var b;if(a)if(2>t)for(b in a)q[b]=[q[b],a[b]];else v.always(a[v.status]);return this},abort:function(a){var b=a||u;return c&&c.abort(b),x(0,b),this}};if(n.promise(v).complete=p.add,v.success=v.done,v.error=v.fail,k.url=((a||k.url||fc)+"").replace(gc,"").replace(lc,ec[1]+"//"),k.type=b.method||b.type||k.method||k.type,k.dataTypes=o.trim(k.dataType||"*").toLowerCase().match(E)||[""],null==k.crossDomain&&(h=mc.exec(k.url.toLowerCase()),k.crossDomain=!(!h||h[1]===ec[1]&&h[2]===ec[2]&&(h[3]||("http:"===h[1]?"80":"443"))===(ec[3]||("http:"===ec[1]?"80":"443")))),k.data&&k.processData&&"string"!=typeof k.data&&(k.data=o.param(k.data,k.traditional)),sc(nc,k,b,v),2===t)return v;i=k.global,i&&0===o.active++&&o.event.trigger("ajaxStart"),k.type=k.type.toUpperCase(),k.hasContent=!kc.test(k.type),d=k.url,k.hasContent||(k.data&&(d=k.url+=(dc.test(d)?"&":"?")+k.data,delete k.data),k.cache===!1&&(k.url=hc.test(d)?d.replace(hc,"$1_="+cc++):d+(dc.test(d)?"&":"?")+"_="+cc++)),k.ifModified&&(o.lastModified[d]&&v.setRequestHeader("If-Modified-Since",o.lastModified[d]),o.etag[d]&&v.setRequestHeader("If-None-Match",o.etag[d])),(k.data&&k.hasContent&&k.contentType!==!1||b.contentType)&&v.setRequestHeader("Content-Type",k.contentType),v.setRequestHeader("Accept",k.dataTypes[0]&&k.accepts[k.dataTypes[0]]?k.accepts[k.dataTypes[0]]+("*"!==k.dataTypes[0]?", "+pc+"; q=0.01":""):k.accepts["*"]);for(j in k.headers)v.setRequestHeader(j,k.headers[j]);if(k.beforeSend&&(k.beforeSend.call(l,v,k)===!1||2===t))return v.abort();u="abort";for(j in{success:1,error:1,complete:1})v[j](k[j]);if(c=sc(oc,k,b,v)){v.readyState=1,i&&m.trigger("ajaxSend",[v,k]),k.async&&k.timeout>0&&(g=setTimeout(function(){v.abort("timeout")},k.timeout));try{t=1,c.send(r,x)}catch(w){if(!(2>t))throw w;x(-1,w)}}else x(-1,"No Transport");function x(a,b,f,h){var j,r,s,u,w,x=b;2!==t&&(t=2,g&&clearTimeout(g),c=void 0,e=h||"",v.readyState=a>0?4:0,j=a>=200&&300>a||304===a,f&&(u=uc(k,v,f)),u=vc(k,u,v,j),j?(k.ifModified&&(w=v.getResponseHeader("Last-Modified"),w&&(o.lastModified[d]=w),w=v.getResponseHeader("etag"),w&&(o.etag[d]=w)),204===a||"HEAD"===k.type?x="nocontent":304===a?x="notmodified":(x=u.state,r=u.data,s=u.error,j=!s)):(s=x,(a||!x)&&(x="error",0>a&&(a=0))),v.status=a,v.statusText=(b||x)+"",j?n.resolveWith(l,[r,x,v]):n.rejectWith(l,[v,x,s]),v.statusCode(q),q=void 0,i&&m.trigger(j?"ajaxSuccess":"ajaxError",[v,k,j?r:s]),p.fireWith(l,[v,x]),i&&(m.trigger("ajaxComplete",[v,k]),--o.active||o.event.trigger("ajaxStop")))}return v},getJSON:function(a,b,c){return o.get(a,b,c,"json")},getScript:function(a,b){return o.get(a,void 0,b,"script")}}),o.each(["get","post"],function(a,b){o[b]=function(a,c,d,e){return o.isFunction(c)&&(e=e||d,d=c,c=void 0),o.ajax({url:a,type:b,dataType:e,data:c,success:d})}}),o.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(a,b){o.fn[b]=function(a){return this.on(b,a)}}),o._evalUrl=function(a){return o.ajax({url:a,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},o.fn.extend({wrapAll:function(a){var b;return o.isFunction(a)?this.each(function(b){o(this).wrapAll(a.call(this,b))}):(this[0]&&(b=o(a,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){var a=this;while(a.firstElementChild)a=a.firstElementChild;return a}).append(this)),this)},wrapInner:function(a){return this.each(o.isFunction(a)?function(b){o(this).wrapInner(a.call(this,b))}:function(){var b=o(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=o.isFunction(a);return this.each(function(c){o(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){o.nodeName(this,"body")||o(this).replaceWith(this.childNodes)}).end()}}),o.expr.filters.hidden=function(a){return a.offsetWidth<=0&&a.offsetHeight<=0},o.expr.filters.visible=function(a){return!o.expr.filters.hidden(a)};var wc=/%20/g,xc=/\[\]$/,yc=/\r?\n/g,zc=/^(?:submit|button|image|reset|file)$/i,Ac=/^(?:input|select|textarea|keygen)/i;function Bc(a,b,c,d){var e;if(o.isArray(b))o.each(b,function(b,e){c||xc.test(a)?d(a,e):Bc(a+"["+("object"==typeof e?b:"")+"]",e,c,d)});else if(c||"object"!==o.type(b))d(a,b);else for(e in b)Bc(a+"["+e+"]",b[e],c,d)}o.param=function(a,b){var c,d=[],e=function(a,b){b=o.isFunction(b)?b():null==b?"":b,d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};if(void 0===b&&(b=o.ajaxSettings&&o.ajaxSettings.traditional),o.isArray(a)||a.jquery&&!o.isPlainObject(a))o.each(a,function(){e(this.name,this.value)});else for(c in a)Bc(c,a[c],b,e);return d.join("&").replace(wc,"+")},o.fn.extend({serialize:function(){return o.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var a=o.prop(this,"elements");return a?o.makeArray(a):this}).filter(function(){var a=this.type;return this.name&&!o(this).is(":disabled")&&Ac.test(this.nodeName)&&!zc.test(a)&&(this.checked||!T.test(a))}).map(function(a,b){var c=o(this).val();return null==c?null:o.isArray(c)?o.map(c,function(a){return{name:b.name,value:a.replace(yc,"\r\n")}}):{name:b.name,value:c.replace(yc,"\r\n")}}).get()}}),o.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(a){}};var Cc=0,Dc={},Ec={0:200,1223:204},Fc=o.ajaxSettings.xhr();a.ActiveXObject&&o(a).on("unload",function(){for(var a in Dc)Dc[a]()}),l.cors=!!Fc&&"withCredentials"in Fc,l.ajax=Fc=!!Fc,o.ajaxTransport(function(a){var b;return l.cors||Fc&&!a.crossDomain?{send:function(c,d){var e,f=a.xhr(),g=++Cc;if(f.open(a.type,a.url,a.async,a.username,a.password),a.xhrFields)for(e in a.xhrFields)f[e]=a.xhrFields[e];a.mimeType&&f.overrideMimeType&&f.overrideMimeType(a.mimeType),a.crossDomain||c["X-Requested-With"]||(c["X-Requested-With"]="XMLHttpRequest");for(e in c)f.setRequestHeader(e,c[e]);b=function(a){return function(){b&&(delete Dc[g],b=f.onload=f.onerror=null,"abort"===a?f.abort():"error"===a?d(f.status,f.statusText):d(Ec[f.status]||f.status,f.statusText,"string"==typeof f.responseText?{text:f.responseText}:void 0,f.getAllResponseHeaders()))}},f.onload=b(),f.onerror=b("error"),b=Dc[g]=b("abort"),f.send(a.hasContent&&a.data||null)},abort:function(){b&&b()}}:void 0}),o.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(a){return o.globalEval(a),a}}}),o.ajaxPrefilter("script",function(a){void 0===a.cache&&(a.cache=!1),a.crossDomain&&(a.type="GET")}),o.ajaxTransport("script",function(a){if(a.crossDomain){var b,c;return{send:function(d,e){b=o("<script>").prop({async:!0,charset:a.scriptCharset,src:a.url}).on("load error",c=function(a){b.remove(),c=null,a&&e("error"===a.type?404:200,a.type)}),m.head.appendChild(b[0])},abort:function(){c&&c()}}}});var Gc=[],Hc=/(=)\?(?=&|$)|\?\?/;o.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=Gc.pop()||o.expando+"_"+cc++;return this[a]=!0,a}}),o.ajaxPrefilter("json jsonp",function(b,c,d){var e,f,g,h=b.jsonp!==!1&&(Hc.test(b.url)?"url":"string"==typeof b.data&&!(b.contentType||"").indexOf("application/x-www-form-urlencoded")&&Hc.test(b.data)&&"data");return h||"jsonp"===b.dataTypes[0]?(e=b.jsonpCallback=o.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,h?b[h]=b[h].replace(Hc,"$1"+e):b.jsonp!==!1&&(b.url+=(dc.test(b.url)?"&":"?")+b.jsonp+"="+e),b.converters["script json"]=function(){return g||o.error(e+" was not called"),g[0]},b.dataTypes[0]="json",f=a[e],a[e]=function(){g=arguments},d.always(function(){a[e]=f,b[e]&&(b.jsonpCallback=c.jsonpCallback,Gc.push(e)),g&&o.isFunction(f)&&f(g[0]),g=f=void 0}),"script"):void 0}),o.parseHTML=function(a,b,c){if(!a||"string"!=typeof a)return null;"boolean"==typeof b&&(c=b,b=!1),b=b||m;var d=v.exec(a),e=!c&&[];return d?[b.createElement(d[1])]:(d=o.buildFragment([a],b,e),e&&e.length&&o(e).remove(),o.merge([],d.childNodes))};var Ic=o.fn.load;o.fn.load=function(a,b,c){if("string"!=typeof a&&Ic)return Ic.apply(this,arguments);var d,e,f,g=this,h=a.indexOf(" ");return h>=0&&(d=a.slice(h),a=a.slice(0,h)),o.isFunction(b)?(c=b,b=void 0):b&&"object"==typeof b&&(e="POST"),g.length>0&&o.ajax({url:a,type:e,dataType:"html",data:b}).done(function(a){f=arguments,g.html(d?o("<div>").append(o.parseHTML(a)).find(d):a)}).complete(c&&function(a,b){g.each(c,f||[a.responseText,b,a])}),this},o.expr.filters.animated=function(a){return o.grep(o.timers,function(b){return a===b.elem}).length};var Jc=a.document.documentElement;function Kc(a){return o.isWindow(a)?a:9===a.nodeType&&a.defaultView}o.offset={setOffset:function(a,b,c){var d,e,f,g,h,i,j,k=o.css(a,"position"),l=o(a),m={};"static"===k&&(a.style.position="relative"),h=l.offset(),f=o.css(a,"top"),i=o.css(a,"left"),j=("absolute"===k||"fixed"===k)&&(f+i).indexOf("auto")>-1,j?(d=l.position(),g=d.top,e=d.left):(g=parseFloat(f)||0,e=parseFloat(i)||0),o.isFunction(b)&&(b=b.call(a,c,h)),null!=b.top&&(m.top=b.top-h.top+g),null!=b.left&&(m.left=b.left-h.left+e),"using"in b?b.using.call(a,m):l.css(m)}},o.fn.extend({offset:function(a){if(arguments.length)return void 0===a?this:this.each(function(b){o.offset.setOffset(this,a,b)});var b,c,d=this[0],e={top:0,left:0},f=d&&d.ownerDocument;if(f)return b=f.documentElement,o.contains(b,d)?(typeof d.getBoundingClientRect!==U&&(e=d.getBoundingClientRect()),c=Kc(f),{top:e.top+c.pageYOffset-b.clientTop,left:e.left+c.pageXOffset-b.clientLeft}):e},position:function(){if(this[0]){var a,b,c=this[0],d={top:0,left:0};return"fixed"===o.css(c,"position")?b=c.getBoundingClientRect():(a=this.offsetParent(),b=this.offset(),o.nodeName(a[0],"html")||(d=a.offset()),d.top+=o.css(a[0],"borderTopWidth",!0),d.left+=o.css(a[0],"borderLeftWidth",!0)),{top:b.top-d.top-o.css(c,"marginTop",!0),left:b.left-d.left-o.css(c,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var a=this.offsetParent||Jc;while(a&&!o.nodeName(a,"html")&&"static"===o.css(a,"position"))a=a.offsetParent;return a||Jc})}}),o.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(b,c){var d="pageYOffset"===c;o.fn[b]=function(e){return J(this,function(b,e,f){var g=Kc(b);return void 0===f?g?g[c]:b[e]:void(g?g.scrollTo(d?a.pageXOffset:f,d?f:a.pageYOffset):b[e]=f)},b,e,arguments.length,null)}}),o.each(["top","left"],function(a,b){o.cssHooks[b]=yb(l.pixelPosition,function(a,c){return c?(c=xb(a,b),vb.test(c)?o(a).position()[b]+"px":c):void 0})}),o.each({Height:"height",Width:"width"},function(a,b){o.each({padding:"inner"+a,content:b,"":"outer"+a},function(c,d){o.fn[d]=function(d,e){var f=arguments.length&&(c||"boolean"!=typeof d),g=c||(d===!0||e===!0?"margin":"border");return J(this,function(b,c,d){var e;return o.isWindow(b)?b.document.documentElement["client"+a]:9===b.nodeType?(e=b.documentElement,Math.max(b.body["scroll"+a],e["scroll"+a],b.body["offset"+a],e["offset"+a],e["client"+a])):void 0===d?o.css(b,c,g):o.style(b,c,d,g)},b,f?d:void 0,f,null)}})}),o.fn.size=function(){return this.length},o.fn.andSelf=o.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return o});var Lc=a.jQuery,Mc=a.$;return o.noConflict=function(b){return a.$===o&&(a.$=Mc),b&&a.jQuery===o&&(a.jQuery=Lc),o},typeof b===U&&(a.jQuery=a.$=o),o});
</script>
<script type="text/javascript">
/*! jQuery throttle / debounce - v1.1 - 3/7/2010 [http://benalman.com/projects/jquery-throttle-debounce-plugin/] | (c) 2010 "Cowboy" Ben Alman | Dual licensed under the MIT and GPL licenses. [http://benalman.com/about/license/] */
(function(b,c){var $=b.jQuery||b.Cowboy||(b.Cowboy={}),a;$.throttle=a=function(e,f,j,i){var h,d=0;if(typeof f!=="boolean"){i=j;j=f;f=c}function g(){var o=this,m=+new Date()-d,n=arguments;function l(){d=+new Date();j.apply(o,n)}function k(){h=c}if(i&&!h){l()}h&&clearTimeout(h);if(i===c&&m>e){l()}else{if(f!==true){h=setTimeout(i?k:l,i===c?e-m:e)}}}if($.guid){g.guid=j.guid=j.guid||$.guid++}return g};$.debounce=function(d,e,f){return f===c?a(d,e,false):a(d,f,e!==false)}})(this);
</script>
<script type="text/javascript">
/*! seedrandom.js v2.3.3 | (c) 2013 David Bau | Licensed under a BSD-style license */
!function(a,b,c,d,e,f,g,h,i){function j(a){var b,c=a.length,e=this,f=0,g=e.i=e.j=0,h=e.S=[];for(c||(a=[c++]);d>f;)h[f]=f++;for(f=0;d>f;f++)h[f]=h[g=r&g+a[f%c]+(b=h[f])],h[g]=b;(e.g=function(a){for(var b,c=0,f=e.i,g=e.j,h=e.S;a--;)b=h[f=r&f+1],c=c*d+h[r&(h[f]=h[g=r&g+b])+(h[g]=b)];return e.i=f,e.j=g,c})(d)}function k(a,b){var c,d=[],e=typeof a;if(b&&"object"==e)for(c in a)try{d.push(k(a[c],b-1))}catch(f){}return d.length?d:"string"==e?a:a+"\0"}function l(a,b){for(var c,d=a+"",e=0;e<d.length;)b[r&e]=r&(c^=19*b[r&e])+d.charCodeAt(e++);return n(b)}function m(c){try{return a.crypto.getRandomValues(c=new Uint8Array(d)),n(c)}catch(e){return[+new Date,a,(c=a.navigator)&&c.plugins,a.screen,n(b)]}}function n(a){return String.fromCharCode.apply(0,a)}var o=c.pow(d,e),p=c.pow(2,f),q=2*p,r=d-1,s=c["seed"+i]=function(a,f,g){var h=[],r=l(k(f?[a,n(b)]:null==a?m():a,3),h),s=new j(h);return l(n(s.S),b),(g||function(a,b,d){return d?(c[i]=a,b):a})(function(){for(var a=s.g(e),b=o,c=0;p>a;)a=(a+c)*d,b*=d,c=s.g(1);for(;a>=q;)a/=2,b/=2,c>>>=1;return(a+c)/b},r,this==c)};l(c[i](),b),g&&g.exports?g.exports=s:h&&h.amd&&h(function(){return s})}(this,[],Math,256,6,52,"object"==typeof module&&module,"function"==typeof define&&define,"random");
</script>
<script type="text/javascript">
/*! lz-string-1.3.3-min.js | (c) 2013 Pieroxy | Licensed under a WTFPL license */
var LZString={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_f:String.fromCharCode,compressToBase64:function(e){if(e==null)return"";var t="";var n,r,i,s,o,u,a;var f=0;e=LZString.compress(e);while(f<e.length*2){if(f%2==0){n=e.charCodeAt(f/2)>>8;r=e.charCodeAt(f/2)&255;if(f/2+1<e.length)i=e.charCodeAt(f/2+1)>>8;else i=NaN}else{n=e.charCodeAt((f-1)/2)&255;if((f+1)/2<e.length){r=e.charCodeAt((f+1)/2)>>8;i=e.charCodeAt((f+1)/2)&255}else r=i=NaN}f+=3;s=n>>2;o=(n&3)<<4|r>>4;u=(r&15)<<2|i>>6;a=i&63;if(isNaN(r)){u=a=64}else if(isNaN(i)){a=64}t=t+LZString._keyStr.charAt(s)+LZString._keyStr.charAt(o)+LZString._keyStr.charAt(u)+LZString._keyStr.charAt(a)}return t},decompressFromBase64:function(e){if(e==null)return"";var t="",n=0,r,i,s,o,u,a,f,l,c=0,h=LZString._f;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(c<e.length){u=LZString._keyStr.indexOf(e.charAt(c++));a=LZString._keyStr.indexOf(e.charAt(c++));f=LZString._keyStr.indexOf(e.charAt(c++));l=LZString._keyStr.indexOf(e.charAt(c++));i=u<<2|a>>4;s=(a&15)<<4|f>>2;o=(f&3)<<6|l;if(n%2==0){r=i<<8;if(f!=64){t+=h(r|s)}if(l!=64){r=o<<8}}else{t=t+h(r|i);if(f!=64){r=s<<8}if(l!=64){t+=h(r|o)}}n+=3}return LZString.decompress(t)},compressToUTF16:function(e){if(e==null)return"";var t="",n,r,i,s=0,o=LZString._f;e=LZString.compress(e);for(n=0;n<e.length;n++){r=e.charCodeAt(n);switch(s++){case 0:t+=o((r>>1)+32);i=(r&1)<<14;break;case 1:t+=o(i+(r>>2)+32);i=(r&3)<<13;break;case 2:t+=o(i+(r>>3)+32);i=(r&7)<<12;break;case 3:t+=o(i+(r>>4)+32);i=(r&15)<<11;break;case 4:t+=o(i+(r>>5)+32);i=(r&31)<<10;break;case 5:t+=o(i+(r>>6)+32);i=(r&63)<<9;break;case 6:t+=o(i+(r>>7)+32);i=(r&127)<<8;break;case 7:t+=o(i+(r>>8)+32);i=(r&255)<<7;break;case 8:t+=o(i+(r>>9)+32);i=(r&511)<<6;break;case 9:t+=o(i+(r>>10)+32);i=(r&1023)<<5;break;case 10:t+=o(i+(r>>11)+32);i=(r&2047)<<4;break;case 11:t+=o(i+(r>>12)+32);i=(r&4095)<<3;break;case 12:t+=o(i+(r>>13)+32);i=(r&8191)<<2;break;case 13:t+=o(i+(r>>14)+32);i=(r&16383)<<1;break;case 14:t+=o(i+(r>>15)+32,(r&32767)+32);s=0;break}}return t+o(i+32)},decompressFromUTF16:function(e){if(e==null)return"";var t="",n,r,i=0,s=0,o=LZString._f;while(s<e.length){r=e.charCodeAt(s)-32;switch(i++){case 0:n=r<<1;break;case 1:t+=o(n|r>>14);n=(r&16383)<<2;break;case 2:t+=o(n|r>>13);n=(r&8191)<<3;break;case 3:t+=o(n|r>>12);n=(r&4095)<<4;break;case 4:t+=o(n|r>>11);n=(r&2047)<<5;break;case 5:t+=o(n|r>>10);n=(r&1023)<<6;break;case 6:t+=o(n|r>>9);n=(r&511)<<7;break;case 7:t+=o(n|r>>8);n=(r&255)<<8;break;case 8:t+=o(n|r>>7);n=(r&127)<<9;break;case 9:t+=o(n|r>>6);n=(r&63)<<10;break;case 10:t+=o(n|r>>5);n=(r&31)<<11;break;case 11:t+=o(n|r>>4);n=(r&15)<<12;break;case 12:t+=o(n|r>>3);n=(r&7)<<13;break;case 13:t+=o(n|r>>2);n=(r&3)<<14;break;case 14:t+=o(n|r>>1);n=(r&1)<<15;break;case 15:t+=o(n|r);i=0;break}s++}return LZString.decompress(t)},compress:function(e){if(e==null)return"";var t,n,r={},i={},s="",o="",u="",a=2,f=3,l=2,c="",h=0,p=0,d,v=LZString._f;for(d=0;d<e.length;d+=1){s=e.charAt(d);if(!Object.prototype.hasOwnProperty.call(r,s)){r[s]=f++;i[s]=true}o=u+s;if(Object.prototype.hasOwnProperty.call(r,o)){u=o}else{if(Object.prototype.hasOwnProperty.call(i,u)){if(u.charCodeAt(0)<256){for(t=0;t<l;t++){h=h<<1;if(p==15){p=0;c+=v(h);h=0}else{p++}}n=u.charCodeAt(0);for(t=0;t<8;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}else{n=1;for(t=0;t<l;t++){h=h<<1|n;if(p==15){p=0;c+=v(h);h=0}else{p++}n=0}n=u.charCodeAt(0);for(t=0;t<16;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}a--;if(a==0){a=Math.pow(2,l);l++}delete i[u]}else{n=r[u];for(t=0;t<l;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}a--;if(a==0){a=Math.pow(2,l);l++}r[o]=f++;u=String(s)}}if(u!==""){if(Object.prototype.hasOwnProperty.call(i,u)){if(u.charCodeAt(0)<256){for(t=0;t<l;t++){h=h<<1;if(p==15){p=0;c+=v(h);h=0}else{p++}}n=u.charCodeAt(0);for(t=0;t<8;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}else{n=1;for(t=0;t<l;t++){h=h<<1|n;if(p==15){p=0;c+=v(h);h=0}else{p++}n=0}n=u.charCodeAt(0);for(t=0;t<16;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}a--;if(a==0){a=Math.pow(2,l);l++}delete i[u]}else{n=r[u];for(t=0;t<l;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}a--;if(a==0){a=Math.pow(2,l);l++}}n=2;for(t=0;t<l;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}while(true){h=h<<1;if(p==15){c+=v(h);break}else p++}return c},decompress:function(e){if(e==null)return"";if(e=="")return null;var t=[],n,r=4,i=4,s=3,o="",u="",a,f,l,c,h,p,d,v=LZString._f,m={string:e,val:e.charCodeAt(0),position:32768,index:1};for(a=0;a<3;a+=1){t[a]=a}l=0;h=Math.pow(2,2);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}switch(n=l){case 0:l=0;h=Math.pow(2,8);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}d=v(l);break;case 1:l=0;h=Math.pow(2,16);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}d=v(l);break;case 2:return""}t[3]=d;f=u=d;while(true){if(m.index>m.string.length){return""}l=0;h=Math.pow(2,s);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}switch(d=l){case 0:l=0;h=Math.pow(2,8);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}t[i++]=v(l);d=i-1;r--;break;case 1:l=0;h=Math.pow(2,16);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}t[i++]=v(l);d=i-1;r--;break;case 2:return u}if(r==0){r=Math.pow(2,s);s++}if(t[d]){o=t[d]}else{if(d===i){o=f+f.charAt(0)}else{return null}}u+=o;t[i++]=f+o.charAt(0);r--;f=o;if(r==0){r=Math.pow(2,s);s++}}}};if(typeof module!=="undefined"&&module!=null){module.exports=LZString}
</script>
<script type="text/javascript">
/*
Portions of this code are based on:
____

TiddlyWiki 1.2.39 by Jeremy Ruston, (jeremy [at] osmosoft [dot] com)

Published under a BSD open source license

Copyright (c) Osmosoft Limited 2005

Redistribution and use in source and binary forms, with or without modification,
are permitted provided that the following conditions are met:

Redistributions of source code must retain the above copyright notice, this list
of conditions and the following disclaimer.

Redistributions in binary form must reproduce the above copyright notice, this
list of conditions and the following disclaimer in the documentation and/or
other materials provided with the distribution.

Neither the name of the Osmosoft Limited nor the names of its contributors may
be used to endorse or promote products derived from this software without
specific prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR
ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/
window.DEBUG=true;
(function(window, document, undefined){
"use strict";

/***********************************************************************************************************************
** [Begin intrinsics.js]
***********************************************************************************************************************/

/***********************************************************************************************************************
** [Polyfills]
***********************************************************************************************************************/
/**
 * classList
 */
/*! @source http://purl.eligrey.com/github/classList.js/blob/master/classList.js*/
;if("document" in self&&!("classList" in document.createElement("_"))){(function(j){"use strict";if(!("Element" in j)){return}var a="classList",f="prototype",m=j.Element[f],b=Object,k=String[f].trim||function(){return this.replace(/^\s+|\s+$/g,"")},c=Array[f].indexOf||function(q){var p=0,o=this.length;for(;p<o;p++){if(p in this&&this[p]===q){return p}}return -1},n=function(o,p){this.name=o;this.code=DOMException[o];this.message=p},g=function(p,o){if(o===""){throw new n("SYNTAX_ERR","an invalid or illegal string was specified")}if(/\s/.test(o)){throw new n("INVALID_CHARACTER_ERR","string contains an invalid character")}return c.call(p,o)},d=function(s){var r=k.call(s.getAttribute("class")||""),q=r?r.split(/\s+/):[],p=0,o=q.length;for(;p<o;p++){this.push(q[p])}this._updateClassName=function(){s.setAttribute("class",this.toString())}},e=d[f]=[],i=function(){return new d(this)};n[f]=Error[f];e.item=function(o){return this[o]||null};e.contains=function(o){o+="";return g(this,o)!==-1};e.add=function(){var s=arguments,r=0,p=s.length,q,o=false;do{q=s[r]+"";if(g(this,q)===-1){this.push(q);o=true}}while(++r<p);if(o){this._updateClassName()}};e.remove=function(){var t=arguments,s=0,p=t.length,r,o=false;do{r=t[s]+"";var q=g(this,r);if(q!==-1){this.splice(q,1);o=true}}while(++s<p);if(o){this._updateClassName()}};e.toggle=function(p,q){p+="";var o=this.contains(p),r=o?q!==true&&"remove":q!==false&&"add";if(r){this[r](p)}return !o};e.toString=function(){return this.join(" ")};if(b.defineProperty){var l={get:i,enumerable:true,configurable:true};try{b.defineProperty(m,a,l)}catch(h){if(h.number===-2146823252){l.enumerable=false;b.defineProperty(m,a,l)}}}else{if(b[f].__defineGetter__){m.__defineGetter__(a,i)}}}(self))};

/**
 * Adds support for window.history.state to browsers which lack it (notably some versions of Safari/iOS)
 */
if (("history" in window) && ("pushState" in window.history) && !("state" in window.history)) {
	(function (origPush, origReplace) {
		// initialize window.history.state to null
		window.history.state = null;

		// replace the default pushState()/replaceState() methods with wrappers
		// which set window.history.state to the appropriate value
		window.history.pushState = function (state) {
			origPush.apply(window.history, arguments);
			window.history.state = state;
		};
		window.history.replaceState = function (state) {
			origReplace.apply(window.history, arguments);
			window.history.state = state;
		};

		// add an event handler for popstate which sets window.history.state to
		// the appropriate value, and make the handler initiate capture so that
		// it will be called before any other popstate handlers
		window.addEventListener("popstate", function (evt) {
			window.history.state = evt.state;
		}, true);
	})(window.history.pushState, window.history.replaceState);
}

/**
 * Returns the array status of the passed variable
 */
if (!Array.isArray) {
	Object.defineProperty(Array, "isArray", {
		enumerable   : false,
		configurable : true,
		writable     : true,
		value        : function (obj) {
			"use strict";
			return Object.prototype.toString.call(obj) === "[object Array]";
		}
	});
}

/**
 * Returns the first index at which an element can be found within the array, or -1 if it is not present
 */
if (!Array.prototype.indexOf) {
	Object.defineProperty(Array.prototype, "indexOf", {
		enumerable   : false,
		configurable : true,
		writable     : true,
		value        : function (needle, from) {
			"use strict";
			if (this == null) {
				throw new TypeError("Array.prototype.indexOf called on null or undefined");
			}

			var list   = Object(this),
				length = list.length >>> 0;

			from = +from || 0;
			if (!isFinite(from)) {
				from = 0;
			}
			if (from < 0) {
				from += length;
				if (from < 0) {
					from = 0;
				}
			}

			for (/* empty*/; from < length; from++) {
				if (list[from] === needle) {
					return from;
				}
			}
			return -1;
		}
	});
}

/**
 * Creates a new array with all elements that pass the test implemented by the provided function
 */
if (!Array.prototype.filter) {
	Object.defineProperty(Array.prototype, "filter", {
		enumerable   : false,
		configurable : true,
		writable     : true,
		value        : function (filterFn /* , thisp */) {
			"use strict";
			if (this == null) {
				throw new TypeError("Array.prototype.filter called on null or undefined");
			}
			if (typeof filterFn !== "function") {
				throw new TypeError("Array.prototype.filter callback parameter must be a function");
			}

			var list   = Object(this),
				length = list.length >>> 0,
				res    = [],
				thisp  = arguments[1];

			for (var i = 0; i < length; i++) {
				if (i in list) {
					var val = list[i];
					if (filterFn.call(thisp, val, i, list)) {
						res.push(val);
					}
				}
			}
			return res;
		}
	});
}

/**
 * Returns a value from the array, if an element in the array satisfies the provided testing function, otherwise undefined is returned
 */
if (!Array.prototype.find) {
	Object.defineProperty(Array.prototype, "find", {
		enumerable   : false,
		configurable : true,
		writable     : true,
		value        : function (callback /* , thisp */) {
			"use strict";
			if (this == null) {
				throw new TypeError("Array.prototype.find called on null or undefined");
			}
			if (typeof callback !== "function") {
				throw new TypeError("Array.prototype.find callback parameter must be a function");
			}

			var list   = Object(this),
				length = list.length >>> 0,
				thisp  = arguments[1];

			for (var i = 0; i < length; i++) {
				if (i in list) {
					var val = list[i];
					if (callback.call(thisp, val, i, list)) {
						return val;
					}
				}
			}
			return undefined;
		}
	});
}

/**
 * Creates a new array with the results of calling a provided function on every element in this array
 */
if (!Array.prototype.map) {
	Object.defineProperty(Array.prototype, "map", {
		enumerable   : false,
		configurable : true,
		writable     : true,
		value        : function (callback /* , thisp */) {
			"use strict";
			if (this == null) {
				throw new TypeError("Array.prototype.map called on null or undefined");
			}
			if (typeof callback !== "function") {
				throw new TypeError("Array.prototype.map callback parameter must be a function");
			}

			var list   = Object(this),
				length = list.length >>> 0,
				res    = new Array(length),
				thisp  = arguments[1];

			for (var i = 0; i < length; i++) {
				if (i in list) {
					var val = list[i];
					res[i] = callback.call(thisp, val, i, list);
				}
			}
			return res;
		}
	});
}

/**
 * Tests whether some element in the array passes the test implemented by the provided function
 */
if (!Array.prototype.some) {
	Object.defineProperty(Array.prototype, "some", {
		enumerable   : false,
		configurable : true,
		writable     : true,
		value        : function (callback /*, thisp */) {
			"use strict";
			if (this == null) {
				throw new TypeError("Array.prototype.some called on null or undefined");
			}
			if (typeof callback !== "function") {
				throw new TypeError("Array.prototype.some callback parameter must be a function");
			}

			var list   = Object(this),
				length = list.length >>> 0,
				thisp  = arguments[1];

			for (var i = 0; i < length; i++) {
				if (i in list) {
					var val = list[i];
					if (callback.call(thisp, val, i, list)) {
						return true;
					}
				}
			}
			return false;
		}
	});
}

/**
 * Returns the integral part of a number by removing any fractional digits, it does not round
 */
if (!Math.trunc) {
	Object.defineProperty(Math, "trunc", {
		enumerable   : false,
		configurable : true,
		writable     : true,
		value        : function (num) {
			"use strict";
			return (num < 0) ? Math.ceil(num) : Math.floor(num);
		}
	});
}

/**
 * Returns whether one string may be found within another string, returning true or false as appropriate
 */
if (!String.prototype.contains) {
	Object.defineProperty(String.prototype, "contains", {
		enumerable   : false,
		configurable : true,
		writable     : true,
		value        : function (/* needle */) {
			"use strict";
			return String.prototype.indexOf.apply(this, arguments) !== -1;
		}
	});
}

/**
 * Returns a copy of the base string with 'count' characters replaced with 'replacement', starting at 'start'
 */
if (!String.prototype.splice) {
	Object.defineProperty(String.prototype, "splice", {
		enumerable   : false,
		configurable : true,
		writable     : true,
		value        : function (start, count, replacement) {
			"use strict";
			if (this == null) {
				throw new TypeError("String.prototype.splice called on null or undefined");
			}

			var length = this.length >>> 0;

			if (length === 0) {
				return "";
			}

			start = +start || 0;
			if (!isFinite(start)) {
				start = 0;
			} else if (start < 0) {
				start += length;
				if (start < 0) {
					start = 0;
				}
			}
			if (start > length) {
				start = length;
			}

			count = +count || 0;
			if (!isFinite(count) || count < 0) {
				count = 0;
			}

			var res = this.slice(0, start);
			if (typeof replacement !== "undefined") {
				res += replacement;
			}
			if ((start + count) < length) {
				res += this.slice(start + count);
			}
			return res;
		}
	});
}

/**
 * Returns a string with all whitespace removed from both sides of the base string
 */
if (!String.prototype.trim) {
	Object.defineProperty(String.prototype, "trim", {
		enumerable   : false,
		configurable : true,
		writable     : true,
		value        : function () {
			"use strict";
			//return this.replace(/^\s+/, "").replace(/\s+$/, "");
			return this.replace(/^\s+|\s+$/g, "");
		}
	});
}

/**
 * Returns a string with all whitespace removed from the left side of the base string
 */
if (!String.prototype.trimLeft) {
	Object.defineProperty(String.prototype, "trimLeft", {
		enumerable   : false,
		configurable : true,
		writable     : true,
		value        : function () {
			"use strict";
			return this.replace(/^\s+/, "");
		}
	});
}

/**
 * Returns a string with all whitespace removed from the right side of the base string
 */
if (!String.prototype.trimRight) {
	Object.defineProperty(String.prototype, "trimRight", {
		enumerable   : false,
		configurable : true,
		writable     : true,
		value        : function () {
			"use strict";
			return this.replace(/\s+$/, "");
		}
	});
}

/**
 * If Object.create isn't already defined, we just do the simple shim, without the second argument, since that's all we need here
 */
if (!Object.create || typeof Object.create !== "function") {
	Object.defineProperty(Object, "create", {
		enumerable   : false,
		configurable : true,
		writable     : true,
		value        : (function () {
			function F () {}

			return function (proto) {
				"use strict";
				if (arguments.length !== 1) {
					throw new Error("polyfill Object.create implementation only accepts one parameter");
				}
				if (proto == null) {
					throw new TypeError("Object.create proto parameter is null or undefined");
				}
				if (typeof proto !== "object") {
					throw new TypeError("Object.create proto parameter must be an object");
				}

				F.prototype = proto;
				return new F();
			};
		}())
	});
}


/***********************************************************************************************************************
** [Extensions, General]
***********************************************************************************************************************/
/**
 * Returns a random value from the passed array in the range of lower and upper, if they are specified
 */
Object.defineProperty(Array, "random", {
	enumerable   : false,
	configurable : true,
	writable     : true,
	value        : function (array, lower, upper) {
		"use strict";
		if (Array.isArray(array)) {
			return array.random(lower, upper);
		} else if (array.hasOwnProperty("length")) {
			return Array.prototype.slice.call(array, 0).random(lower, upper);
		}
		return undefined;
	}
});

/**
 * Returns whether an element may be found within the array, returning true or false as appropriate
 */
Object.defineProperty(Array.prototype, "contains", {
	enumerable   : false,
	configurable : true,
	writable     : true,
	value        : function (/* needle */) {
		"use strict";
		//return Array.prototype.indexOf.apply(this, arguments) !== -1;
		if (arguments.length === 1) {
			if (Array.isArray(arguments[0])) {
				return Array.prototype.contains.apply(this, arguments[0]);
			} else {
				return Array.prototype.indexOf.apply(this, arguments) !== -1;
			}
		} else {
			for (var i = 0, len = arguments.length; i < len; i++) {
				if (Array.prototype.some.call(this, function (v) { return v === this.val; }, { val: arguments[i] })) {
					return true;
				}
			}
			return false;
		}
	}
});

/**
 * Returns a random value from the array in the range of lower and upper, if they are specified
 */
Object.defineProperty(Array.prototype, "random", {
	enumerable   : false,
	configurable : true,
	writable     : true,
	value        : function (lower, upper) {
		"use strict";
		if (lower == null) {  // use lazy equality
			lower = 0;
		} else if (lower < 0) {
			lower = 0;
		} else if (lower >= this.length) {
			lower = this.length - 1;
		}
		if (upper == null) {  // use lazy equality
			upper = this.length - 1;
		} else if (upper < 0) {
			upper = 0;
		} else if (upper >= this.length) {
			upper = this.length - 1;
		}
		return this[random(lower, upper)];
	}
});

/**
 * Returns the passed numerical clamped to the specified bounds
 */
Object.defineProperty(Math, "clamp", {
	enumerable   : false,
	configurable : true,
	writable     : true,
	value        : function (num, min, max) {
		"use strict";
		num = Number(num);
		return isNaN(num) ? NaN : num.clamp(min, max);
	}
});

/**
 * Returns a decimal number eased from 0 to 1
 */
Object.defineProperty(Math, "easeInOut", {
	enumerable   : false,
	configurable : true,
	writable     : true,
	value        : function (num) {
		"use strict";
		return (1 - ((Math.cos(num * Math.PI) + 1) / 2));
	}
});

/**
 * Returns the number clamped to the specified bounds
 */
Object.defineProperty(Number.prototype, "clamp", {
	enumerable   : false,
	configurable : true,
	writable     : true,
	value        : function (min, max) {
		"use strict";
		var num = Number(this);
		if (num < min) { num = min; }
		if (num > max) { num = max; }
		return num;
	}
});

/**
 * Returns a formatted string, after replacing each format item in the given format string with the text equivalent of the corresponding argument's value
 */
Object.defineProperty(String, "format", {
	enumerable   : false,
	configurable : true,
	writable     : true,
	value        : function (format) {
		"use strict";
		function padString(str, align, pad) {
			if (!align) { return str; }
			var plen = Math.abs(align) - str.length;
			if (plen < 1) { return str; }
			var padding = Array(plen + 1).join(pad);
			return (align < 0) ? str + padding : padding + str;
		}

		if (arguments.length < 2) { return (arguments.length === 0) ? "" : format; }

		var args = (arguments.length === 2 && Array.isArray(arguments[1]))
			? arguments[1].slice(0)
			: Array.prototype.slice.call(arguments, 1);

		if (args.length === 0) { return format; }

		return format.replace(/{(\d+)(?:,([+-]?\d+))?}/g, function (match, index, align) {
			var retval = args[index];
			if (retval == null) { return ""; }  // use lazy equality
			while (typeof retval === "function") { retval = retval(); }
			if (typeof retval === "object") { retval = JSON.stringify(retval); }
			return padString(retval, (!align) ? 0 : parseInt(align), " ");
		});
	}
});

/**
 * [DEPRECATED] Returns a string with all whitespace removed from the left side of the base string
 *   n.b. Just a legacy alias for String.prototype.trimLeft now
 */
Object.defineProperty(String.prototype, "ltrim", {
	enumerable   : false,
	configurable : true,
	writable     : true,
	value        : String.prototype.trimLeft
});

/**
 * [DEPRECATED] Returns a string with all whitespace removed from the right side of the base string
 *   n.b. Just a legacy alias for String.prototype.trimRight now
 */
Object.defineProperty(String.prototype, "rtrim", {
	enumerable   : false,
	configurable : true,
	writable     : true,
	value        : String.prototype.trimRight
});

/**
 * Returns an array of link titles, parsed from the string
 *   n.b. Unused in SugarCube, only included for compatibility
 */
Object.defineProperty(String.prototype, "readBracketedList", {
	enumerable   : false,
	configurable : true,
	writable     : true,
	value        : function () {
		"use strict";
		// RegExp groups: Double-square-bracket quoted | Unquoted
		var pattern = "(?:\\[\\[((?:\\s|\\S)*?)\\]\\])|([^\"'\\s]\\S*)",  //"(?:\\[\\[([^\\]]+)\\]\\])|([^\\s$]+)"
			re      = new RegExp(pattern, "gm"),
			names   = [];
		do {
			var match = re.exec(this);
			if (match) {
				if (match[1]) {
					// Double-square-bracket quoted
					names.push(match[1]);
				} else if (match[2]) {
					// Unquoted
					names.push(match[2]);
				}
			}
		} while (match);
		return names;
	}
});


/***********************************************************************************************************************
** [Extensions, JSON/serialization]
***********************************************************************************************************************/
/**
 * Define toJSON functions on each prototype we want to support
 */
Object.defineProperty(Function.prototype, "toJSON", {
	enumerable   : false,
	configurable : true,
	writable     : true,
	value        : function () { return "@@revive@@(" + this.toString() + ")"; }
});
Object.defineProperty(RegExp.prototype, "toJSON", {
	enumerable   : false,
	configurable : true,
	writable     : true,
	value        : function () { return "@@revive@@(" + this.toString() + ")"; }
});
Object.defineProperty(Date.prototype, "toJSON", {
	enumerable   : false,
	configurable : true,
	writable     : true,
	value        : function () { return '@@revive@@(new Date("' + this.toISOString() + '"))'; }
});

/**
 * Backup the original JSON.parse and replace it with a "$revive$"-aware version
 */
Object.defineProperty(JSON, "real_parse_backup", {
	enumerable   : false,
	configurable : true,
	writable     : true,
	value        : JSON.parse
});
Object.defineProperty(JSON, "parse", {
	enumerable   : false,
	configurable : true,
	writable     : true,
	value        : function (text, reviver) {
		"use strict";
		return JSON.real_parse_backup(text, function (key, value) {
			if (typeof value === "string" && value.slice(0, 10) === "@@revive@@") {
				try {
					value = eval(value.slice(10));
				} catch (e) { /* noop; although, perhaps, it would be better to throw an error here */ }
			}
			if (typeof reviver === "function") {
				try {
					value = reviver(key, value);
				} catch (e) { /* noop; although, perhaps, it would be better to throw an error here */ }
			}
			return value;
		});
	}
});


/***********************************************************************************************************************
** [End intrinsics.js]
***********************************************************************************************************************/

/***********************************************************************************************************************
** [Begin utility.js]
***********************************************************************************************************************/

/***********************************************************************************************************************
** [Libraries]
***********************************************************************************************************************/
/*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js */
var saveAs=saveAs||navigator.msSaveBlob&&navigator.msSaveBlob.bind(navigator)||function(e){"use strict";var t=e.document,n=function(){return e.URL||e.webkitURL||e},r=e.URL||e.webkitURL||e,i=t.createElementNS("http://www.w3.org/1999/xhtml","a"),s="download"in i,o=function(n){var r=t.createEvent("MouseEvents");r.initMouseEvent("click",true,false,e,0,0,0,0,0,false,false,false,false,0,null);n.dispatchEvent(r)},u=e.webkitRequestFileSystem,a=e.requestFileSystem||u||e.mozRequestFileSystem,f=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},l="application/octet-stream",c=0,h=[],p=function(){var e=h.length;while(e--){var t=h[e];if(typeof t==="string"){r.revokeObjectURL(t)}else{t.remove()}}h.length=0},d=function(e,t,n){t=[].concat(t);var r=t.length;while(r--){var i=e["on"+t[r]];if(typeof i==="function"){try{i.call(e,n||e)}catch(s){f(s)}}}},v=function(t,r){var f=this,p=t.type,v=false,m,g,y=function(){var e=n().createObjectURL(t);h.push(e);return e},b=function(){d(f,"writestart progress write writeend".split(" "))},w=function(){if(v||!m){m=y(t)}if(g){g.location.href=m}else{window.open(m,"_blank")}f.readyState=f.DONE;b()},E=function(e){return function(){if(f.readyState!==f.DONE){return e.apply(this,arguments)}}},S={create:true,exclusive:false},x;f.readyState=f.INIT;if(!r){r="download"}if(s){m=y(t);i.href=m;i.download=r;o(i);f.readyState=f.DONE;b();return}if(e.chrome&&p&&p!==l){x=t.slice||t.webkitSlice;t=x.call(t,0,t.size,l);v=true}if(u&&r!=="download"){r+=".download"}if(p===l||u){g=e}if(!a){w();return}c+=t.size;a(e.TEMPORARY,c,E(function(e){e.root.getDirectory("saved",S,E(function(e){var n=function(){e.getFile(r,S,E(function(e){e.createWriter(E(function(n){n.onwriteend=function(t){g.location.href=e.toURL();h.push(e);f.readyState=f.DONE;d(f,"writeend",t)};n.onerror=function(){var e=n.error;if(e.code!==e.ABORT_ERR){w()}};"writestart progress write abort".split(" ").forEach(function(e){n["on"+e]=f["on"+e]});n.write(t);f.abort=function(){n.abort();f.readyState=f.DONE};f.readyState=f.WRITING}),w)}),w)};e.getFile(r,{create:false},E(function(e){e.remove();n()}),E(function(e){if(e.code===e.NOT_FOUND_ERR){n()}else{w()}}))}),w)}),w)},m=v.prototype,g=function(e,t){return new v(e,t)};m.abort=function(){var e=this;e.readyState=e.DONE;d(e,"abort")};m.readyState=m.INIT=0;m.WRITING=1;m.DONE=2;m.error=m.onwritestart=m.onprogress=m.onwrite=m.onabort=m.onerror=m.onwriteend=null;e.addEventListener("unload",p,false);return g}(self)


/***********************************************************************************************************************
** [Function Library]
***********************************************************************************************************************/
/**
 * Returns a deep copy of the passed object
 */
function clone(orig) {
	if (orig == null || typeof orig !== "object") {  // use lazy equality on null check
		return orig;
	}

	// Honor native/custom clone methods
	if (typeof orig.clone === "function") {
		return orig.clone(true);
	}

	// Special cases
	if (orig instanceof Date) {
		return new Date(orig.getTime());
	}
	if (orig instanceof RegExp) {
		return new RegExp(orig);
	}
	if (orig.nodeType && typeof orig.cloneNode === "function") {
		return orig.cloneNode(true);
	}

	// If we've reached here, we have a regular object, array, or function
	//   n.b This does NOT preserve ES5 property attributes like 'writable', 'enumerable', etc.
	//       That could be achieved by using Object.getOwnPropertyNames and Object.defineProperty
	var okeys = Object.keys(orig),
		dup;
	// Ensure the returned object has the same prototype as the original
	if (Array.isArray(orig)) {
		// Array object case; this must be done separate from the general case or the prototype will be wrong
		dup = [];
	} else {
		// General, non-array, object case
		var proto = (typeof Object.getPrototypeOf === "function") ? Object.getPrototypeOf(orig) : orig.__proto__;
		dup = proto ? Object.create(proto) : orig.constructor.prototype;  // the latter case should only be reached by very old browsers
	}
	for (var i = 0, len = okeys.length; i < len; i++) {
		dup[okeys[i]] = clone(orig[okeys[i]]);
	}
	return dup;
}

/**
 * Returns the new DOM element, optionally appending it to the passed DOM element (if any)
 */
function insertElement(place, type, id, classNames, text, title) {
	var el = document.createElement(type);

	// add attributes
	if (id) {
		el.id = id;
	}
	if (classNames) {
		el.className = classNames;
	}
	if (title) {
		el.title = title;
	}

	// add content
	if (text) {
		insertText(el, text);
	}

	// append it to the given node
	if (place) {
		place.appendChild(el);
	}

	return el;
}

/**
 * Returns the new DOM element, after appending it to the passed DOM element
 */
function insertText(place, text) {
	return place.appendChild(document.createTextNode(text));
}

/**
 * Removes all children from the passed DOM node
 */
function removeChildren(node) {
	if (node) {
		while (node.hasChildNodes()) {
			node.removeChild(node.firstChild);
		}
	}
}

/**
 * Removes the passed DOM node
 */
function removeElement(node) {
	if (typeof node.remove === "function") {
		node.remove();
	} else if (el.parentNode) {
		node.parentNode.removeChild(node);
	}
}

/**
 * Wikifies a passage into a DOM element corresponding to the passed ID and returns the element
 */
function setPageElement(id, titles, defaultText) {
	var el = (typeof id === "object") ? id : document.getElementById(id);
	if (el) {
		removeChildren(el);
		if (!Array.isArray(titles)) { titles = [ titles ]; }
		for (var i = 0; i < titles.length; i++) {
			if (tale.has(titles[i])) {
				new Wikifier(el, tale.get(titles[i]).processText().trim());
				return el;
			}
		}
		if (defaultText != null && defaultText !== "") {  // use lazy equality on null check
			new Wikifier(el, defaultText);
		}
	}
	return el;
}

/**
 * Appends a new <style> element to the document's <head>
 */
function addStyle(css) {
	var style = document.createElement("style");
	style.type = "text/css";

	// check for Twine 1.4 Base64 image passage transclusion
	var matchRe = new RegExp(formatter.byName["image"].lookaheadRegExp.source, "gm"),
		parseRe = new RegExp(Wikifier.textPrimitives.image);
	if (matchRe.test(css)) {
		css = css.replace(matchRe, function(wikiImage) {
			var parseMatch = parseRe.exec(wikiImage);
			if (parseMatch !== null) {
				// 1=(left), 2=(right), 3=(title), 4=source, 5=(~), 6=(link), 7=(set)
				var source = parseMatch[4];
				if (source.slice(0, 5) !== "data:" && tale.has(source)) {
					var passage = tale.get(source);
					if (passage.tags.contains("Twine.image")) {
						source = passage.text;
					}
				}
				return "url(" + source + ")";
			}
			return wikiImage;
		});
	}

	if (style.styleSheet) {
		// for IE
		style.styleSheet.cssText = css;
	} else {
		// for everyone else
		style.appendChild(document.createTextNode(css));
	}

	document.head.appendChild(style);
}

/**
 * Appends an error message to the passed DOM element
 */
function throwError(place, message, title) {
	insertElement(place, "span", null, "error", "Error: " + message, title);
	return false;
}

/**
 * Fades a DOM element in or out
 *   n.b. Unused in SugarCube, only included for compatibility
 */
function fade(el, options) {
	function tick() {
		current += 0.05 * direction;
		setOpacity(proxy, Math.easeInOut(current));
		if (((direction == 1) && (current >= 1)) || ((direction == -1) && (current <= 0))) {
			el.style.visibility = (options.fade == "in") ? "visible" : "hidden";
			proxy.parentNode.replaceChild(el, proxy);
			proxy = null;
			window.clearInterval(intervalId);
			if (options.onComplete) {
				options.onComplete();
			}
		}
	}
	function setOpacity(el, opacity) {
		var l = Math.floor(opacity * 100);

		// old IE
		el.style.zoom = 1;
		el.style.filter = "alpha(opacity=" + l + ")";

		// CSS
		el.style.opacity = opacity;
	}

	var current,
		proxy      = el.cloneNode(true),
		direction  = (options.fade == "in") ? 1 : -1,
		intervalId;
	el.parentNode.replaceChild(proxy, el);
	if (options.fade == "in") {
		current = 0;
		proxy.style.visibility = "visible";
	} else {
		current = 1;
	}
	setOpacity(proxy, current);
	intervalId = window.setInterval(tick, 25);
}

/**
 * Scrolls the browser window to ensure that a DOM element is in view
 *   n.b. Unused in SugarCube, only included for compatibility
 */
function scrollWindowTo(el, increment) {
	function tick() {
		progress += increment;
		window.scroll(0, start + direction * (distance * Math.easeInOut(progress)));
		if (progress >= 1) {
			window.clearInterval(intervalId);
		}
	}
	function findPosY(el) {
		var curtop = 0;
		while (el.offsetParent) {
			curtop += el.offsetTop;
			el = el.offsetParent;
		}
		return curtop;
	}
	function ensureVisible(el) {
		var posTop    = findPosY(el),
			posBottom = posTop + el.offsetHeight,
			winTop    = window.scrollY ? window.scrollY : document.body.scrollTop,
			winHeight = window.innerHeight ? window.innerHeight : document.body.clientHeight,
			winBottom = winTop + winHeight;
		if (posTop < winTop) {
			return posTop;
		} else {
			if (posBottom > winBottom) {
				if (el.offsetHeight < winHeight) {
					return (posTop - (winHeight - el.offsetHeight) + 20);
				} else {
					return posTop;
				}
			} else {
				return posTop;
			}
		}
	}

	// normalize increment
	if (increment == null) {  // use lazy equality
		increment = 0.1;
	} else {
		if (typeof increment !== "number") {
			increment = Number(increment);
		}
		if (isNaN(increment) || increment < 0) {
			increment = 0.1;
		} else if (increment > 1) {
			increment = 1;
		}
	}

	var start      = window.scrollY ? window.scrollY : document.body.scrollTop,
		end        = ensureVisible(el),
		distance   = Math.abs(start - end),
		progress   = 0,
		direction  = (start > end) ? -1 : 1,
		intervalId = window.setInterval(tick, 25);
}


/***********************************************************************************************************************
** [Function Library, Story Utilities]
***********************************************************************************************************************/
/**
 * Returns a random integer in the range of min and max
 *   n.b. Using Math.round() will give you a non-uniform distribution!
 */
function getRandom(/* min, max */) { return random.apply(null, arguments); }
function random(min, max) {
	if (arguments.length === 0) { throw new Error("random called with insufficient arguments"); }
	if (arguments.length === 1) {
		max = min;
		min = 0;
	}
	if (min > max) {
		var swap = max;
		max = min;
		min = swap;
	}

	return Math.floor(Math.random() * (max - min + 1)) + min;
}

/**
 * Returns a random float in the range of min and max
 */
function getRandomArbitrary(/* min, max */) { return randomFloat.apply(null, arguments); }
function randomFloat(min, max) {
	if (arguments.length === 0) { throw new Error("randomFloat called with insufficient arguments"); }
	if (arguments.length === 1) {
		max = min;
		min = 0.0;
	}
	if (min > max) {
		var swap = max;
		max = min;
		min = swap;
	}

	return (Math.random() * (max - min)) + min;
}

/**
 * Returns a new array containing the tags of the passage(s)
 */
function tags(/* variadic */) {
	if (arguments.length === 0) {
		return tale.get(state.active.title).tags.slice(0);
	} else {
		var tags = [];
		for (var i = 0; i < arguments.length; i++) {
			tags = tags.concat(tale.get(arguments[i]).tags);
		}
		return tags;
	}
}

/**
 * Returns an integer count of how many times the passage exists within the story history
 */
function visited(title) {
	if (arguments.length === 0) { title = state.active.title; }

	var count = 0;
	for (var i = 0; i < state.length; i++) {
		if (state.history[i].title === title) { count++; }
	}
	return count;
}

/**
 * Returns an integer count of how many passages within the story history are tagged with all of the tags
 */
function visitedTags(/* variadic */) {
	if (arguments.length === 0) { return 0; }

	var count = 0;
	for (var i = 0; i < state.length; i++) {
		var tags = tale.get(state.history[i].title).tags;
		if (tags.length !== 0) {
			var found = 0;
			for (var j = 0; j < arguments.length; j++) {
				if (tags.contains(arguments[j])) { found++; }
			}
			if (found === arguments.length) { count++; }
		}
	}
	return count;
}

/**
 * Vanilla-header compatibility shims
 */
function either(/* variadic */) {
	if (arguments.length === 0) { return; }

	var list = [];
	for (var i = 0; i < arguments.length; i++) {
		list = list.concat(arguments[i]);
	}
	return list.random();
}
function visitedTag(/* variadic */) { return visitedTags.apply(null, arguments); }
function turns() { return state.length; }
function passage() { return state.active.title; }
function previous() { return (state.length > 1) ? state.peek(1).title : ""; }


/***********************************************************************************************************************
** [Function Library (namespaced via static Util object)]
***********************************************************************************************************************/
var Util = {

	/**
	 * Backup Math.random for system-level tasks, like generateUuid(), in case it's replaced later
	 */
	random : Math.random,

	/**
	 * Returns whether the passed value is numeric
	 */
	isNumeric : function (obj) {
		switch (typeof obj) {
		case "boolean":
			/* FALL-THROUGH */
		case "object":
			return false;
		case "string":
			obj = Number(obj);
			break;
		}
		return isFinite(obj) && !isNaN(obj);
		/*
		if (typeof obj === "string") {
			obj = Number(obj);
		}
		return (typeof obj === "number") ? isFinite(obj) && !isNaN(obj) : false;
		*/
	},

	/**
	 * Returns whether the passed value is boolean-ish
	 */
	isBoolean : function (obj) {
		return typeof obj === "boolean" || (typeof obj === "string" && (obj === "true" || obj === "false"));
	},

	/**
	 * Returns a lowercased and underscore encoded version of the passed string
	 */
	slugify : function (str) {
		return str
			.trim()
			.replace(/[^\w\s\u2013\u2014-]+/g, '')
			.replace(/[_\s\u2013\u2014-]+/g, '-')
			.toLocaleLowerCase();
	},

	/**
	 * Returns the evaluation of the passed expression, throwing if there were errors
	 */
	evalExpression : function (expression) {
		"use strict";
		// the parens are to protect object literals from being confused with block statements
		return eval("(" + expression + ")");
	},

	/**
	 * Returns whether the evaluation of the passed statements completed without thrown exceptions
	 */
	evalStatements : function (statements) {
		"use strict";
		// the enclosing anonymous function is to isolate the passed code within its own scope
		try {
			eval("(function(){" + statements + "\n}());");
			return true;
		} catch (e) {
			return false;
		}
	},

	/**
	 * Diff operations enumeration
	 */
	DiffOp : Object.freeze({
		Delete      : 0,
		SpliceArray : 1,
		Copy        : 2,
		CopyDate    : 3
	}),

	/**
	 * Returns a patch object containing the differences between the original and the destination objects
	 */
	diff : function (orig, dest) /* diff object */ {
		"use strict";
		var keys    = [].concat(Object.keys(orig), Object.keys(dest))
				        .sort().filter(function (v, i, a) { return (i === 0 || a[i-1] != v); }),
			diff    = {},
			isArray = Array.isArray(orig),
			aOpRef;
		for (var i = 0, klen = keys.length; i < klen; i++) {
			var p     = keys[i],
				origP = orig[p],
				destP = dest[p];
			if (orig.hasOwnProperty(p)) {
				if (dest.hasOwnProperty(p)) {
					// key exists in both
					if (origP === destP) {
						// values are exactly the same, so do nothing
						continue;
					}
					if (typeof origP === typeof destP) {
						// values are of the same basic type
						if (typeof origP === "function") {
							// values are functions, which are problematic to test, so we simply copy
							diff[p] = [ Util.DiffOp.Copy, clone(destP) ];
						} else if (typeof origP !== "object" || origP === null) {
							// values are scalars or null
							diff[p] = [ Util.DiffOp.Copy, destP ];
						} else if (Object.prototype.toString.call(origP) === Object.prototype.toString.call(destP)) {
							// values are objects of the same prototype
							if (origP instanceof Date) {
								if ((+origP) !== (+destP)) {
									diff[p] = [ Util.DiffOp.CopyDate, +destP ];
								}
							} else if (origP instanceof RegExp) {
								if (origP.toString() !== destP.toString()) {
									diff[p] = [ Util.DiffOp.Copy, clone(destP) ];
								}
							} else {
								var recurse = Util.diff(origP, destP);
								if (recurse !== null) {
									diff[p] = recurse;
								}
							}
						} else {
							// values are objects of different prototypes
							diff[p] = [ Util.DiffOp.Copy, clone(destP) ];
						}
					} else {
						// values are of different types
						diff[p] = [ Util.DiffOp.Copy, (typeof destP !== "object" || destP === null) ? destP : clone(destP) ];
					}
				} else {
					// key only exists in orig
					if (isArray && Util.isNumeric(p)) {
						var np = +p;
						if (!aOpRef) {
							aOpRef = "";
							do {
								aOpRef += "~";
							} while (keys.some(function (v) { return v === this.val; }, { val: aOpRef }));
							diff[aOpRef] = [ Util.DiffOp.SpliceArray, np, np ];
						}
						if (np < diff[aOpRef][1]) {
							diff[aOpRef][1] = np;
						}
						if (np > diff[aOpRef][2]) {
							diff[aOpRef][2] = np;
						}
					} else {
						diff[p] = Util.DiffOp.Delete;
					}
				}
			} else {
				// key only exists in dest
				diff[p] = [ Util.DiffOp.Copy, (typeof destP !== "object" || destP === null) ? destP : clone(destP) ];
			}
		}
		return (Object.keys(diff).length !== 0) ? diff : null;
	},

	/**
	 * Returns an object resulting from updating the original object with the difference object
	 */
	patch : function (orig, diff) /* patched object */ {
		"use strict";
		var keys    = Object.keys(diff),
			patched = clone(orig);
		for (var i = 0, klen = keys.length; i < klen; i++) {
			var p     = keys[i],
				diffP = diff[p];
			if (diffP === Util.DiffOp.Delete) {
				delete patched[p];
			} else if (Array.isArray(diffP)) {
				switch (diffP[0]) {
				case Util.DiffOp.SpliceArray:
					patched.splice(diffP[1], 1 + (diffP[2] - diffP[1]));
					break;
				case Util.DiffOp.Copy:
					patched[p] = clone(diffP[1]);
					break;
				case Util.DiffOp.CopyDate:
					patched[p] = new Date(diffP[1]);
					break;
				}
			} else {
				patched[p] = Util.patch(patched[p], diffP);
			}
		}
		return patched;
	},

	/**
	 * [DEPRECATED] Returns a JSON-based serialization of the passed object
	 *   n.b. Just a legacy alias for JSON.stringify now, see 'intrinsics.js' for the new serialization code
	 */
	serialize : JSON.stringify,

	/**
	 * [DEPRECATED] Returns a copy of the original object from the passed JSON-based serialization
	 *   n.b. Just a legacy alias for JSON.parse now, see 'intrinsics.js' for the new serialization code
	 */
	deserialize : JSON.parse,

	/**
	 * Returns a v4 Universally Unique IDentifier (UUID), a.k.a. Globally Unique IDentifier (GUID)
	 *     [RFC4122] http://www.ietf.org/rfc/rfc4122.txt
	 */
	generateUuid : function () {
		// this uses a combination of Util.random() and Date().getTime() to harden itself
		// against bad Math.random() generators and reduce the likelihood of a collision
		var d = new Date().getTime();
		return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
			var r = (d + Util.random()*16)%16 | 0;
			d = Math.floor(d/16);
			return (c === 'x' ? r : (r&0x7|0x8)).toString(16);
		});
	}

};


/***********************************************************************************************************************
** [Seedable PRNG (wrapper for seedrandom.js)]
***********************************************************************************************************************/
function SeedablePRNG(seed, useEntropy) {
	return new Math.seedrandom(seed, useEntropy, function(prng, seed) {
		return {
			random : function () { this.count++; return this._prng(); },
			_prng  : prng,
			seed   : seed,
			count  : 0
		};
	});
}

SeedablePRNG.marshal = function (prng) {
	if (!prng || !prng.hasOwnProperty("seed") || !prng.hasOwnProperty("count")) {
		throw new Error("PRNG is missing required data");
	}

	return { seed: prng.seed, count: prng.count };
};

SeedablePRNG.unmarshal = function (prngObj) {
	if (!prngObj || !prngObj.hasOwnProperty("seed") || !prngObj.hasOwnProperty("count")) {
		throw new Error("PRNG object is missing required data");
	}

	// create a new PRNG using the original seed
	var prng = new SeedablePRNG(prngObj.seed, false);

	// pull values until the new PRNG is in sync with the original
	for (var i = 0; i < prngObj.count; i++) {
		prng.random();
	}

	return prng;
};


/***********************************************************************************************************************
** [Storage Management]
***********************************************************************************************************************/
function KeyValueStore(storeName, storePrefix) {
	this.store = null;
	switch (storeName) {
	case "cookie":
		this.name = "cookie";
		break;
	case "localStorage":
		this.name = storeName;
		if (config.hasLocalStorage) {
			this.store = window.localStorage;
		}
		break;
	case "sessionStorage":
		this.name = storeName;
		if (config.hasSessionStorage) {
			this.store = window.sessionStorage;
		}
		break;
	default:
		throw new Error("unknown storage type");
		break;
	}
	this.prefix = storePrefix + ".";
}

KeyValueStore.prototype.setItem = function (sKey, sValue, quiet) {
	if (!sKey) { return false; }

	var oKey = sKey;

	sKey = this.prefix + sKey;
	sValue = Util.serialize(sValue);

	if (this.store) {
		try {
			sValue = LZString.compressToUTF16(sValue);
			this.store.setItem(sKey, sValue);
		} catch (e) {
			/*
			 * Ideally, we could simply do something either like:
			 *     e.code === 22
			 * Or, preferably, like this:
			 *     e.code === DOMException.QUOTA_EXCEEDED_ERR
			 * However, both of those are browser convention, not part of the standard,
			 * and are not supported in all browsers.  So, we have to resort to pattern
			 * matching the damn name.
			 */
			if (!quiet) {
				technicalAlert(null, 'unable to store key "' + oKey + '"; '
					+ (/quota_?(?:exceeded|reached)/i.test(e.name) ? this.name + " quota exceeded" : "unknown error")
					, e);
			}
			return false;
		}
	} else {
		try {
			sValue = LZString.compressToBase64(sValue);
			var cookie = [ escape(sKey) + "=" + escape(sValue) ];
			// no expiry means a session cookie
			switch (this.name) {
			case "cookie":
				/* FALL-THROUGH */
			case "localStorage":
				cookie.push("expires=Tue, 19 Jan 2038 03:14:07 GMT");
				break;
			}
			cookie.push("path=/");
			document.cookie = cookie.join("; ");
		} catch (e) {
			if (!quiet) {
				technicalAlert(null, 'unable to store key "' + oKey + '"; cookie error: ' + e.message, e);
			}
			return false;
		}
		if (!this.hasItem(oKey)) {
			if (!quiet) {
				technicalAlert(null, 'unable to store key "' + oKey + '"; unknown cookie error');
			}
			return false;
		}
	}
	return true;
};

KeyValueStore.prototype.getItem = function (sKey) {
	if (!sKey) { return null; }

	var oKey   = sKey,
		legacy = false;

	sKey = this.prefix + sKey;

	if (this.store) {
		var sValue = this.store.getItem(sKey);
		if (sValue != null) {  // use lazy equality
			if (DEBUG) { console.log('    > attempting to load value for key "' + oKey + '"'); }
			/* legacy */
			if (sValue.slice(0, 2) === "#~") {
				// try it as a flagged, compressed value
				sValue = Util.deserialize(LZString.decompressFromUTF16(sValue.slice(2)));
				legacy = true;
			} else {
				try {
			/* /legacy */
					// try it as an unflagged, compressed value
					sValue = Util.deserialize(LZString.decompressFromUTF16(sValue));
			/* legacy */
				} catch (e) {
					// finally, try it as an uncompressed value
					sValue = Util.deserialize(sValue);
					legacy = true;
				}
			}
			// attempt to upgrade the legacy value
			if (legacy && !this.setItem(oKey, sValue, true)) {
				throw new Error('unable to upgrade legacy value for key "' + oKey + '" to new format');
			}
			/* /legacy */
			return sValue;
		}
	} else {
		sKey = escape(sKey);
		var cookies = document.cookie.split(";");
		for (var i = 0; i < cookies.length; i++) {
			var bits = cookies[i].split("=");
			if (bits[0].trim() === sKey) {
				var sValue = unescape(bits[1]);
				if (DEBUG) { console.log('    > attempting to load value for key "' + oKey + '"'); }
				/* legacy */
				if (sValue.slice(0, 2) === "#~") {
					// try it as a flagged, compressed value
					sValue = Util.deserialize(LZString.decompressFromBase64(sValue.slice(2)));
					legacy = true;
				} else {
					try {
				/* /legacy */
						// try it as an unflagged, compressed value
						sValue = Util.deserialize(LZString.decompressFromBase64(sValue));
				/* legacy */
					} catch (e) {
						// finally, try it as an uncompressed value
						sValue = Util.deserialize(sValue);
						legacy = true;
					}
				}
				// attempt to upgrade the legacy value
				if (legacy && !this.setItem(oKey, sValue, true)) {
					throw new Error('unable to upgrade legacy value for key "' + oKey + '" to new format');
				}
				/* /legacy */
				return sValue;
			}
		}
	}
	return null;
};

KeyValueStore.prototype.removeItem = function (sKey) {
	if (!sKey) { return false; }

	sKey = this.prefix + sKey;

	if (this.store) {
		this.store.removeItem(sKey);
	} else {
		document.cookie = escape(sKey) + "=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/";
	}
	return true;
};

KeyValueStore.prototype.removeMatchingItems = function (sKey) {
	if (!sKey) { return false; }

	if (DEBUG) { console.log("[<KeyValueStore>.removeMatchingItems()]"); }

	var matched = [];
	var keyRegexp = new RegExp(("^" + this.prefix + sKey).replace(/\./g, "\\.") + ".*");
	if (this.store) {
		for (var i = 0; i < this.store.length; i++) {
			var key = this.store.key(i);
			if (keyRegexp.test(key)) {
				matched.push(key);
			}
		}
	} else {
		sKey = escape(sKey);
		var cookies = document.cookie.split(";");
		for (var i = 0; i < cookies.length; i++) {
			var bits = cookies[i].split("=");
			var key = bits[0].trim();
			if (keyRegexp.test(key)) {
				matched.push(key);
			}
		}
	}
	for (var i = 0; i < matched.length; i++) {
		if (DEBUG) { console.log("    > removing key: " + matched[i]); }
		this.removeItem(matched[i]);
	}
	return true;
};

KeyValueStore.prototype.hasItem = function (sKey) {
	if (!sKey) { return false; }

	sKey = this.prefix + sKey;

	if (this.store) {
		if (this.store.getItem(sKey)) {
			return true;
		}
	} else {
		sKey = escape(sKey);
		var cookies = document.cookie.split(";");
		for (var i = 0; i < cookies.length; i++) {
			var bits = cookies[i].split("=");
			if (bits[0].trim() === sKey) {
				return true;
			}
		}
	}
	return false;
};


/***********************************************************************************************************************
** [End utility.js]
***********************************************************************************************************************/

/***********************************************************************************************************************
** [Begin main.js]
***********************************************************************************************************************/

/***********************************************************************************************************************
** [Error Handling Setup]
***********************************************************************************************************************/
function technicalAlert(where, mesg, error) {
	var errMesg = "Apologies! A technical problem has occurred. You may be able to continue, but some parts may not work properly.";
	// use lazy equality on these null checks
	if (where != null || mesg != null) {
		errMesg += "\n\nError";
		if (where != null) {
			errMesg += " [" + where + "]";
		}
		errMesg += ": " + ((mesg != null) ? mesg.replace(/^Error:\s+/, "") : "unknown error") + ".";
		if (error && error.stack) {
			errMesg += "\n\nStack Trace:\n" + error.stack;
		}
	}
	window.alert(errMesg);
}

if (!DEBUG) {
	window.onerror = function (mesg, url, lineNum, colNum, error) {
		technicalAlert(null, mesg, error);
	};
}


/***********************************************************************************************************************
** [Initialization]
***********************************************************************************************************************/
window.SugarCube = {};  // will contain exported identifiers, also allows scripts to detect if they're running in SugarCube (e.g. "SugarCube" in window)

var version = Object.freeze({
	// data properties
	title      : "SugarCube",
	major      : 0,
	minor      : 9,
	patch      : 5,
	prerelease : "ALPHA.1",
	build      : 3565,
	date       : new Date("2014-07-02T09:59:01.884Z"),
	/* legacy */
	extensions : {},
	/* /legacy */

	// method properties
	toString : function() {
		return this.major + "." + this.minor + "." + this.patch
			+ (this.prerelease ? "-" + this.prerelease : "") + "+" + this.build;
	},
	short : function() {
		return this.title + " (v" + this.major + "." + this.minor + "." + this.patch
			+ (this.prerelease ? "-" + this.prerelease : "") + ")";
	},
	long : function() {
		return this.title + " v" + this.toString() + " (" + this.date.toUTCString() + ")";
	}
});

// SugarCube History prototype mode enumeration
var HistoryMode = Object.freeze({
	Hash    : 1,
	Window  : 2,
	Session : 3
});
/* legacy kludge */
var modes = Object.freeze({ hashTag : HistoryMode.Hash, windowHistory : HistoryMode.Window, sessionHistory : HistoryMode.Session });
/* /legacy kludge */

// SugarCube runtime object (internal use only)
var runtime = Object.defineProperties({}, {
	flags : {
		value : {
			HistoryPRNG : {
				isEnabled  : false,
				isMathPRNG : false
			}
		}
	},
	temp : {
		writable : true,
		value    : {}
	}
});

// SugarCube config (author/developer use)
var config = {
	// capability properties
	hasPushState      : (("history" in window) && ("pushState" in window.history)),
	// the try/catch and length property access here is required due to a monumentally stupid
	// Firefox bug [ #748620; https://bugzilla.mozilla.org/show_bug.cgi?id=748620 ]
	// the try/catch is also required due to the iOS browser core throwing on setItem() calls when in private mode
	hasLocalStorage   : (("localStorage" in window) && (function (wls) { try { if (wls != null && wls.length >= 0) { var tkey = "SugarCube_storage_test"; wls.setItem(tkey, true); wls.removeItem(tkey); return true; } return false; } catch (e) { return false; } }(window.localStorage))),  // use lazy equality on null check
	hasSessionStorage : (("sessionStorage" in window) && (function (wss) { try { if (wss != null && wss.length >= 0) { var tkey = "SugarCube_storage_test"; wss.setItem(tkey, true); wss.removeItem(tkey); return true; } return false; } catch (e) { return false; } }(window.sessionStorage))),  // use lazy equality on null check
	hasFileAPI        : (("File" in window) && ("FileReader" in window) && ("Blob" in window)),

	// basic browser detection
	userAgent : navigator.userAgent.toLowerCase(),
	browser   : {},

	// general option properties
	displayPassageTitles : false,
	loadDelay            : 0,
	startPassage         : "Start",
	updatePageElements   : true,

	// history option properties
	disableHistoryControls : false,
	disableHistoryTracking : false,
	historyMode            : HistoryMode.Hash,

	// macros option properties
	macros : {
		maxLoopIterations : 1000
	},

	// saves option properties
	saves : {
		autosave  : undefined,
		id        : "untitled-story",
		isAllowed : undefined,
		onLoad    : undefined,
		onSave    : undefined,
		slots     : 8
	},

	// error messages properties
	errorName : "game",
	errors    : {}
};
config.transitionEndEventName = (function () { var teMap = { "transition" : "transitionend", "MSTransition" : "msTransitionEnd", "WebkitTransition" : "webkitTransitionEnd", "MozTransition" : "transitionend" }, el = document.createElement("div"); for (var tName in teMap) { if (el.style[tName] !== undefined) { return teMap[tName]; } } return ""; }());
config.errors = {
	savesNotAllowed : "Saving has been disallowed on this passage.",
	upgradeBrowser  :  "Apologies! Your web browser lacks capabilities that this " + config.errorName + " requires. Please consider upgrading it or switching to a more modern web browser."
};
config.browser = {
	isGecko      : (navigator && navigator.product === "Gecko" && !/webkit|trident/.test(config.userAgent)),
	isIE         : (/msie|trident/.test(config.userAgent) && !config.userAgent.contains("opera")),
	ieVersion    : (function () { var ieVer = /(?:msie\s+|rv:)(\d{1,2}\.\d)/.exec(config.userAgent); return ieVer ? +ieVer[1] : 0; }()),
	// opera <= 12: "opera/9.80 (windows nt 6.1; wow64) presto/2.12.388 version/12.16"
	// opera >= 15: "mozilla/5.0 (windows nt 6.1; wow64) applewebkit/537.36 (khtml, like gecko) chrome/28.0.1500.52 safari/537.36 opr/15.0.1147.130"
	isOpera      : (config.userAgent.contains("opera")) || (config.userAgent.contains(" opr/")),
	operaVersion : (function () { var re = new RegExp((/applewebkit|chrome/.test(config.userAgent) ? "opr" : "version") + "\\/(\\d{1,2}\\.\\d+)"), oprVer = re.exec(config.userAgent); return oprVer ? +oprVer[1] : 0; }()),
	isMobile     : {
		any        : function () { return (config.browser.isMobile.Android || config.browser.isMobile.BlackBerry || config.browser.isMobile.iOS || config.browser.isMobile.Windows); },
		Android    : (/android/.test(config.userAgent)),
		BlackBerry : (/blackberry/.test(config.userAgent)),
		iOS        : (/ip(?:hone|ad|od)/.test(config.userAgent)),
		Windows    : (/iemobile/.test(config.userAgent))
	}
};
// adjust these based on the specific browser used
config.historyMode = (config.hasPushState ? ((config.browser.isIE || config.browser.isMobile.iOS) && !config.hasSessionStorage ? HistoryMode.Window : HistoryMode.Session) : HistoryMode.Hash);
config.hasFileAPI = config.hasFileAPI && !config.browser.isMobile.any() && (!config.browser.isOpera || config.browser.operaVersion >= 15);

var formatter = null,  // Wikifier formatters
	macros    = {},    // macros manager
	tale      = {},    // story manager
	state     = {},    // history manager
	storage   = {},    // persistant storage manager
	session   = {},    // session manager
	options   = {},    // options variable store
	setup     = {};    // author setup variable store

var testPlay   = "",  // Twine 1.4+ "Test Play From Here" feature variable
	prerender  = {},          // Twine 1.4+ pre-render task callbacks
	postrender = {};          // Twine 1.4+ post-render task callbacks

/**
 * Main function, entry point for story startup
 */
$(document).ready(function () {
	if (DEBUG) { console.log("[main()]"); }

	/**
	 * WARNING!
	 * 
	 * The ordering of the code in this function is important, so be careful
	 * when mucking around with it.
	 */

	// instantiate the wikifier formatters and macro objects, as well as the standard macro library
	// these must be done before any passages are processed
	formatter = new WikiFormatter(Wikifier.formatters);
	macros    = new Macros();
	addStandardMacros();

	// instantiate the tale, state, storage, and session objects
	tale    = new Tale();
	state   = new History();
	storage = new KeyValueStore("localStorage", tale.domId);
	session = new KeyValueStore("sessionStorage", tale.domId);

	// set the default saves ID
	config.saves.id = tale.domId;

	// setup for story stylesheets, scripts, and widgets (in that order)
	var styles = tale.lookup("tags", "stylesheet");
	for (var i = 0; i < styles.length; i++) {
		addStyle(styles[i].text);
	}
	var scripts = tale.lookup("tags", "script");
	for (var i = 0; i < scripts.length; i++) {
		try {
			eval(scripts[i].text);
		} catch (e) {
			var errMesg = e.message;
			if (e.name === "TypeError" && /read[\s-]only/.test(e.message)) {
				var errMatch = /([\"\'])([^\1]+)\1/.exec(e.message);
				if (errMatch) {
					if (errMatch[2] && macros.has(errMatch[2])) {
						errMesg = "cannot clobber protected macro <<" + errMatch[2] + ">>";
					}
				}
			}
			technicalAlert(scripts[i].title, errMesg);
		}
	}
	var widgets = tale.lookup("tags", "widget");
	for (var i = 0; i < widgets.length; i++) {
		try {
			Wikifier.wikifyEval(widgets[i].processText());
		} catch (e) {
			technicalAlert(widgets[i].title, e.message);
		}
	}

	// initialize the save system (this must be done after script passages and before state initialization)
	SaveSystem.init();

	// initialize the user interface
	UISystem.init();

	// call macros' "early" init functions
	macros.init();

	// execute the StoryInit passage
	if (tale.has("StoryInit")) {
		try {
			Wikifier.wikifyEval(tale.get("StoryInit").text);
		} catch (e) {
			technicalAlert("StoryInit", e.message);
		}
	}

	// finalize the config.disableHistoryControls setting before initializing our state
	//   n.b. we do this here to give the author every opportunity to modify config.disableHistoryTracking during setup
	if (config.disableHistoryTracking) {
		config.disableHistoryControls = true;
	}

	// initialize our state
	state.init();  // this could take a while, so do it late

	// call macros' "late" init functions
	macros.lateInit();

	// lastly, export identifiers for debugging purposes
	window.SugarCube = {
		version    : version,
		config     : config,
		setup      : setup,
		runtime    : runtime,
		storage    : storage,
		session    : session,
		macros     : macros,
		tale       : tale,
		state      : state,
		Wikifier   : Wikifier,
		Util       : Util,
		History    : History,
		SaveSystem : SaveSystem,
		UISystem   : UISystem
	};
});


/***********************************************************************************************************************
** [Save System]
***********************************************************************************************************************/
var SaveSystem = {
	_bad : false,
	_max : -1,
	init : function () {
		function appendSlots(array, num) {
			for (var i = 0; i < num; i++) {
				array.push(null);
			}
			return array;
		}
		/* legacy kludges */
		function convertOldSave(saveObj) {
			if (saveObj.hasOwnProperty("data") && !saveObj.hasOwnProperty("state")) {
				saveObj.state = {
					mode  : saveObj.mode,
					delta : History.deltaEncodeHistory(saveObj.data)
				};
				delete saveObj.mode;
				delete saveObj.data;
			} else if (saveObj.hasOwnProperty("state") && !saveObj.state.hasOwnProperty("delta")) {
				saveObj.state.delta = History.deltaEncodeHistory(saveObj.state.history);
				delete saveObj.state.history;
			}
		}
		/* /legacy kludges */

		if (DEBUG) { console.log("[SaveSystem.init()]"); }

		if (config.saves.slots < 0) { config.saves.slots = 0; }
		if (storage.store === null) { return false; }

		// create and store the saves object, if it doesn't exist
		if (!storage.hasItem("saves")) {
			storage.setItem("saves", {
				autosave : null,
				slots    : appendSlots([], config.saves.slots)
			});
		}

		// retrieve the saves object
		var saves = storage.getItem("saves");
		if (saves === null) {
			SaveSystem._bad = true;
			return false;
		}

		/* legacy kludges */
		// convert an old saves array into a new saves object
		if (Array.isArray(saves)) {
			saves = {
				autosave : null,
				slots    : saves
			};
			storage.setItem("saves", saves);
		}
		/* /legacy kludges */

		// handle the author changing the number of save slots
		if (config.saves.slots !== saves.slots.length) {
			if (config.saves.slots < saves.slots.length) {
				// attempt to decrease the number of slots; this will only compact
				// the slots array, by removing empty slots, no saves will be deleted
				saves.slots.reverse();
				saves.slots = saves.slots.filter(function (val) {
					if (val === null && this.count > 0) {
						this.count--;
						return false;
					}
					return true;
				}, { count : saves.slots.length - config.saves.slots });
				saves.slots.reverse();
			} else if (config.saves.slots > saves.slots.length) {
				// attempt to increase the number of slots
				appendSlots(saves.slots, config.saves.slots - saves.slots.length);
			}
			storage.setItem("saves", saves);
		}

		/* legacy kludges */
		// convert old-style saves
		var needSave = false;
		if (saves.autosave !== null) {
			if (!saves.autosave.hasOwnProperty("state") || !saves.autosave.state.hasOwnProperty("delta")) {
				convertOldSave(saves.autosave);
				needSave = true;
			}
		}
		for (var i = 0; i < saves.slots.length; i++) {
			if (saves.slots[i] !== null) {
				if (!saves.slots[i].hasOwnProperty("state") || !saves.slots[i].state.hasOwnProperty("delta")) {
					convertOldSave(saves.slots[i]);
					needSave = true;
				}
			}
		}
		if (needSave) { storage.setItem("saves", saves); }
		/* /legacy kludges */

		SaveSystem._max = saves.slots.length - 1;

		return true;
	},
	length : function () {
		return SaveSystem._max + 1;
	},
	OK : function () {
		return SaveSystem.autosaveOK() || SaveSystem.slotsOK();
	},
	autosaveOK : function () {
		return !SaveSystem._bad && typeof config.saves.autosave !== "undefined";
	},
	slotsOK : function () {
		return !SaveSystem._bad && SaveSystem._max !== -1;
	},
	hasAuto : function () {
		var saves = storage.getItem("saves");
		if (saves === null) { return false; }
		if (saves.autosave === null) { return false; }

		return true;
	},
	getAuto : function () {
		var saves = storage.getItem("saves");
		if (saves === null) { return null; }

		return saves.autosave;
	},
	loadAuto : function () {
		var saves = storage.getItem("saves");
		if (saves === null) { return false; }
		if (saves.autosave === null) { return false; }

		return SaveSystem.unmarshal(saves.autosave);
	},
	saveAuto : function (title, metadata) {
		if (typeof config.saves.isAllowed === "function" && !config.saves.isAllowed()) {
			return false;
		}

		var saves = storage.getItem("saves");
		if (saves === null) { return false; }

		saves.autosave = SaveSystem.marshal();
		saves.autosave.title = title || tale.get(state.active.title).excerpt();
		saves.autosave.date = Date.now();
		if (metadata != null) { saves.autosave.metadata = metadata; }  // use lazy equality

		return storage.setItem("saves", saves);
	},
	deleteAuto : function () {
		var saves = storage.getItem("saves");
		if (saves === null) { return false; }

		saves.autosave = null;

		return storage.setItem("saves", saves);
	},
	isEmpty : function () {
		return SaveSystem.count() === 0;
	},
	count : function () {
		if (!SaveSystem.slotsOK()) { return 0; }

		var saves = storage.getItem("saves");
		if (saves === null) { return 0; }

		var count = 0;
		for (var i = 0; i < saves.slots.length; i++) { if (saves.slots[i] !== null) { count++; } }

		return count;
	},
	has : function (slot) {
		if (slot < 0 || slot > SaveSystem._max) { return false; }

		var saves = storage.getItem("saves");
		if (saves === null) { return false; }
		if (slot > saves.slots.length) { return false; }
		if (saves.slots[slot] === null) { return false; }

		return true;
	},
	get : function (slot) {
		if (slot < 0 || slot > SaveSystem._max) { return null; }

		var saves = storage.getItem("saves");
		if (saves === null) { return null; }
		if (slot > saves.slots.length) { return null; }

		return saves.slots[slot];
	},
	load : function (slot) {
		if (slot < 0 || slot > SaveSystem._max) { return false; }

		var saves = storage.getItem("saves");
		if (saves === null) { return false; }
		if (slot > saves.slots.length) { return false; }
		if (saves.slots[slot] === null) { return false; }

		return SaveSystem.unmarshal(saves.slots[slot]);
	},
	save : function (slot, title, metadata) {
		if (typeof config.saves.isAllowed === "function" && !config.saves.isAllowed()) {
			UISystem.alert(config.errors.savesNotAllowed);
			return false;
		}
		if (slot < 0 || slot > SaveSystem._max) { return false; }

		var saves = storage.getItem("saves");
		if (saves === null) { return false; }
		if (slot > saves.slots.length) { return false; }

		saves.slots[slot] = SaveSystem.marshal();
		saves.slots[slot].title = title || tale.get(state.active.title).excerpt();
		saves.slots[slot].date = Date.now();
		if (metadata != null) { saves.slots[slot].metadata = metadata; }  // use lazy equality

		return storage.setItem("saves", saves);
	},
	delete : function (slot) {
		if (slot < 0 || slot > SaveSystem._max) { return false; }

		var saves = storage.getItem("saves");
		if (saves === null) { return false; }
		if (slot > saves.slots.length) { return false; }

		saves.slots[slot] = null;

		return storage.setItem("saves", saves);
	},
	purge : function () {
		storage.removeItem("saves");
		return SaveSystem.init();
	},
	exportSave : function () {
		if (DEBUG) { console.log("[SaveSystem.exportSave()]"); }

		if (typeof config.saves.isAllowed === "function" && !config.saves.isAllowed()) {
			UISystem.alert(config.errors.savesNotAllowed);
			return;
		}

		var saveName = tale.domId + ".save",
			saveObj  = LZString.compressToBase64(Util.serialize(SaveSystem.marshal()));

		saveAs(new Blob([saveObj], { type : "text/plain;charset=UTF-8" }), saveName);
	},
	importSave : function (event) {
		if (DEBUG) { console.log("[SaveSystem.importSave()]"); }

		var file   = event.target.files[0],
			reader = new FileReader();

		// capture the file information once the load is finished
		$(reader).load(function(file) {
			return function(evt) {
				if (DEBUG) { console.log('    > loaded: ' + escape(file.name) + '; payload: ' + evt.target.result); }

				if (!evt.target.result) { return; }

				var saveObj;
				try {
					saveObj = (/\.json$/i.test(file.name) || /^\{/.test(evt.target.result))
						? JSON.parse(evt.target.result)
						: Util.deserialize(LZString.decompressFromBase64(evt.target.result));
				} catch (e) { /* noop, the unmarshal() method will handle the error */ }
				SaveSystem.unmarshal(saveObj);
			};
		}(file));

		// initiate the file load
		reader.readAsText(file);
	},
	marshal : function () {
		if (DEBUG) { console.log("[SaveSystem.marshal()]"); }

		var saveObj = {
			id    : config.saves.id,
			state : History.marshal()
		};
		if (config.saves.version) {
			saveObj.version = config.saves.version;
		}

		if (typeof config.saves.onSave === "function") {
			config.saves.onSave(saveObj);
		}

		return saveObj;
	},
	unmarshal : function (saveObj) {
		if (DEBUG) { console.log("[SaveSystem.unmarshal()]"); }

		try {
			if (!saveObj || !saveObj.hasOwnProperty("id") || !saveObj.hasOwnProperty("state")) {
				if (!saveObj || !saveObj.hasOwnProperty("mode") || !saveObj.hasOwnProperty("id") || !saveObj.hasOwnProperty("data")) {
					throw new Error("save is missing required data.  Either you've loaded a file which isn't a save, or the save has become corrupted");
				} else {
					throw new Error("old-style saves seen in SaveSystem.unmarshal()");
				}
			}

			if (typeof config.saves.onLoad === "function") {
				config.saves.onLoad(saveObj);
			}

			if (saveObj.id !== config.saves.id) {
				throw new Error("save is from the wrong " + config.errorName);
			}

			// restore the state
			History.unmarshal(saveObj.state);
		} catch (e) {
			UISystem.alert(e.message[0].toUpperCase() + e.message.slice(1) + ".\n\nAborting load.");
			return false;
		}

		return true;
	}
};


/***********************************************************************************************************************
** [UI System]
***********************************************************************************************************************/
var UISystem = {
	_overlay : null,
	_body    : null,
	_closer  : null,
	init     : function () {
		if (DEBUG) { console.log("[UISystem.init()]"); }

		var html   = $(document.documentElement),
			target;

		// add UI dialog elements to <body>
		UISystem._overlay = insertElement(document.body, "div", "ui-overlay", "ui-close");
		UISystem._body = insertElement(document.body, "div", "ui-body");
		UISystem._closer = insertElement(document.body, "a", "ui-body-close", "ui-close");
		insertText(UISystem._closer, "\ue002");

		// setup for the non-passage page elements
		if (tale.has("StoryCaption")) {
			document.getElementById("story-caption").style.display = "block";
		}
		if (tale.has("StoryMenu") || tale.has("MenuStory")) {
			document.getElementById("menu-story").style.display = "block";
		}
		setPageElement("story-title", "StoryTitle", tale.title);
		UISystem.setPageElements();

		// setup Saves menu
		UISystem.addClickHandler("#menu-saves", null, function () { UISystem.buildSaves(); });

		// setup Rewind menu
		target = $("#menu-rewind");
		if (!config.disableHistoryTracking && tale.lookup("tags", "bookmark").length > 0) {
			target.css({ display : "block" });
			UISystem.addClickHandler(target.find("a"), null, function () { UISystem.buildRewind(); });
		} else {
			target.remove();
		}

		// setup Restart menu
		UISystem.addClickHandler("#menu-restart", null, function () { UISystem.buildRestart(); });

		// setup Options menu
		target = $("#menu-options");
		if (tale.has("MenuOptions") && tale.get("MenuOptions").text.trim() !== "") {
			target.css({ display : "block" });
			UISystem.addClickHandler(target.find("a"), null, function () { UISystem.buildOptions(); });
		} else {
			target.remove();
		}

		// setup Share menu
		target = $("#menu-share");
		if (tale.has("MenuShare") && tale.get("MenuShare").text.trim() !== "") {
			target.css({ display : "block" });
			UISystem.addClickHandler(target.find("a"), null, function () { UISystem.buildShare(); });
		} else {
			target.remove();
		}

		// handle the loading screen
		if (document.readyState === "complete") {
			html.removeClass("init-loading");
		}
		document.addEventListener("readystatechange", function () {
			if (DEBUG) { console.log("**** document.readyState: " + document.readyState + "  (on: readystatechange)"); }
			// readyState can be: "loading", "interactive", or "complete"
			if (document.readyState === "complete") {
				if (DEBUG) { console.log('---- removing class "init-loading" (in ' + config.loadDelay + 'ms)'); }
				if (config.loadDelay > 0) {
					setTimeout(function () { html.removeClass("init-loading"); }, config.loadDelay);
				} else {
					html.removeClass("init-loading");
				}
			} else {
				if (DEBUG) { console.log('++++ adding class "init-loading"'); }
				html.addClass("init-loading");
			}
		}, false);
	},
	setPageElements : function () {
		if (DEBUG) { console.log("[UISystem.setPageElements()]"); }
		// setup for the non-passage page elements
		setPageElement("story-banner",   "StoryBanner");
		setPageElement("story-subtitle", "StorySubtitle");
		setPageElement("story-author",   "StoryAuthor");
		setPageElement("story-caption",  "StoryCaption");
		setPageElement("menu-story",     ["StoryMenu", "MenuStory"]);
	},
	buildSaves : function () {
		function createActionItem(bId, bClass, bText, bAction) {
			var li = document.createElement("li");
			var btn = document.createElement("button");
			btn.id = "saves-" + bId;
			if (bClass) { btn.className = bClass; }
			btn.innerHTML = bText;
			$(btn).click(bAction);
			li.appendChild(btn);
			return li;
		}
		function createSaveList() {
			function createButton(bId, bClass, bText, bSlot, bAction) {
				var btn = document.createElement("button");
				btn.id = "saves-" + bId + "-" + bSlot;
				if (bClass) { btn.className = bClass; }
				btn.classList.add(bId);
				btn.innerHTML = bText;
				$(btn).click(function (i) {
					return function () { bAction(i); };
				}(bSlot));
				return btn;
			}

			var saves = storage.getItem("saves");
			if (saves === null) { return false; }

			var tbody  = document.createElement("tbody"),
				tr,
				tdSlot,
				tdLoad,
				tdDesc,
				tdDele;
			var tdLoadBtn, tdDescTxt, tdDeleBtn;

			if (SaveSystem.autosaveOK()) {
				tr     = document.createElement("tr"),
				tdSlot = document.createElement("td"),
				tdLoad = document.createElement("td"),
				tdDesc = document.createElement("td"),
				tdDele = document.createElement("td");

				//tdSlot.appendChild(document.createTextNode("\u25c6"));
				tdDescTxt = document.createElement("b");
				tdDescTxt.innerHTML = "A";
				tdSlot.appendChild(tdDescTxt);

				if (saves.autosave && saves.autosave.state.mode === config.historyMode) {
					tdLoadBtn = document.createElement("button");
					tdLoadBtn.id = "saves-load-autosave";
					tdLoadBtn.classList.add("load");
					tdLoadBtn.classList.add("ui-close");
					tdLoadBtn.innerHTML = "Load";
					$(tdLoadBtn).click(SaveSystem.loadAuto);
					tdLoad.appendChild(tdLoadBtn);

					tdDescTxt = document.createTextNode(saves.autosave.title);
					tdDesc.appendChild(tdDescTxt);
					tdDesc.appendChild(document.createElement("br"));
					tdDescTxt = document.createElement("small");
					tdDescTxt.innerHTML = "Autosaved (" + new Date(saves.autosave.date).toLocaleString() + ")";
					tdDesc.appendChild(tdDescTxt);

					tdDeleBtn = document.createElement("button");
					tdDeleBtn.id = "saves-delete-autosave";
					tdDeleBtn.classList.add("delete");
					tdDeleBtn.innerHTML = "Delete";
					$(tdDeleBtn).click(function () {
						SaveSystem.deleteAuto();
						UISystem.buildSaves();  // rebuild the saves menu
					});
					tdDele.appendChild(tdDeleBtn);
				} else {
					tdDescTxt = document.createElement("i");
					tdDescTxt.innerHTML = "(autosave slot empty)";
					tdDesc.appendChild(tdDescTxt);
					tdDesc.classList.add("empty");
				}

				tr.appendChild(tdSlot);
				tr.appendChild(tdLoad);
				tr.appendChild(tdDesc);
				tr.appendChild(tdDele);
				tbody.appendChild(tr);
			}
			for (var i = 0; i < saves.slots.length; i++) {
				tr     = document.createElement("tr"),
				tdSlot = document.createElement("td"),
				tdLoad = document.createElement("td"),
				tdDesc = document.createElement("td"),
				tdDele = document.createElement("td");

				tdSlot.appendChild(document.createTextNode(i+1));

				if (saves.slots[i] && saves.slots[i].state.mode === config.historyMode) {
					tdLoadBtn = createButton("load", "ui-close", "Load", i, SaveSystem.load);
					tdLoad.appendChild(tdLoadBtn);

					tdDescTxt = document.createTextNode(saves.slots[i].title);
					tdDesc.appendChild(tdDescTxt);
					tdDesc.appendChild(document.createElement("br"));
					tdDescTxt = document.createElement("small");
					if (saves.slots[i].date) {
						tdDescTxt.innerHTML = "Saved (" + new Date(saves.slots[i].date).toLocaleString() + ")";
					} else {
						tdDescTxt.innerHTML = "Saved (<i>unknown</i>)";
					}
					tdDesc.appendChild(tdDescTxt);

					tdDeleBtn = createButton("delete", null, "Delete", i, function (i) {
						SaveSystem.delete(i);
						UISystem.buildSaves();  // rebuild the saves menu
					});
					tdDele.appendChild(tdDeleBtn);
				} else {
					tdLoadBtn = createButton("save", "ui-close", "Save", i, SaveSystem.save);
					tdLoad.appendChild(tdLoadBtn);

					tdDescTxt = document.createElement("i");
					tdDescTxt.innerHTML = "(save slot empty)";
					tdDesc.appendChild(tdDescTxt);
					tdDesc.classList.add("empty");
				}

				tr.appendChild(tdSlot);
				tr.appendChild(tdLoad);
				tr.appendChild(tdDesc);
				tr.appendChild(tdDele);
				tbody.appendChild(tr);
			}
			var table = document.createElement("table");
			table.id = "saves-list";
			table.appendChild(tbody);
			return table;
		}
		function createSavesImport() {
			var el    = document.createElement("div"),
				label = document.createElement("div"),
				input = document.createElement("input");

			// add label
			label.id = "saves-import-label";
			label.appendChild(document.createTextNode("Select a save file to load:"));
			el.appendChild(label);

			// add file input
			input.type = "file";
			input.id   = "saves-import-file";
			input.name = "saves-import-file";
			$(input).change(function (evt) {
				SaveSystem.importSave(evt);
				UISystem.close();
			});
			el.appendChild(input);

			return el;
		}

		if (DEBUG) { console.log("[UISystem.buildSaves()]"); }

		var dialog  = UISystem._body,
			list,
			btnBar,
			savesOK = SaveSystem.OK();

		$(dialog)
			.empty()
			.addClass("saves");

		if (savesOK) {
			// add saves list
			list = createSaveList();
			if (!list) {
				list = document.createElement("div");
				list.id = "saves-list"
				list.innerHTML = "<i>No save slots found</i>";
			}
			dialog.appendChild(list);
		}

		// add action list (export, import, and purge) and import input
		if (savesOK || config.hasFileAPI) {
			btnBar = document.createElement("div");
			list = document.createElement("ul");
			if (config.hasFileAPI) {
				list.appendChild(createActionItem("export", "ui-close", "Save to Disk\u2026", SaveSystem.exportSave));
				list.appendChild(createActionItem("import", null, "Load from Disk\u2026", function (evt) {
					if (!document.getElementById("saves-import-file")) {
						dialog.appendChild(createSavesImport());
					}
				}));
			}
			if (savesOK) {
				list.appendChild(createActionItem("purge", null, "Purge Save Slots", function (evt) {
					SaveSystem.purge();
					UISystem.buildSaves();  // rebuild the saves menu
				}));
			}
			btnBar.appendChild(list);
			dialog.appendChild(btnBar);
			return true;
		} else {
			UISystem.alert("Apologies! Your browser either lacks some of the capabilities required to support saves or has disabled them.\n\nThe former may be solved by updating it to a newer version or by switching to a more modern browser.\n\nThe latter may be solved by loosening its security restrictions or, perhaps, by viewing the " + config.errorName + " via the HTTP protocol.");
			return false;
		}
	},
	buildRewind : function () {
		if (DEBUG) { console.log("[UISystem.buildRewind()]"); }

		var dialog   = UISystem._body,
			hasItems = false;

		$(dialog)
			.empty()
			.addClass("rewind");

		for (var i = 0, len = state.length - 1; i < len; i++) {
			var passage = tale.get(state.history[i].title);
			if (passage && passage.tags.contains("bookmark")) {
				var el = document.createElement("div");
				el.classList.add("ui-close");
				$(el).click(function () {
					var p = i;
					if (config.historyMode === HistoryMode.Session) {
						return function () {
							if (DEBUG) { console.log("[rewind:click() @Session]"); }

							// necessary?
							document.title = tale.title;

							// regenerate the state history suid
							state.regenerateSuid();

							// push the history states in order
							if (config.disableHistoryControls) {
								if (DEBUG) { console.log("    > pushing: " + p + " (" + state.history[p].title + ")"); }

								// load the state into the window history
								History.replaceWindowState(
									{ suid : state.suid, sidx : state.history[p].sidx },
									(config.displayPassageTitles && state.history[p].title !== config.startPassage)
										? tale.title + ": " + state.history[p].title
										: tale.title
								);
							} else {
								for (var i = 0, end = p; i <= end; i++) {
									if (DEBUG) { console.log("    > pushing: " + i + " (" + state.history[i].title + ")"); }

									// load the state into the window history
									History.addWindowState(
										{ suid : state.suid, sidx : state.history[i].sidx },
										(config.displayPassageTitles && state.history[i].title !== config.startPassage)
											? tale.title + ": " + state.history[i].title
											: tale.title
									);
								}
							}

							var windowState = History.getWindowState();
							if (windowState.sidx < state.top.sidx) {
								if (DEBUG) { console.log("    > stacks out of sync; popping " + (state.top.sidx - windowState.sidx) + " states to equalize"); }
								// stack ids are out of sync, pop our stack until
								// we're back in sync with the window.history
								state.pop(state.top.sidx - windowState.sidx);
							}

							// activate the current top
							state.activate(state.top);

							// display the passage
							state.display(state.active.title, null, "replace");
						};
					} else if (config.historyMode === HistoryMode.Window) {
						return function () {
							if (DEBUG) { console.log("[rewind:click() @Window]"); }

							// necessary?
							document.title = tale.title;

							// push the history states in order
							if (!config.disableHistoryControls) {
								for (var i = 0, end = p; i <= end; i++) {
									if (DEBUG) { console.log("    > pushing: " + i + " (" + state.history[i].title + ")"); }

									// load the state into the window history
									var stateObj = { history : state.history.slice(0, i + 1) };
									if (state.hasOwnProperty("prng")) {
										stateObj.rseed = state.prng.seed;
									}
									History.addWindowState(
										stateObj,
										(config.displayPassageTitles && state.history[i].title !== config.startPassage)
											? tale.title + ": " + state.history[i].title
											: tale.title
									);
								}
							}

							// stack ids are out of sync, pop our stack until
							// we're back in sync with the window.history
							state.pop(state.length - (p + 1));

							// activate the current top
							state.activate(state.top);

							// display the passage
							state.display(state.active.title, null, "replace");
						};
					} else {
						return function () {
							if (DEBUG) { console.log("[rewind:click() @Hash]"); }

							if (!config.disableHistoryControls) {
								window.location.hash = state.history[p].hash;
							} else {
								session.setItem("activeHash", state.history[p].hash);
								window.location.reload();
							}
						};
					}
				}());
				el.innerHTML = passage.excerpt();
				dialog.appendChild(el);
				hasItems = true;
			}
		}
		if (!hasItems) {
			var el = document.createElement("div");
			el.innerHTML = "<i>No passages available</i>";
			dialog.appendChild(el);
		}
	},
	buildRestart : function () {
		if (DEBUG) { console.log("[UISystem.buildRestart()]"); }

		var dialog = UISystem._body;

		$(dialog)
			.empty()
			.addClass("dialog restart")
			.append('<p>Are you sure that you want to restart?  Unsaved progress will be lost.</p><ul><li><button id="restart-ok" class="ui-close">OK</button></li><li><button id="restart-cancel" class="ui-close">Cancel</button></li></ul>');

		// add an additional click handler for the OK button
		$("#ui-body #restart-ok").click(function () {
			state.restart();
		});

		return true;
	},
	buildOptions : function () {
		if (DEBUG) { console.log("[UISystem.buildOptions()]"); }

		var dialog = UISystem._body;

		$(dialog)
			.empty()
			.addClass("dialog options");
		new Wikifier(dialog, tale.get("MenuOptions").processText().trim());

		return true;
	},
	buildShare : function () {
		if (DEBUG) { console.log("[UISystem.buildShare()]"); }

		var dialog = UISystem._body;

		$(dialog)
			.empty()
			.addClass("share");
		new Wikifier(dialog, tale.get("MenuShare").processText().trim());
		$("br", dialog).remove();

		return true;
	},
	alert : function (message, options, closeFunc) {
		var dialog = UISystem._body;

		$(dialog)
			.empty()
			.addClass("dialog alert")
			.append('<p>' + message + '</p><ul><li><button id="alert-ok" class="ui-close">OK</button></li></ul>');

		// show the dialog
		UISystem.show(options, closeFunc);
	},
	restart : function () {
		// build the dialog
		UISystem.buildRestart();

		// show the dialog
		UISystem.show();
	},
	isOpen : function () {
		return document.body.classList.contains("ui-open");
	},
	addClickHandler : function (target, options, startFunc, doneFunc, closeFunc) {
		$(target).click(function (evt) {
			evt.preventDefault();  // does not prevent bound events, only default actions (e.g. href links)

			// call the start function
			if (typeof startFunc === "function") { startFunc(evt); }

			// show the dialog
			UISystem.show(options, closeFunc);

			// call the done function
			if (typeof doneFunc === "function") { doneFunc(evt); }
		});
	},
	show : function (options, closeFunc) {
		options = $.extend({ top : 50, opacity : 0.8 }, options);

		// stop the body from scrolling and setup the delegated UI close handler
		$(document.body)
			.addClass("ui-open")
			.on("click.uisystem-close", ".ui-close", closeFunc, UISystem.close);

		// display the overlay
		$(UISystem._overlay)
			//.addClass("ui-close")
			.css({ display : "block", opacity : 0 })
			.fadeTo(200, options.opacity);

		// display the dialog
		var position = UISystem.calcPositionalProperties(options.top);
		$(UISystem._body)
			.css($.extend({ display : "block", opacity : 0 }, position.dialog))
			.fadeTo(200, 1);
		$(UISystem._closer)
			.css($.extend({ display : "block", opacity : 0 }, position.closer))
			.fadeTo(50, 1);

		// add the UI resize handler
		$(window)
			.on("resize.uisystem", null, options.top, $.debounce(40, UISystem.resizeHandler));
	},
	close : function (evt) {
		// pretty much reverse the actions taken in UISystem.show()
		$(window)
			.off("resize.uisystem");
		$(UISystem._body)
			.css({
				display : "none",
				opacity : 0,
				left    : "",
				right   : "",
				top     : "",
				bottom  : ""
			})
			.removeClass()
			.empty();  // .empty() here will break static menus
		$(UISystem._closer)
			.css({
				display : "none",
				opacity : 0,
				right   : "",
				top     : ""
			});
		/*
		$(UISystem._overlay)
			.css({
				display : "none",
				opacity : 0
			})
			.fadeOut(200)
			.removeClass();
		*/
		$(UISystem._overlay)
			.fadeOut(200);
			//.removeClass();
		$(document.body)
			.off("click.uisystem-close")
			.removeClass("ui-open");

		// call the given "on close" callback function, if any
		if (evt && typeof evt.data === "function") { evt.data(evt); }
	},
	resizeHandler : function (evt) {
		var dialog = $(UISystem._body),
			closer = $(UISystem._closer),
			topPos = (evt && typeof evt.data !== "undefined") ? evt.data : 50;

		if (dialog.css("display") === "block") {
			// stow the dialog and unset its positional properties (this is important!)
			dialog.css({ display : "none", left : "", right : "", top : "", bottom : "" });
			closer.css({ display : "none", right : "", top : "" });

			// restore the dialog with its new positional properties
			var position = UISystem.calcPositionalProperties(topPos);
			dialog.css($.extend({ display : "block" }, position.dialog));
			closer.css($.extend({ display : "block" }, position.closer));
		}
	},
	calcPositionalProperties : function (topPos) {
		if (typeof topPos === "undefined") { topPos = 50; }

		var parent    = $(window),
			dialog    = $(UISystem._body),
			dialogPos = { left : "", right : "", top : "", bottom : "" },
			closer    = $(UISystem._closer),
			closerPos = { right : "", top : "" },
			horzSpace = parent.width() - dialog.outerWidth(true),
			vertSpace = parent.height() - dialog.outerHeight(true);

		if (horzSpace <= 32) {
			dialogPos.left = dialogPos.right = 16;
		} else {
			dialogPos.left = dialogPos.right = ~~(horzSpace / 2);
		}
		if (vertSpace <= 32) {
			dialogPos.top = dialogPos.bottom = 16;
		} else {
			if ((vertSpace / 2) > topPos) {
				dialogPos.top = topPos;
			} else {
				dialogPos.top = dialogPos.bottom = ~~(vertSpace / 2);
			}
		}

		closerPos.right = (dialogPos.right - closer.outerWidth(true) + 6) + "px";
		closerPos.top = (dialogPos.top - closer.outerHeight(true) + 6) + "px";
		for (var p in dialogPos) {
			if (dialogPos[p] !== "") {
				dialogPos[p] += "px";
			}
		}

		return { dialog : dialogPos, closer : closerPos };
	}
};


/***********************************************************************************************************************
** [End main.js]
***********************************************************************************************************************/

/***********************************************************************************************************************
** [Begin story.js]
***********************************************************************************************************************/

/***********************************************************************************************************************
** [History]
***********************************************************************************************************************/
function History(instanceName) {
	if (DEBUG) {
		console.log("[History()]");
		console.log("    > config.historyMode: " + (config.historyMode === HistoryMode.Hash ? "Hash" : (config.historyMode === HistoryMode.Window ? "Window" : "Session")));
		if (History.getWindowState()) {
			if (config.historyMode === HistoryMode.Session) {
				console.log("    > History.getWindowState(): " + History.getWindowState().sidx + " / " + History.getWindowState().suid);
			} else if (config.historyMode === HistoryMode.Window) {
				//console.log("    > History.getWindowState(): " + History.getWindowState().history.length);
				console.log("    > History.getWindowState(): " + History.getWindowState().delta.length);
			}
		} else {
				console.log("    > History.getWindowState(): " + History.getWindowState());
		}
	}

	// currently active/displayed state
	this.active = { init : true, variables : {} };  // allows macro initialization to set variables at startup

	// current hash, if in Hash mode
	if (config.historyMode === HistoryMode.Hash) {
		this.hash = "";
	}

	// history state stack
	//     hashTag        [{ title : null, variables : {} }]
	//     windowHistory  [{ title : null, variables : {} }]
	//     sessionHistory [{ title : null, variables : {}, sidx : null }]
	this.history = [];

	// update instance reference in SugarCube global object
	window.SugarCube[instanceName || "state"] = this;
}

// setup some getters
History.prototype = {
	get top ()     { return (this.history.length !== 0) ? this.history[this.history.length - 1] : null; },
	get bottom ()  { return (this.history.length !== 0) ? this.history[0] : null; },
	get isEmpty () { return this.history.length === 0; },
	get length ()  { return (config.historyMode === HistoryMode.Session) ? this.active.sidx + 1 : this.history.length; }
};

/*
History.prototype.clone = function (at) {
	if (this.isEmpty) { return null; }
	at = 1 + (at ? Math.abs(at) : 0);
	if (at > this.history.length) { return null; }

	var dup = clone(this.history[this.history.length - at]);
	if (config.historyMode === HistoryMode.Session) {
		delete dup.sidx;
	}
	return dup;
};
*/

History.prototype.getDeltaFromHistory = function (end) {
	/*
	if (this.isEmpty) { return null; }

	var hist = this.history,
		diff = [ clone(this.history[0]) ];
	for (var i = 1, len = hist.length; i < len; i++) {
		diff.push(Util.diff(hist[i-1], hist[i]));
	}
	return diff;
	*/
	//if (end != null && (end < -(this.length - 1) || end > this.length)) { return null; }  // use lazy equality on null check

	return History.deltaEncodeHistory((end != null) ? this.history.slice(0, end) : this.history);  // use lazy equality on null check
};

History.prototype.setHistoryFromDelta = function (delta) {
	/*
	if (delta == null || typeof delta !== "object") { return null; }  // use lazy equality on null check

	this.history = [ clone(delta[0]) ];
	var hist = this.history;
	for (var i = 1, len = delta.length; i < len; i++) {
		hist.push(Util.patch(hist[i-1], delta[i]));
	}
	*/
	this.history = History.deltaDecodeHistory(delta);
};

History.prototype.index = function (idx) {
	if (this.isEmpty) { return null; }
	if (idx < 0 || idx >= this.length) { return null; }

	return this.history[idx];
};

History.prototype.peek = function (at) {
	if (this.isEmpty) { return null; }
	at = 1 + (at ? Math.abs(at) : 0);
	if (at > this.length) { return null; }

	return this.history[this.length - at];
};

History.prototype.push = function (/* variadic */) {
	if (arguments.length === 0) { return; }  // maybe throw?

	for (var i = 0; i < arguments.length; i++) {
		var state = arguments[i];
		if (config.historyMode === HistoryMode.Session) {
			state.sidx = this.history.length;
		}
		this.history.push(state);
	}
	return this.history.length;
};

History.prototype.pop = function (num) {
	if (this.isEmpty) { return []; }
	num = num ? Math.abs(num) : 1;
	//if (num > this.history.length) { return []; }

	return (num === 1) ? this.history.pop() : this.history.splice(this.history.length - num, num);
};

History.prototype.activate = function (state) {
	if (arguments.length === 0) { return; }  // maybe throw?
	if (state == null) { throw new Error("state activation attempted with null/undefined"); }  // use lazy equality

	if (typeof state === "object") {
		this.active = clone(state);
	} else {
		if (this.isEmpty) { return null; }
		if (state < 0 || state >= this.history.length) { return null; }
		this.active = clone(this.history[state]);
	}
	if (this.prng) {
		this.prng = SeedablePRNG.unmarshal({
			seed  : this.prng.seed,
			count : this.active.rcount
		});
	}

	return this.active;
};

History.prototype.init = function () {
	if (DEBUG) { console.log("[<History>.init()]"); }

	// display the initial passage
	if (typeof testPlay !== "undefined" && testPlay !== "") {
		// enables the Twine 1.4+ "Test Play From Here" feature
		if (DEBUG) { console.log('    > display: "' + testPlay + '" (testPlay)'); }
		this.display(testPlay);
	} else if (!this.restore()) {
		if (DEBUG) { console.log('    > display: "' + config.startPassage + '"'); }
		this.display(config.startPassage);
	}

	// setup the history change handlers
	//   n.b. do not update these to use jQuery; the "popstate" event gains
	//        nothing from being wrapped in the jQuery Event object and it would
	//        complicate either the handlers, by having to deal with it, or the
	//        jQuery Event object, if we pushed the properties we need onto it
	if (config.historyMode === HistoryMode.Session) {
		window.addEventListener("popstate", History.popStateHandler_Session, false);
	} else if (config.historyMode === HistoryMode.Window) {
		window.addEventListener("popstate", History.popStateHandler_Window, false);
	} else {
		window.addEventListener("hashchange", History.hashChangeHandler, false);
	}
};

History.prototype.display = function (title, link, option) {
	if (DEBUG) { console.log("[<History>.display()]"); }

	// process option
	var updateDisplay = (option === "hidden" || option === "offscreen" || option === "quietly" || option === false) ? false : true,
		updateHistory = (option === "replace" || option === "back") ? false : true;

	// reset the runtime temp/scratch object
	runtime.temp = {};

	// n.b. the title parameter can either be a passage title (string) or passage ID (number), so
	//      after loading the passage, always refer to passage.title and never the title parameter
	var passage     = tale.get(title),
		windowTitle = (config.displayPassageTitles && passage.title !== config.startPassage)
			? tale.title + ": " + passage.title
			: tale.title;

	// ensure that this.active is set if we have history
	if (this.active.init && !this.isEmpty) {
		if (config.historyMode === HistoryMode.Session) {
			if (DEBUG) {
				console.log("    [S]> state.active.init && !state.isEmpty; activating: "
					+ (History.hasWindowState() ? "History.getWindowState().sidx = " + History.getWindowState().sidx : "state.top"));
			}
			this.activate(History.hasWindowState() ? History.getWindowState().sidx : this.top);
		} else {
			if (DEBUG) {
				if (config.historyMode === HistoryMode.Window) {
					console.log("    [W]> state.active.init && !state.isEmpty; activating: state.top");
				} else {
					console.log("    [H]> state.active.init && !state.isEmpty; activating: state.top");
				}
			}
			this.activate(this.top);
		}
	}

	// create a fresh entry in the history
	if (updateHistory) {
		if (!this.isEmpty) {
			if (config.disableHistoryTracking) {
				this.pop();
			} else if (config.historyMode === HistoryMode.Session && History.getWindowState().sidx < this.top.sidx) {
				if (DEBUG) { console.log("    > stacks out of sync; popping " + (this.top.sidx - History.getWindowState().sidx) + " states to equalize"); }
				// stack IDs are out of sync, pop our stack until we're back in
				// sync with the window.history
				this.pop(this.top.sidx - History.getWindowState().sidx);
			}
		}

		this.push({ title : passage.title, variables : clone(this.active.variables) });
		if (this.prng) {
			this.top.rcount = this.prng.count;
		}
		this.activate(this.top);
	}
	if ((updateHistory || config.disableHistoryControls) && config.historyMode !== HistoryMode.Hash) {
		if (DEBUG) { console.log("    > typeof History.getWindowState(): " + typeof History.getWindowState()); }
		var stateObj;
		switch (config.historyMode) {
		case HistoryMode.Session:
			stateObj = { suid : this.suid, sidx : this.active.sidx };
			break;
		case HistoryMode.Window:
			stateObj = { delta : this.getDeltaFromHistory() };
			if (this.hasOwnProperty("prng")) {
				stateObj.rseed = this.prng.seed;
			}
			break;
		}

		History[(!History.hasWindowState() || config.disableHistoryControls)
			? "replaceWindowState"
			: "addWindowState"
		](stateObj, windowTitle);
	}
	if (config.historyMode !== HistoryMode.Window) {
		this.save();
	}

	// clear <body> classes and execute the PassageReady passage
	if (updateDisplay) {
		if (document.body.className) {
			document.body.className = "";
		}
		if (tale.has("PassageReady")) {
			try {
				Wikifier.wikifyEval(tale.get("PassageReady").text);
			} catch (e) {
				technicalAlert("PassageReady", e.message);
			}
		}
	}

	// add it to the page
	var el = passage.render();
	el.style.visibility = "visible";
	if (updateDisplay) {
		var passages = document.getElementById("passages"),
			outgoing = passages.querySelector(".passage");
		if (
			   outgoing !== null
			&& (
				   typeof config.passageTransitionOut === "number"
				|| (typeof config.passageTransitionOut === "boolean" && config.passageTransitionOut && config.transitionEndEventName !== "")
			)
		) {
			outgoing.id = "out-" + outgoing.id;
			outgoing.classList.add("transition-out");
			if (typeof config.passageTransitionOut === "boolean") {
				$(outgoing).on(config.transitionEndEventName, function () {
					if (this.parentNode) { this.parentNode.removeChild(this); }
				});
			} else {
				setTimeout(function () {
					if (outgoing.parentNode) { outgoing.parentNode.removeChild(outgoing); }
				}, config.passageTransitionOut);  // in milliseconds
			}
		} else {
			removeChildren(passages);
		}
		el.classList.add("transition-in");
		passages.appendChild(el);
		setTimeout(function () { el.classList.remove("transition-in"); }, 1);

		if (config.displayPassageTitles && passage.title !== config.startPassage) {
			document.title = windowTitle;
		}

		if (config.historyMode === HistoryMode.Hash) {
			window.location.hash = this.hash;
		}

		window.scroll(0, 0);
	}

	// execute the PassageDone passage and update the non-passage page elements, if enabled
	if (updateDisplay) {
		if (tale.has("PassageDone")) {
			try {
				Wikifier.wikifyEval(tale.get("PassageDone").text);
			} catch (e) {
				technicalAlert("PassageDone", e.message);
			}
		}
		if (config.updatePageElements) {
			UISystem.setPageElements();
		}
	}

	// handle autosaves
	if (typeof config.saves.autosave !== "undefined") {
		switch (typeof config.saves.autosave) {
		case "boolean":
			if (config.saves.autosave) {
				SaveSystem.saveAuto();
			}
			break;
		case "string":
			if (passage.tags.contains(config.saves.autosave)) {
				SaveSystem.saveAuto();
			}
			break;
		case "object":
			if (Array.isArray(config.saves.autosave) && passage.tags.some(function (v) { return config.saves.autosave.contains(v); })) {
				SaveSystem.saveAuto();
			}
			break;
		}
	}

	return el;
};

History.prototype.regenerateSuid = function () {
	if (DEBUG) { console.log("[<History>.regenerateSuid()]"); }
	this.suid = Util.generateUuid();
	this.save();
};

History.prototype.restart = function () {
	if (DEBUG) { console.log("[<History>.restart()]"); }
	if (config.historyMode !== HistoryMode.Hash) {
		History.addWindowState(null, tale.title);  // using null here is deliberate
		window.location.reload();
	} else {
		window.location.hash = "";
	}
};

History.prototype.save = function () {
	if (DEBUG) { console.log("[<History>.save()]"); }
	var stateObj = { delta : this.getDeltaFromHistory() };
	if (this.hasOwnProperty("prng")) {
		stateObj.rseed = this.prng.seed;
	}
	if (config.historyMode === HistoryMode.Session) {
		if (DEBUG) { console.log("    > this.suid: " + this.suid); }
		session.setItem("history." + this.suid, stateObj);
	} else if (config.historyMode === HistoryMode.Hash) {
		this.hash = History.serializeWindowHashState(stateObj);
	}
};

History.prototype.restore = function (suid) {
	if (DEBUG) { console.log("[<History>.restore()]"); }
	if (config.historyMode === HistoryMode.Session) {
		if (suid) {
			this.suid = suid;
		} else {
			if (History.hasWindowState()) {
				this.suid = History.getWindowState().suid;
			} else {
				this.suid = Util.generateUuid();
			}
		}
		if (this.suid && session.hasItem("history." + this.suid)) {
			var stateObj = session.getItem("history." + this.suid),
				sidx     = History.getWindowState().sidx;
			if (DEBUG) { console.log("    > History.getWindowState(): " + History.getWindowState().sidx + " / " + History.getWindowState().suid); }
			if (DEBUG) { console.log("    > history." + this.suid + ": " + Util.serialize(stateObj)); }

			this.setHistoryFromDelta(stateObj.delta);
			if (this.hasOwnProperty("prng") && stateObj.hasOwnProperty("rseed")) {
				this.prng.seed = stateObj.rseed;
			}
			if (tale.has(this.history[sidx].title)) {
				this.display(this.history[sidx].title, null, "replace");
				return true;
			}
		}
	} else if (config.historyMode === HistoryMode.Window) {
		if (DEBUG) {
			console.log("    > typeof window.history: " + typeof window.history);
			console.log("    > typeof History.getWindowState(): " + typeof History.getWindowState());
		}
		if (History.hasWindowState()) {
			var windowState = History.getWindowState();
			this.setHistoryFromDelta(windowState.delta);
			if (this.hasOwnProperty("prng") && windowState.hasOwnProperty("rseed")) {
				this.prng.seed = windowState.rseed;
			}
		}
		if (!this.isEmpty && tale.has(this.top.title)) {
			this.display(this.top.title, null, "replace");
			return true;
		}
	} else {
		if (History.hasWindowHashState()) {
			if (DEBUG) {
				console.log("    > History.hasWindowHashState(): true");
				console.log("    > (!this.hash): " + !this.hash);
			}
			if (!this.hash) {
				// manually call the "hashchange" event handler to handle page reloads
				History.hashChangeHandler();
			}
			return true;
		}
	}
	return false;
};

History.serializeWindowState = function (obj) {
	return LZString.compressToUTF16(Util.serialize(obj));
};

History.deserializeWindowState = function (obj) {
	return Util.deserialize(LZString.decompressFromUTF16(obj));
};

History.addWindowState = function (obj, title, url) {
	// required by IE (if you pass undefined as the URL, IE will happily set it to that, so you must not pass it at all in that case)
	if (url != null) {  // use lazy equality
		window.history.pushState((obj != null) ? History.serializeWindowState(obj) : null, title, url);
	} else {
		window.history.pushState((obj != null) ? History.serializeWindowState(obj) : null, title);
	}
};

History.replaceWindowState = function (obj, title, url) {
	// required by IE (if you pass undefined as the URL, IE will happily set it to that, so you must not pass it at all in that case)
	if (url != null) {  // use lazy equality
		window.history.replaceState((obj != null) ? History.serializeWindowState(obj) : null, title, url);
	} else {
		window.history.replaceState((obj != null) ? History.serializeWindowState(obj) : null, title);
	}
};

History.hasWindowState = function (obj) {
	if (arguments.length === 0) { obj = window.history; }
	return obj.state != null;  // use lazy equality
};

History.getWindowState = function (obj) {
	if (arguments.length === 0) { obj = window.history; }
	return (obj.state != null) ? History.deserializeWindowState(obj.state) : null;  // use lazy equality
};

History.serializeWindowHashState = function (obj) {
	return "#" + (LZString.compressToBase64(Util.serialize(obj))
		.replace(/\+/g, "-").replace(/\//g, "_").replace(/=/g, ".")
	);
};

History.deserializeWindowHashState = function (obj) {
	return Util.deserialize(LZString.decompressFromBase64(obj.slice(1)
		.replace(/\-/g, "+").replace(/_/g, "/").replace(/\./g, "=")
	));
};

History.hasWindowHashState = function (hash) {
	if (arguments.length === 0) { hash = window.location.hash; }
	return (hash !== "" && hash !== "#");
};

History.getWindowHashState = function (hash) {
	if (arguments.length === 0) { hash = window.location.hash; }
	return (hash !== "" && hash !== "#") ? History.deserializeWindowHashState(hash) : null;
};

History.popStateHandler_Session = function (evt) {
	if (DEBUG) {
		console.log("[History.popStateHandler_Session()]");
		if (!History.hasWindowState(evt)) { console.log("    > evt.state: null; no-op"); }
	}

	// no-op if state is null
	if (!History.hasWindowState(evt)) { return; }

	// close any open UI dialog
	if (UISystem.isOpen()) { UISystem.close(); }

	var windowState = History.getWindowState(evt);

	// update the history stack if necessary
	if (windowState.suid !== state.suid) {
		if (DEBUG) { console.log("    > state from previous history detected, swapping in history"); }
		state.save();
		state.restore(windowState.suid);
	}

	state.display(state.activate(windowState.sidx).title, null, "replace");
};

History.popStateHandler_Window = function (evt) {
	if (DEBUG) {
		console.log("[History.popStateHandler_Window()]");
		if (!History.hasWindowState(evt)) { console.log("    > evt.state: null; no-op"); }
	}

	// no-op if state is null
	if (!History.hasWindowState(evt)) { return; }

	// close any open UI dialog
	if (UISystem.isOpen()) { UISystem.close(); }

	var windowState = History.getWindowState(evt);

	// throw error if state has no history or history is empty
	if (!windowState.hasOwnProperty("delta") || windowState.delta.length === 0) {
		throw new Error("window state has no history or history is empty");
	}

	//state.history = windowState.history;
	state.setHistoryFromDelta(windowState.delta);
	if (state.hasOwnProperty("prng") && windowState.hasOwnProperty("rseed")) {
		state.prng.seed = windowState.rseed;
	}
	state.display(state.activate(state.top).title, null, "replace");
};

History.hashChangeHandler = function (evt) {
	if (DEBUG) {
		console.log("[History.hashChangeHandler()]");
		//console.log("    > evt:", evt);
		if (window.location.hash === state.hash) {
			console.log("    > noop (window.location.hash === state.hash)");
		} else {
			console.log("    > process hash (window.location.hash !== state.hash)");
		}
		//console.log("    > window.location.hash:", window.location.hash);
		//console.log("    > state.hash:", state.hash);
	}

	// no-op if hashes match
	if (window.location.hash === state.hash) { return; }

	if (History.hasWindowHashState()) {
		// close any open UI dialog
		if (UISystem.isOpen()) { UISystem.close(); }

		var hashState = History.getWindowHashState();
//console.log("hashState:", hashState);

		// throw error if state has no history or history is empty
		if (!hashState.hasOwnProperty("delta") || hashState.delta.length === 0) {
			throw new Error("hash state has no history or history is empty");
		}

		state.setHistoryFromDelta(hashState.delta);
		if (state.hasOwnProperty("prng") && hashState.hasOwnProperty("rseed")) {
			state.prng.seed = hashState.rseed;
		}
		state.display(state.activate(state.top).title, null, "replace");
	} else {
console.log("**** ALERT! ALERT! DANGER, WILL ROBINSON! DANGER! ****  (window.location.hash !== state.hash && !History.hasWindowHashState())");
console.log("    > window.location.hash:", window.location.hash);
console.log("    > state.hash:", state.hash);
		window.location.reload();
	}
	if (window.location.hash !== state.hash) {
console.log("**** ASSIGNING window.location.hash TO state.hash ****  (window.location.hash !== state.hash)");
		state.hash = window.location.hash;
	}
};

History.initPRNG = function (seed, useEntropy) {
	if (DEBUG) { console.log("[History.initPRNG()]"); }

	runtime.flags.HistoryPRNG.isEnabled = true;
	state.prng = new SeedablePRNG(seed, useEntropy);
	state.active.rcount = state.prng.count;

	if (!runtime.flags.HistoryPRNG.isMathPRNG) {
		runtime.flags.HistoryPRNG.isMathPRNG = true;
		Math.random = function () {
			if (DEBUG) { console.log("**** Math.random() -> state.prng.random() ****"); }
			return state.prng.random();
		};
	}
};

History.deltaEncodeHistory = function (hist) {
	if (!Array.isArray(hist)) { return null; }
	if (hist.length === 0) { return []; }

	var delta = [ clone(hist[0]) ];
	for (var i = 1, len = hist.length; i < len; i++) {
		delta.push(Util.diff(hist[i-1], hist[i]));
	}
	return delta;
};

History.deltaDecodeHistory = function (delta) {
	if (!Array.isArray(delta)) { return null; }
	if (delta.length === 0) { return []; }

	var hist = [ clone(delta[0]) ];
	for (var i = 1, len = delta.length; i < len; i++) {
		hist.push(Util.patch(hist[i-1], delta[i]));
	}
	return hist;
};

History.marshal = function () {
	if (DEBUG) { console.log("[History.marshal()]"); }

	var stateObj = {
		mode : config.historyMode
	};
	if (state.hasOwnProperty("prng")) {
		stateObj.rseed = state.prng.seed;
	}
	switch (config.historyMode) {
	case HistoryMode.Session:
		stateObj.delta = state.getDeltaFromHistory(state.active.sidx + 1);
		break;
	default:
		stateObj.delta = state.getDeltaFromHistory();
		break;
	}

	return stateObj;
};

History.unmarshal = function (stateObj) {
	if (DEBUG) { console.log("[History.unmarshal()]"); }

	if (!stateObj || !stateObj.hasOwnProperty("mode") || !(stateObj.hasOwnProperty("history") || stateObj.hasOwnProperty("delta"))) {
		throw new Error("state object is missing required data");
	}
	if (stateObj.mode !== config.historyMode) {
		throw new Error("state object is from an incompatible history mode");
	}

	// necessary?
	document.title = tale.title;

	// reset the history
	state = new History();
	if (runtime.flags.HistoryPRNG.isEnabled) {
		History.initPRNG(stateObj.hasOwnProperty("rseed") ? stateObj.rseed : null);
	}
	if (config.historyMode === HistoryMode.Session) {
		state.regenerateSuid();
		//if (DEBUG) { console.log("    > [History.unmarshal()] this.suid: " + state.suid); }
	}

	// load the state history from the save
	var hasDelta = false;
	if (stateObj.hasOwnProperty("delta")) {
		state.history = clone(History.deltaDecodeHistory(stateObj.delta));
		hasDelta = true;
	} else {
		state.history = clone(stateObj.history);
	}

	if (config.historyMode !== HistoryMode.Hash) {
		// restore the window history states in order
		for (var i = 0, len = state.history.length; i < len; i++) {
			if (DEBUG) { console.log("    > loading state into window history: " + i + " (" + state.history[i].title + ")"); }

			// load the state into the window history
			if (!config.disableHistoryControls) {
				var windowState,
					windowTitle = (config.displayPassageTitles && state.history[i].title !== config.startPassage)
						? tale.title + ": " + state.history[i].title
						: tale.title;
				switch (config.historyMode) {
				case HistoryMode.Session:
					windowState = { suid : state.suid, sidx : state.history[i].sidx };
					break;
				case HistoryMode.Window:
					if (hasDelta) {
						windowState = { delta : stateObj.delta.slice(0, i + 1) };
					} else {
						windowState = { delta : state.getDeltaFromHistory(i + 1) };
					}
					if (state.hasOwnProperty("prng")) {
						windowState.rseed = state.prng.seed;
					}
					break;
				}
				History.addWindowState(windowState, windowTitle);
			}
		}
	} else {
		/* FIXME: noop? */
	}

	// activate the current top and display the passage
	state.activate(state.top);
	state.display(state.active.title, null, "replace");
};


/***********************************************************************************************************************
** [Passage]
***********************************************************************************************************************/
function Passage(title, el, order) {
	this.title = title;
	if (el) {
		this.id          = order;
		this.domId       = "passage-" + Util.slugify(this.title);
		this.text        = Passage.unescapeLineBreaks(el.firstChild ? el.firstChild.nodeValue : "");
		this.textExcerpt = Passage.getExcerptFromText(this.text);
		this.tags        = el.hasAttribute("tags") ? el.getAttribute("tags").trim() : "";
		if (this.tags) {
			this.tags      = this.tags.split(/\s+/);  // readBracketedList();
			this.classes   = [];
			this.className = "";

			// add tags as classes
			if (this.tags.length > 0) {
				// tags to skip transforming into classes
				//     "debug"        : special tag
				//     "nobr"         : special tag
				//     "passage"      : the default class
				//     "script"       : special tag
				//     "stylesheet"   : special tag
				//     "widget"       : special tag
				//     "twine.*"      : special tag (in theory, anyway)
				//  ?? "twinequest.*" : private use tag
				//  ?? "tq.*"         : private use tag, AFAIK shorthand form of twinequest.*
				var tagsToSkip = /^(?:debug|nobr|passage|script|stylesheet|widget|twine\.\w*)$/i;

				var tagClasses = [];
				for (var i = 0; i < this.tags.length; i++) {
					var tag = this.tags[i].toLowerCase();
					if (!tagsToSkip.test(tag)) {
						tagClasses.push(Util.slugify(tag));
					}
				}
				if (tagClasses.length > 0) {
					if (el.className) {
						tagClasses = tagClasses.concat(el.className.split(/\s+/));
					}
					// sort and filter out non-uniques
					tagClasses = tagClasses.sort().filter(function (val, i, aref) { return (i === 0 || aref[i-1] !== val); });

					this.classes   = tagClasses;
					this.className = tagClasses.join(' ');
				}
			}
		} else {
			this.tags      = [];
			this.classes   = [];
			this.className = "";
		}
	} else {
		this.text      = String.format('<span class="error" title="{0}">Error: this passage does not exist: {0}</span>',
							this.title.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;"));
		this.tags      = [];
		this.classes   = [];
		this.className = "";
	}
}

Passage.prototype.processText = function () {
	var res = this.text;

	if (this.tags.contains("nobr")) {
		res = res.replace(/\n/g, " ");
	}
	// check for Twine 1.4 Base64 image passage transclusion
	if (this.tags.contains("Twine.image")) {
		res = "[img[" + res + "]]";
	}
	return res;
};

Passage.prototype.render = function () {
	if (DEBUG) { console.log("[<Passage>.render()]"); }

	// create the new passage element
	var passage = insertElement(null, "section", this.domId, "passage");
	passage.setAttribute("data-passage", this.title);
	passage.style.visibility = "hidden";

	// add classes (generated from tags) to the passage and <body>
	for (var i = 0, len = this.classes.length; i < len; i++) {
		document.body.classList.add(this.classes[i]);
		passage.classList.add(this.classes[i]);
	}

	// add the passage header, content, and footer elements
	insertElement(passage, "header", null, "header");
	var content = insertElement(passage, "div", null, "body content");
	insertElement(passage, "footer", null, "footer");

	// execute pre-render tasks
	for (var task in prerender) {
		if (typeof prerender[task] === "function") { prerender[task].call(this, content, task); }
	}

	// wikify the passage into the content element
	new Wikifier(content, this.processText());

	// execute post-render tasks
	for (var task in postrender) {
		if (typeof postrender[task] === "function") { postrender[task].call(this, content, task); }
	}

	// update the excerpt cache to reflect the rendered text
	this.textExcerpt = Passage.getExcerptFromNode(content);

	return passage;
};

Passage.prototype.reset = function () {
	/**
	 * This method should never be called, so this code is largely redundant
	 *   n.b. <Tale>.reset() does call this method, but nothing calls it, so...
	 */
	var store = document.getElementById("store-area").childNodes;
	for (var i = 0; i < store.length; i++) {
		var el = store[i],
			tiddlerTitle;
		if (el.getAttribute && (tiddlerTitle = el.getAttribute("tiddler"))) {
			if (this.title === tiddlerTitle) {
				this.text = Passage.unescapeLineBreaks(el.firstChild ? el.firstChild.nodeValue : "");
				return;
			}
		}
	}
	this.text = "<html><span class=\"error\">Error: this passage does not exist</span></html>";
};

Passage.prototype.excerpt = function () {
	return this.textExcerpt;
};

Passage.getExcerptFromText = function (text, count) {
	var pattern = new RegExp("(\\S+(?:\\s+\\S+){0," + (typeof count !== 'undefined' ? count - 1 : 7) + "})"),
		result  = text
			// strip macro tags (replace with a space)
			.replace(/<<.*?>>/g, " ")
			// strip html tags (replace with a space)
			.replace(/<.*?>/g, " ")
			// the above might have left problematic whitespace, so trim
			.trim()
			// strip wiki tables
			.replace(/^\s*\|.*\|.*?$/gm, "")
			// strip wiki images
			.replace(/\[[<>]?img\[[^\]]*\]\]/g, "")
			// clean wiki links, i.e. remove all but the pretty link text
			.replace(/\[\[([^|\]]*)(?:|[^\]]*)?\]\]/g, "$1")
			// clean wiki !headings
			.replace(/^\s*!+(.*?)$/gm, "$1")
			// clean wiki bold/italic/underline/highlight formatting
			.replace(/\'{2}|\/{2}|_{2}|@{2}/g, "")
			// compact remaining whitespace
			.replace(/\s+/g, " ")
			// a final trim
			.trim()
			// lastly, match the excerpt
			.match(pattern);
	return (result ? result[1] + "\u2026" : "\u2026");
};

Passage.getExcerptFromNode = function (node, count) {
	function getTextFromNode(node) {
		if (!node.hasChildNodes()) { return ""; }

		var nodes  = node.childNodes,
			output = "";

		for (var i = 0, len = nodes.length; i < len; i++) {
			switch (nodes[i].nodeType) {
			case 1:  // element nodes
				if (nodes[i].style.display !== "none") {
					output += " ";  // out here to handle void nodes, in addition to child bearing nodes
					if (nodes[i].hasChildNodes()) {
						output += getTextFromNode(nodes[i]);
					}
				}
				break;
			case 3:  // text nodes
				output += nodes[i].textContent;
				break;
			default:
				if (DEBUG) { console.log(" ~> nodes[" + i + "].nodeType: " + nodes[i].nodeType); }
				break;
			}
		}
		return output;
	}

	if (!node.hasChildNodes()) { return ""; }

	var excerptRe = new RegExp("(\\S+(?:\\s+\\S+){0," + (typeof count !== 'undefined' ? count - 1 : 7) + "})"),
		excerpt   = getTextFromNode(node).trim();

	if (excerpt) {
		excerpt = excerpt
			// compact whitespace
			.replace(/\s+/g, " ")
			// attempt to match the excerpt regexp
			.match(excerptRe);
	}
	return (excerpt ? excerpt[1] + "\u2026" : "\u2026");
};

Passage.unescapeLineBreaks = function (text) {
	if (text && text !== "") {
		return text
			.replace(/\\n/gm, '\n')
			.replace(/\\t/gm, '\t')     // Twine 1.4.1 "feature"
			.replace(/\\s|\\/gm, '\\')  // "\\s" is required to workaround a Twine "feature"
			.replace(/\r/gm, "");
	}
	return "";
};

/* DEPRECATED */
Passage.mergeClassNames = function (/* variadic */) {
	if (arguments.length == 0) { return ""; }

	var classes = [];
	for (var i = 0; i < arguments.length; i++) {
		if (typeof arguments[i] === "object" && Array.isArray(arguments[i])) {
			classes = classes.concat(arguments[i]);
		} else if (typeof arguments[i] === "string") {
			classes = classes.concat(arguments[i].split(/\s+/));
		}
	}
	if (classes.length > 0) {
		// return a string of sorted, and unique, class names
		return classes.sort().filter(function (v, i, a) { return (i === 0 || a[i-1] !== v); }).join(' ');
	}
	return "";
};


/***********************************************************************************************************************
** [Tale]
***********************************************************************************************************************/
function Tale(instanceName) {
	if (DEBUG) { console.log("[Tale()]"); }

	this.passages = {};
	// Chrome breaks some data URIs if you don't normalize
	if (document.normalize) {
		document.normalize();
	}
	var store = document.getElementById("store-area").childNodes;

	for (var i = 0; i < store.length; i++) {
		var el = store[i],
			tiddlerTitle;
		if (el.getAttribute && (tiddlerTitle = el.getAttribute("tiddler"))) {
			this.passages[tiddlerTitle] = new Passage(tiddlerTitle, el, i);
		}
	}

	if (this.passages.hasOwnProperty("StoryTitle")) {
		var buf = document.createElement("div");
		new Wikifier(buf, this.passages.StoryTitle.processText().trim());
		this.setTitle(buf.textContent);
	} else {
		this.setTitle("ePDO");
	}

	// update instance reference in SugarCube global object
	window.SugarCube[instanceName || "tale"] = this;
}

Tale.prototype.setTitle = function (title) {
	this.title = document.title = title;
	this.domId = Util.slugify(title);
};

Tale.prototype.has = function (key) {
	if (typeof key === "string") {
		return this.passages[key] != null;  // use lazy equality
	} else if (typeof key === "number") {
		for (var pname in this.passages) {
			if (this.passages[pname].id === key) {
				return true;
			}
		}
	}
	return false;
};

Tale.prototype.get = function (key) {
	if (typeof key === "string") {
		return this.passages[key] || new Passage(key);
	} else if (typeof key === "number") {
		for (var pname in this.passages) {
			if (this.passages[pname].id === key) {
				return this.passages[pname];
			}
		}
	}
	return;  //FIXME: should this return null instead of undefined?
};

Tale.prototype.lookup = function (key, value, sortKey) {
	if (!sortKey) { sortKey = "title"; }
	var results = [];

	for (var pname in this.passages) {
		var passage = this.passages[pname];

		switch (typeof passage[key]) {
		case "undefined":
			/* noop */
			break;
		case "object":
			// currently, we assume that the only properties which are objects
			// will be either arrays or array-like-objects
			for (var i = 0; i < passage[key].length; i++) {
				if (passage[key][i] == value) {  // use lazy equality
					results.push(passage);
					break;
				}
			}
			break;
		default:
			if (passage[key] == value) {  // use lazy equality
				results.push(passage);
			}
			break;
		}
	}

	results.sort(function (a, b) { return (a[sortKey] == b[sortKey]) ? 0 : ((a[sortKey] < b[sortKey]) ? -1 : +1); });  // use lazy equality

	return results;
};

Tale.prototype.reset = function () {
	/**
	 * This method should never be called, so this code is largely redundant
	 */
	for (var i in this.passages) {
		this.passages[i].reset();
	}
};


/***********************************************************************************************************************
** [End story.js]
***********************************************************************************************************************/

/***********************************************************************************************************************
** [Begin wikifier.js]
***********************************************************************************************************************/

/***********************************************************************************************************************
** [Initialization]
***********************************************************************************************************************/
function WikiFormatter(formatters) {
	this.formatters = [];
	this.byName     = {};
	var pattern     = [];

	for (var i = 0; i < formatters.length; i++) {
		pattern.push("(" + formatters[i].match + ")");
		this.formatters.push(formatters[i]);
		this.byName[formatters[i].name] = this.formatters[this.formatters.length - 1];
	}

	this.formatterRegExp = new RegExp(pattern.join("|"), "gm");
}

function Wikifier(place, source) {
	this.formatter = formatter;  // formatter comes from the top-level scope of the module
	this.output    = (place != null) ? place : document.createElement("div");  // use lazy equality
	this.source    = source;
	this.nextMatch = 0;
	this.nobr      = [];

	this.subWikify(this.output);

	if (place == null && typeof this.output["remove"] === "function") {
		this.output.remove();
	}
}

Wikifier.prototype.subWikify = function (output, terminator, terminatorIgnoreCase) {
	// Temporarily replace the output pointer
	var oldOutput = this.output;
	this.output = output;

	// Prepare the terminator RegExp
	var terminatorRegExp = terminator ? new RegExp("(" + terminator + ")", terminatorIgnoreCase ? "gim" : "gm") : null;

	var formatterMatch, terminatorMatch;
	do {
		// Prepare the RegExp match positions
		this.formatter.formatterRegExp.lastIndex = this.nextMatch;
		if (terminatorRegExp) {
			terminatorRegExp.lastIndex = this.nextMatch;
		}

		// Get the first matches
		formatterMatch = this.formatter.formatterRegExp.exec(this.source);
		terminatorMatch = terminatorRegExp ? terminatorRegExp.exec(this.source) : null;

		// Check for a terminator & formatter match
		if (terminatorMatch && (!formatterMatch || terminatorMatch.index <= formatterMatch.index)) {  // terminator match
			// Output any text before the match
			if (terminatorMatch.index > this.nextMatch) {
				this.outputText(this.output, this.nextMatch, terminatorMatch.index);
			}

			// Set the match parameters
			this.matchStart = terminatorMatch.index;
			this.matchLength = terminatorMatch[1].length;
			this.matchText = terminatorMatch[1];
			this.nextMatch = terminatorMatch.index + terminatorMatch[1].length;

			// Restore the output pointer and exit
			this.output = oldOutput;
			return;
		} else if (formatterMatch) {  // formatter match
			// Output any text before the match
			if (formatterMatch.index > this.nextMatch) {
				this.outputText(this.output, this.nextMatch, formatterMatch.index);
			}

			// Set the match parameters
			this.matchStart = formatterMatch.index;
			this.matchLength = formatterMatch[0].length;
			this.matchText = formatterMatch[0];
			this.nextMatch = this.formatter.formatterRegExp.lastIndex;

			// Figure out which formatter matched
			var matchingFormatter = -1;
			for (var i = 1; i < formatterMatch.length; i++) {
				if (formatterMatch[i]) {
					matchingFormatter = i - 1;
					break;  // stop once we've found the matching formatter
				}
			}

			// Call the formatter
			if (matchingFormatter !== -1) {
				this.formatter.formatters[matchingFormatter].handler(this);
				if (runtime.temp.break != null) { break; }  // use lazy equality
			}
		}
	} while (terminatorMatch || formatterMatch);

	if (runtime.temp.break == null) {  // use lazy equality
		// Output any text after the last match
		if ((this.nextMatch < this.source.length)) {
			this.outputText(this.output, this.nextMatch, this.source.length);
			this.nextMatch = this.source.length;
		}
	} else if (
		   this.output.lastChild
		&& this.output.lastChild.nodeType === 1 /* Element Node */
		&& this.output.lastChild.nodeName.toUpperCase() === "BR"
	) {
		// In case of <<break>>/<<continue>>, remove the last <br>
		removeElement(this.output.lastChild);
	}

	// Restore the output pointer
	this.output = oldOutput;
};

Wikifier.prototype.outputText = function (place, startPos, endPos) {
	insertText(place, this.source.substring(startPos, endPos));
};

/**
 * Meant to be called by macros, this returns the raw, unprocessed, text passed to the currently executing macro.
 * Unlike TiddlyWiki's default mechanism, this does not attempt to split up the arguments into an array.
 */
Wikifier.prototype.rawArgs = function () {
	return this._macroRawArgs;
};

/**
 * Meant to be called by macros, this returns the text passed to the currently executing macro after doing some
 * magic with certain Twine/Twee operators (like: eq, gt, and $variable).
 */
Wikifier.prototype.fullArgs = function () {
	return Wikifier.parse(this.rawArgs());
};

/**
 * Returns the passed string with all Twine/Twee operators converted to their JavaScript counterparts
 */
Wikifier.parse = function (expression) {
	// Double quoted | Single quoted | Empty quotes | Operator delimiters | Barewords & Sigil
	var re    = new RegExp("(?:(?:\"((?:(?:\\\\\")|[^\"])+)\")|(?:'((?:(?:\\\\\')|[^'])+)')|((?:\"\")|(?:''))|([=+\\-*\\/%<>&\\|\\^~!?:,;\\(\\)\\[\\]{}]+)|([^\"'=+\\-*\\/%<>&\\|\\^~!?:,;\\(\\)\\[\\]{}\\s]+))", "g"),
		match,
		map   = {
			// standard Twine/Twee operators
			"$"      : "state.active.variables.",
			"eq"     : "==",
			"neq"    : "!=",
			"gt"     : ">",
			"gte"    : ">=",
			"lt"     : "<",
			"lte"    : "<=",
			"and"    : "&&",
			"or"     : "||",
			"not"    : "!",
			// Twine2-compatible operators
			"is"     : "===",
			"is not" : "!==",
			"to"     : "=",
			// SugarCube operators
			"def"    : '"undefined" !== typeof',
			"ndef"   : '"undefined" === typeof'
		};

	while ((match = re.exec(expression)) !== null) {
		// noop: Double quoted | Single quoted | Empty quote | Operator delimiters

		// Barewords & Sigil
		if (match[5]) {
			var token = match[5];

			// special cases
			if (token === "$") {
				// if the token is "$", then it's the jQuery function alias or a naked dollar-sign, so skip over it
				continue;
			} else if (token[0] === "$") {
				// if the token starts with a "$", then it's a $variable, so just replace the sigil ("$")
				token = "$";
			} else if (token === "is") {
				// if the token is "is", check to see if it's part of the "is not" operator
				var start = match.index + token.length,
					part  = expression.slice(start);
				if (/^\s+not\b/.test(part)) {
					expression = expression.splice(start, part.search(/\S/), " ");
					token = "is not";
				}
			}

			// n.b. do not simply use "map[token]", otherwise tokens that match
			//      basic object properties will break the world (e.g. "toString")
			if (map.hasOwnProperty(token)) {
				expression = expression.splice(
					match.index,   // starting index
					token.length,  // replace how many
					map[token]     // replacement string
				);
				re.lastIndex += map[token].length - token.length;
			}
		}
	}
	return expression;
};

/**
 * Returns the value of the passed story $variable
 */
Wikifier.getValue = function (storyVar) {
	var pNames = Wikifier.parseStoryVariable(storyVar),
		retVal = undefined;

	if (pNames.length !== 0) {
		retVal = state.active.variables;
		for (var i = 0, len = pNames.length; i < len; i++) {
			if (typeof retVal[pNames[i]] !== "undefined") {
				retVal = retVal[pNames[i]];
			} else {
				retVal = undefined;
				break;
			}
		}
	}
	return retVal;
};

/**
 * Sets the value of the passed story $variable
 */
Wikifier.setValue = function (storyVar, newValue) {
	var pNames = Wikifier.parseStoryVariable(storyVar);

	if (pNames.length !== 0) {
		var baseObj = state.active.variables,
			varName = pNames.pop();
		for (var i = 0, len = pNames.length; i < len; i++) {
			if (typeof baseObj[pNames[i]] !== "undefined") {
				baseObj = baseObj[pNames[i]];
			} else {
				baseObj = undefined;
				break;
			}
		}
		if (baseObj !== undefined) {
			baseObj[varName] = newValue;
			return true;
		}
	}
	return false;
};

/**
 * Returns the property name chain of the passed story $variable, which may be of arbitrary complexity
 */
Wikifier.parseStoryVariable = function (varText) {
	var re     = /^(?:\$(\w+)|\.(\w+)|\[(?:(?:\"((?:\\.|[^\"\\])+)\")|(?:\'((?:\\.|[^\'\\])+)\')|(\$\w.*)|(\d+))\])/,
		match,
		pNames = [];

	while ((match = re.exec(varText)) !== null) {
		// Remove full match from varText
		varText = varText.slice(match[0].length);

		if (match[1]) {
			// Base variable
			pNames.push(match[1]);
		} else if (match[2]) {
			// Dot property
			pNames.push(match[2]);
		} else if (match[3]) {
			// Square-bracketed property (double quoted)
			pNames.push(match[3]);
		} else if (match[4]) {
			// Square-bracketed property (single quoted)
			pNames.push(match[4]);
		} else if (match[5]) {
			// Square-bracketed property (embedded $variable)
			pNames.push(Wikifier.getValue(match[5]));
		} else if (match[6]) {
			// Square-bracketed property (numeric index)
			pNames.push(Number(match[6]));
		}
	}
	return (varText === "") ? pNames : [];
};

/**
 * Evaluate the passed Twine expression and return the result, throwing if there were errors
 */
Wikifier.evalExpression = function (expression) {
	return Util.evalExpression(Wikifier.parse(expression));
};

/**
 * Evaluate the passed Twine statements and return the result, throwing if there were errors
 */
Wikifier.evalStatements = function (statements) {
	return Util.evalStatements(Wikifier.parse(statements));
};

/**
 * Wikify the passed text and discard the output, throwing if there were errors
 */
Wikifier.wikifyEval = function (text) {
	var errTrap = document.createDocumentFragment();
	try {
		new Wikifier(errTrap, text);
		while (errTrap.hasChildNodes()) {
			var fc = errTrap.firstChild;
			if (fc.classList && fc.classList.contains("error")) {
				throw new Error(fc.textContent);
			}
			errTrap.removeChild(fc);
		}
	} catch (e) {
		throw new Error(e.message.replace(/^Error:\s+/, ""));
	} finally {
		// probably unnecessary, but let's be tidy
		removeChildren(errTrap);  // remove any remaining children
	}
};

/**
 * Create and return an internal link
 */
Wikifier.createInternalLink = function (place, passage, text, callback) {
	var el = document.createElement("a");
	if (passage != null) {  // use lazy equality; 0 is a valid ID and name, so we cannot simply evaluate passage
		el.setAttribute("data-passage", passage);
		el.className = tale.has(passage) ? "link-internal" : "link-broken";
		$(el).click(function () {
			if (typeof callback === "function") { callback(); }
			state.display(passage, el);
		});
	}
	if (text) {
		insertText(el, text);
	}
	if (place) {
		place.appendChild(el);
	}
	return el;
};

/**
 * Create and return an external link
 */
Wikifier.createExternalLink = function (place, url, text) {
	var el = insertElement(place, "a", null, "link-external", text);
	el.target = "_blank";
	if (url != null) {  // use lazy equality
		el.href = url;
	}
	return el;
};

/**
 * Setup the basic text primitives (regular expressions)
 */
if (!((new RegExp("[\u0150\u0170]", "g")).test("\u0150"))) {
	Wikifier.textPrimitives = {
		/*
		  upperLetter     : "[A-Z\u00c0-\u00de]"
		, lowerLetter     : "[a-z0-9_\\-\u00df-\u00ff]"
		, anyLetter       : "[A-Za-z0-9_\\-\u00c0-\u00de\u00df-\u00ff]"
		, anyLetterStrict : "[A-Za-z0-9\u00c0-\u00de\u00df-\u00ff]"
		*/
		anyLetter : "[A-Za-z0-9_\\-\u00c0-\u00de\u00df-\u00ff]"
	};
} else {
	Wikifier.textPrimitives = {
		/*
		  upperLetter     : "[A-Z\u00c0-\u00de\u0150\u0170]"
		, lowerLetter     : "[a-z0-9_\\-\u00df-\u00ff\u0151\u0171]"
		, anyLetter       : "[A-Za-z0-9_\\-\u00c0-\u00de\u00df-\u00ff\u0150\u0170\u0151\u0171]"
		, anyLetterStrict : "[A-Za-z0-9\u00c0-\u00de\u00df-\u00ff\u0150\u0170\u0151\u0171]"
		*/
		anyLetter : "[A-Za-z0-9_\\-\u00c0-\u00de\u00df-\u00ff\u0150\u0170\u0151\u0171]"
	};
}
Wikifier.textPrimitives.emptyQuotes     = "((?:\"\")|(?:''))";
Wikifier.textPrimitives.doubleQuoted    = '(?:"((?:(?:\\\\")|[^"])+)")';
Wikifier.textPrimitives.singleQuoted    = "(?:'((?:(?:\\\\')|[^'])+)')";
Wikifier.textPrimitives.doubleBracketed = "(?:(\\[\\[(?:\\s|\\S)*?\\]\\]))";
Wikifier.textPrimitives.barewords       = "([^\"'`\\s]\\S*)";

Wikifier.textPrimitives.url      = "(?:file|https?|mailto|ftp|javascript|irc|news|data):[^\\s'\"]+(?:/|\\b)";
Wikifier.textPrimitives.link     = "\\[\\[\\s*(?:(.+?)\\s*\\|\\s*)?(~)?(.+?)\\s*\\](?:\\[\\s*(.+?)\\s*\\])?\\]";  // 1=(text), 2=(~), 3=link, 4=(set)
Wikifier.textPrimitives.image    = "\\[([<]?)([>]?)[Ii][Mm][Gg]\\[\\s*(?:(.+?)\\s*\\|\\s*)?([^\\|]+?)\\s*\\](?:\\[\\s*(~)?(.+?)\\s*\\])?(?:\\[\\s*(.+?)\\s*\\])?\\]";  // 1=(left), 2=(right), 3=(title), 4=source, 5=(~), 6=(link), 7=(set)
Wikifier.textPrimitives.macroArg = "(?:" + [
		Wikifier.textPrimitives.doubleQuoted,    // 1=double quoted
		Wikifier.textPrimitives.singleQuoted,    // 2=single quoted
		Wikifier.textPrimitives.emptyQuotes,     // 3=empty quotes
		Wikifier.textPrimitives.doubleBracketed, // 4=double square-bracketed
		Wikifier.textPrimitives.barewords        // 5=barewords
	].join("|") + ")";

/**
 * Setup helper functions for the formatters
 */
Wikifier.formatterHelpers = {
	charFormatHelper: function (w) {
		var b = insertElement(w.output, this.element);
		w.subWikify(b, this.terminator);
	},
	inlineCssHelper: function (w) {
		var styles = [],
			lookahead = "(?:(" + Wikifier.textPrimitives.anyLetter + "+)\\(([^\\)\\|\\n]+)(?:\\):))|(?:(" + Wikifier.textPrimitives.anyLetter + "+):([^;\\|\\n]+);)",
			lookaheadRegExp = new RegExp(lookahead, "gm");
		do {
			lookaheadRegExp.lastIndex = w.nextMatch;
			var lookaheadMatch = lookaheadRegExp.exec(w.source),
				gotMatch = lookaheadMatch && lookaheadMatch.index == w.nextMatch;
			if (gotMatch) {
				var s, v;
				if (lookaheadMatch[1]) {
					s = this.cssToDOMPropertyName(lookaheadMatch[1]);
					v = lookaheadMatch[2];
				} else {
					s = this.cssToDOMPropertyName(lookaheadMatch[3]);
					v = lookaheadMatch[4];
				}
				switch (s) {
				case "bgcolor":
					s = "backgroundColor";
					break;
				case "float":
					s = "cssFloat";
					break;
				}
				styles.push({ style: s, value: v });
				w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;
			}
		} while (gotMatch);
		return styles;
	},
	monospacedByLineHelper: function (w) {
		var lookaheadRegExp = new RegExp(this.lookahead, "gm");
		lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = lookaheadRegExp.exec(w.source);
		if (lookaheadMatch && lookaheadMatch.index === w.matchStart) {
			insertElement(w.output, "pre", null, null, lookaheadMatch[1]);
			w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;
		}
	},
	cssToDOMPropertyName: function (propertyName) {
		/**
		 * Returns a DOM property name for a CSS property, parsed from the string
		 */
		var parts = propertyName.split("-");
		if (parts.length > 1) {
			for (var i = 1; i < parts.length; i++) {
				parts[i] = parts[i].substr(0, 1).toUpperCase() + parts[i].substr(1);
			}
		}
		return parts.join("");
	},
	isExternalLink: function (link) {
		if (tale.has(link)) {
			return false;
		}

		var urlRegExp = new RegExp("^" + Wikifier.textPrimitives.url, "gim");
		if (urlRegExp.test(link) || /[\.\/\\#]/.test(link)) {
			return true;
		}
		return false;
	},
	evalExpressionBadResultRegExp: /\[(?:object(?:\s+[^\]]+)?|native\s+code)\]/,
	evalExpression: function (text) {
		var result;
		try {
			result = Wikifier.evalExpression(text);
			if (this.evalExpressionBadResultRegExp.test(result)) {
				result = text;
			}
		} catch (e) {
			result = text;
		}
		return result;
	},
	evalPassageId: function (passage) {
		if (passage != null && !tale.has(passage)) {  // use lazy equality; 0 is a valid ID and name, so we cannot simply evaluate passage
			passage = this.evalExpression(passage);
		}
		return passage;
	}
};

/**
 * Setup the wiki formatters
 */
Wikifier.formatters =
[  // Begin formatters

{
	name: "table",
	match: "^\\|(?:[^\\n]*)\\|(?:[fhck]?)$",
	lookahead: "^\\|([^\\n]*)\\|([fhck]?)$",
	rowTerminator: "\\|(?:[fhck]?)$\\n?",
	cellPattern: "(?:\\|([^\\n\\|]*)\\|)|(\\|[fhck]?$\\n?)",
	cellTerminator: "(?:\\x20*)\\|",
	rowTypes: { "c": "caption", "h": "thead", "": "tbody", "f": "tfoot" },
	handler: function (w) {
		var table           = insertElement(w.output, "table"),
			lookaheadRegExp = new RegExp(this.lookahead, "gm"),
			curRowType      = null,
			nextRowType,
			rowContainer,
			rowElement,
			prevColumns     = [],
			rowCount        = 0;
		w.nextMatch = w.matchStart;
		do {
			lookaheadRegExp.lastIndex = w.nextMatch;
			var lookaheadMatch = lookaheadRegExp.exec(w.source),
				matched        = lookaheadMatch && lookaheadMatch.index === w.nextMatch;
			if (matched) {
				nextRowType = lookaheadMatch[2];
				if (nextRowType === "k") {
					table.className = lookaheadMatch[1];
					w.nextMatch += lookaheadMatch[0].length + 1;
				} else {
					if (nextRowType !== curRowType) {
						rowContainer = insertElement(table, this.rowTypes[nextRowType]);
					}
					curRowType = nextRowType;
					if (curRowType === "c") {
						if (rowCount === 0) {
							rowContainer.setAttribute("align", "top");
						} else {
							rowContainer.setAttribute("align", "bottom");
						}
						w.nextMatch = w.nextMatch + 1;
						w.subWikify(rowContainer, this.rowTerminator);
					} else {
						rowElement = insertElement(rowContainer, "tr");
						this.rowHandler(w, rowElement, prevColumns);
					}
					rowCount++;
				}
			}
		} while (matched);
	},
	rowHandler: function (w, e, prevColumns) {
		var col          = 0,
			curColCount  = 1,
			cellRegExp   = new RegExp(this.cellPattern, "gm");
		do {
			cellRegExp.lastIndex = w.nextMatch;
			var cellMatch = cellRegExp.exec(w.source),
				matched   = cellMatch && cellMatch.index === w.nextMatch;
			if (matched) {
				if (cellMatch[1] === "~") {
					var last = prevColumns[col];
					if (last) {
						last.rowCount++;
						last.element.setAttribute("rowSpan", last.rowCount);
						last.element.setAttribute("rowspan", last.rowCount);
						last.element.valign = "center";
					}
					w.nextMatch = cellMatch.index + cellMatch[0].length-1;
				} else if (cellMatch[1] === ">") {
					curColCount++;
					w.nextMatch = cellMatch.index + cellMatch[0].length-1;
				} else if (cellMatch[2]) {
					w.nextMatch = cellMatch.index + cellMatch[0].length;
					break;
				} else {
					var spaceLeft  = false,
						spaceRight = false,
						cell;
					w.nextMatch++;
					var styles = Wikifier.formatterHelpers.inlineCssHelper(w);
					while (w.source.substr(w.nextMatch, 1) === " ") {
						spaceLeft = true;
						w.nextMatch++;
					}
					if (w.source.substr(w.nextMatch, 1) === "!") {
						cell = insertElement(e, "th");
						w.nextMatch++;
					} else {
						cell = insertElement(e, "td");
					}
					prevColumns[col] = { rowCount: 1, element: cell };
					var lastColCount   = 1,
						lastColElement = cell;
					if (curColCount > 1) {
						cell.setAttribute("colSpan", curColCount);
						cell.setAttribute("colspan", curColCount);
						curColCount = 1;
					}
					for (var i = 0; i < styles.length; i++) {
						cell.style[styles[i].style] = styles[i].value;
					}
					w.subWikify(cell, this.cellTerminator);
					if (w.matchText.substr(w.matchText.length - 2, 1) === " ") {
						spaceRight = true;
					}
					if (spaceLeft && spaceRight) {
						cell.align = "center";
					} else if (spaceLeft) {
						cell.align = "right";
					} else if (spaceRight) {
						cell.align = "left";
					}
					w.nextMatch = w.nextMatch - 1;
				}
				col++;
			}
		} while (matched);
	}
},

{
	name: "heading",
	match: "^!{1,6}",
	terminator: "\\n",
	handler: function (w) {
		w.subWikify(insertElement(w.output, "h" + w.matchLength), this.terminator);
	}
},

{
	name: "list",
	match: "^(?:(?:\\*+)|(?:#+))",
	lookahead: "^(?:(\\*+)|(#+))",
	terminator: "\\n",
	outerElement: "ul",
	itemElement: "li",
	handler: function (w) {
		var lookaheadRegExp = new RegExp(this.lookahead, "gm");
		w.nextMatch = w.matchStart;
		var placeStack = [w.output],
			curType    = null,
			newType,
			curLevel   = 0,
			newLevel,
			i;
		do {
			lookaheadRegExp.lastIndex = w.nextMatch;
			var lookaheadMatch = lookaheadRegExp.exec(w.source);
			var matched = lookaheadMatch && lookaheadMatch.index == w.nextMatch;
			if (matched) {
				if (lookaheadMatch[2]) {
					newType = "ol";
				} else {
					newType = "ul";
				}
				newLevel = lookaheadMatch[0].length;
				w.nextMatch += lookaheadMatch[0].length;
				if (newLevel > curLevel) {
					for (i = curLevel; i < newLevel; i++) {
						placeStack.push(insertElement(placeStack[placeStack.length - 1], newType));
					}
				} else if (newLevel < curLevel) {
					for (i = curLevel; i > newLevel; i--) {
						placeStack.pop();
					}
				} else if (newLevel == curLevel && newType != curType) {
					placeStack.pop();
					placeStack.push(insertElement(placeStack[placeStack.length - 1], newType));
				}
				curLevel = newLevel;
				curType = newType;
				var el = insertElement(placeStack[placeStack.length - 1], "li");
				w.subWikify(el, this.terminator);
			}
		} while (matched);
	}
},

{
	name: "quoteByBlock",
	match: "^<<<\\n",
	terminator: "^<<<\\n",
	handler: function (w) {
		var el = insertElement(w.output, "blockquote");
		w.subWikify(el, this.terminator);
	}
},

{
	name: "quoteByLine",
	match: "^>+",
	terminator: "\\n",
	element: "blockquote",
	handler: function (w) {
		var lookaheadRegExp = new RegExp(this.match, "gm"),
			placeStack      = [w.output],
			curLevel        = 0,
			newLevel        = w.matchLength,
			i;
		do {
			if (newLevel > curLevel) {
				for (i = curLevel; i < newLevel; i++) {
					placeStack.push(insertElement(placeStack[placeStack.length - 1], this.element));
				}
			} else {
				if (newLevel < curLevel) {
					for (i = curLevel; i > newLevel; i--) {
						placeStack.pop();
					}
				}
			}
			curLevel = newLevel;
			w.subWikify(placeStack[placeStack.length - 1], this.terminator);
			insertElement(placeStack[placeStack.length - 1], "br");
			lookaheadRegExp.lastIndex = w.nextMatch;
			var lookaheadMatch = lookaheadRegExp.exec(w.source);
			var matched = lookaheadMatch && lookaheadMatch.index == w.nextMatch;
			if (matched) {
				newLevel = lookaheadMatch[0].length;
				w.nextMatch += lookaheadMatch[0].length;
			}
		} while (matched);
	}
},

{
	name: "rule",
	match: "^----+$\\n?|<hr ?/?>\\n?",
	handler: function (w) {
		insertElement(w.output, "hr");
	}
},

{
	name: "monospacedByLine",
	match: "^\\{\\{\\{\\n",
	lookahead: "^\\{\\{\\{\\n((?:^[^\\n]*\\n)+?)(^\\}\\}\\}$\\n?)",
	handler: Wikifier.formatterHelpers.monospacedByLineHelper
},

{
	name: "prettyLink",
	match: "\\[\\[",
	lookaheadRegExp: /(\[\[(?:\s|\S)*?\]\])/gm,
	handler: function (w) {
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if (lookaheadMatch && lookaheadMatch.index === w.matchStart) {
			var re    = new RegExp("^" + Wikifier.textPrimitives.link + "$"),
				match = re.exec(lookaheadMatch[0]);
			if (match !== null) {
				// 1=(text), 2=(~), 3=link, 4=(set)
				w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;

				var link  = Wikifier.formatterHelpers.evalPassageId(match[3]),
					text  = match[1] ? Wikifier.formatterHelpers.evalExpression(match[1]) : link,
					setFn = match[4]
						? function (ex) { return function () { Wikifier.evalStatements(ex); }; }(Wikifier.parse(match[4]))
						: null;
				if (!match[2] && Wikifier.formatterHelpers.isExternalLink(link)) {
					Wikifier.createExternalLink(w.output, link, text)
				} else {
					Wikifier.createInternalLink(w.output, link, text, setFn);
				}

			}
		}
	}
},

{
	name: "urlLink",
	match: Wikifier.textPrimitives.url,
	handler: function (w) {
		var el = Wikifier.createExternalLink(w.output, w.matchText);
		w.outputText(el, w.matchStart, w.nextMatch);
	}
},

{
	name: "image",
	match: "\\[[<>]?[Ii][Mm][Gg]\\[",
	lookaheadRegExp: /(\[[<>]?[Ii][Mm][Gg]\[(?:\s|\S)*?\]\])/gm,
	handler: function (w) {
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if (lookaheadMatch && lookaheadMatch.index === w.matchStart) {
			var re    = new RegExp("^" + Wikifier.textPrimitives.image + "$"),
				match = re.exec(lookaheadMatch[0]);
			if (match !== null) {
				// 1=(left), 2=(right), 3=(title), 4=source, 5=(~), 6=(link), 7=(set)
				w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;

				var el     = w.output,
					setFn  = match[7]
						? function (ex) { return function () { Wikifier.evalStatements(ex); }; }(Wikifier.parse(match[7]))
						: null,
					source;
				if (match[6]) {
					var link = Wikifier.formatterHelpers.evalPassageId(match[6]);
					if (!match[5] && Wikifier.formatterHelpers.isExternalLink(link)) {
						el = Wikifier.createExternalLink(el, link);
					} else {
						el = Wikifier.createInternalLink(el, link, null, setFn);
					}
					el.classList.add("link-image");
				}
				el = insertElement(el, "img");
				source = Wikifier.formatterHelpers.evalPassageId(match[4]);
				// check for Twine 1.4 Base64 image passage transclusion
				if (source.slice(0, 5) !== "data:" && tale.has(source)) {
					var passage = tale.get(source);
					if (passage.tags.contains("Twine.image")) {
						el.setAttribute("data-passage", passage.title);
						source = passage.text;
					}
				}
				el.src = source;
				if (match[3]) {
					el.title = Wikifier.formatterHelpers.evalExpression(match[3]);
				}
				if (match[1]) {
					el.align = "left";
				} else if (match[2]) {
					el.align = "right";
				}
			}
		}
	}
},

{
	name: "macro",
	match: "<<",
	lookaheadRegExp: /<<([^>\s]+)(?:\s*)((?:(?:\"(?:\\.|[^\"\\])*\")|(?:\'(?:\\.|[^\'\\])*\')|[^>]|(?:>(?!>)))*)>>/gm,
	working: { name: "", handlerName: "", arguments: "", index: 0 },  // the working parse object
	context: null,  // last execution context object (top-level macros, hierarchically, have a null context)
	handler: function (w) {
		var matchStart = this.lookaheadRegExp.lastIndex = w.matchStart;
		if (this.parseTag(w)) {
			// if parseBody() is called below, it will change the current working
			// values, so we must cache them now
			var nextMatch   = w.nextMatch,
				macroName   = this.working.name,
				handlerName = this.working.handlerName,
				macroArgs   = this.working.arguments;
			try {
				var macro = macros.get(macroName);
				if (macro) {
					var payload = null;
					if (macro.hasOwnProperty("tags")) {
						payload = this.parseBody(w, macro.tags);
						if (!payload) {
							w.nextMatch = nextMatch;  // parseBody() changes this during processing, so we reset it here
							return throwError(w.output, "cannot find a closing tag for macro <<" + macroName + ">>"
								, w.source.slice(matchStart, w.nextMatch) + "\u2026");
						}
					}
					if (typeof macro[handlerName] === "function") {
						var args = (!macro.hasOwnProperty("skipArgs") || !macro["skipArgs"]) ? this.parseArgs(macroArgs) : [];

						// new-style macros
						if (macro.hasOwnProperty("_USE_MACROS_API")) {
							var prevContext = this.context,
								curContext  = {  // setup the execution context object (should probably make a factory for this)
									// data properties
									"self"    : macro,
									"name"    : macroName,
									"args"    : args,
									"payload" : payload,
									"output"  : w.output,
									"parser"  : w,
									"context" : this.context,

									// method properties
									"contextHas": function (filter) {
										var c = this;

										while ((c = c.context) !== null) {
											if (filter(c)) { return true; }
										}
										return false;
									},
									"contextSelect": function (filter) {
										var c   = this,
											res = [];

										while ((c = c.context) !== null) {
											if (filter(c)) { res.push(c); }
										}
										return res;
									},
									"error": function (message) {
										throwError(this.output, "<<" + this.name + ">>: " + message, w.source.slice(matchStart, w.nextMatch));
										return false;
									}
								};
							// extend the args array with the raw and full argument strings
							curContext.args["raw"]  = macroArgs;
							curContext.args["full"] = Wikifier.parse(macroArgs);

							// call the handler, modifying the execution context chain appropriately
							//   n.b. there's no catch clause because this try/finally is here simply to ensure that
							//        the execution context is properly restored in the event that an uncaught exception
							//        is thrown during the handler call
							try {
								this.context = curContext;
								macro[handlerName].call(curContext);
							} finally {
								this.context = prevContext;
							}
						}
						// old-style macros
						else {
							w._macroRawArgs = macroArgs;  // cache the raw arguments for use by Wikifier.rawArgs() & Wikifier.fullArgs()
							macro[handlerName](w.output, macroName, args, w, payload);
							w._macroRawArgs = "";
						}
					} else {
						return throwError(w.output, "macro <<" + macroName + '>> handler function "' + handlerName + '" '
							+ (macro.hasOwnProperty(handlerName) ? "is not a function" : "does not exist"), w.source.slice(matchStart, w.nextMatch));
					}
				} else if (macros.tags.hasOwnProperty(macroName)) {
					return throwError(w.output, "child tag <<" + macroName + ">> was found outside of a call to its parent macro"
						+ (macros.tags[macroName].length === 1 ? '' : 's') + " <<" + macros.tags[macroName].join(">>, <<") + ">>",
						  w.source.slice(matchStart, w.nextMatch));
				} else {
					return throwError(w.output, "macro <<" + macroName + ">> does not exist", w.source.slice(matchStart, w.nextMatch));
				}
			} catch (e) {
				return throwError(w.output, "cannot execute " + ((macro && macro.isWidget) ? "widget" : "macro") + " <<" + macroName + ">>: " + e.message,
					w.source.slice(matchStart, w.nextMatch));
			} finally {
				this.working.name        = "";
				this.working.handlerName = "";
				this.working.arguments   = "";
				this.working.index       = 0;
			}
		}
	},
	parseTag: function (w) {
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if (lookaheadMatch && lookaheadMatch.index === w.matchStart && lookaheadMatch[1]) {
			w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;
			this.lookaheadRegExp.lastIndex = w.nextMatch;

			var fnSigil = lookaheadMatch[1].indexOf("::");
			if (fnSigil !== -1) {
				this.working.name = lookaheadMatch[1].slice(0, fnSigil);
				this.working.handlerName = lookaheadMatch[1].slice(fnSigil + 2);
			} else {
				this.working.name = lookaheadMatch[1];
				this.working.handlerName = "handler";
			}
			this.working.arguments = lookaheadMatch[2];
			this.working.index = lookaheadMatch.index;

			return true;
		}
		return false;
	},
	parseBody: function (w, tags) {
		var openTag      = this.working.name,
			closeTag     = "/" + openTag,
			closeAlt     = "end" + openTag,
			bodyTags     = Array.isArray(tags) ? tags : false,
			end          = -1,
			opened       = 1,
			curTag       = this.working.name,
			curArgument  = this.working.arguments,
			contentStart = w.nextMatch,
			payload      = [];

		while (
			   (w.matchStart = w.source.indexOf("<<", w.nextMatch)) !== -1
			&& this.parseTag(w)
		) {
			var tagName  = this.working.name,
				tagArgs  = this.working.arguments,
				tagBegin = this.working.index,
				tagEnd   = w.nextMatch;

			switch (tagName) {
			case openTag:
				opened++;
				break;

			case closeAlt:
				/* FALL-THROUGH */
			case closeTag:
				opened--;
				break;

			default:
				if (opened === 1 && bodyTags) {
					for (var i = 0, len = bodyTags.length; i < len; i++) {
						if (tagName === bodyTags[i]) {
							payload.push({
								name      : curTag,
								arguments : curArgument,
								contents  : w.source.slice(contentStart, tagBegin)
							});
							curTag       = tagName;
							curArgument  = tagArgs;
							contentStart = tagEnd;
						}
					}
				}
				break;
			}
			if (opened === 0) {
				payload.push({
					name      : curTag,
					arguments : curArgument,
					contents  : w.source.slice(contentStart, tagBegin)
				});
				end = tagEnd;
				break;
			}
		}

		if (end !== -1) {
			w.nextMatch = end;
			return payload;
		}
		return null;
	},
	parseArgs: function (str) {
		// Groups: 1=double quoted | 2=single quoted | 3=empty quotes | 4=double square-bracketed | 5=barewords
		var re    = new RegExp(Wikifier.textPrimitives.macroArg, "gm"),
			match,
			args  = [];

		while ((match = re.exec(str)) !== null) {
			var arg;

			if (match[1]) {
				// Double quoted
				arg = match[1];
			} else if (match[2]) {
				// Single quoted
				arg = match[2];
			} else if (match[3]) {
				// Empty quotes
				arg = "";
			} else if (match[4]) {
				// Double square-bracketed
				arg = match[4];

				// Convert to an object
				var linkRe    = new RegExp(Wikifier.textPrimitives.link),
					linkMatch = linkRe.exec(arg),
					linkObj   = {};
				if (linkMatch !== null) {
					// 1=(text), 2=(~), 3=link, 4=(set)
					linkObj.count      = linkMatch[1] ? 2 : 1;
					linkObj.link       = Wikifier.formatterHelpers.evalPassageId(linkMatch[3]);
					linkObj.text       = linkMatch[1] ? Wikifier.formatterHelpers.evalExpression(linkMatch[1]) : linkObj.link;
					linkObj.isExternal = !linkMatch[2] && Wikifier.formatterHelpers.isExternalLink(linkObj.link);
					linkObj.setFn      = linkMatch[4]
						? function (ex) { return function () { Wikifier.evalStatements(ex); }; }(Wikifier.parse(linkMatch[4]))
						: null;
					arg = linkObj;
				}
			} else if (match[5]) {
				// Barewords
				arg = match[5];

				if (/^\$\w+/.test(arg)) {
					// $variable, so substitute its value
					arg = Wikifier.getValue(arg);
				} else if (/^(?:options|setup)[\.\[]/.test(arg)) {
					// options or setup object, so try to evaluate it
					try {
						arg = Wikifier.evalExpression(arg);
					} catch (e) {
						throw new Error('unable to parse macro argument "' + arg + '": ' + e.message);
					}
				} else if (/^(?:\{.*\}|\[.*\])$/.test(arg)) {
					// Object or Array literal, so try to evaluate it
					//   n.b. Authors really shouldn't be passing object/array literals as arguments.  If they want to
					//        pass a complex type, then store it in a variable and pass that instead.
					try {
						arg = Wikifier.evalExpression(arg);
					} catch (e) {
						throw new Error('unable to parse macro argument "' + arg + '": ' + e.message);
					}
				} else if (arg === "null") {
					// Null literal, so convert it into null
					arg = null;
				} else if (arg === "undefined") {
					// Undefined literal, so convert it into undefined
					arg = undefined;
				} else if (arg === "true") {
					// Boolean true literal, so convert it into boolean true
					arg = true;
				} else if (arg === "false") {
					// Boolean false literal, so convert it into boolean false
					arg = false;
				} else if (!isNaN(parseFloat(arg)) && isFinite(arg)) {
					// Numeric literal, so convert it into a number
					//   n.b. Octal literals are not handled correctly by Number() (e.g. Number("077") yields 77, not 63).
					//        We could use eval("077") instead, which does correctly yield 63, however, it's probably far
					//        more likely that the average Twine/Twee author would expect "077" to yield 77 rather than 63.
					//        So, we cater to author expectation and use Number().
					//
					//        Besides, octal literals are browser extensions, which aren't part of the ECMAScript standard,
					//        and are considered deprecated in most (all?) browsers anyway.
					arg = Number(arg);
				}
			}

			args.push(arg);
		}

		return args;
	}
},

{
	name: "html",
	match: "<[Hh][Tt][Mm][Ll]>",
	lookaheadRegExp: /<[Hh][Tt][Mm][Ll]>((?:.|\n)*?)<\/[Hh][Tt][Mm][Ll]>/gm,
	handler: function (w) {
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if (lookaheadMatch && lookaheadMatch.index === w.matchStart) {
			w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;

			var frag = document.createDocumentFragment(),
				temp = document.createElement("div");
			temp.innerHTML = lookaheadMatch[1];
			while (temp.firstChild) {
				frag.appendChild(temp.firstChild);
			}
			w.output.appendChild(frag);
		}
	}
},

{
	name: "commentByBlock",
	match: "/(?:%|\\*)",
	lookaheadRegExp: /\/(%|\*)((?:.|\n)*?)\1\//gm,
	handler: function (w) {
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if (lookaheadMatch && lookaheadMatch.index === w.matchStart) {
			w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;
		}
	}
},

{
	name: "htmlCommentByBlock",
	match: "<!--",
	lookaheadRegExp: /<!--((?:.|\\n)*?)-->/gm,
	handler: function (w) {
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if (lookaheadMatch && lookaheadMatch.index === w.matchStart) {
			w.output.appendChild(document.createComment(lookaheadMatch[1]));
			w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;
		}
	}
},

{
	name: "boldByChar",
	match: "''",
	terminator: "''",
	element: "strong",
	handler: Wikifier.formatterHelpers.charFormatHelper
},

{
	name: "strikeByChar",
	match: "==",
	terminator: "==",
	element: "strike",
	handler: Wikifier.formatterHelpers.charFormatHelper
},

{
	name: "underlineByChar",
	match: "__",
	terminator: "__",
	element: "u",
	handler: Wikifier.formatterHelpers.charFormatHelper
},

{
	name: "italicByChar",
	match: "//",
	terminator: "//",
	element: "em",
	handler: Wikifier.formatterHelpers.charFormatHelper
},

{
	name: "subscriptByChar",
	match: "~~",
	terminator: "~~",
	element: "sub",
	handler: Wikifier.formatterHelpers.charFormatHelper
},

{
	name: "superscriptByChar",
	match: "\\^\\^",
	terminator: "\\^\\^",
	element: "sup",
	handler: Wikifier.formatterHelpers.charFormatHelper
},

{
	name: "monospacedByChar",
	match: "\\{\\{\\{",
	lookahead: "\\{\\{\\{((?:.|\\n)*?)\\}\\}\\}",
	handler: function (w) {
		var lookaheadRegExp = new RegExp(this.lookahead, "gm");
		lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = lookaheadRegExp.exec(w.source);
		if (lookaheadMatch && lookaheadMatch.index === w.matchStart) {
			insertElement(w.output, "code", null, null, lookaheadMatch[1]);
			w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;
		}
	}
},

{
	name: "styleByChar",
	match: "@@",
	terminator: "@@",
	lookahead: "(?:([^\\(@]+)\\(([^\\)]+)(?:\\):))|(?:([^:@]+):([^;]+);)",
	handler: function (w) {
		var el = insertElement(w.output, "span", null, null, null);
		var styles = Wikifier.formatterHelpers.inlineCssHelper(w);
		if (styles.length == 0) {
			el.className = "marked";
		} else {
			for (var i = 0; i < styles.length; i++) {
				el.style[styles[i].style] = styles[i].value;
			}
		}
		w.subWikify(el, this.terminator);
	}
},

{
	name: "emdash",
	match: "--",
	handler: function (w) {
		insertText(w.output, "\u2014");
	}
},

{
	name: "lineContinuation",
	match: "\\\\[\\s\\u00a0\\u2028\\u2029]*?(?:\\n|$)",  // Unicode space-character escapes required for IE < 11 (maybe < 10?)
	handler: function (w) {
		w.nextMatch = w.matchStart + w.matchLength;
	}
},

{
	name: "lineBreak",
	match: "\\n|<br ?/?>",
	handler: function (w) {
		if (w.nobr.length === 0 || !w.nobr[0]) {
			insertElement(w.output, "br");
		}
	}
},

{
	name: "rawText",
	match: "\"{3}|<nowiki>",
	lookaheadRegExp: /(?:\"{3}|<nowiki>)((?:.|\n)*?)(?:\"{3}|<\/nowiki>)/gm,
	handler: function(w) {
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if (lookaheadMatch && lookaheadMatch.index === w.matchStart) {
			insertElement(w.output, "span", null, null, lookaheadMatch[1]);
			w.nextMatch = this.lookaheadRegExp.lastIndex;
		}
	}
},

{
	name: "htmlCharacterReference",
	match: "(?:(?:&#?[a-zA-Z0-9]{2,8};|.)(?:&#?(?:x0*(?:3[0-6][0-9a-fA-F]|1D[c-fC-F][0-9a-fA-F]|20[d-fD-F][0-9a-fA-F]|FE2[0-9a-fA-F])|0*(?:76[89]|7[7-9][0-9]|8[0-7][0-9]|761[6-9]|76[2-7][0-9]|84[0-3][0-9]|844[0-7]|6505[6-9]|6506[0-9]|6507[0-1]));)+|&#?[a-zA-Z0-9]{2,8};)",
	handler: function(w) {
		var el = document.createElement("div");
		el.innerHTML = w.matchText;
		insertText(w.output, el.textContent);
	}
},

{   // n.b. This formatter MUST come after any formatter which handles HTML tag-like constructs (e.g. html & rawText)
	name: "htmlTag",
	match: "<\\w+(?:\\s+[^\\u0000-\\u001F\\u007F-\\u009F\\s\"'>\\/=]+(?:\\s*=\\s*(?:\"[^\"]*?\"|'[^']*?'|[^\\s\"'=<>`]+))?)*\\s*\\/?>",
	tagPattern: "<(\\w+)",
	voidElements: [ "area", "base", "br", "col", "embed", "hr", "img", "input", "keygen", "link", "menuitem", "meta", "param", "source", "track", "wbr" ],
	nobrElements: [ "colgroup", "datalist", "dl", "figure", "ol", "optgroup", "select", "table", "tbody", "tfoot", "thead", "tr", "ul" ],
	handler: function (w) {
		var tagMatch = new RegExp(this.tagPattern).exec(w.matchText),
			tag      = tagMatch && tagMatch[1],
			tagName  = tag && tag.toLowerCase();

		//if (tagName && ["html", "nowiki"].contains(tagName)) {
		if (tagName) {
			var isVoid = this.voidElements.contains(tagName),
				isNobr = this.nobrElements.contains(tagName),
				terminator,
				terminatorRegExp,
				terminatorMatch;

			if (!isVoid) {
				terminator = "<\\/" + tagName + "\\s*>";
				terminatorRegExp = new RegExp(terminator, "gim");  // ignore case during match
				terminatorRegExp.lastIndex = w.matchStart;
				terminatorMatch = terminatorRegExp.exec(w.source);
			}
			if (isVoid || terminatorMatch) {
				var el = document.createElement(w.output.tagName);
				el.innerHTML = w.matchText;
				while (el.firstChild) {
					el = el.firstChild;
				}

				if (el.hasAttribute("data-passage")) {
					this.processDataAttributes(el);
				}

				if (terminatorMatch) {
					if (isNobr) {
						w.nobr.unshift(true);
					} else if (w.nobr.length !== 0) {
						w.nobr.unshift(false);
					}
					try {
						w.subWikify(el, terminator, true);  // ignore case during match
					} finally {
						if (w.nobr.length !== 0) {
							w.nobr.shift();
						}
					}
				}
				w.output.appendChild(el);
			} else {
				throwError(w.output, 'HTML tag "' + tag + '" is not closed', w.matchText + "\u2026");
			}
		}
	},
	processDataAttributes: function (el) {
		var passage = el.getAttribute("data-passage");
		if (passage == null) { return; }

		passage = ((typeof passage !== "string") ? String(passage) : passage).trim();
		if (/^\$\w+/.test(passage)) {
			passage = Wikifier.getValue(passage);
			el.setAttribute("data-passage", passage);
		}
		if (passage !== "") {
			switch (el.tagName.toUpperCase()) {
			case "A":    /* FALL-THROUGH */
			case "AREA":
				var setter   = el.getAttribute("data-setter"),
					callback;
				if (setter != null) {
					setter = ((typeof setter !== "string") ? String(setter) : setter).trim();
					if (setter !== "") {
						callback = function (ex) { return function () { Wikifier.evalStatements(ex); }; }(Wikifier.parse(setter));
					}
				}
				el.classList.add(tale.has(passage) ? "link-internal" : "link-broken");
				$(el).click(function () {
					if (typeof callback === "function") { callback(); }
					state.display(passage, el);
				});
				break;
			case "IMG":
				var source;
				// check for Twine 1.4 Base64 image passage transclusion
				if (tale.has(passage)) {
					passage = tale.get(passage);
					if (passage.tags.contains("Twine.image")) {
						source = passage.text;
					}
				}
				el.src = source;
				break;
			}
		}
	}
}

];  // End formatters


/***********************************************************************************************************************
** [End wikifier.js]
***********************************************************************************************************************/

/***********************************************************************************************************************
** [Begin macros.js]
***********************************************************************************************************************/

/***********************************************************************************************************************
** [Macro API]
***********************************************************************************************************************/
function Macros() {
	// protect the Macros API object's properties and return it
	//   n.b. we can't use Object.freeze() here because we still have to support old-style macros
	return Object.defineProperties({}, {
		// data properties
		definitions : {
			value : {}
		},

		tags : {
			value : {}
		},

		// method properties
		add : {
			value : function (name, def, deep) {
				if (Array.isArray(name)) {
					name.forEach(function (n) { this.add(n, def, deep); }, this);
					return;
				}

				if (this.has(name)) {
					throw new Error("cannot clobber existing macro <<" + name + ">>");
				} else if (this.tags.hasOwnProperty(name)) {
					throw new Error("cannot clobber child tag <<" + name + ">> of parent macro"
						+ (this.tags[name].length === 1 ? '' : 's') + " <<" + this.tags[name].join(">>, <<") + ">>");
				}

				try {
					if (typeof def === "object") {
						// add the macro definition
						this.definitions[name] = deep ? clone(def) : def;
					} else {
						// add the macro alias
						if (this.has(def)) {
							this.definitions[name] = deep ? clone(this.definitions[def]) : this.definitions[def];
						} else {
							throw new Error("cannot create alias of nonexistent macro <<" + def + ">>");
						}
					}
					Object.defineProperty(this.definitions, name, { writable : false });

					/* legacy kludges */
					this.definitions[name]["_USE_MACROS_API"] = true;
					/* /legacy kludges */
				} catch (e) {
					if (e.name === "TypeError") {
						throw new Error("cannot clobber protected macro <<" + name + ">>");
					} else {
						throw new Error("unknown error when attempting to add macro <<" + name + ">>: [" + e.name + "] " + e.message);
					}
				}

				// tags post-processing
				if (this.definitions[name].hasOwnProperty("tags")) {
					if (this.definitions[name].tags == null) {
						this.registerTags(name);
					} else if (Array.isArray(this.definitions[name].tags)) {
						this.registerTags(name, this.definitions[name].tags);
					} else {
						throw new Error('bad value for "tags" property of macro <<' + name + ">>");
					}
				}
			}
		},

		remove : {
			value : function (name) {
				if (Array.isArray(name)) {
					name.forEach(function (n) { this.remove(n); }, this);
					return;
				}

				if (this.definitions.hasOwnProperty(name)) {
					// tags pre-processing
					if (this.definitions[name].hasOwnProperty("tags")) {
						this.unregisterTags(name);
					}

					try {
						// remove the macro definition
						Object.defineProperty(this.definitions, name, { writable : true });
						delete this.definitions[name];
					} catch (e) {
						throw new Error("unknown error removing macro <<" + name + ">>: " + e.message);
					}
				} else if (this.tags.hasOwnProperty(name)) {
					throw new Error("cannot remove child tag <<" + name + ">> of parent macro <<" + this.tags[name] + ">>");
				}
			}
		},

		has : {
			value : function (name, searchTags) {
				return this.definitions.hasOwnProperty(name) || (searchTags && this.tags.hasOwnProperty(name));
			}
		},

		get : {
			value : function (name) {
				var macro = null;

				if (this.definitions.hasOwnProperty(name) && typeof this.definitions[name]["handler"] === "function") {
					macro = this.definitions[name];
				} else if (this.hasOwnProperty(name) && typeof this[name]["handler"] === "function") {
					macro = this[name];
				}
				return macro;
			}
		},

		getHandler : {
			value : function (name, handler) {
				var macro = this.get(name);

				if (!handler) { handler = "handler"; }
				return (macro && macro.hasOwnProperty(handler) && typeof macro[handler] === "function") ? macro[handler] : null;
			}
		},

		evalStatements : {
			value : function (statements, thisp) {
				"use strict";
				try {
					eval((thisp == null)  /* use lazy equality */
						? 'var output = document.createElement("div");(function(){' + statements + '\n}());'
						: "var output = thisp.output;(function(){" + statements + "\n}.call(thisp));");
					return true;
				} catch (e) {
					if (thisp == null) {  // use lazy equality
						throw e;
					}
					return thisp.error("bad evaluation: " + e.message);
				}
			}
		},

		registerTags : {
			value : function (parent, bodyTags) {
				if (!parent) { throw new Error("no parent specified"); }

				if (!Array.isArray(bodyTags)) { bodyTags = []; }

				var endTags = [ "/" + parent, "end" + parent ],  // automatically create the closing tags
					allTags = [].concat(endTags, bodyTags);

				for (var i = 0; i < allTags.length; i++) {
					var tag = allTags[i];
					if (this.definitions.hasOwnProperty(tag)) {
						throw new Error("cannot register tag for an existing macro");
					}
					if (this.tags.hasOwnProperty(tag)) {
						if (!this.tags[tag].contains(parent)) {
							this.tags[tag].push(parent);
							this.tags[tag].sort();
						}
					} else {
						this.tags[tag] = [ parent ];
					}
				}
			}
		},

		unregisterTags : {
			value : function (parent) {
				if (!parent) { throw new Error("no parent specified"); }

				for (var tag in this.tags) {
					var i = this.tags[tag].indexOf(parent);
					if (i !== -1) {
						if (this.tags[tag].length === 1) {
							delete this.tags[tag];
						} else {
							this.tags[tag].splice(i, 1);
						}
					}
				}
			}
		},

		init : {
			value : function () {
				for (var name in this.definitions) {
					var fn = this.getHandler(name, "init");
					if (fn) { fn.call(this.definitions[name], name); }
				}
				/* legacy kludges */
				for (var name in this) {
					var fn = this.getHandler(name, "init");
					if (fn) { fn.call(this[name], name); }
				}
				/* /legacy kludges */
			}
		},

		lateInit : {
			value : function () {
				for (var name in this.definitions) {
					var fn = this.getHandler(name, "lateInit");
					if (fn) { fn.call(this.definitions[name], name); }
				}
				/* legacy kludges */
				for (var name in this) {
					var fn = this.getHandler(name, "lateInit");
					if (fn) { fn.call(this[name], name); }
				}
				/* /legacy kludges */
			}
		}
	});
}


/***********************************************************************************************************************
** [End macros.js]
***********************************************************************************************************************/

/***********************************************************************************************************************
** [Begin macroslib.js]
***********************************************************************************************************************/

/***********************************************************************************************************************
** [Standard Macro Definitions]
***********************************************************************************************************************/
function addStandardMacros() {
	/***************************************************************************
	 * Links
	 **************************************************************************/
	/**
	 * <<actions>>
	 */
	macros.add("actions", {
		version : { major : 2, minor : 2, patch : 0 },
		handler : function () {
			var list = insertElement(this.output, "ul");
			list.classList.add(this.name);
			if (!state.active.variables["#actions"]) {
				state.active.variables["#actions"] = {};
			}
			for (var i = 0; i < this.args.length; i++) {
				var linkText,
					passage,
					setFn,
					el;

				if (typeof this.args[i] === "object") {
					// argument was in wiki link syntax
					linkText = this.args[i].text;
					passage  = this.args[i].link;
					setFn    = this.args[i].setFn;
				} else {
					// argument was simply the passage name
					linkText = passage = this.args[i];
				}

				if (state.active.variables["#actions"][passage]) {
					continue;
				}

				el = Wikifier.createInternalLink(insertElement(list, "li"), passage, linkText, function (p, fn) {
					return function () {
						state.active.variables["#actions"][p] = true;
						if (typeof fn === "function") { fn(); }
					};
				}(passage, setFn));
				el.classList.add("link-" + this.name);
			}
		}
	});

	/**
	 * <<back>> & <<return>>
	 */
	macros.add(["back", "return"], {
		version : { major : 4, minor : 2, patch : 0 },
		handler : function () {
			var steps = 1,
				pname,
				ctext,
				ltext = this.name[0].toUpperCase() + this.name.slice(1),
				el;

			// translate wiki link syntax into the <<back>>/<<return>> "to" syntax
			if (this.args.length === 1 && typeof this.args[0] === "object") {
				if (this.args[0].count === 1) {
					// simple link syntax: [[...]]
					this.args.push(this.args[0].link);
					this.args[0] = "to"
				} else {
					// pretty link syntax: [[...|...]]
					this.args.push("to");
					this.args.push(this.args[0].link);
					this.args[0] = this.args[0].text;
				}
			}

			if (this.args.length === 1) {
				ctext = this.args[0];
			} else if (this.args.length !== 0) {
				if (this.args.length === 3) {
					ctext = this.args.shift();
				}

				if (this.args[0] === "go") {
					if (isNaN(this.args[1]) || this.args[1] < 1) {
						return this.error('the argument after "go" must be a whole number greater than zero');
					}
					steps = (this.args[1] < state.length) ? this.args[1] : state.length - 1;
					pname = state.peek(steps).title;
					ltext += " (go " + steps + ")";
				} else if (this.args[0] === "to") {
					if (typeof this.args[1] === "object") {
						// argument was in wiki link syntax
						this.args[1] = this.args[1].link;
					}
					if (!tale.has(this.args[1])) {
						return this.error('the "' + this.args[1] + '" passage does not exist');
					}
					if (this.name === "return") {  // || config.disableHistoryTracking)  // allow <<back>> to work like <<return>> when config.disableHistoryTracking is enabled
						pname = this.args[1];
						ltext += ' (to "' + pname + '")';
					} else {
						for (var i = state.length - 1; i >= 0; i--) {
							if (state.history[i].title === this.args[1]) {
								steps = (state.length - 1) - i;
								pname = this.args[1];
								ltext += ' (to "' + pname + '")';
								break;
							}
						}
					}
					if (pname === undefined) {
						return this.error('cannot find passage "' + this.args[1] + '" in the current story history');
					}
				} else {
					return this.error('"' + this.args[0] + '" is not a valid action (go|to)');
				}
			}
			if (pname === undefined && state.length > 1) {
				pname = state.peek(steps).title;
			}

			if (pname === undefined) {
				return this.error("cannot find passage");
			} else if (steps === 0) {
				return this.error("already at the first passage in the current story history");
			}

			el = document.createElement("a");
			el.classList.add("link-internal");
			el.classList.add("link-" + this.name);
			if (steps > 0) {
				$(el).click(function () {
					if (this.name === "back") {
						if (config.historyMode === HistoryMode.Hash || config.disableHistoryControls) {
							return function () {
								// pop the history stack
								//   n.b. (steps > 0) is correct, since SugarCube's history stack does not store "dirty"
								//        (i.e. post-rendered/executed) states; in most other headers, something like
								//        (steps >= 0) would probably be necessary
								while (steps > 0) {
									if (!state.isEmpty) {
										state.pop();
									}
									steps--;
								}
								// activate the new top since we popped the stack
								state.activate(state.top);
								// display the passage
								state.display(pname, el, "replace");
							};
						} else {
							return function () {
								if (state.length > 1) {
									window.history.go(-(steps));
								}
							};
						}
					} else {
						return function () {
							state.display(pname, el);
						};
					}
				}.call(this));
			}
			insertText(el, ctext || this.self.dtext || ltext);
			this.output.appendChild(el);
		},
		linktext : function () {
			if (this.args.length === 0) {
				delete this.self.dtext;
			} else {
				this.self.dtext = this.args[0];
			}
		}
	}, true);

	/**
	 * <<choice>>
	 */
	macros.add("choice", {
		version : { major : 4, minor : 0, patch : 0 },
		handler : function () {
			if (this.args.length === 0) {
				return this.error("no passage specified");
			}

			var linkText,
				passage,
				setFn,
				choiceId  = state.active.title,
				el;

			if (this.args.length === 1) {
				if (typeof this.args[0] === "object") {
					// argument was in wiki link syntax
					linkText = this.args[0].text;
					passage  = this.args[0].link;
					setFn    = this.args[0].setFn;
				} else {
					// argument was simply the passage name
					linkText = passage = this.args[0];
				}
			} else {
				// yes, the arguments are backwards
				passage  = this.args[0];
				linkText = this.args[1];
			}

			if (!state.active.variables.hasOwnProperty("#choice")) {
				state.active.variables["#choice"] = {};
			} else if (state.active.variables["#choice"][choiceId]) {
				insertElement(this.output, "span", null, "link-disabled link-" + this.name, linkText);
				return;
			}

			el = Wikifier.createInternalLink(this.output, passage, linkText, function () {
				state.active.variables["#choice"][choiceId] = true;
				if (typeof setFn === "function") { setFn(); }
			});
			el.classList.add("link-" + this.name);
		}
	});

	/**
	 * <<link>>
	 */
	macros.add("link", {
		version : { major : 3, minor : 4, patch : 0 },
		handler : function () {
			if (this.args.length === 0) {
				return this.error("no link location specified");
			}

			var linkText,
				linkLoc,
				isExternal,
				setFn,
				limit,
				el;

			if (this.args.length === 3) {
				limit = this.args.pop();
			} else if (this.args.length === 2 && (this.args[1] === "keep" || this.args[1] === "remove" || this.args[1] === "once")) {
				limit = this.args.pop();
			}
			if (limit && limit !== "keep" && limit !== "remove" && limit !== "once") {
				return this.error('"' + limit + '" is not a valid action (keep|remove)');
			}

			if (this.args.length === 2) {
				linkText = this.args[0];
				linkLoc  = this.args[1];
			} else {
				if (typeof this.args[0] === "object") {
					// argument was in wiki link syntax
					linkText   = this.args[0].text;
					linkLoc    = this.args[0].link;
					isExternal = this.args[0].isExternal;
					setFn      = this.args[0].setFn;
				} else {
					// argument was simply the link location
					linkText = linkLoc = this.args[0];
				}
			}
			if (isExternal === undefined) {
				isExternal = Wikifier.formatterHelpers.isExternalLink(linkLoc);
			}

			if (limit) {
				if (!state.active.variables.hasOwnProperty("#link")) {
					state.active.variables["#link"] = {};
				} else if (state.active.variables["#link"][linkLoc]) {
					if (limit === "keep") {
						insertElement(this.output, "span", null, "link-disabled link-" + this.name, linkText);
					}
					return;
				}
			}

			if (isExternal) {
				el = Wikifier.createExternalLink(this.output, linkLoc, linkText);
			} else {
				el = Wikifier.createInternalLink(this.output, linkLoc, linkText, function () {
					if (limit) { state.active.variables["#link"][linkLoc] = true; }
					if (typeof setFn === "function") { setFn(); }
				});
			}
			el.classList.add("link-" + this.name);
		}
	});


	/***************************************************************************
	 * Display
	 **************************************************************************/
	/**
	 * <<display>>
	 */
	macros.add("display", {
		version : { major : 3, minor : 1, patch : 0 },
		handler : function () {
			if (this.args.length === 0) {
				return this.error("no passage specified");
			}

			var passage;

			if (typeof this.args[0] === "object") {
				// argument was in wiki link syntax
				passage = this.args[0].link;
			} else {
				// argument was simply the passage name
				passage = this.args[0];
			}
			if (!tale.has(passage)) {
				return this.error('passage "' + passage + '" does not exist');
			}

			var el = this.output;

			passage = tale.get(passage);
			if (this.args[1]) {
				el = insertElement(el, this.args[1], null, passage.domId);
				el.setAttribute("data-passage", passage.title);
			}
			new Wikifier(el, passage.processText());
		}
	});

	/**
	 * <<nobr>>
	 */
	macros.add("nobr", {
		version  : { major : 1, minor : 1, patch : 0 },
		skipArgs : true,
		tags     : null,
		handler  : function () {
			// wikify the contents, after removing all newlines
			new Wikifier(this.output, this.payload[0].contents.replace(/\n/g, " "));
		}
	});

	/**
	 * <<print>>
	 */
	macros.add("print", {
		version  : { major : 2, minor : 1, patch : 0 },
		skipArgs : true,
		handler  : function () {
			if (this.args.full.length === 0) {
				return this.error("no expression specified");
			}

			try {
				var result = Util.evalExpression(this.args.full);
				if (result != null && (typeof result !== "number" || !isNaN(result))) {
					new Wikifier(this.output, result.toString());
				}
			} catch (e) {
				return this.error("bad expression: " + e.message);
			}
		}
	});

	/**
	 * <<silently>>
	 */
	macros.add("silently", {
		version  : { major : 4, minor : 0, patch : 0 },
		skipArgs : true,
		tags     : null,
		handler  : function () {
			var errTrap = document.createDocumentFragment(),
				errList = [];

			// wikify the contents
			new Wikifier(errTrap, this.payload[0].contents.trim());

			// discard the output, unless there were errors
			while (errTrap.hasChildNodes()) {
				var fc = errTrap.firstChild;
				if (fc.classList && fc.classList.contains("error")) { errList.push(fc.textContent); }
				errTrap.removeChild(fc);
			}
			if (errList.length > 0) {
				return this.error("error" + (errList.length === 1 ? "" : "s") + " within contents (" + errList.join('; ') + ")");
			}
		}
	});


	/***************************************************************************
	 * Control
	 **************************************************************************/
	/**
	 * <<if>>
	 */
	macros.add("if", {
		version  : { major : 3, minor : 1, patch : 1 },
		skipArgs : true,
		tags     : [ "elseif", "else" ],
		handler  : function () {
			try {
				for (var i = 0, len = this.payload.length; i < len; i++) {
					if (this.payload[i].name !== "else" && this.payload[i].arguments.length === 0) {
						return this.error("no conditional expression specified for <<" + this.payload[i].name + ">> clause" + (i > 0 ? " (#" + i + ")" : ""));
					} else if (this.payload[i].name === "else" && this.payload[i].arguments.length !== 0) {
						if (/^\s*if\b/i.test(this.payload[i].arguments)) {
							return this.error('whitespace is not allowed between the "else" and "if" in <<elseif>> clause' + (i > 0 ? " (#" + i + ")" : ""));
						}
						return this.error("<<else>> does not accept a conditional expression (perhaps you meant to use <<elseif>> instead), invalid: " + this.payload[i].arguments);
					}
					if (this.payload[i].name === "else" || !!Wikifier.evalExpression(this.payload[i].arguments)) {
						new Wikifier(this.output, this.payload[i].contents);
						break;
					}
				}
			} catch (e) {
				return this.error("bad conditional expression: " + e.message);
			}
		}
	});

	/**
	 * <<for>>, <<break>>, & <<continue>>
	 */
	macros.add("for", {
		version  : { major : 1, minor : 0, patch : 0 },
		skipArgs : true,
		tags     : null,
		handler  : function () {
			var init,
				condition = this.args.full.trim(),
				post,
				parts,
				payload   = this.payload[0].contents.replace(/\n$/, ""),
				first     = true,
				safety    = config.macros.maxLoopIterations;

			if (condition.length === 0) {
				condition = true;
			} else if (condition.indexOf(";") !== -1) {
				if ((parts = condition.match(/^([^;]*?)\s*;\s*([^;]*?)\s*;\s*([^;]*?)$/)) !== null) {
					init      = parts[1];
					condition = parts[2];
					post      = parts[3];
				} else {
					return this.error("invalid 3-part syntax, format: init ; condition ; post");
				}
			}

			try {
				runtime.temp.break = null;
				try {
					if (init) { Util.evalExpression(init); }
				} catch (e) {
					return this.error("bad init expression: " + e.message);
				}
				while (!!Util.evalExpression(condition)) {
					if (--safety < 0) {
						return this.error("exceeded configured maximum loop iterations (" + config.macros.maxLoopIterations + ")");
					}
					new Wikifier(this.output, first ? payload.replace(/^\n/, "") : payload);
					if (first) { first = false; }
					if (runtime.temp.break != null) {
						if (runtime.temp.break === 1) {
							runtime.temp.break = null;
						} else if (runtime.temp.break === 2) {
							runtime.temp.break = null;
							break;
						}
					}
					try {
						if (post) { Util.evalExpression(post); }
					} catch (e) {
						return this.error("bad post expression: " + e.message);
					}
				}
			} catch (e) {
				return this.error("bad conditional expression: " + e.message);
			} finally {
				runtime.temp.break = null;
			}
		}
	});
	macros.add(["break", "continue"], {
		version  : { major : 1, minor : 0, patch : 0 },
		skipArgs : true,
		handler  : function () {
			if (this.contextHas(function (c) { return c.name === "for"; })) {
				runtime.temp.break = (this.name === "continue") ? 1 : 2;
			} else {
				return this.error("must only be used in conjunction with its parent macro <<for>>");
			}
		}
	});


	/***************************************************************************
	 * Variables
	 **************************************************************************/
	/**
	 * <<set>>
	 */
	macros.add("set", {
		version  : { major : 3, minor : 1, patch : 0 },
		skipArgs : true,
		handler  : function () {
			if (this.args.full.length === 0) {
				return this.error("no expression specified");
			}

			macros.evalStatements(this.args.full, this);
		}
	});

	/**
	 * <<unset>>
	 */
	macros.add("unset", {
		version  : { major : 2, minor : 1, patch : 0 },
		skipArgs : true,
		handler  : function () {
			if (this.args.full.length === 0) {
				return this.error("no $variable list specified");
			}

			var expression = this.args.full,
				re         = /state\.active\.variables\.(\w+)/g,
				match;

			while ((match = re.exec(expression)) !== null) {
				var name = match[1];

				if (state.active.variables.hasOwnProperty(name)) {
					delete state.active.variables[name];
				}
			}
		}
	});

	/**
	 * <<remember>>
	 */
	macros.add("remember", {
		version  : { major : 3, minor : 1, patch : 0 },
		skipArgs : true,
		handler  : function () {
			if (this.args.full.length === 0) {
				return this.error("no expression specified");
			}

			var expression = this.args.full;
			if (macros.evalStatements(expression, this)) {
				var remember = storage.getItem("remember") || {},
					re       = /state\.active\.variables\.(\w+)/g,
					match;

				while ((match = re.exec(expression)) !== null) {
					var name = match[1];

					remember[name] = state.active.variables[name];
				}
				if (!storage.setItem("remember", remember)) {
					return this.error("unknown error, cannot remember: " + this.args.raw);
				}
			}
		},
		init : function () {
			var remember = storage.getItem("remember");
			if (remember) {
				for (var name in remember) {
					state.active.variables[name] = remember[name];
				}
			}
		}
	});

	/**
	 * <<forget>>
	 */
	macros.add("forget", {
		version  : { major : 1, minor : 1, patch : 0 },
		skipArgs : true,
		handler  : function () {
			if (this.args.full.length === 0) {
				return this.error("no $variable list specified");
			}

			var expression = this.args.full,
				re         = /state\.active\.variables\.(\w+)/g,
				match,
				remember   = storage.getItem("remember"),
				needStore  = false;

			while ((match = re.exec(expression)) !== null) {
				var name = match[1];

				if (state.active.variables.hasOwnProperty(name)) {
					delete state.active.variables[name];
				}
				if (remember && remember.hasOwnProperty(name)) {
					needStore = true;
					delete remember[name];
				}
			}
			if (needStore && !storage.setItem("remember", remember)) {
				return this.error("unknown error, cannot update remember store");
			}
		}
	});


	/***************************************************************************
	 * Scripting
	 **************************************************************************/
	/**
	 * <<run>>
	 */
	macros.add("run", "set");  // add <<run>> as an alias of <<set>>

	/**
	 * <<script>>
	 */
	macros.add("script", {
		version  : { major : 1, minor : 0, patch : 0 },
		skipArgs : true,
		tags     : null,
		handler  : function () {
			macros.evalStatements(this.payload[0].contents, this);
		}
	});


	/***************************************************************************
	 * Interactive
	 **************************************************************************/
	/**
	 * <<click>> & <<button>>
	 */
	macros.add(["click", "button"], {
		version : { major : 4, minor : 1, patch : 0 },
		tags    : null,
		handler : function () {
			function getWidgetArgs() {
				var wargs;

				if (this.context && state.active.variables.hasOwnProperty("args")) {
					if (this.contextHas(function (c) { return c.self.isWidget; })) {
						wargs = state.active.variables.args;
					}
				}
				return wargs;
			}

			if (this.args.length === 0) {
				return this.error("no " + (this.name === "click" ? "link" : "button") + " text specified");
			}

			var elText,
				passage,
				widgetArgs = getWidgetArgs.call(this),
				el         = document.createElement(this.name === "click" ? "a" : "button");

			if (typeof this.args[0] === "object") {
				// argument was in wiki link syntax
				elText  = this.args[0].text;
				passage = this.args[0].link;
			} else {
				// argument was simply the link text
				elText  = this.args[0];
				passage = this.args.length > 1 ? this.args[1] : undefined;
			}

			el.classList.add("link-" + (passage ? (tale.has(passage) ? "internal" : "broken") : "internal"));
			el.classList.add("link-" + this.name);
			insertText(el, elText);
			$(el).click(function (self, contents, widgetArgs) {
				return function () {
					if (contents !== "") {
						if (widgetArgs !== undefined) {
							// store existing $args variables
							if (state.active.variables.hasOwnProperty("args")) {
								if (!self.hasOwnProperty("_argsStack")) {
									self._argsStack = [];
								}
								self._argsStack.push(state.active.variables.args);
							}

							// setup the $args variable
							state.active.variables.args = widgetArgs;
						}

						// wikify the contents and discard any output, unless there were errors
						Wikifier.wikifyEval(contents);

						if (widgetArgs !== undefined) {
							// teardown the $args variable
							delete state.active.variables.args;

							// restore existing $args variables
							if (self.hasOwnProperty("_argsStack")) {
								state.active.variables.args = self._argsStack.pop();
								if (self._argsStack.length === 0) {
									// teardown the stack
									delete self._argsStack;
								}
							}
						}
					}

					// go to the specified passage (if any)
					if (passage !== undefined) {
						state.display(passage, el);
					}
				};
			}(this.self, this.payload[0].contents.trim(), widgetArgs));
			this.output.appendChild(el);
		}
	});

	/**
	 * <<textbox>>
	 */
	macros.add("textbox", {
		version : { major : 4, minor : 0, patch : 0 },
		handler : function () {
			if (this.args.length < 2) {
				var errors = [];
				if (this.args.length < 1) { errors.push("$variable name"); }
				if (this.args.length < 2) { errors.push("default value"); }
				return this.error("no " + errors.join(" or ") + " specified");
			}

			var varName      = this.args[0].trim(),
				varId        = Util.slugify(varName),
				defaultValue = this.args[1],
				passage      = this.args.length > 2 ? this.args[2] : undefined,
				el           = document.createElement("input"),
				enterKeyUsed = false;

			// legacy error
			if (varName[0] !== "$") {
				return this.error('$variable name "' + varName + '" is missing its sigil ($)');
			}

			el.type  = "text";
			el.id    = "textbox-" + varId;
			el.name  = "textbox-" + varId;
			el.value = defaultValue;
			Wikifier.setValue(varName, defaultValue);
			$(el)
				.change(function () {
					// set the $variable upon change, only if Return/Enter was not pressed
					if (!enterKeyUsed) {
						Wikifier.setValue(varName, this.value);
					}
				})
				.keypress(function (evt) {
					// set the $variable and, optionally, forward to another passage if Return/Enter is pressed
					if (evt.which === 13) {
						evt.preventDefault();
						enterKeyUsed = true;
						Wikifier.setValue(varName, this.value);
						if (typeof passage !== "undefined") {
							state.display(passage, this);
						}
					}
				});
			this.output.appendChild(el);
		}
	});

	/**
	 * <<checkbox>>
	 */
	macros.add("checkbox", {
		version : { major : 5, minor : 0, patch : 0 },
		handler : function () {
			if (this.args.length < 3) {
				var errors = [];
				if (this.args.length < 1) { errors.push("$variable name"); }
				if (this.args.length < 2) { errors.push("unchecked value"); }
				if (this.args.length < 3) { errors.push("checked value"); }
				return this.error("no " + errors.join(" or ") + " specified");
			}

			var varName      = this.args[0].trim(),
				varId        = Util.slugify(varName),
				uncheckValue = this.args[1],
				checkValue   = this.args[2],
				el           = document.createElement("input");

			// legacy error
			if (varName[0] !== "$") {
				return this.error('$variable name "' + varName + '" is missing its sigil ($)');
			}

			el.type  = "checkbox";
			el.id    = this.name + "-" + varId;
			el.name  = this.name + "-" + varId;
			if (this.args.length > 3 && this.args[3] === "checked") {
				el.checked = true;
				Wikifier.setValue(varName, checkValue);
			} else {
				Wikifier.setValue(varName, uncheckValue);
			}
			$(el)
				.change(function () {
					Wikifier.setValue(varName, this.checked ? checkValue : uncheckValue);
				});
			this.output.appendChild(el);
		}
	});

	/**
	 * <<radiobutton>>
	 */
	macros.add("radiobutton", {
		version : { major : 5, minor : 0, patch : 0 },
		handler : function () {
			if (this.args.length < 2) {
				var errors = [];
				if (this.args.length < 1) { errors.push("$variable name"); }
				if (this.args.length < 2) { errors.push("checked value"); }
				return this.error("no " + errors.join(" or ") + " specified");
			}

			var varName    = this.args[0].trim(),
				varId      = Util.slugify(varName),
				checkValue = this.args[1],
				el         = document.createElement("input");

			// legacy error
			if (varName[0] !== "$") {
				return this.error('$variable name "' + varName + '" is missing its sigil ($)');
			}

			if (!runtime.temp.hasOwnProperty("radiobutton")) { runtime.temp["radiobutton"] = {}; }
			if (!runtime.temp["radiobutton"].hasOwnProperty(varId)) { runtime.temp["radiobutton"][varId] = 0; }

			el.type  = "radio";
			el.id    = this.name + "-" + varId + "-" + runtime.temp["radiobutton"][varId]++;
			el.name  = this.name + "-" + varId;
			if (this.args.length > 2 && this.args[2] === "checked") {
				el.checked = true;
				Wikifier.setValue(varName, checkValue);
			}
			$(el)
				.change(function () {
					if (this.checked) {
						Wikifier.setValue(varName, checkValue);
					}
				});
			this.output.appendChild(el);
		}
	});


	/***************************************************************************
	 * DOM (Classes)
	 **************************************************************************/
	/**
	 * <<addclass>> & <<toggleclass>>
	 */
	macros.add(["addclass", "toggleclass"], {
		version : { major : 2, minor : 0, patch : 0 },
		handler : function () {
			if (this.args.length < 2) {
				var errors = [];
				if (this.args.length < 1) { errors.push("selector"); }
				if (this.args.length < 2) { errors.push("class names"); }
				return this.error("no " + errors.join(" or ") + " specified");
			}

			var targets = $(this.args[0]);

			if (targets.length === 0) {
				return this.error('no elements matched the selector "' + this.args[0] + '"');
			}

			switch (this.name) {
			case "addclass":
				targets.addClass(this.args[1].trim());
				break;
			case "toggleclass":
				targets.toggleClass(this.args[1].trim());
				break;
			}
		}
	});

	/**
	 * <<removeclass>>
	 */
	macros.add("removeclass", {
		version : { major : 1, minor : 0, patch : 0 },
		handler : function () {
			if (this.args.length === 0) {
				return this.error("no selector specified");
			}

			var targets = $(this.args[0]);

			if (targets.length === 0) {
				return this.error('no elements matched the selector "' + this.args[0] + '"');
			}

			if (this.args.length > 1) {
				targets.removeClass(this.args[1].trim());
			} else {
				targets.removeClass();
			}
		}
	});


	/***************************************************************************
	 * DOM (Content)
	 **************************************************************************/
	/**
	 * <<append>>, <<prepend>>, & <<replace>>
	 */
	macros.add(["append", "prepend", "replace"], {
		version : { major : 2, minor : 0, patch : 1 },
		tags    : null,
		handler : function () {
			if (this.args.length === 0) {
				return this.error("no selector specified");
			}

			var targets = $(this.args[0]);

			if (targets.length === 0) {
				return this.error('no elements matched the selector "' + this.args[0] + '"');
			}

			if (this.payload[0].contents !== "") {
				var frag = document.createDocumentFragment();
				new Wikifier(frag, this.payload[0].contents);
				switch (this.name) {
				case "replace":
					targets.empty();
					/* FALL-THROUGH */
				case "append":
					targets.append(frag);
					break;
				case "prepend":
					targets.prepend(frag);
					break;
				}
			}
		}
	});

	/**
	 * <<remove>>
	 */
	macros.add("remove", {
		version : { major : 1, minor : 0, patch : 0 },
		handler : function () {
			if (this.args.length === 0) {
				return this.error("no selector specified");
			}

			var targets = $(this.args[0]);

			if (targets.length === 0) {
				return this.error('no elements matched the selector "' + this.args[0] + '"');
			}

			targets.remove();
		}
	});


	/***************************************************************************
	 * Miscellaneous
	 **************************************************************************/
	/**
	 * <<widget>>
	 */
	macros.add("widget", {
		version : { major : 2, minor : 0, patch : 0 },
		tags    : null,
		handler : function () {
			if (this.args.length === 0) {
				return this.error("no widget name specified");
			}

			var widgetName = this.args[0];

			if (macros.has(widgetName)) {
				if (!macros.get(widgetName).isWidget) {
					return this.error('cannot clobber existing macro "' + widgetName + '"');
				}

				// remove existing widget
				macros.remove(widgetName);
			}

			try {
				macros.add(widgetName, {
					version  : { major : 1, minor : 0, patch : 0 },
					isWidget : true,
					handler  : (function (contents) {
						return function () {
							try {
								// store existing $args variables
								if (state.active.variables.hasOwnProperty("args")) {
									if (!this.self.hasOwnProperty("_argsStack")) {
										this.self._argsStack = [];
									}
									this.self._argsStack.push(state.active.variables.args);
								}

								// setup the widget arguments array
								state.active.variables.args = [];
								for (var i = 0, len = this.args.length; i < len; i++) {
									state.active.variables.args[i] = this.args[i];
								}
								state.active.variables.args.raw = this.args.raw;
								state.active.variables.args.full = this.args.full;

								// setup the error trapping variables
								var outFrag = document.createDocumentFragment(),
									resFrag = document.createDocumentFragment(),
									errList = [];

								// wikify the widget contents
								new Wikifier(resFrag, contents);

								// carry over the output, unless there were errors
								while (resFrag.hasChildNodes()) {
									var fc = resFrag.firstChild;
									if (fc.classList && fc.classList.contains("error")) { errList.push(fc.textContent); }
									outFrag.appendChild(fc);
								}
								if (errList.length === 0) {
									this.output.appendChild(outFrag);
								} else {
									return this.error("error" + (errList.length === 1 ? "" : "s") + " within widget contents (" + errList.join('; ') + ")");
								}
							} catch (e) {
								return this.error("cannot execute widget: " + e.message);
							} finally {
								// teardown the widget arguments array
								delete state.active.variables.args;

								// restore existing $args variables
								if (this.self.hasOwnProperty("_argsStack")) {
									state.active.variables.args = this.self._argsStack.pop();
									if (this.self._argsStack.length === 0) {
										// teardown the widget arguments stack
										delete this.self._argsStack;
									}
								}
							}
						};
					}(this.payload[0].contents))
				});
			} catch (e) {
				return this.error('cannot create widget macro "' + widgetName + '": ' + e.message);
			}
		}
	});


	/***************************************************************************
	 * Options
	 **************************************************************************/
	/**
	 * <<optionlist>> & <<optiontoggle>>
	 */
	macros.add(["optiontoggle", "optionlist"], {
		version : { major : 2, minor : 0, patch : 0 },
		tags    : [ "onchange" ],
		handler : function () {
			if (this.args.length === 0) {
				return this.error("no option property specified");
			}
			if (this.name === "optionlist" && this.args.length < 2) {
				return this.error("no list specified");
			}

			var propertyName = this.args[0],
				propertyId   = Util.slugify(propertyName),
				elOption     = document.createElement("div"),
				elLabel      = document.createElement("div"),
				elControl    = document.createElement("div");

			elOption.appendChild(elLabel);
			elOption.appendChild(elControl);
			elOption.id  = "option-body-" + propertyId;
			elLabel.id   = "option-label-" + propertyId;
			elControl.id = "option-control-" + propertyId;

			// setup the label
			new Wikifier(elLabel, this.payload[0].contents.trim());

			// setup the control
			var onChangeContents = this.payload.length === 2 ? this.payload[1].contents.trim() : "";
			if (!options.hasOwnProperty(propertyName)) {
				options[propertyName] = undefined;
			}
			switch (this.name) {
			case "optiontoggle":
				var linkText = this.args.length > 1 ? this.args[1] : undefined,
					elInput  = document.createElement("a");
				if (options[propertyName] === undefined) {
					options[propertyName] = false;
				}
				if (options[propertyName]) {
					insertText(elInput, linkText || "On");
					elInput.classList.add("enabled");
				} else {
					insertText(elInput, linkText || "Off");
				}
				$(elInput).click(function () {
					return function (evt) {
						removeChildren(elInput);
						if (options[propertyName]) {
							insertText(elInput, linkText || "Off");
							elInput.classList.remove("enabled");
							options[propertyName] = false;
						} else {
							insertText(elInput, linkText || "On");
							elInput.classList.add("enabled");
							options[propertyName] = true;
						}
						macros.get("saveoptions").handler();

						// if <<onchange>> exists, execute the contents and discard the output (if any)
						if (onChangeContents !== "") {
							new Wikifier(document.createElement("div"), onChangeContents);
						}
					}
				}());
				break;
			case "optionlist":
				var items   = this.args[1],
					elInput = document.createElement("select");
				if (!Array.isArray(items)) {
					if (options.hasOwnProperty(items)) {
						items = options[items];
					} else {
						items = items.trim().split(/\s*,\s*/);
					}
				}
				if (options[propertyName] === undefined) {
					options[propertyName] = items[0];
				}
				for (var i = 0; i < items.length; i++) {
					var elItem = document.createElement("option");
					insertText(elItem, items[i]);
					elInput.appendChild(elItem);
				}
				elInput.value = options[propertyName];
				$(elInput).change(function () {
					return function (evt) {
						options[propertyName] = evt.target.value;
						macros.get("saveoptions").handler();

						// if <<onchange>> exists, execute the contents and discard the output (if any)
						if (onChangeContents !== "") {
							new Wikifier(document.createElement("div"), onChangeContents);
						}
					}
				}());
				break;
			}
			elInput.id = "option-input-" + propertyId;
			elControl.appendChild(elInput);

			this.output.appendChild(elOption);
		}
	});

	/**
	 * <<optionbar>>
	 */
	macros.add("optionbar", {
		version : { major : 3, minor : 0, patch : 0 },
		handler : function () {
			var elSet   = document.createElement("ul"),
				elOK    = document.createElement("li"),
				elReset = document.createElement("li");

			elSet.appendChild(elOK);
			elSet.appendChild(elReset);

			elOK.appendChild(insertElement(null, "button", "options-ok", "ui-close", "OK"));
			elReset.appendChild(insertElement(null, "button", "options-reset", "ui-close", "Reset to Defaults"));

			$("button", elReset).click(function (evt) {
				macros.get("deleteoptions").handler();
				window.location.reload();
			});

			this.output.appendChild(elSet);
		},
	});

	/**
	 * <<saveoptions>>
	 */
	macros.add("saveoptions", {
		version : { major : 2, minor : 0, patch : 0 },
		handler : function () {
			return storage.setItem("options", options);
		},
		init : function () {
			var opts = storage.getItem("options");
			if (opts !== null) {
				for (var name in opts) {
					options[name] = opts[name];
				}
			}
		}
	});

	/**
	 * <<deleteoptions>>
	 */
	macros.add("deleteoptions", {
		version : { major : 2, minor : 0, patch : 0 },
		handler : function () {
			options = {};
			if (!storage.removeItem("options")) {
				return this.error("unknown error, cannot update options store");
			}
		}
	});
}


/***********************************************************************************************************************
** [End macroslib.js]
***********************************************************************************************************************/

}(window, window.document));

</script>
<style type="text/css">
/* Init screen styling */
body > #init-screen { display: none; z-index: 100000; position: fixed; top: 0px; left: 0px; height: 100%; width: 100%; color: #fff; background-color: #111; text-align: center; }
body > #init-screen p { display: none; width: 75%; margin: 2em auto; font-family: verdana,"dejavu sans",tahoma,arial,sans-serif; font-size: 2em; font-weight: bold; font-style: italic; }
html.init-no-js body > #init-screen, html.init-lacking body > #init-screen, html.init-loading body > #init-screen { display: block; }
html.init-no-js body > #init-screen > #init-no-js { display: block; }
html.init-lacking body > #init-screen > #init-lacking { display: block; }
html.init-loading body > #init-screen > #init-loading { display: block; }
html.init-no-js body > #ui-bar, html.init-no-js body > #passages,
html.init-lacking body > #ui-bar, html.init-lacking body > #passages,
html.init-loading body > #ui-bar, html.init-loading body > #passages { display: none; }

@font-face {
	font-family: 'icomoon-sugarcube';
	src: url(data:application/font-woff;charset=utf-8;base64,d09GRk9UVE8AABEkAAsAAAAAHHgAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABDRkYgAAABCAAADeQAABb40HwEm0ZGVE0AAA7sAAAAGgAAABxmn3O0R0RFRgAADwgAAAAdAAAAIABOAARPUy8yAAAPKAAAAEsAAABgL9zcQGNtYXAAAA90AAAAPQAAAVLgMPLNaGVhZAAAD7QAAAAuAAAANv41RT9oaGVhAAAP5AAAAB4AAAAkBBD/5GhtdHgAABAEAAAAHgAAAEgEkACpbWF4cAAAECQAAAAGAAAABgAhUABuYW1lAAAQLAAAAOsAAAIHCW+4AnBvc3QAABEYAAAADAAAACAAAwAAeJyNWAl0lEUS7j9OZoYkThLIIGcCCASYABkIQkQQMHIFEWEERBQEvBgE1ImrnAIRlB+E1QmycoiRS8IqizHgystjMRwyHgkEQcK94ALBAJrNPzBDar/qngxR43v7Jq+6u7q76qvq6ur6owmTSWiaVv/5idNemDZtaseXs5596qWJWROeFlqE0ERvf88I/313+BuZ9Jg79BhTYpRoPKI+6Xq4E2NZPNmf48+KbKblxTYTIq6ZdiW+mYhpZo+oL1qxDKuIFQ1Fc9FaOEQXkS76iAFiqHhUjBUTxWTxonhVzBULxVLhFatErvhYbBM7RKHYK74Rh8VxcVb8ot2RNfX5/qmpqWgeDDdO1XRRTVfVpKmmm2ruUU131fRQTbpq+qqmn2oeUE2Gah5UTX/ZOJU+p9LnVPqcSp9T6XMqfU6lz6n0OZU+p9LnVPqcSp9T6XMqfc4H/+D9Px6HENoi7U3tLW2xpmtLtKXa29oybbn2V+0d7V3Nq+VoK7T3tJXa37T3tVXaam2Ntlb7QFunfajlah9p67UN2kbRkk8jQsSIUi3N1NDU0bTBtNd0wnQxcnDkqMjtZpu5o3moOcucYzYsvSyBesOix9xpjm0VOyz2qzgtLil+RPwz8Xr9Ypvu95iCXr/XYvNnG/l2EtYfTCQs7YNEfvTIaB9MclhkG+LUsBMDGYEMc50zjtpsKYzFJhnYYKlzptxSS3GYnWhkGNBQ10y5uU6kkG8z1pvq3OL31L3nT6wLeuo2wkZawLWLREbeG/CWttVKVD1iJ3rd5qMXvY+E2LeZ6Fb5QhIRSXOIbj58GhNfQ9CN0UeIAi/YJMG+gnXZTPpFMuOd0NSN0aVYfrA3b1zLImaFhEmx1TFWVjWPlXpYfT3IoepXMK0B76S/20isGtFV9WjS1m8hm2gWk9lM5jApDJPZLKcAxJXO4Bey5rmsD8AofbTCQLfOYHjjsdGseQ9gTvmWhOmdX6QF/UgMGjdbWhArucpWYd7kYPCFJCK3tWTwlzFMmKnAC60yHSRvH1swGLOiH5MFYdI3TLKtbFAaEw8b9A16w6+xzTvZ5oGRDP7emoMAeMguVOChbwaDX8AYWrDmr4Br42WGeT1kAcAXMtkdqcCDbONFm7H8HhNvXM8i+rEw9mL6+wo8VM1hpYOkequEEgK1avgvtYBK3PJwFFrsWVJjeuUsFTYSKFz0DOuboM5cYpBxoJwaeGGYRDuHnb5Qor2mIkYCVWEjD+rmw2cUUBxjhgIq4xIn7ZfHHYoYiRZx8k4Y7VTZi7T5M/xp9rKegVL8XIarrMwwBUyR0LRvx1IS9raX7aSlz91NWtqysURrOEyfarWcqH3qR0Qp8C2t+tdAEhO2zFWztPbkdCC+J2VwQxIp2WNIOErakZjUG/rXPNqHxA/fjyVxmG1JyV5NVNq5CVUH+UDFnocAx2NqEeX35NlbRhmVfpPdlxnw4JdmpPl85Y7fzJcblfaA18DPUpttM7x+j71VVNBlujvKYbhwcdNuVQJGREyIyGGYR6XokY97vvCwDl54b+JvNCBFzKoY6YaWJWPgm/fyq4nOdelE4tcGfqquzD6F47JMseokZnVeG3CxjwMujOZceg1uOj1eIA56fUZU5cb5TTjxM9H+u+sTrQxctMJFC+KvQBXRy+tPEj2XGUGi+XcjiWKuWEmLnnEGkeP3QjYtKJ5gSMkGZNO8hotwVVqsEwiQPctI1PMih61pVUKix8lUEs+aGllthsfErtPhWq8uc0TAhTMQ/XSw4Gev4YF3A17dSAOR19ZwESQW6mAhQDRwGBuzsDAN+7wQwQt1xUzTI+EqtzokzIO6pCZdKjJ4vtzvsvsTgviZjco8u8FhWGrJzERPz3MHE3Tdn5DnhqdWrFuAoBs3G844VHiTRMe+uGXjIE2MF5pKr7gxs2C/zoaExrNhiQsofZl60BX0Qpo30vBm2gMJPiPBYkCtXSft6dnbiS7MhmuazB9KdHx+MTshkM+WunU9mMB2+DmSlk5YTuKlNdOJuEfoJcGYz976J9Gp13ALv3zyC6KDPyKZlty1FDF9ZMvuLwE++UQFibs7rSTRuM14El1ffQQuSn/sLtDJ9bB3izWfxKNV/YlyjCEQePDmWdBi5Ee6PO8g0ck+uOsn+5qRFQYUNSLa2SsVQaTzgQwOXCT6PKIYWjqNMEA4Qd5fDQ8121xFov8/knUcdilpK/J3wYCxC58hOp+1h8QDjHfLQ6VQ9P6iT4A1exCQrCroHyJymD0oyEMkx0kYipkF/ROB+elXh/P+MmDensIy25Bourg3ZOyKzMUL+/OFXLykjRsSXR3zJFHl9m1E11dXhMjZ/Z+EyNXHJxEdLbkCCEcecClKIm79asklkdhjuFqJ3iOhXruOh9VG0WFXhV5D23U8pDbKPb8ncqJdpwS5fKtVNSxlo2Sz5CkhbYxQ2CYUK+gi+qFhyhxh+emyFa/c0gfPI559nHNIO3QhkcQnZwRXUqduEl3LxWWL8ewi+hWnImwTj6GqKHoMfvn2U+TpzcfP4VqWdBqJOOOXt2gqVF9LvorYQ2hQyZJ6WJ7cATx+zwOHOgFEH34ioyPQe2UR5KwaNwsvP+08QqLbOU5MC/F4OVa+i5B55hIcWNHvTtCrT/yK/T3Avb71O8jceFlCOE1iVJvxHCirO+DA2l6CZ+LwVvact5ghAFYnD147I6GaROyLV2BFFh7RGNtxyFlwFDbeNxkB2OXh23KO4wJesEBYzx1DsOcQntMmJ7ZiYhHCwno9GbxZmDU53oCqq3gc6CQSaVz+DMiZ9KEsV6pBvz5TBCtW4GUrbYFr261oNfwaf2QPDiqu4E3sLwUiG6dKq3wZuwxrwd5cx97sPgTxfBHlwtVjOL4iAAIERFnJa3fB6I5NzkF81jycUDonDLzLQPd8Dyav8bAPTwywMkXglqx4k2cQ+PuQY0B2Mq9/iIR5WBJk3iIpNRFvqJEADSmdjuOWl7QlOsHnebjkOZDiCzyEC090bsq8tiFyQi7GrEjp3BRJRJj4aRVjmqF3L4jYhHrC1ELAiHZzZ5Nw7+bS8brnXoRH5Uyi8rXINFUfvkV0yf2GbmWpySz1x9tSGdFKRpTM5Dke/phEoqF3JtQlPDWA9+Pptun7WSafydHXF7CmbD6Z0XFSP3obzktMCqO1lp2KyGFt24//3s4wL5HRLtQZPbxY78lXlEUiNnqhtBNVl/f+QkSW2OxEBJ/BiYvHytDbex6bAtsmKApMG9tILnqjvkfvdKFEP79mv00/wFL3s50DWdNf2O4ZSIV42JDI6YNh63GRqhsjB15y4HrdbIOUdZlr8qqrqHOuLLoGgb2qb8Louy1IVS+fhafPVKLG9N+H6Po3eELy9h/apsNd51Bq0jHOxYc3wur/tEaW/u7JNJ1pN9DD7MRGZZg/twm5JhlPsNqrZNGSxL+wfNTMlq/qK52CeRJDpEIlGrwap5AKu6y9G6PubVhabZXm5OEl3JCIGI+owE1uPeo7XN0quKKlA98TDfguNlk9BUs/tTig9IR/OCvAKSRF43Ja9hTjwQCPJG/UqCidT+GlaSCjfwB5uQBk5AHudQUZ9TZREDWJqLe7D4Ck4CMhKqsIzoo6VwyadnYxcuzNcyCn8LnSLZJfDUWZS0daLg59lvgSC4Dmv81TWcoS9BbjYyi4AYFSdX8ha8PNps35CgF6lYwKiZE2pVgVToUbhzGQbcFXjb9XqrKPmAd7U9iWBtdxLBcmutgruMunSmcoT1HZ5i5W5Tqbz5Tp9/osQReus8NXbslDG/D4DI8lzxEqGfIQPYFSn1FqCVeBk/A6vsSh+kSLGiKHTCi3ZoKWhkluzcRtnlqSG9qW5DbO2zN9PktewGvPcxsJDneew+2GSg8Q8YSPqzNXJsoTsyNTd/v0cvzBynh8YSHp4zPLxp96FSMKEh1l9tZRX5rayMI4I9R3ByqlnEzDCzk+w8XmkLb8Iy5ytk7eTdXLxm6l6k0dXmffgcHVD1UacDdTOHlZE7wU6/ZCW/NKRFWbVxZR9ZAXtyBUr/b1Icp78gPYuxuuwgZUPK3aXkaO0rZvmmLmwWadJ1FQNBqzjjf0R11b1EiKOUDaZ2+PjGTh+Gyy8SPHCoVl+k8KgBVVIUDGf4wPT9tIU4jIYZhH19GjCu5VhId18MJ7E/NkVqhgp12v8SEPk3IcO/ScP3EtqlcPCtWg18wfKKgYURcbCfieAs91mwe/e+3uQH4wweJ2636XrK7z7Vy+oXKLkYSfMv6e5/KNdkcMRVR/jGfoi6ErObffrjhryk5FbpeiXJkitw/hYkpkXMSFaXnsXYi7ArzdcvpAxvdH4cUOrRtB062uMCD4/Wn0uEgLch4L+n8AuYFh2a7JTNzYcqAKqdDiIPpmB5+8oswVDfxHeFF7ZBrUbOht5d5RtVykdud72XVglaJqOXPVcpBjarkayokG/lK1xVqzk9mQl6LWsw6YsfO+dpKwExN0+5KYqGYipoEw83/I6ol4MVF8rr2pHfd7g/iZo/0u1P0uS3Rdpfuf+5XCi0WNc0PDGl5SNJfuQa7aTSEih0xoS80E5YTJlpqJ2zy1ZEtoG0vsvqwJZ8+eG/EWPYHPkeRBPfCqFByo3bPnojj1FY3BSRyY/pOkF9RycB9Xi35DvpbLeUnnWlt0xYW4ErUIKrqHez3UckDZoDOsplbZNFHrJUK5Xi6t1ZMTjJD36Nbo/zd063KxIrePQn5tRf8PlqV0RnicY2BgYGQAgpOd+YYg+lw3kyOMBgA8PwUsAAB4nGNgZGBg4ANiCQYQYGJgBEIFIGYB8xgABaoAUwAAAHicY2BmYmCcwMDKwMHow5jGwMDgDqW/MkgytDAwMDGwMjPAgQCCyRCQ5prC4PCA4QMD44P/Dxj0GB8wKDQwMDDCFSgAISMAEEIMHwB4nGNgYGBmgGAZBkYGEPAB8hjBfBYGAyDNAYRMIIkHch8Y/v8HsxggLAUmAUaoLjBgZGNA5o5IAADrtAjMAAAAeJxjYGRgYADild0rzsfz23xl4GZiAIFz3UyOCPr/AyYGxgdALgcDWBoAMdIKXgAAeJxjYGRgYHzw/wGDHhMDA8M/BiAJFEEBzABt5wP2AAB4nGNigAAmBqxAgcEAiQ0hOdHUJDA4MDAAABelAT4AAAAAUAAAIQAAeJydj81Kw0AUhb9pk0LRTV3oNhS3iTMRXNR9F66lq4K0IYQsmoFJ8yo+iG/km3gSZyEoCB243I9zz/0Z4Jp3DOMzrLiPPGPJS+Q5BR+RE1YmjZxyZR4iL6S/yWmSpZT11DXyjBueIs/Z8xo5keczcsqtuYu8YG2eaanwnBSejpyegYYDQfrAkRrayp+87/J+aA6hGo6S/nD9qG6nWecpB/lqMkr9zCpvFP/v/PaVOFWd+nKxFT1quO/OWx+aOisLm22yX9dJK13ubF5aJ/9lH9xJD/K2U1em1eP57OrQt77LXGEvnPwFPSJZ7QB4nGNgZsALAAB9AAQ=) format('woff');
	font-weight: normal;
	font-style: normal;
}

body { margin: 3.5em 15% 5% 3.5em; color: #fff; background-color: #111; font-family: verdana,"dejavu sans",tahoma,arial,sans-serif; font-size: 12px; }
a { cursor: pointer; color: #46d; }
a:hover { color: #79f; }
a:active { color: #f70; }
a.link-internal, a.link-external { font-weight: bold; text-decoration: none; }
a.link-internal:hover, a.link-external:hover { text-decoration: underline; }
a.link-broken { padding: 3px; color: #000; background-color: red; font-weight: bold; text-decoration: none; }
input, textarea { color: #fff; background-color: #444; border: 1px solid #fff; }
input[type="text"], textarea { min-width: 16em; }
input { padding: 2px 3px; }
input:focus, textarea:focus { border: 1px solid #292; }
input:hover, textarea:hover { border: 1px solid #f70; }
noscript { color: red; font-size: 210%; font-weight: bold; }
button {
	cursor: pointer;
	padding: 4px 6px;
	color: #fff;
	background-color: #36c;
	border: 1px solid #58e;
	-webkit-border-radius: 4px;
	-moz-border-radius: 4px;
	border-radius: 4px;
	text-decoration: none;
	text-shadow: 1px 1px rgba(0, 0, 0, 0.4);
	-webkit-transition-duration: 200ms;
	-moz-transition-duration: 200ms;
	transition-duration: 200ms;
}
button:hover { background-color: #58e; border-color: #7af; }
button:active { background-color: #f70; border-color: #f92; }
.error { margin: 0 12px 0 3px; padding: 3px 5px; color: #000; background-color: red; font-weight: bold; }
.error[title] { cursor: help; }
.highlight, .marked { color: yellow; font-weight: bold; font-style: italic; }
.transition-in { opacity: 0; }

#store-area { display: none; z-index: 0; }

/* FULL SIDEBAR PROTOTYPE
#ui-bar { position: fixed; z-index: 50; top: 0; left: 0; width: 14.5em; height: 100%; margin: 0; padding: 3.5em 1.5em 0 3.5em; background-color: #111; border-right: 1px solid #fff; }
*/
#ui-bar { position: fixed; z-index: 50; top: 3.5em; left: 3.5em; width: 14.5em; margin: 0; padding: 0 1.5em 0 0; border-right: 1px solid #fff; }
#ui-bar header, #ui-bar nav, #ui-bar footer { text-align: right; }
#ui-bar header, #ui-bar nav { font-weight: bold; }
#ui-bar nav, #ui-bar footer { margin-top: 3em; }
#ui-bar ul { list-style: none; }
#ui-bar li { margin-bottom: 1em; }
#ui-bar li a { text-decoration: none; }

#story-caption, #menu-story, #menu-rewind, #menu-options, #menu-share { display: none; }
#story-title { margin: 0; font-size: 210%; }
#story-subtitle { font-size: 111%; }
#story-author { font-size: 111%; }
#story-caption { margin-top: 3em; text-align: right; }
#menu-story { line-height: 1.125; }

[data-icon], a.link-back:before, a.link-return:after, a.link-external:after,
#menu-saves a:before, #menu-rewind a:before, #menu-restart a:before, #menu-options a:before, #menu-share a:before,
#ui-body-close, #ui-body.options a[id|="option-input"]:before, #ui-body.options a[id|="option-input"].enabled:before {
	font-family: 'icomoon-sugarcube';
	speak: none;
	font-style: normal;
	font-weight: normal;
	font-variant: normal;
	text-transform: none;
	line-height: 1;
	-webkit-font-smoothing: antialiased;
	-moz-osx-font-smoothing: grayscale;
}
[data-icon]:before { content: attr(data-icon) "\00a0\00a0"; }
a.link-back:before { content: "\e00a\00a0\00a0"; }
a.link-return:after { content: "\00a0\00a0\e00b"; }
#passages a.link-external:after { content: "\00a0\e010"; }
#menu-saves a:before { content: "\e011\00a0\00a0"; }
#menu-rewind a:before { content: "\e012\00a0\00a0"; }
#menu-restart a:before { content: "\e013\00a0\00a0"; }
#menu-options a:before { content: "\e014\00a0\00a0"; }
#menu-share a:before { content: "\e015\00a0\00a0"; }

#credits, #version { margin-top: 1em; color: #999; font-weight: normal; font-size: 71%; }

/* Default menu styling */
body.ui-open { overflow: hidden; }
#ui-overlay {
	display: none;
	z-index: 1000;
	opacity: 0.8;
	position: fixed;
	top: 0px;
	left: 0px;
	height: 100%;
	width: 100%;
	background-color: #000;
}
#ui-body-close {
	display: none;
	z-index: 1110;
	opacity: 1;
	position: fixed;
	cursor: pointer;
	font-size: 111%;
	margin: 0;
	padding: 3px 4px;
	font-weight: normal;
	color: #fff;
	background-color: #36c;
	border: 1px solid #58e;
	-webkit-border-radius: 4px;
	-moz-border-radius: 4px;
	border-radius: 4px;
	text-decoration: none;
	text-shadow: 1px 1px rgba(0, 0, 0, 0.4);
	-webkit-transition-duration: 200ms;
	-moz-transition-duration: 200ms;
	transition-duration: 200ms;
	white-space: nowrap;
}
#ui-body-close:hover { background-color: #58e; border-color: #7af; }
#ui-body-close:active { background-color: #f70; border-color: #f92; }
#ui-body {
	display: none;
	z-index: 1100;
	opacity: 1;
	position: fixed;
	overflow: auto;
	min-width: 140px;
	max-width: 90%;
	max-height: 90%;
	color: #fff;
	background-color: #333;
	border: 1px solid #fff;
	text-align: left;
	line-height: 2;
}
#ui-body div {
	padding: 0.2em;
}
#ui-body hr { height: 1px; border: none; background-color: #fff; }

/* Default menu button styling */
#ui-body > ul > li + li > button {
	margin-left: 12px;
}

/* General dialog styling */
#ui-body.dialog {
	min-width: 280px;
	padding: 0.33em 1em 0.66em;
}
#ui-body.dialog > ul { display: block; width: 100%; margin: 0; padding: 0; list-style: none; text-align: left; }
#ui-body.dialog > ul li { display: inline-block; margin: 0; padding: 0.4em 0.4em 0.5em; }

/* Saves menu styling */
#ui-body.saves table {
	border-spacing: 0;
	min-width: 320px;
	width: 100%;
}
#ui-body.saves tr:nth-child(even) {
	background-color: #444;
}
#ui-body.saves td {
	padding: 0.33em 0.33em;
	line-height: 1.2;
}
#ui-body.saves td:first-child {
	min-width: 1.5em;
	text-align: center;
}
#ui-body.saves .empty {
	color: #999;
}
#ui-body.saves ul { display: block; margin: 0; padding: 0; list-style: none; white-space: nowrap; }
#ui-body.saves li { display: inline-block; margin: 0; padding: 0.33em 0.33em 0.4em; }
#ui-body.saves > div:not(:first-child) { border-top: 1px solid #fff; }
#saves-import-label { margin: 0 6px; font-weight: bold; }
#saves-import-file { margin: 0 6px 6px; }

/* Rewind & Share menu styling */
#ui-body.share > a { display: block; color: #fff; font-weight: normal; text-decoration: none; }
#ui-body.rewind div, #ui-body.share div, #ui-body.share a {
	padding: 0.15em 0.75em;
}
#ui-body.rewind div:nth-child(even), #ui-body.share div:nth-child(even), #ui-body.share a:nth-child(even) {
	background-color: #444;
}
#ui-body.rewind div:hover, #ui-body.share div:hover, #ui-body.share a:hover {
	cursor: pointer;
	color: #fff;
	background-color: #47b;
}
#ui-body.rewind div:active, #ui-body.share div:active, #ui-body.share a:active {
	background-color: #47b;
}

/* Options menu styling */
#ui-body.options [id|="option-body"] { display: table; width: 100%; }
#ui-body.options div[id|="option-body"] + div[id|="option-body"],
#ui-body.options div[id|="option-body"] + br + div[id|="option-body"] {
	margin-top: 0.5em;
}
#ui-body.options [id|="option-label"] { display: table-cell; width: 80%; padding: 0.33em 2em 0.4em 0.33em; }
#ui-body.options [id|="option-control"] { display: table-cell; padding: 0.33em 0.33em 0.4em; white-space: nowrap; }
#ui-body.options select[id|="option-input"] {
	cursor: pointer;
	padding: 3px 6px;
	font-weight: normal;
	color: #fff;
	background-color: #36c;
	border: 1px solid #58e;
	-webkit-border-radius: 4px;
	-moz-border-radius: 4px;
	border-radius: 4px;
	text-decoration: none;
	text-shadow: 1px 1px rgba(0, 0, 0, 0.4);
	-webkit-transition-duration: 200ms;
	-moz-transition-duration: 200ms;
	transition-duration: 200ms;
	white-space: nowrap;
}
#ui-body.options a[id|="option-input"] {
	cursor: pointer;
	padding: 4px 6px;
	font-weight: normal;
	color: #fff;
	background-color: #36c;
	border: 1px solid #58e;
	-webkit-border-radius: 4px;
	-moz-border-radius: 4px;
	border-radius: 4px;
	text-decoration: none;
	text-shadow: 1px 1px rgba(0, 0, 0, 0.4);
	-webkit-transition-duration: 200ms;
	-moz-transition-duration: 200ms;
	transition-duration: 200ms;
	white-space: nowrap;
}
#ui-body.options a[id|="option-input"]:hover {
	background-color: #58e;
	border-color: #7af;
}
#ui-body.options a[id|="option-input"].enabled {
	background-color: #292;
	border-color: #4b4;
}
#ui-body.options a[id|="option-input"].enabled:hover {
	background-color: #4b4;
	border-color: #6d6;
}
#ui-body.options a[id|="option-input"]:before { content: "\e002\00a0\00a0"; }
#ui-body.options a[id|="option-input"].enabled:before { content: "\e003\00a0\00a0"; }

/* Passages area styling */
/* FULL SIDEBAR PROTOTYPE
#passages { z-index: 10; margin-left: 16em; padding-left: 1.5em; }
*/
#passages { z-index: 10; margin-left: 16em; padding-left: 1.5em; border-left: 1px solid #fff; }
.passage { line-height: 1.75; margin-bottom: 2em; text-align: left; transition: opacity 400ms ease-in; -webkit-transition: opacity 400ms ease-in; }
.passage ul, .passage ol { margin-left: 0.5em; padding-left: 1.5em; }
.passage table { margin: 0.8em 1.0em; border-collapse: collapse; font-size: 100%; }
.passage th, .passage td, .passage tr, .passage caption { padding: 3px; }
.passage hr { height: 1px; border: none; background-color: #fff; }

/* Stop text selection on UI widgets */
button, #ui-body-close, #ui-body.rewind div, #ui-body.share div, #ui-body.share a, #ui-body.options a[id|="option-input"] {
	-webkit-user-select: none;
	-khtml-user-select: none;
	-moz-user-select: none;
	-ms-user-select: none;
	-o-user-select: none;
	user-select: none;
}

/* Basic mobile device styling */
@media screen and (max-width: 768px) {
	body { margin: 3.5%; }

	/* FULL SIDEBAR PROTOTYPE
	#ui-bar { position: relative; top: 0; left: 0; width: 100%; margin: 0; padding: 0; background-color: transparent; border-right: none; border-bottom: 1px solid #fff; }
	*/
	#ui-bar { position: relative; top: 0; left: 0; width: 100%; margin: 0; padding: 0; border-right: none; border-bottom: 1px solid #fff; }
	#ui-bar header, #ui-bar #story-caption, #ui-bar footer { text-align: left; width: 60%; }
	#ui-bar nav { position: absolute; top: 0; right: 0; margin: 0; }
	#ui-bar ul { margin: 0; }
	#ui-bar li { margin-bottom: 0.5em; }
	#ui-bar li#menu-story { margin-bottom: 0.7em; line-height: 0.9; }

	#passages {
		width: 100%;
		margin-left: 0;
		padding-top: 2em;
		padding-left: 0;
		border-left: none;
		min-height: 100vh;
	}
}
</style>
</head>
<body id="body">
	<div id="init-screen">
		<p id="init-no-js"><noscript>Apologies! JavaScript is required. Please enable it to continue.</noscript></p>
		<p id="init-lacking">Apologies! Your web browser lacks required capabilities. Please consider upgrading it or switching to a more modern web browser.</p>
		<p id="init-loading">Initializing.  Please wait&hellip;<br /><progress></progress></p>
	</div>
	<div id="ui-bar">
		<header id="title">
			<div id="story-banner"></div>
			<h1 id="story-title"></h1>
			<div id="story-subtitle"></div>
			<div id="story-title-separator"></div>
			<p id="story-author"></p>
		</header>
		<div id="story-caption"></div>
		<nav>
			<ul>
				<li id="menu-story"></li>
				<li id="menu-saves"><a>Saves</a></li>
				<li id="menu-rewind"><a>Rewind</a></li>
				<li id="menu-restart"><a>Restart</a></li>
				<li id="menu-options"><a>Options</a></li>
				<li id="menu-share"><a>Share</a></li>
			</ul>
		</nav>
		<footer>
			<p id="credits">This story was created with <a href="http://twinery.org/" target="_blank">Twine</a> and is powered by <a href="http://www.motoslave.net/sugarcube/" target="_blank">SugarCube</a>, which is based on <a href="http://tiddlywiki.com/" target="_blank">TiddlyWiki</a></p>
			<p id="version">SugarCube (v0.9.5-ALPHA.1)</p>
		</footer>
	</div>

	<div role="main" id="passages"></div>

	<div id="store-area" data-size="STORY_SIZE" hidden><div tiddler="Balancing Contact" tags="living" created="201404171622" modifier="twee" twine-position="380,1028">!Communicating with home\n!!!!Striking a balance\nYou will need to strike an appropriate balance between the folks back home and your new life abroad. Your family wants to know you are safe and having a good time, and your friends want to keep in touch--so don’t cut them off completely!\n\nAt the same time, be careful not to spend //all// your time chatting back home. Constant contact might be tempting, but will ultimately make culture shock harder to bear and prevent you from experiencing your host country to the fullest. Our suggestion for keeping a healthy balance: get out and explore, make new friends, and set up a weekly schedule for contacting home.\n\nAlso keep your experiences in perspective when you call home. What you report from abroad can seem much more serious to family who aren't around to assess the situation for themselves. Beware of venting; you don’t want to alarm anyone if you are only battling a head cold! Work with your on-site staff to remedy problems, and make sure your family knows you are safe and happy.\n\n&lt;&lt;sidebar-box&gt;&gt;\n   [[Phones and internet abroad|Phones and internet abroad]]\n&lt;&lt;/sidebar-box&gt;&gt;\n\n&lt;&lt;segue &quot;Disabilities and accommodations&quot;&gt;&gt;</div><div tiddler="CSS for replacelinks macros" tags="stylesheet" created="201407031641" modifier="twee" twine-position="0,0">.revision-span-in { opacity: 0; }\n.revision-span:not(.revision-span-out) { transition: 0.4s; -webkit-transition: 0.4s; }\n.revision-span-out { position: absolute; opacity: 0; }</div><div tiddler="DisplayAdmin" tags="script" created="201407031641" modifier="twee" twine-position="0,0">// Displays direct links for the current page, depending on selected\n// basic PDO types (semester, summer, etc.\n// Syntax: &lt;&lt;displayAdmin&gt;&gt;\n\nmacros.add(&quot;displayAdmin&quot;, {\n    version: { major: 1, minor: 0, revision: 0 },\n    handler: function () {\n        var passage = tale.get(state.active.title);\n        if (passage.tags.indexOf(&quot;no save&quot;) === -1) {\n            var html = &quot;&lt;div id='admin-area'&gt;&lt;h4&gt;Admin area&lt;/h4&gt;&quot;;\n            var hash = { &quot;Semester&quot;: &quot;&quot;,\n                         &quot;Summer&quot;: &quot;&summer=true&quot;,\n                         &quot;Summer faculty-led&quot;: &quot;&summer=true&facultyled=true&quot;,\n                         &quot;Maymester faculty-led&quot;: &quot;&maymester=true&facultyled=true&quot;\n                        };\n            $.each(hash, function(term, query) {\n                var url = window.location.protocol + &quot;//&quot; + window.location.host + window.location.pathname + &quot;?nav=&quot; + encodeURI(state.active.title) + query;\n                html += &quot;&lt;p&gt;&lt;strong&gt;&quot; + term + &quot;&lt;/strong&gt; : &lt;a href='&quot; + url + &quot;'&gt;&quot;+ url + &quot;&lt;/a&gt;&lt;/p&gt;&quot;;\n            });\n            html += &quot;&lt;/div&gt;&quot;;\n            $(&quot;div.body.content&quot;).append(html);\n        }\n    }\n});</div><div tiddler="Vaccination" tags="sidebar health" created="201404171642" modifier="twee" twine-position="1248,14">&lt;&lt;sidebar &quot;Do I Need Any Vaccinations?&quot;&gt;&gt;\nTo find out whether any vaccinations are required or recommended for your trip abroad, you may visit the [[Vanderbilt Student Health Center's Travel Medicine Clinic|https://medschool.vanderbilt.edu/student-health/travel-medicine]]. You are also, of course, welcome to see a travel medicine provider of your choice.\n\nRegardless of who you consult, schedule your initial appointment ''at least 6 weeks before your departure''. Think about //all// of the countries you hope to visit and discuss them all with your travel clinician.   \n\nBe aware that most ''medical insurance usually does not cover immunizations'' or other medications needed for travel!\n\n|box|k\n|!Resources|\n|[[Centers for Disease Control travel website|http://wwwnc.cdc.gov/travel]], an excellent resource with country-specific information|\n|[[The Yellow Book|http://wwwnc.cdc.gov/travel/yellowbook/2014/table-of-contents]], the CDC's extensive guide for foreign travel, with answers to questions you didn't even know to ask!|\n|[[VU Student Health Travel Medicine Clinic|https://medschool.vanderbilt.edu/student-health/travel-medicine]], information including list of documents to bring to your consultation|\n|[[List of information about vaccines|https://medschool.vanderbilt.edu/student-health/files/student-health/public_files/TravelImmunizations.pdf]] offered at VU Student Health, including approximate cost|\n\n&lt;&lt;segue &quot;Medical insurance&quot;&gt;&gt;</div><div tiddler="Passage Transition CSS" tags="stylesheet" created="201407031641" modifier="twee" twine-position="0,0">/* disable SugarCube's default passage transition */\n.passage { transition: none; -webkit-transition: none; }\n\n/* setup the new passage transition(s) */\n/* this is a simple 3-step fade out \n.transition-in { opacity: 0; position: absolute; }\n.passage:not(.transition-out) { transition: 0s 1100ms; -webkit-transition: 0s 1100ms; }\n.transition-out { opacity:0; position: absolute; transition: 1000ms steps(3); -webkit-transition: 1000ms steps(3); }\n*/\n\n/* Fast scroll (normal flow) */\n\n.transition-in:not(.flip) {\n    opacity:0;\n    transform: translate(0,-100rem);\n    -webkit-transform: translate(0,-100rem);\n    position:absolute;\n}\n.passage {\n    transition: 0.7s;\n    -webkit-transition: 0.7s;\n}\n.transition-out:not(.flip) {\n    opacity:0;\n    transform: translate(0,100rem);\n    -webkit-transform: translate(0,100rem);\n    position:absolute;\n}\n\n\n/* Page-flipping for sidebars */\n\n.flip.transition-in {\n    opacity:0;\n    position:absolute;\n    transform: rotateY(90deg);\n    -webkit-transform: rotateY(90deg);    \n}\n\n.flip.transition-out {\n    opacity:0;\n    transform: rotateY(-90deg);\n    -webkit-transform: rotateY(-90deg);\n    position:absolute;\n}\n\n#passages {\n    transition: background-color 0.4s cubic-bezier(0.95, 0.05, 0.795, 0.035);\n    -webkit-transition: background-color 0.4s cubic-bezier(0.95, 0.05, 0.795, 0.035);\n}</div><div tiddler="Basic shim for IE console.log" tags="script" created="201407031641" modifier="twee" twine-position="0,0">//from https://stackoverflow.com/questions/8785624/how-to-safely-wrap-console-log\nif (typeof console === &quot;undefined&quot;){\n    console={};\n    console.log = function(){\n        return;\n    }\n}</div><div tiddler="Continue arrow & animation" tags="stylesheet" created="201407031641" modifier="twee" twine-position="0,0">span.continue-button {\n    background:-webkit-gradient(linear, left top, left bottom, color-stop(0.05, #2dabf9), color-stop(1, #0688fa));\n    background:-moz-linear-gradient(top, #2dabf9 5%, #0688fa 100%);\n    background:-webkit-linear-gradient(top, #2dabf9 5%, #0688fa 100%);\n    background:-o-linear-gradient(top, #2dabf9 5%, #0688fa 100%);\n    background:-ms-linear-gradient(top, #2dabf9 5%, #0688fa 100%);\n    background:linear-gradient(to bottom, #2dabf9 5%, #0688fa 100%);\n    background-color:#2dabf9;\n    -moz-border-radius:28px;\n    -webkit-border-radius:28px;\n    border-radius:28px;\n    border:1px solid #c4ccff;\n    display:inline-block;\n    cursor:pointer;\n    color:#ffffff;\n    font-size:1.1em;\n    font-weight:normal;\n    padding:0px 15px 1px 10px;\n    text-decoration:none;\n    text-shadow:0px 1px 5px #2b4487;\n    -webkit-tap-highlight-color: rgba(0,0,0,0); /*No colored highlight on iOS/Android*/\n    -webkit-tap-highlight-color: transparent;\n    -moz-user-select: none;\n    -webkit-user-select: none;\n    -ms-user-select: none;\n    user-select: none;\n}\nspan.continue-button:hover {\n    background:-webkit-gradient(linear, left top, left bottom, color-stop(0.05, #0688fa), color-stop(1, #2dabf9));\n    background:-moz-linear-gradient(top, #0688fa 5%, #2dabf9 100%);\n    background:-webkit-linear-gradient(top, #0688fa 5%, #2dabf9 100%);\n    background:-o-linear-gradient(top, #0688fa 5%, #2dabf9 100%);\n    background:-ms-linear-gradient(top, #0688fa 5%, #2dabf9 100%);\n    background:linear-gradient(to bottom, #0688fa 5%, #2dabf9 100%);\n    background-color:#0688fa;\n}\n.onward-arrow {\n    position: relative;\n    left:0;\n    width:0.75em;\n    display:inline-block;\n}\n.fade-bounce {\n -webkit-animation-name: fade-bounce;\n -moz-animation-name: fade-bounce;\n -webkit-animation-duration: 1s;\n -moz-animation-duration: 1s;\n -webkit-animation-iteration-count: infinite;\n -moz-animation-iteration-count: infinite;\n -webkit-animation-direction: normal;\n -moz-animation-direction: normal;\n -webkit-animation-timing-function: ease-in;\n -moz-animation-timing-function: ease-in;\n animation-name: fade-bounce;\n animation-duration: 1s;\n animation-iteration-count: infinite;\n animation-direction: normal;\n animation-timing-function: ease-in;\n}\n @-webkit-keyframes fade-bounce {\n    0%   { left: 0; opacity:1.0; }\n    35%  { left: 0.75em; opacity:1.0; }\n    100% { left: 0.35em; opacity:0.25; }\n }\n@-moz-keyframes fade-bounce {\n    0%   { left: 0; opacity:1.0; }\n    35%  { left: 0.75em; opacity:1.0; }\n    100% { left: 0.35em; opacity:0.25; }\n}\n@keyframes fade-bounce {\n    0%   { left: 0; opacity:1.0; }\n    35%  { left: 0.75em; opacity:1.0; }\n    100% { left: 0.35em; opacity:0.25; }\n }\n @media print {\n  .continue-button {\n    display:none!important;\n  }\n}\n\n/* Bottom of page Back button */\nh6.page-back-link {\n    margin:0;\n    display:inline;\n}\n.page-back-link a {\n    color:#a8a8a8;\n}\n\n.page-back-link a::before {\n  font-family: 'icomoon-sugarcube';\n  speak: none;\n  font-style: normal;\n  font-weight: normal;\n  font-variant: normal;\n  text-transform: none;\n  line-height: 1;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n  content: &quot;\se00a\s00a0\s00a0&quot;\n}\n\n@media print {\n  h6.page-back-link {\n    display:none!important;\n  }\n}</div><div tiddler="Autoplay interface" tags="widget" created="201407031641" modifier="twee" twine-position="0,0">/%%%%%%%%%%%%%\n&lt;&lt;autoPlay filename [passage]&gt;&gt;\nIf you pass the title of a passage into the widget, things will automatically\nforward to that passage when the sound completes playing.\n\nIf no passage title is included, then the sound will simply play and stop.\nThis should be used for times when the reader has e.g. clicked on an\noptional link, or if some further interaction is called for.\n%%%%%%%%%%%%%%/\n&lt;&lt;widget &quot;autoPlay&quot;&gt;&gt;\s\n    &lt;&lt;set $autoplaySound to $args[0]&gt;&gt;\s\n        &lt;&lt;if  $args[1]&gt;&gt;\s\n            &lt;&lt;set $autoplayDestination to $args[1]&gt;&gt;\s\n        &lt;&lt;/if&gt;&gt;\s\n&lt;&lt;/widget&gt;&gt;\s</div><div tiddler="Alcohol and drugs" tags="safety" created="201405281702" modifier="twee" twine-position="975,876">!Alcohol and drugs\n!!!!Intoxication is a major contributor to injury abroad\nVanderbilt recommends that you avoid the use of alcohol and controlled substances while overseas, even if you are of legal age. Intoxication is a factor is the major factor in injuries and deaths experienced by American students abroad. Physical and mental impairment also make it difficult for you to take precautions for your own safety--including your sexual well-being.\n\nIf you do drink, do so in moderation. Be careful what you consume, and always watch your drink to avoid having it spiked with a dangerous substance. \n\nRemember that your behavior is subject to local laws, to policies set by your program provider and/or university, //and// to [[Vanderbilt policy|http://www.vanderbilt.edu/student_handbook/alcohol/]]. Laws governing controlled substances may differ greatly from those in your home country, and it is your responsibility to be aware. Public intoxication is always inappropriate, may be illegal, and can lead to serious--even fatal--consequences.\n\nIf you are uncertain about specific policies or laws abroad, please consult with a local program representative. GEO staff can also help you clarify policies.\n\n&lt;&lt;sidebar-box&gt;&gt;\n   [[Can I be arrested abroad?|Your legal status in your host country]]\n&lt;&lt;/sidebar-box&gt;&gt;\n\n|box|k\n|!Resources|\n|[[Vanderbilt Office of Wellness Programs and Alcohol Education|http://www.vanderbilt.edu/alcohol/]] provides information, resources, and referrals|\n|[[Vanderbilt Psychological and Counseling Center|https://medschool.vanderbilt.edu/pcc/student-services]], available for counseling, assessment, and treatment during and after your stay abroad|\n|[[Alcoholics Anonymous international meeting resources|http://www.aa.org/lang/en/aa_international.cfm?origpage=31]]|\n|[[Vanderbilt Student Handbook Alcohol Policy|http://www.vanderbilt.edu/student_handbook/alcohol/]]|\n\n&lt;&lt;segue &quot;Personal emergencies&quot;&gt;&gt;\s</div><div tiddler="Update Autoplay Button" tags="widget" created="201407031641" modifier="twee" twine-position="0,0">/%%%%%%%%%%%%%\n&lt;&lt;updateAutoplay&gt;&gt;\n\nThis updates the on-screen button for autoplay/sounds. Use this macro\nwhenever changing the state of the options.autoplay variable. \n%%%%%%%%%%%%%%/\n&lt;&lt;widget &quot;updateAutoplay&quot;&gt;&gt;\s\n    &lt;&lt;if options.autoplay&gt;&gt;\s\n        &lt;&lt;script&gt;&gt;$(&quot;#autoplay-switch&quot;).addClass(&quot;switchedon&quot;);&lt;&lt;/script&gt;&gt;\s\n    &lt;&lt;else&gt;&gt;\s\n        &lt;&lt;script&gt;&gt;$(&quot;#autoplay-switch&quot;).removeClass(&quot;switchedon&quot;);&lt;&lt;/script&gt;&gt;\s\n    &lt;&lt;/if&gt;&gt;\s\n&lt;&lt;/widget&gt;&gt;\s</div><div tiddler="Financial Aid" tags="policies sidebar" created="201404171613" modifier="twee" twine-position="145,343">&lt;&lt;sidebar &quot;Financial Aid&quot;&gt;&gt;\nAll ''semester-long programs available through GEO are eligible for federal and Vanderbilt financial aid''. All types of financial aid, other than work study, are applicable to semester-long study abroad. If you aren't sure about your financial aid package, check with your financial aid officer.\n\n''Summer and Maymester abroad programs are normally not eligible for Vanderbilt financial aid''. However, there may be some circumstances in which financial aid can apply to summer study. You should speak with your financial aid officer if you think an exception might apply in your case. \n\nThe Office of Financial Aid disburses funding from the scholarships covered by the ''GEO Common Scholarship Application''. Scholarship funds will be credited to your student account //on or about the day that your account is billed for your abroad program//. Please feel free to contact the Global Education Office's [[scholarship coordinator|https://webapp.mis.vanderbilt.edu/studioabroad/index.cfm?FuseAction=Abroad.ViewLink&Parent_ID=1B2936BD-9D45-883A-02A56AC77951A353&Link_ID=1B34B64E-9B4D-6FCE-D278333739D84B5D&pID=1&lID=5]] with questions about this process.\n\n&lt;&lt;segue &quot;Preparation and responsibilities&quot;&gt;&gt;\s</div><div tiddler="StoryTitle" tags="" created="201405061132" modifier="twee" twine-position="1194,1738">Global Education Office Predeparture Orientation</div><div tiddler="Your legal status in your host country" tags="safety sidebar" created="201405291528" modifier="twee" twine-position="1118,880">&lt;&lt;sidebar &quot;Your legal status in your host country&quot;&gt;&gt;\nMany US citizens are under the impression that their US passport acts as a &quot;get out of jail free&quot; card overseas. Nothing could be further from the truth. Whatever your nationality, if you are arrested, you will be subject to the entire foreign legal process--including imprisonment. Neither Vanderbilt or your government can do anything to get you out of prison!\n\nKnow the laws of your host country! Be aware that conditions in foreign jails and prisons may be very different from those in your home country. The legal system will also be difficult to understand and navigate. Your home country's consular officials can provide a wide array of services, but they //cannot extricate you from the situation//.\n\nDrug arrests can be particularly bad in many places. Harsh sentences, no bail, and dire conditions characterize many countries. Know the local laws and think twice before making a jail stay part of your time abroad. Do not carry packages or baggage for anyone else, and keep your own baggage under observation while traveling. If illegal sentences are found in your suitcase, //you// will pay the price.\n\nIf you are arrested, your embassy cannot hire legal counsel or pay your fines or legal fees. They can only notify your family, provide you with information, and ask that you be treated humanely and according to local laws.\n\n|box|k\n|!Resources|\n|[[Arrest or Detention of a US Citizen Abroad|http://travel.state.gov/content/passports/english/emergencies/arrest.html]]|\n|[[Country-Specific Information|http://travel.state.gov/content/passports/english/country.html]], includes information on noteworth aspects of the legal system for countries around the world|\n\n&lt;&lt;segue &quot;Personal emergencies&quot;&gt;&gt;\s</div><div tiddler="AutoPlay Sound widget" tags="widget" created="201407031641" modifier="twee" twine-position="0,0">/%%%%%%%%%%%%%\n&lt;&lt;autoplay filename [passage]&gt;&gt;\n\nThis widget is called automatically during the PassageDone phase\n(i.e., right after the passage has rendered), to prevent the voiceover\nfrom beginning before there is text on the page. It uses the values\nset by the &quot;autoPlay&quot; widget.\n\nA delay (in milliseconds) can be set in options.autoplaydelay; the sound\nwill begin playing only after at least this much time has passed since\nthe passage rendered. \n%%%%%%%%%%%%%%/\n&lt;&lt;widget &quot;autoplay&quot;&gt;&gt;\s\n    &lt;&lt;if options.autoplay&gt;&gt;\s\n            &lt;&lt;if $args[0] neq $autoplaySound&gt;&gt;\s\n                &lt;&lt;stopAllSounds&gt;&gt;\s\n            &lt;&lt;/if&gt;&gt;\s\n            &lt;&lt;set $args[2] to options.autoplaydelay&gt;&gt;\s\n            &lt;&lt;if $args[1]&gt;&gt;\s\n                &lt;&lt;playSoundDelay $args[0] $args[2] $args[1]&gt;&gt;\s\n            &lt;&lt;else&gt;&gt;\s\n                &lt;&lt;playSoundDelay $args[0] $args[2] &gt;&gt;\s\n            &lt;&lt;set $autoplay to $args[0]&gt;&gt;\s\n        &lt;&lt;/if&gt;&gt;\s\n    &lt;&lt;/if&gt;&gt;\s\n&lt;&lt;/widget&gt;&gt;\s</div><div tiddler="Time values support" tags="script" created="201407031641" modifier="twee" twine-position="0,0">//adapted from http://www.glorioustrainwrecks.com/files/TwineMacro-TimedLoop-1.1.0.txt\nString.prototype.cssTimeUnit = function() {\n    if (typeof this == &quot;string&quot;) {\n          if (this.slice(-2).toLowerCase() == &quot;ms&quot;) {\n            return Number(this.slice(0, -2)) || 0;\n          }\n          else if (this.slice(-1).toLowerCase() == &quot;s&quot;) {\n            return Number(this.slice(0, -1)) * 1000 || 0;\n          }\n        }\n        throw new Error(this + &quot; isn't a CSS this unit&quot;);\n        return 0;\n}</div><div tiddler="Sexual Misconduct" tags="sidebar policies" created="201406301636" modifier="twee" twine-position="145,886">&lt;&lt;sidebar &quot;Sexual misconduct abroad&quot;&gt;&gt;\nNorms of behavior, including sexual behavior, vary across the world. Depending on where you study abroad, you may find attitudes in your host country either more or less enlightened than those in the United States. Laws related to sex and sexual behavior will vary too, since laws tend to reflect the prevailing attitudes and norms of the societies that make them.\n\nWhile laws and social norms may be different in your host country, your study abroad program will probably //not// follow suit. Your program almost certainly caters to North American students, and if so ''expectations for behavior on your program will be very similar to those at Vanderbilt.''  Just as at Vanderbilt, these expectations apply to both students and to staff and faculty hired by the program.\n\nIf you are a victim of sexual misconduct while abroad, you should contact the resident director of your program for help. If your program is directly administered by Vanderbilt faculty, you should consult with your program leader. If it is not possible or advisable for you to discuss the issue with program staff, please contact Vanderbilt's [[Equal Opportunity, Affirmative Action, and Disability Services Department|http://www.vanderbilt.edu/ead/]] (EAD). \n\nIf you are found to have perpetrated an act or acts of sexual misconduct while on your abroad program, be aware that you may also be subject to local laws, and consequences may be severe. Also, as with any breach of the Vanderbilt code of conduct abroad, you may also face disciplinary sanctions when you return to the Nashville campus.\n\nIf you have questions or are not sure where to turn, please contact the [[Global Education Office|https://webapp.mis.vanderbilt.edu/studioabroad/index.cfm?FuseAction=Abroad.ViewLink&Parent_ID=1B2BA4C0-FC49-E73B-80E95C6B35878D81&Link_ID=1B4BC93A-F781-026B-FAC336662CD56FF3&pID=11&lID=65]] for confidential assistance.\n\n|box|k\n|!Resources|\n|[[VU Student Handbook on Sexual Misconduct|http://www.vanderbilt.edu/student_handbook/sexual-misconduct/]], includes comprehensive definition of sexual misconduct|\n|[[VU Equal Opportunity, Affirmative Action, and Disability Services Department|http://www.vanderbilt.edu/ead/]]|\n|[[Vanderbilt's anti-harassment policy|http://hr.vanderbilt.edu/policies/anti-harassment.php]], covering sexual and other types of harassment|\n\n&lt;&lt;segue &quot;Grades and credits&quot;&gt;&gt;\s</div><div tiddler="Disabilities and accommodations" tags="living" created="201404171622" modifier="twee" twine-position="379,1161">!Disabilities and accommodations\n!!!!Getting physical and academic accommodations\nIf you have registered with the [[Office of Equal Opportunity, Affirmative Action, and Disability Services|http://www.vanderbilt.edu/ead/index.html]] (EAD) to receive academic or physical accommodations at Vanderbilt, you will want to learn whether you can get similar accommodations on your program abroad.\n\nConsult with the EAD staff and request that they send your accommodations letter to your program advisor or  on-site staff. Do this //before// you depart! Program staff will use this letter in researching what accommodations are possible on site.\n\nIf you have a disability or challenge that you have so far managed without the EAD, you may want to meet with them before you study abroad. In addition to providing you with a letter, they can help you think through what you might need to ask of your program abroad.\n\nDo understand that while most requests will be honored, laws in other countries regarding required or reasonable accommodations often differ from what is mandated by law in the United States.\n\n|box|k\n|!Resources|\n|[[Vanderbilt Office of Equal Opportunity, Affirmative Action, and Disability Services|http://www.vanderbilt.edu/ead/index.html]]|\n|[[Mobility International USA|http://www.miusa.org/]], resources for travelers with disabilities|\n|[[Travelers with Disabilities|http://wwwnc.cdc.gov/travel/yellowbook/2014/chapter-8-advising-travelers-with-specific-needs/travelers-with-disabilities]], excellent information on traveling with physical disabilities|\n\n&lt;&lt;segue &quot;Money&quot;&gt;&gt;\s</div><div tiddler="Culture shock" tags="health" created="201404171642" modifier="twee" twine-position="980,274">!Culture shock\n!!!!The process of adjusting to a new culture\nStudy abroad is an amazing time in the lives of students. However, it is natural to have difficulty adjusting to a new culture. We call the feelings associated with this adaptation process &quot;culture shock,&quot; and they take a variety of forms. These may include homesickness, sadness, loneliness, frustration, anxiety, difficulty concentrating, and more.\n\nCulture shock is usually not sudden or &quot;shocking.&quot; Instead, it is part of a continuum of feelings. Usually, there is a period of excitement when you first arrive--there is so much to see and do! Feelings of culture shock typically come soon after. The good news is that culture shock is temporary. Nearly all students will, after a few weeks, adjust to and thrive in their new surroundings.\n\nHow long culture shock lasts and how difficult it is, of course, differs depending on the person. If you are having a hard time adjusting, especially if others on your program seem to be doing fine, reach out to your resident staff or director to explain what you are feeling.\n\nKeep in mind that you will likely experience a similar adjustment period when you return home and back to Vanderbilt. Students often tell us that this &quot;shock&quot; is harder than going abroad. \n\n&lt;&lt;sidebar-box&gt;&gt;\n   [[How should I cope with culture shock or other stress abroad?|Coping with stress and culture shock]]\n&lt;&lt;/sidebar-box&gt;&gt;\n\n&lt;&lt;segue &quot;Illness abroad&quot;&gt;&gt;\s</div><div tiddler="Reverse culture shock" tags="home bookmark" created="201404171648" modifier="twee" twine-position="1610,13">!Reverse culture shock\n!!!!Be prepared for coming home to be a bumpy ride\nIt may seem like a distant reality now, but part of the study abroad experience is returning home. There are many students who tell GEO that this is harder than expected, and often harder than going abroad to begin with!\n\nLook, reverse culture shock is a fact. Returning home after a significant period of time abroad is in some ways just like going abroad. You have changed, your perceptions have changed, and you are now used to living in and interacting with a different culture. You may even find that readjusting to life in the US is more difficult than the initial adaption to your host country! Instead of ignoring this reverse culture shock, learn about it and about effective ways to combat it. Rest assured, there are many resources that may be helpful as you make the adjustment to being back at home. You can find some resources on GEO's website (under [[Reverse Culture Shock|http://vanderbi.lt/reversecultureshock]]); you might want to bookmark it for when you come back! We're also listing some right here.\n\n|box|k\n|!Resources for Reverse Culture Shock|\n|[[Top 10 Challenges Faced on Returning from Study Abroad|http://www.du.edu/intl/abroad/pdf_docs/challenges_returnees.pdf]]|\n|[[Adjusting to Life Back Home|http://www.studyabroad.illinois.edu/resources/return/adjusting_home.aspx]]|\n|[[Common Challenges and Coping Strategies|http://www.du.edu/intl/abroad/pdf_docs/returneechallenges.pdf]]|\n|[[Tips for Family and Friends on Welcoming a Student Home|http://www.du.edu/intl/abroad/pdf_docs/twelvetips_parents.pdf]]|\n|[[Small Planet Studio, an online community for study abroad alums|http://www.smallplanetstudio.com/]]|\n|[[Melibee Global|http://www.melibeeglobal.com/]]|\n\n&lt;&lt;segue &quot;Opportunities for returned students&quot;&gt;&gt;\s</div><div tiddler="Continue Button" tags="widget" created="201407031641" modifier="twee" twine-position="0,0">/% Syntax:\n    &lt;&lt;segue [passage name]&gt;&gt;  %/\s\n&lt;&lt;widget &quot;segue&quot;&gt;&gt;\s\n    &lt;&lt;if tale.get(state.active.title).tags.indexOf(&quot;nosave&quot;) eq -1 &gt;&gt;\s\n        &lt;&lt;script&gt;&gt;\n            var passage = state.active.variables.args[0];\n            var el = document.createElement(&quot;a&quot;);\n            if (passage != null) {\n                el.setAttribute(&quot;data-passage&quot;, passage);\n                $(el).addClass(&quot;continue-link&quot;);\n                $(el).addClass(tale.has(passage) ? &quot;link-internal&quot; : &quot;link-broken&quot;);\n                el.innerHTML = &quot;&lt;span class='continue-button'&gt;Continue&lt;span class='onward-arrow fade-bounce'&gt;&raquo;&lt;/span&gt;&lt;/span&gt;&quot;;\n                $(el).click(function () {\n                    state.display(passage, el);\n                });\n            }\n            this.output.appendChild(el);\n        &lt;&lt;/script&gt;&gt;\n        &lt;&lt;if $index[state.active.title].enumeration gt 1&gt;&gt;\s\n            &lt;&lt;if tale.get(state.active.title).tags.indexOf(&quot;sidebar&quot;) eq -1&gt;&gt;\s\n                &nbsp; &nbsp;&lt;h6 class='page-back-link'&gt;&lt;&lt;click &quot;Previous&quot;&gt;&gt;&lt;&lt;prevPassage&gt;&gt;&lt;&lt;/click&gt;&gt;&lt;/h6&gt;\s\n            &lt;&lt;elseif state.length gt 1&gt;&gt;\s\n                &lt;&lt;set $temp to state.peek(1).title&gt;&gt;\s\n                &nbsp; &nbsp;&lt;h6 class=&quot;sidebar page-back-link&quot;&gt;[['Back to &quot;' + state.peek(1).title + '&quot;'|$temp]]&lt;/h6&gt;\s\n            &lt;&lt;else&gt;&gt;\s\n                /%Fallback for finding the passage\s\n                before the current sidebar when state fails%/\s\n                &nbsp; &nbsp;&lt;h6 class='page-back-link'&gt;&lt;&lt;click &quot;Back&quot;&gt;&gt;&lt;&lt;prevPassage 0&gt;&gt;&lt;&lt;/click&gt;&gt;&lt;/h6&gt;\s\n            &lt;&lt;/if&gt;&gt;\s\n        &lt;&lt;/if&gt;&gt;\s\n    &lt;&lt;/if&gt;&gt;\s\n&lt;&lt;/widget&gt;&gt;\s</div><div tiddler="Display index" tags="script" created="201407031641" modifier="twee" twine-position="0,0">macros.add(&quot;displayIndex&quot;, {\n    handler: function () {\n        var fullindex = state.active.variables.fullindex;\n        var html = &quot;&quot;;\n        var pass;\n        if (fullindex.length &gt; 0) {\n            $.each(fullindex, function(i, part){\n                //Insert section name\n                html += &quot;&lt;div class='index-item'&gt;&lt;h1 class='index-section'&gt;&quot; + fullindex[i].section + &quot;&lt;/h1&gt;&quot;;\n                if (part.passages.length &gt; 0) {\n                    $.each(part.passages, function(j, group) {\n                        if (group.hasOwnProperty(&quot;passage&quot;)) {\n                            pass = tale.get(group.passage);\n                            if (pass.tags.indexOf(&quot;nogather&quot;) === -1) {\n                                html += &quot;&lt;p class='index-passage'&gt;&lt;a class='index-passage' data-passage='&quot; + pass.title + &quot;'&gt;&quot; + pass.title + &quot;&lt;/a&gt;&lt;/p&gt;&quot;;\n                            }\n                        }\n                         if (group.hasOwnProperty(&quot;sidebars&quot;)) {\n                            group.sidebars.forEach (function (side) {\n                                pass = tale.get(side);\n                                if (pass.tags.indexOf(&quot;nogather&quot;) === -1) {\n                                    html += &quot;&lt;p class='index-sidebar'&gt;&lt;a class='index-passage' data-passage='&quot; + pass.title + &quot;'&gt;&quot; + pass.title + &quot;&lt;/a&gt;&lt;/p&gt;&quot;;\n                                }\n                            });\n                        } \n                    });\n                }\n                html += &quot;&lt;/div&gt;&quot;;\n            });\n        }\n\n        $(&quot;#index-list&quot;).html(html);\n\n        $(&quot;a.index-passage&quot;).on(&quot;click&quot;, function () {\n            state.display($(this).attr(&quot;data-passage&quot;));\n        });\n    }\n});</div><div tiddler="MenuOptions" tags="" created="201407031641" modifier="twee" twine-position="0,0">&lt;&lt;optiontoggle &quot;autoplay&quot;&gt;&gt;Autoplay&lt;&lt;/optiontoggle&gt;&gt;</div><div tiddler="External Script Loader" tags="script" created="201407031641" modifier="twee" twine-position="0,0">//adapted from http://videlais.com/2013/03/05/twine-tuesday-loading-external-javascript/\n(function () {\n    macros.add(&quot;loadJS&quot;, {\n        version: {\n            major: 1,\n            minor: 0,\n            revision: 0\n        },\n        handler: function () {\n            try {\n                var se = document.createElement(&quot;script&quot;);\n                se.type = 'text/javascript';\n                se.src = this.args[0];\n                $(&quot;head&quot;).append(se);\n                if(se.innerText) {eval(se.innerText);}\n                else {eval(se.textContent);} \n            } \n            catch (e) {\n                return this.error(&quot;LoadJS: &quot; + e.message);\n            }\n        }\n    });\n}());</div><div tiddler="DisplayAll" tags="script" created="201407031641" modifier="twee" twine-position="0,0">// Simple macro that displays all passages at once.\n// The macro *must* be called only from a passage with the tag &quot;nogather&quot;\n// Syntax:\n// &lt;&lt;displayAll&gt;&gt;\n\nmacros.add(&quot;displayAll&quot;, {\n    version: { major: 1, minor: 0, revision: 0 },\n    handler: function () {\n        var fullindex = state.active.variables.fullindex;\n        var el = this.output;\n        var elem;\n        var pass;\n        if (fullindex.length &gt; 0) {\n            $.each(fullindex, function(i, part){\n                elem = insertElement(el, &quot;h1&quot;, null, &quot;full-print&quot;);\n                new Wikifier(elem, fullindex[i].section);//Insert section name\n                console.log(&quot;h1: &quot; + fullindex[i].section);\n                if (part.passages.length &gt; 0) {\n                    $.each(part.passages, function(j, group) {\n                        if (group.hasOwnProperty(&quot;passage&quot;)) {\n                            pass = tale.get(group.passage);\n                            if (pass.tags.indexOf(&quot;nogather&quot;) === -1) {\n                                elem = insertElement(el, &quot;div&quot;, pass.domID, &quot;full-print&quot;);\n                                elem.setAttribute(&quot;data-passage&quot;, pass.title);\n                                new Wikifier(elem, pass.processText());\n                                console.log(&quot;   &quot; + pass.title);\n                            }\n                        }\n                         if (group.hasOwnProperty(&quot;sidebars&quot;)) {\n                            group.sidebars.forEach (function (side) {\n                                console.log(&quot;state:&quot;);\n                                console.log(state);\n                                pass = tale.get(side);\n                                if (pass.tags.indexOf(&quot;nogather&quot;) === -1) {\n                                    elem = insertElement(el, &quot;div&quot;, pass.domID, &quot;full-print&quot;);\n                                    elem.setAttribute(&quot;data-passage&quot;, pass.title);\n                                    new Wikifier(elem, pass.processText());\n                                }\n                            });\n                        } \n                    });\n                }\n            });\n        }\n    }\n});</div><div tiddler="StoryInit" tags="" created="201407031641" modifier="twee" twine-position="0,0">/% Add the header & controls to the document when the story first loads. %/\n&lt;&lt;set options.autoplaydelay to 0&gt;&gt;\n&lt;&lt;set $csscalc to true&gt;&gt;\n&lt;&lt;set $facultyled to false&gt;&gt;\n&lt;&lt;set $vanderbilt to false&gt;&gt;\n&lt;&lt;set $admin to false&gt;&gt;\n&lt;&lt;set $maymester to false&gt;&gt;\n&lt;&lt;set $urlopts to {}&gt;&gt;\n&lt;&lt;set $temp to &quot;&quot;&gt;&gt;\n&lt;&lt;script&gt;&gt;\n    // Create new options interface\n    window.setOption = function(name, value) {\n        try {\n            options[name] = value;\n        }\n        catch (e) {\n            throw new Error(&quot;Attempted to set nonexistent option &quot; + name + &quot;.&quot;);\n        }\n        //macros.get(&quot;saveoptions&quot;).handler();\n    }\n    // Check CSS3 calc() support\n    $('body').append('&lt;div id=&quot;css3-calc&quot;&gt;&lt;/div&gt;');\n    var css3_calc = parseInt($('#css3-calc').width());\n    if(css3_calc == 10) {\n        state.active.variables.csscalc = false;\n    }\n    $('#css3-calc').remove();\n\n    // Initialize chapter progress storage\n    if (!options.chapterprogress) {\n        setOption(&quot;chapterprogress&quot;, 0);\n    }\n    if (!options.passageprogress) {\n        setOption(&quot;passageprogress&quot;, 0);\n    }\n\n    // Set up custom UI\n    var header = insertElement(document.html, &quot;header&quot;, &quot;custom&quot;);\n    var banner = insertElement(header, &quot;h2&quot;, &quot;section-name&quot;, &quot;&quot;, &quot;GEO Predeparture Information&quot;);\n    var controls = insertElement(header, &quot;div&quot;, &quot;controls&quot;);\n    var story_rewind = insertElement(controls, &quot;div&quot;, &quot;story-rewind&quot;);\n    var sound_controls = insertElement(controls, &quot;div&quot;, &quot;sound-controls&quot;);\n    var progress = insertElement(header, &quot;div&quot;, &quot;progress&quot;);\n    var toggle = insertElement(sound_controls, &quot;button&quot;, &quot;autoplay-switch&quot;);\n    var backgrounds = insertElement(document.body, &quot;div&quot;, &quot;backgrounds&quot;);\n    var image_container_1 = insertElement(backgrounds, &quot;div&quot;, &quot;bkgd-1&quot;);\n    var image_container_2 = insertElement(backgrounds, &quot;div&quot;, &quot;bkgd-2&quot;);\n\n    $(&quot;body&quot;).before(backgrounds);\n    $(&quot;body&quot;).before(header);\n    $(&quot;#custom&quot;).css(&quot;display&quot;,&quot;none&quot;);\n    $(image_container_1).addClass(&quot;img-anchor img-container&quot;);\n    $(image_container_2).addClass(&quot;img-fader img-container&quot;);\n    $(progress).html(&quot;&lt;div id='progress-meter'&gt;&lt;span id='pb-complete'&gt;&lt;/span&gt;&lt;span id='pb-position'&gt;&lt;/span&gt;&lt;/div&gt;&quot;);\n\n    $(toggle)\n        .attr(&quot;type&quot;, &quot;button&quot;)\n        .addClass(function() {\n            if (options.autoplay) { return &quot;switchedon&quot; }\n        })\n        .click(function() {\n            $(toggle).toggleClass(&quot;switchedon&quot;);\n            if ( $(toggle).hasClass(&quot;switchedon&quot;) ) {\n                var soundName = state.active.variables.autoplaySound;\n                setOption(&quot;autoplay&quot;, true);\n                var sound = macros.get(&quot;playSound&quot;).soundtracks[soundName.slice(0, soundName.lastIndexOf(&quot;.&quot;))];\n                if (sound) { sound.play() }\n            }\n            else {\n                setOption(&quot;autoplay&quot;, false);\n                var sounds = macros.get(&quot;playSound&quot;).soundtracks;\n                for (var i in sounds) {\n                    if (sounds.hasOwnProperty(i)) {\n                        sounds[i].pause();\n                        sounds[i].currentTime = 0;\n                    }\n                }\n            }\n        });\n\n    // Prep first background image object with inline CSS for background image\n    $(&quot;.img-anchor&quot;).css(&quot;background-image&quot;, &quot;url(&quot;+ getBackgroundImage(&quot;.img-anchor&quot;) +&quot;)&quot;);\n\n    //Process URL substring for options\n    state.active.variables.urlopts = parseQueryString( window.location.search.substring(1) );\n    var opts = state.active.variables.urlopts;\n    for (var key in opts) {\n        if ( opts.hasOwnProperty(key) ) {\n            state.active.variables.urlopts[key] = decodeURIComponent(opts[key]);\n            if (state.active.variables.hasOwnProperty(key)) {\n                state.active.variables[key] = state.active.variables.urlopts[key];\n                console.log(&quot;Setting variable $&quot;+ key + &quot; to &quot; + state.active.variables.urlopts[key]);\n            }\n        }\n    }\n    if (opts.hasOwnProperty(&quot;admin&quot;)) {\n        console.log (&quot;Setting start passage to &quot; + options.adminStart);\n        SaveSystem.deleteAuto();\n        config.startPassage = options.adminStart;\n    } \n    if (opts.hasOwnProperty(&quot;nav&quot;)) {\n        SaveSystem.deleteAuto();\n        config.startPassage = opts[&quot;nav&quot;];\n    } \n&lt;&lt;/script&gt;&gt;\n\n/% Initialize variables %/\n/% &lt;&lt;set $index to {}&gt;&gt;\n&lt;&lt;set $section to &quot;&quot;&gt;&gt;\n&lt;&lt;set $backgrounds to {}&gt;&gt;\n&lt;&lt;set $tags to []&gt;&gt; %/\n/% Custom scrollbar %/\s\n&lt;&lt;loadJS &quot;jquery.nicescroll.js&quot;&gt;&gt;\s\n&lt;&lt;script&gt;&gt;\n$(document).ready(\n    function() {  \n        $(&quot;body&quot;).niceScroll({\n            cursorwidth: &quot;8px&quot;, \n            railpadding:{top:0,right:5,left:0,bottom:0}\n        });\n    }\n);\n&lt;&lt;/script&gt;&gt;\s\n&lt;&lt;loadJS &quot;superfish/hoverIntent.js&quot;&gt;&gt;\s\n&lt;&lt;loadJS &quot;superfish/superfish.min.js&quot;&gt;&gt;\s\n&lt;&lt;display &quot;Table of Contents&quot;&gt;&gt;\n&lt;&lt;script&gt;&gt;\n//Set up the progress bar\nvar fullindex = state.active.variables.fullindex;\nif (fullindex.length &gt; 0) {\n    var len = 0;\n    var stops = [];\n    var colorA = &quot;#b0b0b0&quot;;\n    var colorB = &quot;#d8d8d8&quot;;\n    var first = colorA;\n    var second = colorB;\n    for (var i = 0; i &lt; fullindex.length; i++) {\n        len += fullindex[i].passages.length;\n        stops.push(fullindex[i].passages.length);\n    }\n    console.log(stops);\n    var rule = &quot;linear-gradient(to right, &quot;;\n    if (len &gt; 0) {\n        rule += colorA + &quot;, &quot;;\n        var sum = 0;\n        for (i = 0; i &lt; stops.length; i++) {\n            //get first color, then choose opposite\n            if (i === 0 || i % 2 === 0) {\n                first = colorA;\n                second = colorB;\n            }\n            else {\n                first = colorB;\n                second = colorA;\n            }\n            var val = (stops[i]/len)*100;\n            rule += first + &quot; &quot; + (sum + val);\n            if (i + 1 === stops.length) {\n                rule += &quot;%)&quot;;\n            }\n            else {\n                rule += &quot;%, &quot; + second + &quot; &quot; + (sum + val) + &quot;%, &quot;;\n                sum += val;\n            }\n        }\n        $(&quot;#progress-meter&quot;).css(&quot;backgroundImage&quot;, rule);\n    }\n}\n\n\nif (isHandheld() === true) {\n    console.log(&quot;You have a handheld device!&quot;);\n}\n&lt;&lt;/script&gt;&gt;</div><div tiddler="Ethical photography" tags="home sidebar" created="201404171648" modifier="twee" twine-position="1753,279">&lt;&lt;sidebar &quot;Ethical Photography Abroad&quot;&gt;&gt;\nAs a representative of Vanderbilt, your home country, and the global community at large, you have a responsibility to follow ethical and respectful photography practices. Be mindful of the message your final product sends as well as the impact it has on the host culture.\n\nDefinitely ''get permission'' to photograph human subjects: There are cultures where people consider photography rude or a violation of modesty, or believe that the camera can be harmful to health. And in all cultures there are people who just don't like to be photographed! Don't be afraid to ask for permission, though, or let it stop you from shooting. Instead consider asking for permission as opportunity to make a connection, have a conversation, and to demonstrate your interest in the people of your host country!\n\n|box|k\n|!Questions to ask yourself before you snap that picture|\n|Does the photo make fun of the culture or people of my host country?|\n|Does this picture tell a false story about my host country or its people?|\n|Does the subject mind that I'm photographing them?|\n|What message does this photo send about how I spent my time abroad?|\n\n''More resources:''\n[[Guidelines for Culturally Sensitive Photography|http://www.culturosity.com/pdfs/CulturallySensitivePhotography.pdf]]\n[[Breaking Free from the Viewfinder|http://www.melibeeglobal.com/2012/09/photography-while-on-study-abroad-breaking-free-from-the-viewfinder/]]\n\n&lt;&lt;segue &quot;What to do next&quot;&gt;&gt;\s</div><div tiddler="Image with Caption" tags="widget" created="201407031641" modifier="twee" twine-position="0,0">/% Syntax:\n       &lt;&lt;figure [image url] \n                [caption text]\n                [optional: &quot;left&quot; or &quot;right&quot;, to float figure container; other classes could be given here as well]&gt;&gt;  %/\s\n&lt;&lt;widget &quot;figure&quot;&gt;&gt;\s\n    &lt;&lt;script&gt;&gt;\n        (function () {\n            var url = &quot;&quot;;\n            url = state.active.variables.args[0];\n            var text = &quot;&quot;;\n            text = state.active.variables.args[1];\n            var positioning = &quot;&quot;;\n            positioning = state.active.variables.args[2].length ? state.active.variables.args[2] : &quot;&quot;;\n            var container = insertElement( \n                output, \n                &quot;figure&quot;, \n                &quot;&quot;, \n                positioning \n            );\n            var image = insertElement(\n                container,\n                &quot;img&quot;\n            );\n            var figurecaption = insertElement(\n                container,\n                &quot;figcaption&quot;,\n                &quot;&quot;,\n                &quot;&quot;,\n                text\n            );\n            image.src = url;\n        }());\n    &lt;&lt;/script&gt;&gt;\s\n&lt;&lt;/widget&gt;&gt;\s</div><div tiddler="Passport Check" tags="travel" created="201404291457" modifier="twee" twine-position="378,146">&lt;img src=&quot;images/warning.png&quot; class=&quot;left inline&quot; style=&quot;width:40px; margin-right:10px;&quot; /&gt;\s\n!Passport Check\n!!!!Be sure that you have a valid passport, and that it will not be expiring within the next year or so.\nBefore we go any farther, take a moment to check your passport's expiration date.\n\n/%&lt;&lt;figure &quot;images/passport_expiration.jpg&quot; &quot;Where to find the expiration date on your main passport page.&quot; &quot;right&quot;&gt;&gt;%/Most countries will not allow you to get a student visa or residence permit if your passport is near its expiration date. ''Be sure that your passport does not expire until at least 6 months after your program ends!''\n\n&lt;&lt;sidebar-box&gt;&gt;\n\t[[Uh oh, it looks like I need a new passport!|Passport Acquisition]]\n&lt;&lt;/sidebar-box&gt;&gt;\n\n&lt;&lt;segue &quot;Documents&quot;&gt;&gt;</div><div tiddler="Making friends" tags="living" created="201405161420" modifier="twee" twine-position="383,1686">!Making friends\n!!!!Consider your goals as well as your opportunities\nStarting off in a foreign country is in some ways like being a first-year student again. //Everything// is new, including all of the other students. Most study abroad programs offer orientation activities at the beginning of the semester. Take advantage of social opportunities during this orientation. It's your best chance to get to know the other participants, and it's not hard--luckily, they happen to be in the market for new friends too!\n\nWhile it will be great to have friends in your program, you should be aware of the disadvantages of spending too much time with other Americans. If your goals include meeting local people, learning the language, or becoming something more than a long-stay tourist, you will need to look beyond the American crowd.\n\n&lt;&lt;segue &quot;Making local friends&quot;&gt;&gt;\s</div><div tiddler="Registration" tags="finish" created="201405131352" modifier="twee" twine-position="1618,1014">!Registration\n!!!!Don't forget to register!\nPlease fill out the form below to register your participation. It may take a few days before your registration is reflected in your GEO account.\n\n&lt;html&gt;&lt;iframe id=&quot;JotFormIFrame&quot; onload=&quot;window.parent.scrollTo(0,0)&quot; allowtransparency=&quot;true&quot; src=&quot;https://secure.jotformpro.com/form/41326113066949&quot; frameborder=&quot;0&quot; style=&quot;width:100%; height:467px; border:none;&quot; scrolling=&quot;no&quot;&gt;&lt;/iframe&gt;\n&lt;script type=&quot;text/javascript&quot;&gt;window.handleIFrameMessage = function(e) {var args = e.data.split(&quot;:&quot;);var iframe = document.getElementById(&quot;JotFormIFrame&quot;);if (!iframe)return;switch (args[0]) {case &quot;scrollIntoView&quot;:iframe.scrollIntoView();break;case &quot;setHeight&quot;:iframe.style.height = args[1] + &quot;px&quot;;break;}};if (window.addEventListener) {window.addEventListener(&quot;message&quot;, handleIFrameMessage, false);} else if (window.attachEvent) {window.attachEvent(&quot;onmessage&quot;, handleIFrameMessage);}&lt;/script&gt;&lt;/html&gt;</div><div tiddler="Religious identity abroad" tags="living sidebar" created="201405200954" modifier="twee" twine-position="790,890">&lt;&lt;sidebar &quot;Religious identity abroad&quot;&gt;&gt;\nReligion is a prominent feature of cultures around the world, even in countries that are officially atheist. During your time abroad, you will likely encounter fascinating and enriching ideas and practices. You may also experience things that challenge your notions of spiritual truth or even basic fairness. \n\nIf you plan to practice your own religion abroad, do some research first. You'll want to know whether there are convenient houses of worship, of course. But depending on where you are going, there may be safety issues to consider as well.\n\nIn some countries, there may be little commitment to religious pluralism. The state may sanction a religion. Or laws may restrict religious speech, particularly as it relates to political activism. In China, for example, it is illegal to use religion to &quot;disrupt social order, impair the health of citizens, or interfere with the educational system of the state.&quot;\n\nEven if the society is generally an open one, be aware that safety concerns may still exist. Just as in the US, wearing symbols of some religions, or even frequenting houses of worship, may make you a target for passionate violence from other groups. \n\nWhatever your personal beliefs and circumstances, remember that your primary purpose is studying abroad. Consider your experiences an opportunity to understand the historical and social dimensions of religion in your host country. Be open-minded, save critical impulses for later, and open your own beliefs and practices to the same degree of scrutiny. If you approach your time in your host country as a time to learn about others' beliefs and attitudes, you can avoid many opportunities for conflict.\n\n|box|k\n|!Questions to ask yourself|\n|Is there a dominant religion in my host country?|\n|&lt;hr&gt;What laws exist pertaining to religion? Are there strong societal practices that, while not codified in law, might shape religious practice?|\n|&lt;hr&gt;How tolerant is my host country of religious diversity?|\n|&lt;hr&gt;How tolerant is my host country of nonbelief (i.e. atheism, agnosticism)?|\n|&lt;hr&gt;Where can I practice my religion?|\n|&lt;hr&gt;How safe is it for me to wear symbolic expressions of my religion in public?|\n|&lt;hr&gt;How can I accommodate my dietary requirements abroad?|\n\n|box|k\n|!Resources|\n|[[Pluralism Project|http://www.pluralism.org/reports/links]], bibliography of research and websites on world religions|\n|[[International Religious Freedom|http://www.state.gov/j/drl/rls/irf/religiousfreedom/index.htm#wrapper]], the most recent report from the US State Department on religious freedom around the world|\n|[[Jewish Travel Advisor|http://jewishtraveladvisor.com/]], world-wide listing of kosher hotels and restaurants, synagogues, mikvaot, and Jewish communities around the world |\n|[[Halal Trip|http://www.halaltrip.com/city-guide-all]], website focused on Muslim travelers and including city guides with a focus on halal dining|\n\n&lt;&lt;segue &quot;Contacts and communications&quot;&gt;&gt;\s</div><div tiddler="Index" tags="finish nogather" created="201404171650" modifier="twee" twine-position="1613,744">!Index\n!!!!Quick reference\nThis page lists all of the information you have viewed in this presentation. You may ''bookmark'' it now for easy access later.\n\n&lt;&lt;segue &quot;Credits&quot;&gt;&gt;\n\n&lt;div id=&quot;index-list&quot; class=&quot;index-columns&quot;&gt;Error: Index could not be shown. Try reloading the page.&lt;/div&gt;\s\n/% The code that displays the index is in ::PassageDone and works only when the name of the passage is &quot;Index&quot; %/\s\n</div><div tiddler="Documents" tags="travel" created="201404171617" modifier="twee" twine-position="378,281">!Passport and Document Security\n!!!!Keep your passport and other key documents safe\nWhen you are abroad, no single document is more important than your passport. Without it, ''you will not be able to cross international borders'', and other tasks--such as transferring funds--may also be made difficult or impossible. Losing your passport can be a major headache, and might even cost you thousands of dollars in airfare for missed flights. Do everything you can to keep it safe!\n\nIn general, you should only keep your passport on your person when you are traveling across borders. Otherwise, ''find a safe place for it and leave it there.'' Make a photocopy and carry that on you when you are out and about.\n&lt;img src=&quot;images/passport wallet.jpg&quot; class=&quot;right&quot; style=&quot;height: 250px;&quot; /&gt;\s\n\nIf you must carry your passport with you, keep it in a special ''passport wallet'' under your clothes.\n\n|box|k\n|!(Potentially) Good Places to Keep Your Passport|\n|Hidden in the room of your homestay or residence hall|\n|In your hotel's safe (//not// the room safe)|\n|With your study abroad provider, if they offer such a service|\n|&lt;hr&gt;//In some situations, even these options may not be secure. Use your common sense and evaluate the situation. If in doubt, talk to your Resident Director for advice.//|\n\n&lt;&lt;sidebar-box&gt;&gt;\n   [[How do I go about getting a travel visa?|Visa Acquisition]]\n&lt;&lt;/sidebar-box&gt;&gt;\n\n&lt;&lt;segue &quot;Traveling with medications&quot;&gt;&gt;</div><div tiddler="Sexual and gender identity abroad" tags="living sidebar" created="201405191507" modifier="twee" twine-position="786,758">&lt;&lt;sidebar &quot;Sexual and gender identity abroad&quot;&gt;&gt;\nIf you identify as lesbian, gay, bisexual, transgender, queer/questioning, or intersex, you will want to take time to consider whether and how you plan to be out abroad. Depending on where you are traveling, your destination may provide you with either a more open environment than the US, or a much less welcoming one. Either way, be prepared: make yourself aware in advance of local attitudes, beliefs, and understandings. Ask yourself questions like the following:\n\n|box|k\n|!Questions for LGBTQI Students to Consider:|\n|What behaviors are legal in my host country? If I am interested in activism, are there ways to practice it both safely and legally?|\n|&lt;hr&gt;Is it safe for me to be out in my host country and city?|\n|&lt;hr&gt;How open do I want or need to be about my gender or sexual identity while abroad? Do I plan to be out? How specifically will I reconcile my human rights with the cultural values of my host country?|\n|&lt;hr&gt;If my destination is one where I need to conceal my identity, how will this impact my experience?|\n|&lt;hr&gt;What are the cultural norms surrounding friendship and dating in my host culture?|\n|&lt;hr&gt;What norms surround publicly identifying as LGBTQI in my host culture? How does my self-presentation &quot;read&quot; in my host culture's system of gendered norms and expectations?|\n|&lt;hr&gt;What is the LGBTQI community in my host city like? How is it different from the community at home?|\n|&lt;hr&gt;What on-site resources will I have if I experience any issues/concerns while I am abroad? Are there LGBTQI organizations or other resources at my host university or in my host city?|\n|&lt;hr&gt;Do I have concerns about my housing situation? (If living with a host family, consider making the housing coordinator aware that you would like a host family that has hosted LGBQTI students in the past.)|\n|&lt;hr&gt;Might I face challenges with travel and documents due to my gender presentation?|\n\nRegardless of self-identification, all students should be aware not only of local attitudes and beliefs surrounding sex and sexual identity, but also of local laws. Some countries criminalize speech as well as behavior, and you need to be well informed about matters that could affect your safety and well-being. The [[ILGA website|http://ilga.org/]] is a good resource for checking on legal regimes around the world. \n\nStudy abroad is often a time when students explore identity and selfhood. If you are not out at home and are considering being out abroad, please make doubly sure that you do your research and ensure that your safety and well-being are provided for. If you will live with a homestay family and want to be out to them, consider telling the housing coordinator in advance that you would like an LGBQTI-friendly family. You can stipulate that they keep your request confidential, including from the family.\n\nThe local LGBQTI community will likely be quite different from that in your home country. Coming to know and understand this new culture will likely be exciting and rewarding, but like any process of cultural adaptation it may also be trying at times. Learn as much as you can in advance, but also adopt the attitude that difficulties are challenges to overcome rather than merely obstacles in your way.\n\nIt may be helpful to talk with others who have studied or traveled in your host country. You may be able to take advantage of welcoming contexts on campus, such as the [[Office of LGBQTI Life|http://www.vanderbilt.edu/lgbtqi/]], to help you network with past participants. Your study abroad provider may be able to connect you with LGBQTI alumni of your specific program, and can also serve as an excellent resource both before you leave and while you're abroad.\n\nIf you would like to talk about any aspect of your program with the Global Education Office, please do not hesitate to [[contact us|https://webapp.mis.vanderbilt.edu/studioabroad/index.cfm?FuseAction=Abroad.ViewLink&Parent_ID=1B2936BD-9D45-883A-02A56AC77951A353&Link_ID=1B34B64E-9B4D-6FCE-D278333739D84B5D&pID=1&lID=5]].\n\n|box|k\n|!Resources|\n|Vanderbilt's [[Office of LGBQTI Life|http://www.vanderbilt.edu/lgbtqi/]], a cultural center and resource for information and support about gender and sexuality|\n|[[International Lesbian, Gay, Bisexual, Trans and Intersex Association|http://ilga.org/]] provides legal information on every country, as well as news and reports on the state of LGBTQI rights around the world|\n|[[International Gay & Lesbian Human Rights Commission|http://iglhrc.org/]] has extensive country-specific resources.|\n|[[Rainbow SIG bibliography|http://overseas.iu.edu/living/glbt_biblio.shtml]], bibliography of LGBQTI literature with an international perspective|\n|[[Rainbow SIG|http://www.rainbowsig.org/]], an organization of study abroad professionals|\n|[[ILGA-Europe|http://www.ilga-europe.org/]], the website of the International Lesbian, Gay, Bisexual, Trans and Intersex Association's European chapter, provides multiple resources, including a Guide to Europe|\n|[[Utopia|http://www.utopia-asia.com/]], an online guide to Asia-Pacific gay and lesbian resources, including legal and cultural information as well as links to country-specific resources|\n|[[Travel at Transgender Equality|http://transequality.org/Issues/travel.html]]: air travel tips for transgender people|\n|[[US passport requirements|http://travel.state.gov/content/passports/english/passports/information/gender.html]] for transgender students|\n\n&lt;&lt;segue &quot;Contacts and communications&quot;&gt;&gt;\s\n</div><div tiddler="Print" tags="nogather nosave" created="201405071525" modifier="twee" twine-position="1613,1743">&lt;&lt;displayAll&gt;&gt;</div><div tiddler="Go To Link On Timer" tags="script" created="201407031641" modifier="twee" twine-position="0,0">(function () {\n    version.extensions.timedgotoMacro = {\n        major: 1,\n        minor: 2,\n        revision: 0\n    };\n    macros[&quot;goto&quot;] = macros.timedgoto = {\n        timer: null,\n        handler: function (a, b, c, d) {\n            function cssTimeUnit(s) {\n                if (typeof s == &quot;string&quot;) {\n                    if (s.slice(-2).toLowerCase() == &quot;ms&quot;) {\n                        return +(s.slice(0, -2)) || 0\n                    } else {\n                        if (s.slice(-1).toLowerCase() == &quot;s&quot;) {\n                            return +(s.slice(0, -1)) * 1000 || 0\n                        }\n                    }\n                }\n                throwError(a, s + &quot; isn't a CSS time unit&quot;);\n                return 0\n            }\n            var t, d, m, s;\n            t = c[c.length - 1];\n            d = d.fullArgs();\n            m = 0;\n            if (b != &quot;goto&quot;) {\n                d = d.slice(0, d.lastIndexOf(t));\n                m = cssTimeUnit(t)\n            }\n            d = eval(Wikifier.parse(d));\n            if (d + &quot;&quot; && state && state.init) {\n                if (macros[&quot;goto&quot;].timer) {\n                    clearTimeout(macros[&quot;goto&quot;].timer)\n                }\n                //s = state.history[0].passage.title;\n                macros[&quot;goto&quot;].timer = setTimeout(function () {\n                    state.display(d, a);\n                }, m)\n            }\n        }\n    };\n}());</div><div tiddler="Vanderbilt's safety efforts" tags="safety sidebar" created="201405281301" modifier="twee" twine-position="1245,620">&lt;&lt;sidebar &quot;Vanderbilt's safety efforts&quot;&gt;&gt;\nThe safety and security of students studying abroad are primary concerns of Vanderbilt University. Vanderbilt takes care to minimize the risks students face abroad through several measures, including:\n\n*selecting responsible partners and organizations to provide educational opportunities abroad;\n*assessing the risks associated with all study abroad sites both when approving programs and over the program's lifetime;\n*assuring a high standard of personal health insurance coverage for all students studying abroad;\n*retaining emergency evacuation services and full-spectrum travel assistance for all students;\n*providing program-specific training to help students identify and mitigate potential risks;\n*providing access to on-site support staff and organizations trained to handle emergencies of all types;\n*training on-campus personnel to respond to crises and provide support where possible;\n*keeping abreast of conditions and events where students abroad are based;\n*training students in preventive as well as remedial strategies to avoid trouble abroad.\n\n&lt;&lt;segue &quot;Basic safety abroad&quot;&gt;&gt;\s</div><div tiddler="Stop All Sounds" tags="script" created="201407031641" modifier="twee" twine-position="0,0">//based on http://www.glorioustrainwrecks.com/node/5061\n(function () {\n    macros.add([&quot;stopAllSounds&quot;, &quot;pauseAllSounds&quot;], {\n        version: {\n            major: 1,\n            minor: 0,\n            revision: 0\n        },\n        handler: function () {\n            var sounds = macros.get(&quot;playSound&quot;).soundtracks;\n            for (var i in sounds) {\n                if (sounds.hasOwnProperty(i)) {\n                    sounds[i].pause();\n                    if (this.name == &quot;stopAllSounds&quot; && sounds[i].currentTime) {\n                        sounds[i].currentTime = 0;\n                    }\n                }\n            }\n        }\n    });\n}());</div><div tiddler="About the Presentation" tags="nosave" created="201404181147" modifier="twee" twine-position="1198,2004">!About This Presentation\n!!!!Choose mode to continue\nThis presentation can be viewed in Automatic Mode, with a narrator speaking the text, or in Manual Mode. You can turn Automatic Mode on or off at any time using the button in the upper right.\n\nYou can always hit the &lt;span class='continue-button' style=&quot;clear:both;&quot;&gt;&lt;&lt;click &quot;Continue&quot; $first&gt;&gt;&lt;&lt;set options.autoplay to true&gt;&gt;&lt;&lt;updateAutoplay&gt;&gt;&lt;&lt;saveoptions&gt;&gt;&lt;&lt;/click&gt;&gt;&lt;span class=&quot;anim-wrapper&quot;&gt;&lt;span class='onward-arrow fade-bounce'&gt;&raquo;&lt;/span&gt;&lt;/span&gt;&ensp;&lt;/span&gt; button at any time to advance.\n\n[[\n\n&lt;&lt;click &quot;Continue in Automatic Mode&quot; $first&gt;&gt;\s\n    &lt;&lt;set options.autoplay to true&gt;&gt;\s\n    &lt;&lt;updateAutoplay&gt;&gt;\s\n    &lt;&lt;saveoptions&gt;&gt;\s\n&lt;&lt;/click&gt;&gt;\n&lt;&lt;click &quot;Continue in Manual Mode&quot; $first&gt;&gt;\s\n    &lt;&lt;set options.autoplay to false&gt;&gt;\s\n    &lt;&lt;updateAutoplay&gt;&gt;\s\n    &lt;&lt;saveoptions&gt;&gt;\s\n&lt;&lt;/click&gt;&gt;\s\n&lt;&lt;stopAllSounds&gt;&gt;\s\n&lt;&lt;set options.autoplaydelay to 1000 &gt;&gt;\s\n&lt;&lt;saveoptions&gt;&gt;\s</div><div tiddler="Gender roles abroad" tags="living sidebar" created="201405191507" modifier="twee" twine-position="518,755">&lt;&lt;sidebar &quot;Gender roles abroad&quot;&gt;&gt;\nExpectations surrounding gender roles vary from country to country, and even within countries. Because so much of our communication with others is interpreted in terms of gender, it is helpful to learn something about gender roles in your host culture. One of the best things about study abroad is making new friends, and you will want to avoid undue friction due to misunderstanding and miscommunication.\n\n|box|k\n|!Things to think about include:|\n|Americans are accustomed to having non-romantic friendships with the opposite sex. How does your host culture view opposite-sex friendships?|\n|&lt;hr&gt;If you are considering being sexually active abroad, research safe sex and birth control practices as well as attitudes toward sex outside marriage.|\n|&lt;hr&gt;What constitutes sexual harassment under local law or understanding?|\n|&lt;hr&gt;How do locals dress on the street? What might your manner of dress communicate to them about you?|\n\nWhile men studying abroad will certainly see cultural differences in their roles, it is women who will need to adapt most to local norms and values. North American women should be aware that they may face special sets of attitudes and assumptions.\n\n|box|k\n|!Women may want to further research questions like these:|\n|In some countries (particularly Latin countries), catcalls or other forms of harassment of women might be common. Is this sort of think likely in your country? How will you deal with it if so?|\n|&lt;hr&gt;What behaviors might be construed as sexual? Smiling or greeting strangers? Looking directly at others? Going out at night without a companion of the opposite sex?|\n\nIt can be useful to talk with [[study abroad alumni|https://webapp.mis.vanderbilt.edu/studioabroad/index.cfm?FuseAction=Abroad.ViewDocument&File_ID=9604]] of your host country about what they've experienced. Get in touch with GEO to see if we can find you someone to talk to.\n\n|box|k\n|!Resources|\n|[[Women: What You Need to Know Abroad|http://www.ciee.org/gap-year-abroad/downloads/school-resources/Women.pdf]], a pamphlet for women traveling abroad|\n|[[Her Own Way|http://travel.gc.ca/travelling/publications/her-own-way]], a travel guide for women published by the Canadian government|\n|[[Tips about appropriate clothing from women travelers|\nhttp://www.journeywoman.com/ccc/default.html#women%20clothing]]|\n|[[Margaret Cuninggim Women’s Center|http://www.vanderbilt.edu/WomensCenter/]] at Vanderbilt|\n\n&lt;&lt;segue &quot;Contacts and communications&quot;&gt;&gt;\s\n</div><div tiddler="PassageDone" tags="nobr" created="201407031641" modifier="twee" twine-position="0,0">/% Runs once the passage has completely rendered. %/\n&lt;&lt;if options.autoplay&gt;&gt;\n    &lt;&lt;autoplay $autoplaySound $autoplayDestination&gt;&gt;\n&lt;&lt;/if&gt;&gt;\n&lt;&lt;script&gt;&gt;\n    var index = state.active.variables.index;\n    var passage = state.active.title;\n    console.log(&quot;passage: &quot; + passage);\n    var currentPassage = index[passage];\n    var tags = state.active.variables.tags;\n    var sections = state.active.variables.backgrounds;\n    var bookmarks = state.active.variables.bookmarks;\n    var fullindex = state.active.variables.fullindex;\n    var currentTag = tags.indexOf(currentPassage.tag);\n    \n    var totalPassages = state.active.variables.totalPassages;\n    console.log(&quot;current tag: &quot; + currentTag + &quot;, no. &quot; + currentPassage.tag);\n\n    var progress = 0;\n\n    if (currentPassage.hasOwnProperty(&quot;enumeration&quot;)) {\n        //The progress marker will appear halfway through the imaginary rectangle\n        //of each passage on the progress meter, except for the last, where we\n        //show it completely filling the bar.\n        var progress = currentPassage.enumeration;\n        if (progress &gt; options.passageprogress) { options.passageprogress = progress; }\n        if (progress !== totalPassages) { progress = progress - 0.5; }\n    }\n    else if (currentTag &lt; 1) {\n        //var progress = 0;\n    }\n    console.log(&quot;Current passage: &quot; + progress + &quot; of &quot; + totalPassages);\n    var progressPercent = (progress / totalPassages)* 100;\n    $(&quot;#pb-complete&quot;).css(&quot;right&quot;, 100 - progressPercent + &quot;%&quot;);\n    if (state.active.variables.csscalc === true) {\n        $(&quot;#pb-position&quot;).css(&quot;left&quot;, &quot;calc(&quot; + progressPercent + &quot;% - 2px)&quot;);\n    }\n    else { //if CSS calc() isn't supported, we don't try to be as exact\n        $(&quot;#pb-position&quot;).css(&quot;left&quot;, progressPercent + &quot;%&quot;);\n    }\n    console.log(&quot;Set #pb-complete right to: &quot; + (100 - (progress / totalPassages)* 100) + &quot;%&quot;);\n    console.log(&quot;Set #pb-position left to: &quot; + (progress / totalPassages)* 100 + &quot;%&quot;);\n\n    if (currentTag &gt; 0) { //the user has read enough to need to see the chapter button\n        if (currentTag &gt; options.chapterprogress) {\n                setOption(&quot;chapterprogress&quot;, currentTag);\n                $(&quot;#story-rewind, a#rewind-icon&quot;).addClass(&quot;hilight&quot;);\n                setTimeout(function() {\n                    $(&quot;#story-rewind, a#rewind-icon&quot;).removeClass(&quot;hilight&quot;);\n                }, 1100);\n            }\n        console.log(&quot;current tag: &quot; + currentTag);\n        $(&quot;#story-rewind&quot;).empty().append(function(){\n            var html = &quot;&lt;div id='nav-container'&gt;&lt;a id='rewind-icon'&gt;&lt;/a&gt;&lt;ul id='nav-sf-menu' class='sf-menu sf-vertical'&gt;&lt;li class='sep'&gt;&lt;span class='disable'&gt;Jump to Passage&lt;/span&gt;&lt;/li&gt;&quot;;\n            for (var i = 1; i &lt; (options.chapterprogress + 1); i++) {\n                html += &quot;&lt;li&gt;&lt;a class='chapter-list' data='&quot; + bookmarks[tags[i]] + &quot;'&gt;&quot; + sections[tags[i]].section + &quot;&lt;/a&gt;&lt;ul&gt;&quot;;\n                    $.each(fullindex[i-1].passages, function(j, pass) {\n                        console.log(&quot;Adding &quot; + pass.passage + &quot; to menu: &quot; + index[pass.passage].enumeration + &quot;/&quot; + progress);\n                        if (pass.passage === state.active.title) {\n                            html += &quot;&lt;li&gt;&lt;a class='passage-list passage-list-inactive' data='&quot; + pass.passage + &quot;'&gt;&quot; + pass.passage + &quot;&lt;/a&gt;&lt;/li&gt;&quot;;\n                        }\n                        else {\n                            html += &quot;&lt;li&gt;&lt;a class='passage-list' data='&quot; + pass.passage + &quot;'&gt;&quot; + pass.passage + &quot;&lt;/a&gt;&lt;/li&gt;&quot;;\n                        }\n                        if (index[pass.passage].enumeration === options.passageprogress) {return false; }\n                    });\n                html += &quot;&lt;/ul&gt;&lt;/li&gt;&quot;;\n            }\n            html+=&quot;&lt;/ul&gt;&lt;/div&gt;&quot;;\n            return html;\n        });\n        if ($(&quot;#backgrounds&quot;).css(&quot;display&quot;) === &quot;none&quot;) {//proxy for screen width media query\n            jQuery('ul.sf-menu').superfish({\n                animation: {height:'show'}, // slide-down effect without fade-in\n                animationOut: {height:'hide'},\n                delay:     1200,\n                speed:     'fast',\n                speedOut:  'fast',\n                cssArrows: false,\n                addArrows: false\n            });\n        }\n        else {\n            jQuery('ul.sf-menu').superfish({\n                cssArrows: false,\n                addArrows: false,\n            });\n        }\n        \n        $(&quot;#rewind-icon, #nav-sf-menu&quot;).off(&quot;.navcontrol&quot;).on(&quot;mouseenter.navcontrol&quot;, function () {\n                $(&quot;#nav-sf-menu&quot;).show();\n            })\n            .on(&quot;mouseleave.navcontrol&quot;, function() {\n                $(&quot;#nav-sf-menu&quot;).hide();\n            });\n        $(&quot;.passage-list&quot;).click(function(){\n            var $this = $(this);\n            console.log($this);\n            console.log(&quot;You clicked on &quot; + $this.attr(&quot;data&quot;) + &quot;. You are on &quot; + state.active.title + &quot;.&quot;);\n            if ($this.attr(&quot;data&quot;) !== state.active.title) {\n                state.display($this.attr(&quot;data&quot;));\n            }\n            return false;\n        });\n        $(&quot;#story-rewind&quot;).show();\n    }\n\n    if (index.hasOwnProperty(passage)) { //skip this for passages that aren't in the index\n        //update image if necessary\n        var currentImage = getBackgroundImage(&quot;.img-anchor&quot;);\n        var url = currentPassage.url;\n        url = url.substring(url.lastIndexOf('/', url.lastIndexOf('/') - 1) + 1);\n        if (url !== currentImage) { //Background image changing is proxy for section change\n            // First, animate the section name change\n            $(&quot;#section-name&quot;).html(currentPassage.section).addClass(&quot;hilight&quot;);\n            setTimeout(function() {\n                $(&quot;#section-name&quot;).removeClass(&quot;hilight&quot;);\n            }, 1100);\n\n            // Next, change the background image\n            var $active = $(&quot;.img-anchor&quot;);\n            var $passive = $(&quot;.img-fader&quot;);\n            $(&quot;.img-container&quot;).toggleClass('img-anchor img-fader');\n            $passive.css(&quot;background-image&quot;, &quot;url(&quot; + url + &quot;)&quot;);\n            $passive.removeClass('background-fade');\n            $active.addClass(&quot;background-fade&quot;);\n            //look for next tag: if there is one, cache its background image\n            var nextTag = tags.indexOf(currentTag) + 1;\n            if (nextTag &lt; tags.length) {\n                setTimeout(function() {\n                    var nextUrl = sections[tags[nextTag]].url;\n                    $active.css(&quot;background-image&quot;, &quot;url(&quot; + nextUrl + &quot;)&quot;);\n                }, 1100);\n            }\n        }\n    }\n\n    passage = tale.get(state.active.title);\n    if (passage.tags.indexOf(&quot;sidebar&quot;) === -1 && $(&quot;#passages&quot;).hasClass(&quot;sidebar&quot;)) {\n        //we are going from a sidebar to the main flow of the presentation\n        passage.classes.purge(&quot;flip&quot;);\n        $(&quot;#passages&quot;).removeClass(&quot;sidebar&quot;);\n    }\n    else if (!$(&quot;#passages&quot;).hasClass(&quot;sidebar&quot;)) {\n        $(&quot;.passage&quot;).removeClass(&quot;flip&quot;);\n    }\n    // Display for controls\n    if (tale.get(state.active.title).tags.indexOf(&quot;nosave&quot;) === -1 && $(&quot;#custom&quot;).is(&quot;:hidden&quot;)) {\n        $(&quot;#custom&quot;).slideDown(&quot;fast&quot;);\n    }\n    else if (tale.get(state.active.title).tags.indexOf(&quot;nosave&quot;) !== -1) {\n        $(&quot;#custom&quot;).slideUp(&quot;fast&quot;);\n    }\n&lt;&lt;/script&gt;&gt;\n&lt;&lt;if state.active.title eq &quot;Index&quot;&gt;&gt;\n    &lt;&lt;displayIndex&gt;&gt;\n    &lt;&lt;script&gt;&gt;\n        var query = window.location.search.substring(1);\n        var locus = &quot;nav=Index&quot;;\n        if (query.length &gt; 0) {\n            if (query.search(/nav=/) != -1) {\n                query = query.replace(/nav=.*?(?=&|$)/, locus);\n            }\n            else {\n                query += &quot;&&quot; + locus;\n            }\n        }\n        window.history.replaceState(window.history.state, document.title, window.location.protocol + &quot;//&quot; + window.location.host + window.location.pathname + &quot;?&quot; + query);\n    &lt;&lt;/script&gt;&gt;\n&lt;&lt;/if&gt;&gt;\n&lt;&lt;script&gt;&gt;\n    console.log(&quot;Tried to display admin info. admin=&quot; + state.active.variables.admin);\n&lt;&lt;/script&gt;&gt;\n&lt;&lt;if $admin eq &quot;true&quot;&gt;&gt;\n    &lt;&lt;displayAdmin&gt;&gt;\n&lt;&lt;/if&gt;&gt;\s\n&lt;&lt;script&gt;&gt;\n    console.log(&quot;Passage done!&quot;);\n&lt;&lt;/script&gt;&gt;</div><div tiddler="CSS for circle graphs" tags="stylesheet" created="201407031641" modifier="twee" twine-position="0,0">.circle-graph {\n  width: 30px;\n  height: 30px;\n  -moz-border-radius: 50%;\n  -webkit-border-radius: 50%;\n  border-radius: 50%;\n  display:inline-block;\n}\n\n.circle-graph-full {\n    background: #0688fa;\n}\n\n.circle-graph-empty {\n    background: #bdbdbd;\n}\n\n.circle-graph-clip-container {\n    position:relative;\n    width:30px;\n    height:30px;\n    display:inline-block;\n}\n\n.circle-graph-clip {\n    position:absolute;\n    top:0;\n    left:0;\n}</div><div tiddler="CSS for Sidebars" tags="stylesheet" created="201407031641" modifier="twee" twine-position="0,0">#passages.sidebar {\n    background-color: #FAF3E8;\n}\n\n.passage h1.sidebar {\n    color:black;\n}\n\n.passage h4.sidebar {\n    margin-bottom:0;\n}\n\n.passage h6.sidebar {\n    margin:-0.4em 0 0 0;\n}\n\n.passage h6.sidebar a {\n    color:#a8a8a8;\n}\n\n.passage hr.sidebar {\n    background-color:black;\n}\n\n.sidebar-box {\n  display:table;  \n}\n\n.sidebar-head {\n    background-color:#dd3b2a;\n    border:1px solid #dd3b2a;\n    border-radius:5px 0 0 5px;\n    color:white;\n    padding:3px 10px;\n    display:table-cell;\n    vertical-align:middle;\n    text-align:center;\n    width:4em;\n    line-height:140%;\n}\n\n.sidebar-container {\n  margin:0;\n}\n\nul.sidebar-links {\n    border:1px solid #dd3b2a;\n    border-radius:0 5px 5px 0;\n    padding:3px 10px 3px 8px;\n    line-height:100%;\n    display:table-cell;\n    vertical-align:middle;\n    list-style-type: none;\n}\n\n.sidebar-links li {\n  margin:9px 0;\n}\n\n.sidebar-links a, sidebar-link a:hover {\n    text-decoration:underline;\n    color:#dd3b2a;\n}</div><div tiddler="Section record" tags="script" created="201407031641" modifier="twee" twine-position="0,0">(function () {\n    macros.add(&quot;section&quot;, {\n        version: {\n            major: 1,\n            minor: 0,\n            revision: 0\n        },\n        handler: function () {\n            try {\n                var backgrounds = state.active.variables.backgrounds;\n                var sectionName = &quot;&quot;;\n                var tagName = &quot;&quot;;\n                var url = &quot;&quot;;\n                if (this.args[2].length &lt; 1) {throw sectionName + &quot;: Supply a section name, a tag name, and the path to a background image.&quot;;}\n                sectionName = this.args[0];\n                tagName = this.args[1];\n                url = this.args[2];\n                if (!backgrounds.hasOwnProperty(tagName)) {\n                    backgrounds[tagName] = {};\n                }\n                backgrounds[tagName].section = sectionName;\n                backgrounds[tagName].url = url;\n            } catch(e) {\n                return this.error(&quot;Error: &quot; + e.message);\n            }\n        }\n    });\n\n    macros.add(&quot;create-index&quot;, {\n        version: {\n            major: 1,\n            minor: 0,\n            revision: 0\n        },\n        handler: function () {\n            try {\n            \tvar index = state.active.variables.index;\n                var backgrounds = state.active.variables.backgrounds;\n                var bookmarks = state.active.variables.bookmarks;\n                state.active.variables.tags = Object.getOwnPropertyNames(backgrounds);\n                console.log(backgrounds);\n                var sectionName = &quot;&quot;;\n                var tagName = &quot;&quot;;\n                var url = &quot;&quot;;\n                var text = '';\n                var num = -1;\n                console.log(&quot;Tags: &quot; + state.active.variables.tags);\n                for(var i in backgrounds) {\n\t\t\t\t\tif (backgrounds.hasOwnProperty(i)) {\n\t\t\t\t\t\tnum++;\n\t\t\t\t\t\ttagName = i;\n\t\t\t\t\t\tbackgrounds[i].enumeration = num;\n\t\t\t\t\t\t$(&quot;#store-area div&quot;).each(function() {\n\t\t\t\t\t\t\tif ($(this).attr(&quot;tags&quot;).indexOf(i) &gt; -1) {\n\t\t\t\t\t\t\t\tvar passageName = $(this).attr(&quot;tiddler&quot;);\n\t\t\t\t\t\t\t\tconsole.log(&quot;Found passage: &quot; + passageName);\n\t\t\t\t\t\t\t\tif (!index.hasOwnProperty(passageName)) {\n\t\t\t\t\t\t\t\t\tindex[passageName] = {};\n\t\t\t\t\t\t\t\t\tindex[passageName].tag = tagName;\n\t\t\t\t\t\t\t\t\tindex[passageName].section = backgrounds[i].section;\n\t\t\t\t\t\t\t\t\tindex[passageName].url = backgrounds[i].url;\n\t\t\t\t\t\t\t\t\tindex[passageName].enumeration = backgrounds[i].enumeration;\n\t\t\t\t\t\t\t\t}\n                                if ($(this).attr(&quot;tags&quot;).indexOf(&quot;bookmark&quot;) &gt; -1) {\n                                    if (!bookmarks.hasOwnProperty(tagName)) {\n                                        bookmarks[tagName] = &quot;&quot;;\n                                    }\n                                    bookmarks[tagName] = passageName;\n                                }\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n                console.log(&quot;Backgrounds&quot;);\n                console.log(backgrounds);\n                console.log(&quot;Bookmarks&quot;);\n                console.log(bookmarks);\n\n                //Build the full index by &quot;reading&quot; the full presentation in order\n                var fullindex = state.active.variables.fullindex;\n                var seek = state.active.variables.first;\n                var lastTag = &quot;&quot;;\n                var count = -1;\n                while(seek !== null) {\n                    $(&quot;#store-area div&quot;).each(function() {\n                        if ($(this).attr(&quot;tiddler&quot;) === seek) {\n                            for(tagName in backgrounds) {\n                                if ($(this).attr(&quot;tags&quot;) && $(this).attr(&quot;tags&quot;).indexOf(tagName) &gt; -1 ) {\n                                    if (tagName !== lastTag) {\n                                        count++;\n                                        lastTag = tagName;\n                                        fullindex.push({});\n                                    }\n                                    console.log(&quot;fullindex.length = &quot;+fullindex.length+ &quot;, count: &quot;+ count);\n                                    if (fullindex.length &lt; count + 2) {\n                                        console.log(&quot;Looking to add &quot; + $(this).attr(&quot;tiddler&quot;) + &quot; to fullindex&quot;);\n                                        if (!fullindex[count].hasOwnProperty(&quot;section&quot;)) {\n                                            console.log(&quot;   Looking to add section.&quot;);\n                                            fullindex[count].section = backgrounds[tagName].section;\n                                        }\n                                        if (!fullindex[count].hasOwnProperty(&quot;passages&quot;)) {\n                                            console.log(&quot;   Looking to add passages.&quot;);\n                                            fullindex[count].passages = [];\n                                        }\n                                        var passageStore = { passage: $(this).attr(&quot;tiddler&quot;) };\n                                        console.log(&quot;   Looking to add sidebars.&quot;);\n                                        var sidebars = $(this).text().match(/&lt;&lt;\ss*sidebar-box(?:\ss*.*?)&gt;&gt;([\ss\sS]*?)&lt;&lt;\ss*\s/sidebar\s-box\ss*&gt;&gt;/g);\n                                        if (sidebars !== null) {\n                                            var sidebarStore = [];\n                                            var sought = /\s[\s[\ss*.*?\s|(.*?)\ss*\s]\s]/g;\n                                            while ((seek = sought.exec(sidebars[0])) !== null) {\n                                                sidebarStore.push(seek[1]);\n                                            }\n                                            passageStore.sidebars = sidebarStore;\n                                            console.log(&quot;   Found sidebars: &quot; + sidebarStore.length);\n                                        }\n                                        fullindex[count].passages.push(passageStore);\n                                    }\n                                    \n                                    break;\n                                }\n                            }\n                            seek = (/&lt;&lt;\ss*segue\ss+[&quot;'](.*?)[&quot;']\ss*&gt;&gt;/g).exec($(this).text());\n                            if (seek != null) {\n                                seek = seek[1]; \n                            }\n                            return false;\n                        }\n                    });\n\n                    \n                }\n            \n            console.log(fullindex);\n\n            //In the $index, number each passage so that we can quickly\n            //identify where we are for the progress meter.\n            count = 0;\n            $.each(fullindex, function(i, part){\n                if (part.passages.length &gt; 0) {\n                    $.each(part.passages, function(j, group) {\n                        count ++;\n                        index[group.passage].enumeration = count;\n                        if (group.hasOwnProperty(&quot;sidebars&quot;)) {\n                            $.each(group.sidebars, function(k, sides) {\n                                console.log(&quot;Enumerating &quot; + sides);\n                                index[sides].enumeration = count;\n                            })\n                        }\n                    });\n                }\n            });\n            console.log(&quot;Index&quot;);\n            console.log(index);\n            \n            state.active.variables.totalPassages = count;\n\n            } catch(e) {\n                return this.error(&quot;Error: &quot; + e.message);\n            }\n        }\n    });                \n}());</div><div tiddler="Configuration" tags="script" created="201407031641" modifier="twee" twine-position="0,0">config.saves.autosave = true;\nconfig.saves.slots = 0;\nconfig.errorName = &quot;presentation&quot;;\nconfig.disableHistoryControls = true;\n\nconfig.saves.isAllowed = function () {\n    if (tale.get(state.active.title).tags.indexOf(&quot;nosave&quot;) === -1) { \n       return true; \n    }\n    return false; \n};</div><div tiddler="Outgoing Passage Transition Config" tags="script" created="201407031641" modifier="twee" twine-position="0,0">// # of milliseconds before outgoing elements are removed\nconfig.passageTransitionOut = 780; // it's probably best if it's just slightly longer (say 10ms or so) than your outgoing transition delay</div><div tiddler="Things you need to know about traveling" tags="travel bookmark" created="201404171617" modifier="twee" twine-position="378,13">!Traveling while abroad\n!!!!Important things to keep in mind when planning travel\nFirst, always ''keep your Resident Director or staff informed'' of your travel. Also keep your family in the loop; if there is an emergency back home, they will want to know how get in touch with you!\n\nSome countries that you plan to visit may have different entry requirements than your primary host country. ''Investigate all the countries you're interested in'' before you leave the US. If any require a visa, it will probably be easier to get the visa while you're in the US (this applies to both international students and US citizens)!\n\nIn every country you visit, make a point of knowing where your ''home country's nearest embassy or consulate'' is. You want to know where you can find support if you get into real trouble. (If you're a US citizen, you should bookmark the [[list of US embassies around the world|http://www.usembassy.gov/]].)\n\nFinally, independent travel is one of the ''most expensive activities'' you can undertake abroad. Be sure to budget appropriately, and remember to consider safety while you're on the lookout for ways to travel on the cheap!\n&lt;div class=&quot;talkbox&quot;&gt;\s\n|box|k\n|!Wisdom from alums|\n|Every year, students tell us that while they loved the traveling they did abroad, they also regretted not getting to know their host city better. Consider the value of staying put sometimes rather than skipping town.|\n&lt;/div&gt;\n&lt;&lt;segue &quot;Passport Check&quot;&gt;&gt;\s</div><div tiddler="StoryMenu" tags="" created="201407031641" modifier="twee" twine-position="0,0">/% &lt;a id=&quot;audio-control&quot; href=&quot;#&quot;&gt;[ &gt; ]&lt;/a&gt; %/</div><div tiddler="Course equivalency evaluations" tags="academics" created="201404171614" modifier="twee" twine-position="24,1299">!Course equivalency evaluations\n!!!!Making sure your courses count for Vanderbilt credit\nEvery course you take abroad needs to be evaluated by Vanderbilt faculty to earn Vanderbilt credit. This process determines how the course will count at Vanderbilt--or if it will count at all.\n\nThe single most important thing to remember about course equivalency evaluations is that ''you are responsible''! GEO facilitates the process, but it falls on you to ensure that your courses get evaluated for credit. Vanderbilt can't process your grades until //all the courses// you took have evaluations on file.\n\n|box|k\n|&gt;|! How to get your courses evaluated|\n|&lt;li&gt;1&lt;/li&gt;|Check the [[list of evaluated courses|https://webapp.mis.vanderbilt.edu/studioabroad/index.cfm?FuseAction=Abroad.ViewLink&Parent_ID=57CE127F-D56A-6FB1-6E26BBF5FD3E8308&Link_ID=AF72ED87-FAA3-E8FD-08D54FEDDC87FB10&pID=4&lID=31]] for your program. Are all of your courses already on the list? Great, you're done! Skip to Step 5.|\n|&lt;li&gt;2&lt;/li&gt;|If not: Get your hands on syllabi for the missing courses, either online, by writing the department abroad, or by going to the first day of class.|\n|&lt;li&gt;3&lt;/li&gt;|Submit a [[Course Equivalency Evaluation Request|https://webapp.mis.vanderbilt.edu/studioabroad/index.cfm?FuseAction=Abroad.ViewLink&Parent_ID=57CE127F-D56A-6FB1-6E26BBF5FD3E8308&Link_ID=AF6994DC-E918-C4B1-439DAF6CA2C9B451&pID=4&lID=30]] for each course|\n|&lt;li&gt;4&lt;/li&gt;|GEO will do the rest! We contact faculty and find out how the course will count, and then we email you the result.|\n|&lt;li&gt;5&lt;/li&gt;|Relax. Enjoy life.|\n\nNeed more information? Check out our very detailed [[guide|https://webapp.mis.vanderbilt.edu/studioabroad/index.cfm?FuseAction=Abroad.ViewLink&Parent_ID=57CE127F-D56A-6FB1-6E26BBF5FD3E8308&Link_ID=D9D0A705-07C6-4CA3-2AE838FCDC41A39E&pID=4&lID=29]], or talk with your [[GEO advisor|https://webapp.mis.vanderbilt.edu/studioabroad/index.cfm?FuseAction=Abroad.ViewLink&Parent_ID=1B2936BD-9D45-883A-02A56AC77951A353&Link_ID=1B34B64E-9B4D-6FCE-D278333739D84B5D&pID=1&lID=4]]. \n\n&lt;&lt;segue &quot;Things you need to know about traveling&quot;&gt;&gt;\s</div><div tiddler="Budgeting" tags="sidebar living" created="201404171622" modifier="twee" twine-position="528,1291">&lt;&lt;sidebar &quot;Basics of Budgeting&quot;&gt;&gt;\nBudgeting can be crucial to ensuring you have enough money to fund your study abroad experience. There are really two levels of budgeting that you need to keep in mind.\n\nFirst is the ''overall budget for your study abroad experience''. Getting a ballpark figure for this will help you and your family determine an appropriate monthly budget for you while you are abroad. Be sure to include not only the costs that are billed through Vanderbilt, but also the clear, fixed costs that you will pay out of pocket. Examples include: passport fees, visa fees, airfare, luggage fees, and purchase of clothing or other travel needs.\n\nTo this, you need to add an estimate of what you will spend on living expenses and entertainment and enrichment activities. This can be tricky to estimate, especially because a sudden change in currency exchange rates can alter it substantially. GEO offers rough estimates in our cost calculator, but your program provider can give you a better idea of your costs on the ground. You can also use online cost of living calculators (see Resources section below). \n\nNow that you have a blanket estimate of costs, you and your family can determine how much you should aim to spend per month. Here is where you will need to figure out how to maintain your month-to-month budget while you are abroad. \n\nA ''month-to-month budget'' is a detailed plan of the money you plan to spend, divided into categories: so much for food, so much for travel, and so on. You may need to revise it as you go. For example, you may overspend one month and need to cut back on future months. Keep in mind that students often spend more money the first few weeks while becoming acquainted with the new surroundings. [[More tips on budgeting from GEO|http://prezi.com/hkf9icfmogbd/budgeting-while-abroad/]].\n\n|box|k\n|!Resources|\n|[[Numbeo|http://www.numbeo.com/cost-of-living/]], international cost of living database and calculator|\n|[[Expatistan|http://www.expatistan.com/cost-of-living]], international cost of living database and calculator|\n|[[OANDA|http://www.oanda.com/currency/converter/]] currency exchange converter, including historical trends|\n|[[Maintain a Personal Budget|http://www.wikihow.com/Maintain-a-Budget-for-Personal-Use]], a general budget |\n|[[Budgeting While Abroad|http://prezi.com/hkf9icfmogbd/budgeting-while-abroad/]], GEO's tips for maintaining a budget while abroad|\n|[[Budget tracking sheet|https://docs.google.com/spreadsheet/ccc?key=0Alj5J4V4xlpIdEx2Q0ZWME9ISnlEQms1ZzRLenkyNlE#gid=0]], a Google spreadsheet that helps automate budget tracking|\n\n&lt;&lt;segue &quot;Where will you live?&quot;&gt;&gt;\s</div><div tiddler="Identity and diversity" tags="living bookmark" created="201405191432" modifier="twee" twine-position="378,754">!Identity and diversity\n!!!!Research beliefs, attitudes, and experiences\nOur surroundings shape us and help to define who we are. Living in another cultural context will give you the chance to explore many facets of your identity, and to consider them in light of new surroundings. Students overwhelmingly tell us that this process leads to increased personal growth and insight. However, it often carries difficulties too.\n\nAs you gear up for your time abroad, prepare yourself for how people in your new culture will perceive your identity. Just as in the US, people abroad will have beliefs, myths, stereotypes, and prejudices about aspects of personal identity. You may also find that the way(s) in which you identify yourself in the US differ from how others will identify you abroad.\n\n|box|k\n|!You might be surprised to learn...|\n|The components of identity that most impact the treatment of students abroad are ''nationality'' and ''gender'', no matter what their background.|\n\nResearch the viewpoints held by people of your host country, including beliefs, laws, and customs that revolve around nationality, race and ethnicity, gender, religion, sexual orientation, age, mobility, and more. You may be able to prevent or at least alleviate cultural misunderstandings by learning as much as you can about your host culture before leaving. But also prepare for how your time abroad might change, challenge, and strengthen your identity. \n\n&lt;&lt;sidebar-box &quot;More Specific Topics&quot;&gt;&gt;\n   [[Being American abroad|Being American abroad]]\n   [[Gender roles abroad|Gender roles abroad]]\n   [[Race and ethnicity abroad|Race and ethnicity abroad]]\n   [[Sexual and gender identity abroad|Sexual and gender identity abroad]]\n   [[Religious identity abroad|Religious identity abroad]]\n&lt;&lt;/sidebar-box&gt;&gt;\s\n\n&lt;&lt;segue &quot;Contacts and communications&quot;&gt;&gt;\s</div><div tiddler="Sidebar Stack" tags="script" created="201407031641" modifier="twee" twine-position="0,0">/* Syntax:\n    &lt;&lt;sidebar-box [optional:text to replace &quot;More&quot;]&gt;&gt;\n        [[Link text|Passage Name]]\n        ...\n    &lt;&lt;/sidebar-box&gt;&gt; */\nmacros.add(&quot;sidebar-box&quot;, {\n    version: { major: 1, minor: 0, revision: 0 },\n    tags: null,\n    handler: function ()\n    {\n        if (this.payload.length !== 0)\n        {\n            // create the basic elements\n            var   sidebar = document.createElement(&quot;div&quot;)\n                , header  = document.createElement(&quot;div&quot;)\n                , links   = document.createElement(&quot;ul&quot;);\n\n            // setup the basic elements\n            sidebar.className = this.name;\n            header.className  = &quot;sidebar-head&quot;;\n            header.innerHTML  = this.args.length !== 0 ? this.args[0] : &quot;More&quot;;\n            links.className   = &quot;sidebar-links&quot;;\n            sidebar.appendChild(header);\n            sidebar.appendChild(links);\n\n            // process the payload\n            var wikitext = this.payload[0].contents.trim().split(/\ss*\sn\ss*/);\n            for (var i = 0; i &lt; wikitext.length; i++)\n            {\n                var linkEl = document.createElement(&quot;li&quot;);\n                new Wikifier(linkEl, wikitext[i]);\n                links.appendChild(linkEl);\n            }\n\n            // append the sidebar to the output buffer\n            this.output.appendChild(sidebar);\n        }\n    }\n});</div><div tiddler="GEO Photo Contest" tags="home" created="201404171648" modifier="twee" twine-position="1615,279">!GEO's Annual Photo Contest\n!!!!Keep the contest in mind as you decide what to photograph!\nEvery year, GEO conducts a photo contest. We solicit photos from students who went abroad in the 12 months previous and choose the best images to feature.\n\nWe will contact you via email, usually in the summer, to request your entries in the contest. \nThere are prizes, but we also invite the entire Vanderbilt campus and alumni community to take part in the judging process. If you're a winner, your photo will be seen by tens of thousands of people! We put the winning photos on live exhibit in the Student Life Center, and they tend to show up in campus publications as well, including //Vanderbilt Magazine.//\n\nPhotos can be of any subject (scenery, activities, cultures, etc.) but please be tasteful and respectful as you snap your pics.\n\nIf you just want to share photos of your experiences without entering the contest, we have an outlet for that, too!\n\nGEO is particularly keen on photos that show Vanderbilt students participating in academic and cultural endeavors. Scenery is beautiful, but action shots with Vandy representatives (such as yourself) tell interesting stories!\n\n&lt;&lt;sidebar-box&gt;&gt;\n   [[Quick guidelines for ethical photography|Ethical photography]]\n&lt;&lt;/sidebar-box&gt;&gt;\n\n&lt;&lt;segue &quot;What to do next&quot;&gt;&gt;\s</div><div tiddler="Image Utilities" tags="script" created="201407031641" modifier="twee" twine-position="0,0">window.getBackgroundImage = function (element) {\n\tvar url = $(element).css('background-image');\n\tif (url == &quot;&quot; || url == &quot;none&quot;) return url;\n\turl = /^url\s((['&quot;]?)(.*)\s1\s)$/.exec(url);\n\turl = url[2];//continue with only the filepath portion\n\tvar filename = url.substring(url.lastIndexOf('/', url.lastIndexOf('/') - 1) + 1);\n\tfilename = filename ? filename : &quot;&quot;;\n\treturn filename;\n};</div><div tiddler="Options" tags="script" created="201406041138" modifier="twee" twine-position="1335,1875">// Need to set the default location to go to when the\n// admin mode is in effect. Admin mode is activated\n// by URL, e.g. http://...index.html?admin=true\n\noptions.adminStart = &quot;Index&quot;;\nmacros.get(&quot;saveoptions&quot;).handler();</div><div tiddler="CSS" tags="stylesheet" created="201407031641" modifier="twee" twine-position="0,0">/* Change box-sizing model for all elements */\n/*\n*, *::before, *::after {\n    -moz-box-sizing: border-box;\n    -webkit-box-sizing: border-box;\n    box-sizing:border-box;\n}\n*/\n/* Override SugarCube button animations & styles\nbutton\n{\n    -webkit-transition-duration: 0s;\n    -moz-transition-duration: 0s;\n    transition-duration: 0s;\n}\nbutton:hover {\n    background-color: #58e;\n    border: 1px solid #7af;\n}\nbutton:active {\n    background-color: #f70;\n    border: 1px solid #f92;\n}\n*/\n\n/* CSS3 calc() support check */\n#css3-calc {\n    width: 10px;\n    width: calc(10px + 10px);\n    display: none;\n}\n\nhtml {\n  height:100%;\n}\nfigcaption {\n    font-size:80%;\n    font-style:italic;\n}\n.inline {\n    display: inline-block;\n}\n.inline-head {\n    font-weight:bold;\n}\n.left {\n    float: left;\n}\n.right {\n    float:right;\n}\n.talkbox {\n  width:85%;\n  margin:auto;\n}\nbody {\n    color: #000;\n    font-family: 'Open Sans',serif;\n    margin:0;\n    height:100%;\n    overflow:auto;\n    position:relative;\n    z-index: 3;\n}\nh1 {\n    font-family: 'Arvo',serif;\n    font-weight:700;\n    font-size: 36px;\n    line-height: 1.2em;\n    margin: 0 0 10px 0;\n    color: #dd3b2a;\n}\nh4 {\n    font-family: 'Arvo',serif;\n    font-weight:700;\n    font-size:18px;\n    margin-top:0;\n}\nh6 {\n    font-family: 'Arvo',serif;\n    font-weight:700;\n    font-size:14px;\n    margin:0;\n}\n.img-container {\n    position:fixed;\n    top:0;\n    left:0;\n    background-repeat: no-repeat;\n    background-position: center center;\n    background-attachment: fixed; \n    -webkit-background-size: cover;\n    -moz-background-size: cover;\n    -o-background-size: cover;\n    background-size: cover;\n    height:100%;\n    width:100%;\n    -webkit-transition: opacity 1s ease-in-out;\n    -moz-transition: opacity 1s ease-in-out;\n    -o-transition: opacity 1s ease-in-out;\n    transition: opacity 1s ease-in-out;\n}\n.img-anchor {\n    opacity:1;\n    z-index:1;\n}\n.img-fader {\n    z-index:2;\n    \n}\n.background-fade {\n    opacity:0;\n}\n\n\n/* Make link font slightly smaller to compensate for boldface */\n.content a.link-internal,\n.content a.link-external,\n.content a.link-back,\n.content a.link-return {\n    font-size: 90%;\n}\n.content strong {\n    font-size: 90%;\n}\n\n/* Basic passage styles */\n#passages {\n    color: #000;\n    font-size:15px;\n    background-color:#fefefe;\n    \n    min-height:100%;\n    margin: 0 auto;\n    border-left:none;\n    padding: 55px 2em 3em 2em;\n    -moz-box-shadow: 0 0 20px black;\n    -webkit-box-shadow: 0 0 20px black;\n    box-shadow: 0 0 20px black;\n    -moz-box-sizing: border-box;\n    -webkit-box-sizing: border-box;\n    box-sizing:border-box;\n    position:relative;\n}\n@media screen {\n  #passages {\n    width:60%;\n  }\n}\n\n@media print {\n  #passages {\n    width:100%;\n  }\n}\n.passage {\n    line-height: 1.75em;\n    margin-bottom: 0;\n    text-align: left;\n    height:100%;\n}\n#ui-bar {\n    display:none;\n}\n#passages table thead td {\n    font-weight:bold;\n}\n#passages table.alternating-rows tr:nth-child(odd) {\n    background-color:#EEEEEE;/*Fallback*/\n    background-color:rgba(221,221,221,0.5);\n}\n#passages table.alternating-rows tr:nth-child(even) {\n    background-color:#DDDDDD;/*Fallback*/\n    background-color:rgba(204,204,204,0.5);\n}\n#passages table.box {\n    background-color:#EEEEEE;/*Fallback*/\n    background-color:rgba(221,221,221,0.5);\n}\n#passages table.box th, #passages table.box thead {\n    background-color:#DDDDDD;/*Fallback*/\n    background-color:rgba(204,204,204,0.5);\n}\n#passages table.box tr:first-child td,\n#passages table.box tr:first-child th,\n#passages table.box th tr:first-child td {\n    padding-top:10px;\n}\n#passages table.box tr:last-child td {\n    padding-bottom:10px;\n}\n#passages table {\n    font-size: 80%;\n    border-collapse: collapse;\n    line-height:145%;\n}\n#passages th, #passages td {\n    padding: 0.5em 1em;\n}\n#passages table a.link-internal, #passages table a.link-external, #passages table a.link-back, #passages table a.link-return {\n    font-size: 100%!important;\n}\n#passages table strong {\n    font-size: 100%!important;\n}\ntable li {\n  border-radius:50%;\n  width:1.4em;\n  height:1.4em;\n  display:inline-block;\n  text-align:center;\n  font-weight:bold;\n  text-decoration:none;\n  padding-left: 1px;\n  padding-bottom: 1px;\n  color: #ffffff;\n  background-color: #555555;\n}\n\n\n/* Figures */\nfigure {\n  margin-left:auto;\n  margin-right:auto;\n  display:table;\n}\n\n/* Special layout options for full presentation print version */\n.full-print {\n  margin-top: 30px;\n}\n\nh1.full-print {\n  color: black!important;\n  font-size: 42px;\n  border-top: 2px black solid!important;\n  margin-top: 40px;\n  padding-top: 10px;\n  border-bottom: 2px black solid!important;\n  padding-bottom: 10px;\n  background-color: beige!important;\n}\n\n@media print {\n  .full-print {\n    page-break-after:always;\n  }\n}\n\n/* Multicolumn layout for index */\n.index-columns {\n  -webkit-column-count: 2;\n  -webkit-column-gap: 30px; \n  -webkit-column-rule: 0px dotted black;\n  -webkit-column-fill: balance;\n  -moz-column-count: 2;\n  -moz-column-gap: 30px;  \n  -moz-column-rule: 0px dotted black;\n  -moz-column-fill: balance;\n  column-count: 2;\n  column-gap: 30px; \n  column-rule: 0px dotted black;\n  column-fill: balance;\n  /*display: inline-block;*/ /*needed for webkit to balance columns properly */\n}\n\n.index-item {\n  display: inline-block;\n}\n\nh1.index-section {\n  font-size: 18px;\n  color: black;\n  margin-top:0.5em;\n}\n\n.index-columns p {\n  -webkit-margin-before: 0;\n  line-height: 100%;\n}\n\np.index-sidebar {\n  margin-left: 2em;\n  font-size: 80%;\n}\n\n\n/*Admin area */\n#admin-area {\n  margin-top:20px;\n  background-color: rgb(200, 224, 245);\n  padding: 5px 8px;\n  font-size:11px;\n}</div><div tiddler="Tips for packing" tags="travel" created="201404171617" modifier="twee" twine-position="375,540">!Tips for packing\n!!!!Pack light and pack smart!\nIn GEO's experience, students experience two primary difficulties with packing: They bring too much stuff, and they often don't plan well enough for their specific destination. Here are some tips to help!\n\n''Research your location's climate'' and the prevailing weather patterns for the time you will be there, and pack accordingly! Wikipedia is a good source for basic climate data on nearly every city in the world (just search for your city), but commercial guidebooks are probably the single best source of information. \n\n''Bring only //one// suitcase'' that you can lift and maneuver without help. If you bring a backpack as your carry-on, it can double as a weekend travel bag.\n\n''Consider bringing a light duffel bag'' that you can fold up and put in your large suitcase. You may need it to carry the things you buy abroad!\n\nOnly ''pack wardrobe pieces that are interchangeable'' and are good for layering. If it can’t be used to make multiple outfits, it doesn’t belong in your suitcase! Items that can be dressed up or dressed down are ideal.\n\nFor more tips and a detailed list of suggestions, download GEO's [[packing checklist|https://webapp.mis.vanderbilt.edu/studioabroad/_customtags/ct_FileRetrieve.cfm?File_ID=14068]].\n\n&lt;&lt;segue &quot;Identity and diversity&quot;&gt;&gt;\s</div><div tiddler="Visa Acquisition" tags="sidebar travel" created="201404171617" modifier="twee" twine-position="514,282">&lt;&lt;sidebar &quot;How to Get a Travel Visa&quot;&gt;&gt;\nA ''travel visa'' is not a credit card! It's a stamp or sticker placed in your passport that allows you to visit a foreign country. Depending on your own nationality and your reasons for traveling, ''you may or may not need a visa'' to enter a given country.\n\nIf you will be taking classes from an institution based in your host country, you will usually need a student-class visa to enter. Entry requirements are often lower when you are simply visiting as a tourist. \n\nRequirements to get a visa may include photographs, financial information, a letter from your host university, a criminal background check, or even a personal appearance at the foreign consulate. Your own nationality may have a major impact on the requirements you face in getting a visa. For example, US citizens typically face lower barriers than students of other nationalities. \n\nIn certain cases, students may be able to enter a country without a visa, but will need to obtain a ''residence permit'' after entering.\n\nYour study abroad provider will inform you about your visa requirements. If you are uncertain or have general questions, please contact GEO. \n\n|box|k\n|&gt;|!Further information|\n|[[Travisa|http://www.travisa.com/]]|Easy access to visa requirements for all countries and most nationalities|\n|[[Visa @Wikipedia|https://en.wikipedia.org/wiki/Visa_(document)]]|Article providing information about visa policies around the world|\n\n&lt;&lt;segue &quot;Traveling with medications&quot;&gt;&gt;\s</div><div tiddler="Money" tags="living" created="201404171622" modifier="twee" twine-position="381,1288">!Money\n!!!!Use debit and credit cards wisely to save money\nThe amount of money you spend while studying abroad will vary depending on the local cost of living, your personal spending habits, independent travel, and so on. //How// you access your money can also play a role in maintaining your budget.\n\nMany businesses will not accept plastic, especially for smaller purchases, so it's a good idea to have ''cash'' on hand throughout your time abroad. The most cost-effective way to get cash abroad is to use your ''debit card'' (not a credit card!) in an ATM. You can usually find out where the ATMs you might need are before you leave the US--ask your bank how!\n\nGEO also recommends that you bring a ''credit card''. Be aware that every credit card purchase or debit card withdrawal will likely carry transaction fees. Shop around a bit for the best rates before you leave the US, but also minimize the number of times you use your cards. Take out as much cash as you feel comfortable with each time you use the ATM, and use your credit card only when necessary or when you have an especially large purchase.\n\nBefore you depart the US, and every time you enter a new country, you should inform your bank(s) of your location. If you don't, you may find your cards canceled as an anti-fraud measure! \n\n|box|k\n|!Summary|\n|Before you leave, consider seeking out the US banks with the best currency conversion and transaction fees for your host country.|\n|Call your bank(s) to let them know you'll be abroad, and whenever you cross international borders.|\n|Use your debit card in an ATM to get cash on a weekly or biweekly basis.|\n|Use your credit card for purchases. Do not use your debit card except for ATM withdrawals!|\n|Use your credit card for large purchases if possible.|\n|Only get cash from an ATM using your credit card in a dire emergency. Cash advances carry high fees.|\n\n&lt;&lt;sidebar-box&gt;&gt;\n   [[More on credit cards|More on credit cards]]\n   [[How do I budget for myself?|Budgeting]]\n&lt;&lt;/sidebar-box&gt;&gt;\n\n&lt;&lt;segue &quot;Where will you live?&quot;&gt;&gt;\s</div><div tiddler="Academic systems abroad" tags="academics sidebar" created="201405191314" modifier="twee" twine-position="156,1163">&lt;&lt;sidebar &quot;Academic systems abroad&quot;&gt;&gt;\nHigher education and academic systems abroad can vary greatly from what you are used to in the United States. Here are some things that might be different depending on the country.\n\n|box|k\n|!Differences in academic systems abroad|\n|There are fewer hours spent in the classroom, and students are expected to spend more time studying on their own. This doesn't mean that there will be assigned homework! A lot of responsibility for deciding how best to spend your homework hours may be left up to you.|\n|Depending on the course and level you are taking, and whether you are taking it in a foreign language, you may need to spend extra time learning and mastering the material.|\n|There are fewer tests and quizzes, and students may earn a grade based on just one final exam, or a mid-term and a final. This means you'll have less chance to gauge how a professor grades in the weeks or months before an exam.|\n|Professors are less accessible for office hours, and by email.|\n|Classes may be more lecture-style than discussion-based. This may leave fewer opportunities to ask questions or express your opinions.|\n|There may not be much sense of privacy attached to grades. For example, the instructor might post all exam grades publicly. In some places, individual grades may be discussed openly in class.|\n|The prevailing academic culture may well be very different. For example, students may not be as concerned--or concerned at all--about getting high grade point averages.|\n|In some places, such as Latin America, students pursue something like a strict professional degree, without a liberal arts component. They may have a much more focused academic experience.|\n|Students likely do not live on campus, which may mean that you need to meet people through academics at first, or join a club.|\n|&lt;hr&gt;//Every country is different! If you want to know more about systems in your host country, talk to your GEO advisor!//|\n\n&lt;&lt;segue &quot;Course equivalency evaluations&quot;&gt;&gt;</div><div tiddler="Race and ethnicity abroad" tags="living sidebar" created="201405191507" modifier="twee" twine-position="652,756">&lt;&lt;sidebar &quot;Race and ethnicity abroad&quot;&gt;&gt;\nDepending on who you are and where you are going, you may feel a part of a racial or ethnic majority for the first time in your life. Or you may have the opposite experience, becoming a racial minority in one fell swoop. Either way, you will likely find that your ethnic or racial identity has different implications in your new host country than it has at home. \n\nThese new vantage points on self and identity can be exciting, but they can also be difficult. People may consistently misidentify you based on physical appearance, for example. Or you may be surprised at how freely people comment on appearance. If your appearance is very exotic for your host culture, you may find that you are stared at, or that people want to touch your hair or skin.\n\nOr, it's possible that your physical appearance and racial or ethnic identity is almost totally ignored, and all that really seems to matter is your nationality and gender.\n\nIf you are traveling to a location that is part of your own heritage, be aware that people there may not see your heritage as the most important thing about you. If you are from the US, you may find that people there identify you as an American first. You should be prepared to be considered an outsider.   \n\nFor all of these reasons, it will be wise to prepare yourself in advance for the attitudes on race and ethnicity held by people of your host country. Do some research, and also see whether talking with alums of the program might help. GEO can help you find alums to talk to, just ask!\n\n|box|k\n|!Resources|\n|[[Diversity Issues in Study Abroad|http://www.smith.edu/studyabroad/docs/diversity_st_abroad01.pdf]]: A booklet that collects statements of Brown University students about their experiences of identity abroad. A bit dated now, but many comments remain reflective of realities today.|\n|[[AllAbroad.us|http://allabroad.us/diversity-resources.php]], which has a wide variety of specific information for African American, Asian/Pacific Island, Latino/Hispanic American, and Native American students|\n|[[Diversity Abroad|http://www.diversityabroad.com/]], a collection of resources for underrepresented students traveling abroad|\n|[[Heritage seekers|http://www.diversityabroad.com/Heritage-Seekers]], thoughts and resources for students interested in exploring their own heritage through study abroad|\n\n&lt;&lt;segue &quot;Contacts and communications&quot;&gt;&gt;\s\n</div><div tiddler="What to do next" tags="finish bookmark" created="201404171650" modifier="twee" twine-position="1615,611">!What to do next\n!!!!Subhead goes here\n   * Link to checklist of responsibilities\n   * Visa/Passport\n\n&lt;&lt;segue &quot;Index&quot;&gt;&gt;</div><div tiddler="More on credit cards" tags="living sidebar" created="201405221647" modifier="twee" twine-position="665,1291">&lt;&lt;sidebar &quot;More on credit cards&quot;&gt;&gt;\nEurope and much of the rest of the world are moving to chip-and-PIN (or EMV) &quot;smart&quot; credit cards. These cards offer more secure transactions by adding an embedded microchip and replacing easily forged signatures with the entry of a PIN number.\n\nStudents should be able to function abroad with a regular US swipe card, which are still accepted by most businesses. However, US swipe cards are not likely to work at most self-serve kiosks.\n\nDepending on your bank, it may be possible for you to get a chip-and-PIN card in the US for use overseas. If you decide to explore this route, be aware that there is a difference between chip-and-PIN and chip-and-signature cards. Chip-and-signature cards will not work in automated kiosks abroad, for example.\n\nRegardless of whether you choose a chip-embedded card, you may want to shop around for banks and credit card companies before you leave. Seek out cards that carry low foreign transaction fees, as well as debit card providers with overseas partnerships that allow for lower ATM fees.\n\n&lt;&lt;segue &quot;Where will you live?&quot;&gt;&gt;</div><div tiddler="Extended icon font" tags="stylesheet" created="201407031641" modifier="twee" twine-position="0,0">@font-face\n{\n    font-family: 'icomoon-sugarcube-extended';\n    src: url(data:application/font-woff;charset=utf-8;base64,d09GRk9UVE8AAAckAAoAAAAABtwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABDRkYgAAAA9AAAAwAAAAMAsb/8qk9TLzIAAAP0AAAAYAAAAGAOsgMuY21hcAAABFQAAABEAAAAROYWAIdnYXNwAAAEmAAAAAgAAAAIAAAAEGhlYWQAAASgAAAANgAAADYBKuITaGhlYQAABNgAAAAkAAAAJAfCA8hobXR4AAAE/AAAABwAAAAcFgAAwG1heHAAAAUYAAAABgAAAAYAB1AAbmFtZQAABSAAAAHkAAAB5CE/yNRwb3N0AAAHBAAAACAAAAAgAAMAAAEABAQAAQEBG2ljb21vb24tc3VnYXJjdWJlLWV4dGVuZGVkAAECAAEAPvgcAvgbA/gYBB4KAAl2ViX/i4seCgAJdlYl/4uLDAeLS/qU+lQFHQAAAMUPHQAAAMoRHQAAAAkdAAAC9xIACAEBGzU4PUJHTFFpY29tb29uLXN1Z2FyY3ViZS1leHRlbmRlZGljb21vb24tc3VnYXJjdWJlLWV4dGVuZGVkdTIwdUU2MDB1RTYwMXVFNjAydUU2MDN1RTYwNAAAAgGJAAUABwIAAQAEAAcAXAEQAXYBpQIb/pQO/JQO+hT51BWL/dQF/TSLBVaLYLaLwAiLwLa2wIsI+PSLBYv5lAX9FIsFRYtRUYtFCIv9lAWLRcVR0YsI+ZSLBYv6FAVLiwX9FP1UFfjUiwWLSwX81IsFDvoQ+ZgV+wz3DAVmsEGqVosI/FSLBVaLYGCLVgiL/dQFi1a2YMCLCPlUiwXAi7a2i8AIi/jUBYvAbNVmsAj7kMAVjYqNio2KCJ2EmIKPhwj3DPsMBY+HlH6SeQiMiYyJjIkI+0yLBYv3TAX3VP2MFf0UiwWL+ZQF+BSLBYv7lAX3lIsFi/yUBfzU+BQV+JSLBYtLBfyUiwWLSxX4lIsFi0sF/JSLBYtLFfiUiwWLSwX8lIsFDov6VBX3lIsFi/uUBfuUiwX4FPdUFfkUiwWL+xQF/RSLBfwU+1QV95SLBYv7lAX7lIsF+BT3VBX5FIsFi/sUBf0UiwX8FPtUFfeUiwWL+5QF+5SLBfgU91QV+RSLBYv7FAX9FIsFDsv5lBX6FIsFi/tUBf4UiwWLSxX6FIsFi/tUBf4UiwWLSxX6FIsFi/tUBf4UiwUOi/jUFflUiwWL+xQF/VSLBYv3FAWL91QV+VSLBYv7FAX9VIsFi/cUBYv8FBX5VIsFi/sUBf1UiwWL9xQFi/tUFflUiwWL+xQF/VSLBYv3FAX5lPdUFfcU+1QF9xT3VAX7lIsF95TLFfsU91QF+xT7VAX3lIsFDvqUFPqUFYsMCgADBAABkAAFAAACmQLMAAAAjwKZAswAAAHrADMBCQAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAAAAAAAAAAAAAAEAAIOYEA8D/wP/AA8AAQAAAAAEAAAAAAAAAAAAAACAAAAAAAAIAAAADAAAAFAADAAEAAAAUAAQAMAAAAAgACAACAAAAIOYE//3//wAAACDmAP/9////4RoCAAMAAQAAAAAAAAAAAAEAAf//AA8AAQAAAAEAALH7S3dfDzz1AAsEAAAAAADPBc7LAAAAAM8FzssAAP/ABAADwAAAAAgAAgAAAAAAAAABAAADwP/AAAAEAAAAAAAEAAABAAAAAAAAAAAAAAAAAAAABwAAAAACAAAABAAAQAQAAEAEAAAABAAAQAQAAAAAAFAAAAcAAAAAAA4ArgABAAAAAAABADQAAAABAAAAAAACAA4AzAABAAAAAAADADQASgABAAAAAAAEADQA2gABAAAAAAAFABYANAABAAAAAAAGABoAfgABAAAAAAAKACgBDgADAAEECQABADQAAAADAAEECQACAA4AzAADAAEECQADADQASgADAAEECQAEADQA2gADAAEECQAFABYANAADAAEECQAGADQAmAADAAEECQAKACgBDgBpAGMAbwBtAG8AbwBuAC0AcwB1AGcAYQByAGMAdQBiAGUALQBlAHgAdABlAG4AZABlAGQAVgBlAHIAcwBpAG8AbgAgADAALgAwAGkAYwBvAG0AbwBvAG4ALQBzAHUAZwBhAHIAYwB1AGIAZQAtAGUAeAB0AGUAbgBkAGUAZGljb21vb24tc3VnYXJjdWJlLWV4dGVuZGVkAGkAYwBvAG0AbwBvAG4ALQBzAHUAZwBhAHIAYwB1AGIAZQAtAGUAeAB0AGUAbgBkAGUAZABSAGUAZwB1AGwAYQByAGkAYwBvAG0AbwBvAG4ALQBzAHUAZwBhAHIAYwB1AGIAZQAtAGUAeAB0AGUAbgBkAGUAZABHAGUAbgBlAHIAYQB0AGUAZAAgAGIAeQAgAEkAYwBvAE0AbwBvAG4AAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==) format('woff');\n    font-weight: normal;\n    font-style: normal;\n}</div><div tiddler="Sidebar Title" tags="widget" created="201407031641" modifier="twee" twine-position="0,0">/% Syntax:\n    &lt;&lt;sidebar [text]&gt;&gt; %/\s\n&lt;&lt;widget &quot;sidebar&quot;&gt;&gt;\s\n    &lt;hr class=&quot;sidebar&quot;&gt;\s\n    &lt;h4 class=&quot;sidebar&quot;&gt;Additional Information&lt;/h4&gt;\s\n    &lt;h1 class=&quot;sidebar&quot;&gt;&lt;&lt;print $args[0]&gt;&gt;&lt;/h1&gt;\s\n    &lt;hr class=&quot;sidebar&quot;&gt;\s\n    &lt;&lt;if state.length gt 1&gt;&gt;\s\n        &lt;&lt;set $temp to state.peek(1).title&gt;&gt;\s\n        &lt;h6 class=&quot;sidebar page-back-link&quot;&gt;[['Back to &quot;' + state.peek(1).title + '&quot;'|$temp]]&lt;/h6&gt;\n    &lt;&lt;/if&gt;&gt;\s\n&lt;&lt;/widget&gt;&gt;\s</div><div tiddler="Resources for monitoring safety" tags="safety sidebar" created="201405281500" modifier="twee" twine-position="1111,618">&lt;&lt;sidebar &quot;Resources for monitoring safety&quot;&gt;&gt;\nYou should keep an eye on the safety situation in all the places you are planning to travel. This includes the program site, but also countries you might visit on independent weekend travel, or on breaks and holidays.\n\nPotential resources include local and international media, as well as the websites of governmental and nongovernmental agencies. It can be a good idea to look at the advice of multiple sources, as they may have different perspectives and emphases. The resources here include country-specific resources from many governments to facilitate this sort of comparison.\n\n|box|k\n|!Resources|\n|[[Learn About Your Destination|http://travel.state.gov/content/passports/english/country.html]], country-specific resources from the US Department of State|\n|[[International SOS|https://www.internationalsos.com/MasterPortal/default.aspx?content=faqs]], up-to-date risk ratings and travel security advisories|\n|[[US Department of State Traveler's Checklist|http://travel.state.gov/content/passports/english/go/checklist.html]]|\n|[[US Department of State's site for student travelers|http://studentsabroad.state.gov/]]|\n|[[US Department of State's STEP program|https://step.state.gov/step/]] (Smart Traveler Enrollment Program)|\n|[[Canadian Foreign Affairs and Int'l Trade Office|http://travel.gc.ca/travelling/advisories]], country-specific travel advisories (English and French)|\n|[[UK Foreign & Commonwealth Office|https://www.gov.uk/foreign-travel-advice]], country-specific travel advisories|\n|[[Republic of Ireland Department of Foreign Affairs and Trade|http://dfa.ie/home/index.aspx?id=275]], country-specific travel advisories|\n|[[German Federal Foreign Office|http://www.auswaertiges-amt.de/DE/Laenderinformationen/LaenderReiseinformationen_node.html]], country-specific travel advisories (German only)|\n|[[Australian Department of Foreign Affairs and Trade|http://www.smartraveller.gov.au/]], country-specific travel advisories|\n|[[French Ministry of Foreign Affairs and International Development|http://www.diplomatie.gouv.fr/en/]], country-specific travel advisories (English, French, German, Spanish, Arabic, and Chinese)|\n|[[Israeli Ministry of Foreign Affairs|http://www.mfa.gov.il/MFA]], country-specific travel advisories (English, Hebrew, Arabic, Russian)|\n|[[Egyptian Ministry of Foreign Affairs|http://www.mfa.gov.eg/english/Pages/default.aspx]], country-specific travel advisories (English, French, Arabic)|\n|[[Indian Ministry of External Affairs|http://www.mea.gov.in/]], country-specific travel advisories (English, Hindi, other)|\n|[[Japanese Ministry of Foreign Affairs|http://www.mofa.go.jp/]], country-specific travel advisories (English, Japanese, others)|\n|[[People's Republic of China Ministry of Foreign Affairs|http://www.fmprc.gov.cn/eng/]], country-specific travel advisories (English, Chinese, French, Russian, and Arabic)|\n|[[Russian Ministry of Foreign Affairs|http://www.mid.ru/brp_4.nsf/main_eng]], country-specific travel advisories (English, Russian, French, German, Spanish)|\n\n&lt;&lt;segue &quot;Basic safety abroad&quot;&gt;&gt;\s</div><div tiddler="Vanderbilt conduct policies" tags="policies" created="201404171613" modifier="twee" twine-position="15,751">!Vanderbilt conduct policies\n!!!!Vanderbilt policies apply abroad as well as on campus\n&lt;&lt;if ($vanderbilt eq &quot;true&quot;) or ($facultyled eq &quot;true&quot;)&gt;&gt;Your ''trip leader or resident director has sole discretion over all discipline decisions''. They will hold you accountable for the standards of behavior described in the VU [[Student Handbook|http://www.vanderbilt.edu/student_handbook/]] and [[Honor System|http://www.vanderbilt.edu/student_handbook/the-honor-system/]], and they may also dictate other rules as needed. Your Vanderbilt trip leader may impose any disciplinary sanction, up to and including dismissal from the program. You also may face further consequences when you return to Vanderbilt.\n&lt;&lt;else&gt;&gt;You are subject to your abroad institution's rules, but you //also// need to abide by Vanderbilt's conduct policies. The standards of behavior described in the VU [[Student Handbook|http://www.vanderbilt.edu/student_handbook/]] and [[Honor System|http://www.vanderbilt.edu/student_handbook/the-honor-system/]] apply while you are abroad. Conduct that violates these codes may result in sanctions when you return to Vanderbilt, //even if you already received sanctions from your program abroad.//&lt;&lt;/if&gt;&gt;\n\nBe sure to read the section in the Student Handbook on [[conduct in study abroad programs|http://www.vanderbilt.edu/student_handbook/student-accountability/#conduct-in-study-abroad-programs]].\n\n&lt;&lt;sidebar-box&gt;&gt;\n\t[[Is Vanderbilt's alcohol policy different abroad?|Alcohol Policy]]\n\t[[What should I know about rules surrounding sexual misconduct abroad?|Sexual Misconduct]]\n&lt;&lt;/sidebar-box&gt;&gt;\n&lt;&lt;segue &quot;Grades and credits&quot;&gt;&gt;\s</div><div tiddler="Start" tags="nosave" created="201404181147" modifier="twee" twine-position="1188,1868">&lt;&lt;if \n    SaveSystem.autosaveOK \n    && storage.getItem(&quot;saves&quot;).autosave !== null \n&gt;&gt;\s\nYou have a session already in progress. Continue where you left off? \n&lt;&lt;script&gt;&gt; \n    var resumeBtn = insertElement( \n        output, \n        &quot;button&quot;, \n        &quot;resume-button&quot;, \n        &quot;ui-autostart-button&quot;, \n        &quot;Resume where I left off&quot; \n    ); \n    var restartBtn = insertElement( \n        output, \n        &quot;button&quot;, \n        &quot;restart-button&quot;, \n        &quot;ui-autostart-button&quot;, \n        &quot;Start over&quot; \n    ); \n    $(resumeBtn).click(function() {\n        SaveSystem.loadAuto();\n    }); \n    $(restartBtn).click(function() { \n        SaveSystem.deleteAuto();\n        state.display(&quot;About the Presentation&quot;);\n    });\n&lt;&lt;/script&gt;&gt;\s\n&lt;&lt;else&gt;&gt;\s\n\t&lt;&lt;display &quot;About the Presentation&quot;&gt;&gt;\s\n&lt;&lt;/if&gt;&gt;\s</div><div tiddler="Medications" tags="sidebar health" created="201404171642" modifier="twee" twine-position="1116,13">&lt;&lt;sidebar &quot;Where to Find Crucial Information About Your Medications&quot;&gt;&gt;\nThere are two pieces of information that it will be useful or even critical for you to know about your medications: the legal status of the drug in your host country, and the generic/chemical name and/or the local brand names it goes by.\n\nTo ''find the generic or chemical name'' of a drug, you can check the National Institutes of Health's [[MedlinePlus website|http://www.nlm.nih.gov/medlineplus/druginformation.html]]. It may be somewhat trickier to find out the brand name the drug might be sold under in your host country, but [[this tool from HTH Worldwide Insurance|https://www.hthstudents.com/drug/index1.cfm]] will provide answers in most cases.\n\nTo ''find out if any of your medications are restricted or banned'' in your host country, contact the country's embassy here in the US. The US Department of State provides a [[directory of foreign embassies|http://www.state.gov/s/cpr/rls/dpl/32122.htm]]. Even some over-the-counter drugs may be more restricted abroad, so ask if you have doubts.\n\nWhatever the legal status of your medications, ''request a letter from your physician'' explaining why the drugs you are transporting have been prescribed to you. Also include over-the-counter drugs if needed. You will want to take this letter with you //whenever you travel!// Request that your doctor use the local brand names or generic/chemical names for your drugs.\n\nWhen possible, ''take enough medicine with you to cover your entire stay abroad''. If your medicine is only available in limited supply, please discuss with your physician and program staff how you will obtain enough  for your stay. Please be aware that medications //cannot be sent through the mail!//\n\n|box|k\n|!Resources|\n|[[MedlinePlus|http://www.nlm.nih.gov/medlineplus/druginformation.html]], information on prescription and over-the-counter drugs, including generic/chemical names|\n|[[HTH Drug Translation Guide|https://www.hthstudents.com/drug/index1.cfm]], offers equivalent brand names and availability for frequently visited countries/destinations|\n|[[Directory of Foreign Embassies|http://www.state.gov/s/cpr/rls/dpl/32122.htm]], US Department of State|\n|[[Traveler's Checklist|http://travel.state.gov/content/passports/english/go/checklist.html]] from the US Department of State|\n|[[The Yellow Book|http://wwwnc.cdc.gov/travel/yellowbook/2014/table-of-contents]], the CDC's extensive guide for foreign travel, with answers to questions you didn't even know to ask!|\n\n&lt;&lt;segue &quot;Medical insurance&quot;&gt;&gt;\s</div><div tiddler="Traveling with medications" tags="travel" created="201404171617" modifier="twee" twine-position="375,410">!Traveling with medications\n!!!!Ensure continuity in your medical care\nDrugs that are regularly prescribed in the US can sometimes be more restricted abroad. Even some over-the-counter drugs may be interdicted overseas. Take precautions when traveling to ensure that your medications don't get you in trouble.\n\n''Keep all of your medications in their original packaging'' when traveling. This will trigger less suspicion from customs agents and law enforcement.\n\nTo find out if any of your medications are restricted or banned in your host country, [[contact the country's embassy|http://www.state.gov/s/cpr/rls/dpl/32122.htm]]. Ask about over-the-counter drugs too if they are a part of your regular care regime.\n\nWhatever the legal status of your medications, ''request a letter from your physician'' explaining why the drugs you are transporting have been prescribed to you. Also include over-the-counter drugs if needed. You will want to take this letter with you //whenever you travel!// Request that your doctor use the local brand names or generic/chemical names for your drugs.\n\nWhen possible, ''take enough medicine with you to cover your entire stay abroad''. If your medicine is only available in limited supply, please discuss with your physician and program staff how you will obtain enough  for your stay. \n\nBe aware that medications ''cannot be sent through the mail!''\n\n|box|k\n|!Resources|\n|[[MedlinePlus|http://www.nlm.nih.gov/medlineplus/druginformation.html]], information on prescription and over-the-counter drugs, including generic/chemical names|\n|[[HTH Drug Translation Guide|https://www.hthstudents.com/drug/index1.cfm]], offers equivalent brand names and availability for frequently visited countries/destinations|\n|[[Directory of Foreign Embassies|http://www.state.gov/s/cpr/rls/dpl/32122.htm]], US Department of State|\n\n&lt;&lt;segue &quot;Tips for packing&quot;&gt;&gt;\s</div><div tiddler="Where will you live?" tags="living" created="201404171622" modifier="twee" twine-position="379,1425">!Where will you live?\n!!!!What choices do you have in your housing abroad?\nSome programs offer you the opportunity to select from multiple housing options. &lt;&lt;if $facultyled eq false&gt;&gt;Which should you choose? (If you're not sure about your housing options, talk to the GEO advisor for your program.)\n\nThe answer, of course, depends on what you are hoping to get out of your time overseas. \n\nBut since you may be facing a choice soon, we want to share with you what alumni of Vanderbilt study abroad tell us in their program evaluations: Students who live with natives of their host country typically report greater satisfaction with their housing and integration into the local culture than students who live with Americans. This is true whether students lived with a homestay family or with native roommates of their own age.\n&lt;&lt;display &quot;Housing chart&quot;&gt;&gt;\s\n&lt;&lt;else&gt;&gt;You will receive more information from your instructor about housing abroad. If your program has a component in Nashville, you may want to ask your instructor about housing here on campus.\n&lt;&lt;/if&gt;&gt;\nPlease note that [[Vanderbilt University policy|https://webapp.mis.vanderbilt.edu/studioabroad/index.cfm?FuseAction=Abroad.ViewLink&Parent_ID=1B2BA4C0-FC49-E73B-80E95C6B35878D81&Link_ID=1B4B6ADC-B154-3B65-716254775A4B2E6D&pID=11&lID=65#housing]] does not allow you to find your own housing, //unless// your program doesn't offer prearranged housing.\n   \n&lt;&lt;segue &quot;Eating and diet&quot;&gt;&gt;\s</div><div tiddler="Basic safety abroad" tags="safety" created="201405281256" modifier="twee" twine-position="975,749">!Basic safety abroad\n!!!!Tips for staying safe while out and about\nYou are the best guarantor of your own safety! While abroad, commit yourself to being an alert and observant traveler at all times. Anticipate problems by learning to read the local environment, and by knowing where and when to be hypervigilant. If you aren't paying attention, you can easily become the victim of opportunistic crime.\n\n''Know where you are going and look like you belong''. Definitely bring your map along, but don't check it in the open street, where looking lost could get you robbed. Be friendly, but don't hesitate to refuse offers of help from strangers, especially near ATMs, ticket machines, train and metro stations, and baggage lines.\n\n''Avoid demonstrations and political disturbances'' of all kinds. Crowd behavior is unpredictable, and even peaceful marches can turn violent.\n\n''Get a working cell phone'' and carry it with you. Some programs require students to have a phone, and most will provide you information on getting a cheap phone that works locally. A phone can be a literal lifeline in an emergency--carry one!\n\nSecure your travel and identification documents at all times, and store duplicate copies in multiple places. ''Know your local emergency numbers'', particularly for your resident director or program staff and for the local equivalent of 911. \n\nLearn local traffic patterns and traffic laws, as well as safe pedestrian habits. Road safety issues and driving accidents are the //primary// cause of injury to students abroad. Given the risks of traffic accidents, ''Vanderbilt does //not// recommend the rental of motor vehicles while studying abroad''.\n\n&lt;&lt;sidebar-box&gt;&gt;\n   [[Road safety overseas|Road safety overseas]]\n&lt;&lt;/sidebar-box&gt;&gt;\n\n&lt;&lt;segue &quot;Personal emergencies&quot;&gt;&gt;\s</div><div tiddler="Student status and billing" tags="policies bookmark" created="201404171613" modifier="twee" twine-position="10,341">!Student status and billing\n!!!!You remain a Vanderbilt student while abroad!\nWhile studying abroad, you ''remain registered as a Vanderbilt student'' and you retain access to on-campus resources. You can register for classes, log in to YES and other campus applications, and make use of services (including [[counseling|https://medschool.vanderbilt.edu/pcc/]]).\n&lt;&lt;if $facultyled neq &quot;true&quot;&gt;&gt; \nTo make this possible, GEO enrolls you in a study abroad &ldquo;''placeholder course''.&rdquo; The placeholder will appear on your YES account before you go abroad. The actual courses you take abroad, as well as the grades you earned, will eventually replace the placeholder. This will occur only after your transcript arrives from abroad and both GEO and the University Registrar have processed it. ''It may take 2 to 6 months'' from the end of your program for your transcript to arrive, depending on individual circumstances.&lt;&lt;/if&gt;&gt;\n\n''Billing'' works just as it does for on-campus students. Vanderbilt Student Accounts will bill you, and your bill will arrive at the same time as usual, with the same payment terms. You can find the fees for your program in GEO's [[Cost Calculator|https://webapp.mis.vanderbilt.edu/studioabroad/index.cfm?FuseAction=Abroad.ViewLink&Parent_ID=B6A18B3E-FF30-D2BF-DB945C58C1748491&Link_ID=A02DB6D2-A969-AD00-E852344EC0D31EA1&pID=5&lID=33]]. Be aware that there are costs that are not billed by Vanderbilt--including airfare, visa fees, and more--which you should factor into your overall budget. Contact your program provider or GEO advisor for more information.\n\n|box|k\n|!What's in my bill?|\n|Regular Vanderbilt tuition|\n|Study-abroad program fee (different for each program)|\n|(Reduced) activity fee|\n|&lt;hr /&gt;//More information:// [[Billing policies and procedures|https://webapp.mis.vanderbilt.edu/studioabroad/index.cfm?FuseAction=Abroad.ViewLink&Parent_ID=1B2BA4C0-FC49-E73B-80E95C6B35878D81&Link_ID=1B4B6ADC-B154-3B65-716254775A4B2E6D&pID=11&lID=64#billing]]|\n\n&lt;&lt;sidebar-box&gt;&gt;\n\t[[What about financial aid?|Financial Aid]]\n&lt;&lt;/sidebar-box&gt;&gt;\n&lt;&lt;segue &quot;Preparation and responsibilities&quot;&gt;&gt;\s</div><div tiddler="Opportunities for returned students" tags="home" created="201404171648" modifier="twee" twine-position="1613,144">!Opportunities for returned students\n!!!!There's sooooo much you can do when you get home!\nYour study abroad experience doesn't have to end when you return to the US! In fact, our goal is to ensure that you can extend and process your experience when you return home.\n\nGEO offers programming specifically created for returning students. We sponsor a ''student organization,'' the Study Abroad Alumni Group, which hosts social dinners and workshops. Our [[annual conference|http://vanderbi.lt/icgrsa]] helps you unpack your experience and/or share your newfound insights about the world with fellow students.\n\nWhen you return, you can also ''volunteer with or work for GEO''; it's a great way to share your experience with other students. You can also get involved in our own local community: you may be surprised how international Nashville really is!\n\nStudying abroad can make you a great candidate for ''prestigious honors scholarships'' when you return home. Some of these, such as the Fulbright Fellowship or Critical Language Summer Institutes, may even send you abroad again! These opportunities may require advance planning, though, so we encourage you to study the offerings and discuss your interests with the [[Office of Honor Scholarships|http://ohs.vanderbilt.edu]] //before you leave//.\n\n&lt;&lt;sidebar-box&gt;&gt;\n   [[More ideas and resources for getting involved after you return!|Returnee resources]]\n   [[What possibilities exist for me to go abroad again after I return?|Going abroad again]]\n&lt;&lt;/sidebar-box&gt;&gt;\n\n&lt;&lt;segue &quot;GEO Photo Contest&quot;&gt;&gt;\s</div><div tiddler="Disclosing medical information" tags="health sidebar" created="201405231125" modifier="twee" twine-position="1245,143">&lt;&lt;sidebar &quot;Disclosing medical information&quot;&gt;&gt;\nGEO strongly recommends that you disclose all medical conditions to your program staff. Even if you are diligent in the management of your health, studying abroad can present challenges you may not have foreseen. You or your body may react in unexpected ways. It is in your best interest to give your on-site staff the tools necessary to ensure you have a safe and successful time abroad. \n\nAny health-related history you provide is used to support your stay. It would only be shared in the case of a medical or mental health emergency--and only with the appropriate clinicians or staff on site. \n\nYou might even consider signing a Release of Information (ROI) form with your physician. This document would grant your doctor permission to share your medical history with the person(s) named in the ROI. This would enable you to be cared for in the event that you were incapacitated and unable to grant the permission yourself.\n\n&lt;&lt;segue &quot;Medical insurance&quot;&gt;&gt;\s\n</div><div tiddler="Goto Passage" tags="script" created="201407031641" modifier="twee" twine-position="0,0">/* Syntax:\n    &lt;&lt;goto [passage name]&gt;&gt;  */\n(function () {\n    macros.add(&quot;goto&quot;, {\n        version: {\n            major: 1,\n            minor: 0,\n            revision: 0\n        },\n        handler: function () {\n            try {\n                state.display(this.args[0]); \n            } \n            catch (e) {\n                return this.error(&quot;Go to passage: &quot; + e.message);\n            }\n        }\n    });\n}());</div><div tiddler="Going abroad again" tags="home sidebar" created="201404171648" modifier="twee" twine-position="1751,144">&lt;&lt;sidebar &quot;Going Abroad...Again!&quot;&gt;&gt;\nStudents who return from abroad often feel they need to go abroad again!\n\nIf you are not graduating and you have room in your academic schedule, you are welcome to ''apply for another GEO study abroad program''--there is no rule that says you can only go once! Or, if you are more strapped for time, consider ''volunteering abroad''! You can go over break either with OACS or on your own. You may even be able to find funding (ask OACS about the Nichols Humanitarian Fund!).\n\nOr consider ''graduate studies abroad''. Several universities around the world welcome international students for graduate degrees. Many have more reasonable tuition fees than you will find in the US, yet with a comparable quality of education. It is often possible to apply US federal financial aid toward studies at recognized institutions. Some countries, like the United Kingdom, will even give you a 1- or 2-year work visa upon completion of an advanced degree in their country.\n\nAnother option might be ''working or interning abroad'', including teaching English abroad. Visit GEO's [[Career page|https://webapp.mis.vanderbilt.edu/studioabroad/index.cfm?FuseAction=Abroad.ViewLink&Parent_ID=1B2A18AE-0A6B-2220-EA57131A558B072C&Link_ID=1B3AFB7F-CCFB-5B8C-F4E22E5CBC34F1E5&pID=2&lID=21]] for resources and tips for finding an international job!\n\n&lt;&lt;segue &quot;GEO Photo Contest&quot;&gt;&gt;\s</div><div tiddler="Road safety overseas" tags="safety sidebar" created="201405281644" modifier="twee" twine-position="1115,754">&lt;&lt;sidebar &quot;Road safety overseas&quot;&gt;&gt;\nMovies and media reporting have conditioned us to think that the greatest threats to safety abroad are dramatic, &quot;foreign,&quot; and of the &quot;third world.&quot; The reality is that the ''number one cause of injury and death for American students abroad is traffic accidents''. And the vast majority of these occur in wealthy, industrialized countries.\n\nGEO suggests that you train yourself to pay maximum attention at all times. Avoid earbuds as well as drinking--both can impair perception! Know the basic patterns of traffic, and remember to pay attention to the right side of the road in countries where traffic flow is reversed!\n\nAvoid traveling late at night, and always choose the safest form of transportation available. If you have a choice between riding in a taxicab or on the roof of a crowded bus--choose the cab! If walking is your safest option, do that whenever possible.\n\nJust as in the US, if you are a passenger, you should always wear a seatbelt. Avoid riding with anyone who appears intoxicated, over-tired, or emotionally distraught. Always sit in the back seat of a taxi.\n\nDeveloping countries present other risks, including shady taxi drivers, unsafe vehicles, overcrowded transport, etc. Your program staff will provide you with information about your options and help you assess risk. Don't be afraid to ask questions! \n\nVanderbilt strongly advises against renting a vehicle while abroad. Cars, SUVs, motorcycles, and mopeds are equally poor choices. The risks of driving when the rules of the road are unfamiliar are just too great.\n\n|box|k\n|!Resources|\n|[[Road Safety Overseas|http://travel.state.gov/content/passports/english/go/safety/road.html]], US Department of State|\n|[[Country-specific information from US Department of State|http://travel.state.gov/content/passports/english/country.html]], includes information on road safety for every country in the world|\n\n&lt;&lt;segue &quot;Personal emergencies&quot;&gt;&gt;\s</div><div tiddler="International SOS" tags="safety" created="201405281334" modifier="twee" twine-position="978,1273">!International SOS\n!!!!Emergency and travel assistance for Vanderbilt students\nVanderbilt contracts with International SOS (ISOS) primarily to handle responses to major emergencies overseas. ISOS also offers other services, and as a Vanderbilt student, you have access to all of them. But you should be aware that not all are free to you.\n\nThe primary role of ISOS is to aid in response to large-scale disasters and crises. For example, during the &quot;Arab Spring,&quot; ISOS evacuated a Vanderbilt student from Egypt. The organization runs a worldwide network of centers, clinics, and ambulances to deal with ill or wounded people. If you use ISOS in such an emergency, Vanderbilt will cover the cost.\n\nISOS can also help you with medical, personal, security, legal, or travel problems. Examples might include dealing with a lost passport, a critical missed airline connection, medical help, or other issues. ISOS provides these services on a fee-for-service basis (it is //not// a health insurer). While Vanderbilt may cover the up-front charges in non-emergency circumstances, ''you may be billed for these services after the fact!'' \n\nISOS also offers excellent safety information both on its [[website|https://www.internationalsos.com/MasterPortal/default.aspx?membnum=11BSGM000066]] and via emailed updates, which you must register your travel in order to receive.\n\n|box|k\n|!Resources|\n|[[Vanderbilt's ISOS portal|https://www.internationalsos.com/MasterPortal/default.aspx?membnum=11BSGM000066]], up-to-date risk ratings and travel security advisories. Register your travel here!|\n\n&lt;&lt;segue &quot;Reverse culture shock&quot;&gt;&gt;\s</div><div tiddler="Fonts" tags="stylesheet" created="201407031641" modifier="twee" twine-position="0,0">/*@import url(http://fonts.googleapis.com/css?family=Bevan);*/\n@import url(https://fonts.googleapis.com/css?family=Arvo:400,700);\n@import url(https://fonts.googleapis.com/css?family=Open+Sans:400italic,400,600,700);</div><div tiddler="Housing chart" tags="nobr" created="201404171622" modifier="twee" twine-position="530,1423">&lt;figure&gt;\n\t&lt;table class=&quot;box&quot;&gt;\n\t\t&lt;thead&gt;\n\t\t\t&lt;tr&gt;&lt;th colspan=2&gt;Overall Satisfaction with Housing and Cultural Immersion&lt;/th&gt;&lt;/tr&gt;\n\t\t&lt;/thead&gt;\n\t\t&lt;tbody&gt;\n\t\t\t&lt;tr&gt;\n\t\t\t\t&lt;td style=&quot;text-align:right;&quot;&gt;&lt;strong&gt;Lived with natives of host country&lt;/strong&gt;&lt;/td&gt;\n\t\t\t\t&lt;td&gt;\n\t\t\t\t\t&lt;div class=&quot;circle-graph circle-graph-full&quot;&gt;&lt;/div&gt;\n\t\t\t\t\t&lt;div class=&quot;circle-graph circle-graph-full&quot;&gt;&lt;/div&gt;\n\t\t\t\t\t&lt;div class=&quot;circle-graph circle-graph-full&quot;&gt;&lt;/div&gt;\n\t\t\t\t\t&lt;div class=&quot;circle-graph circle-graph-full&quot;&gt;&lt;/div&gt;\n\t\t\t\t\t&lt;div class=&quot;circle-graph-clip-container&quot;&gt;\n\t\t\t\t\t\t&lt;div class=&quot;circle-graph circle-graph-empty&quot;&gt;&lt;/div&gt;\n\t\t\t\t\t\t&lt;div class=&quot;circle-graph circle-graph-clip circle-graph-full&quot; style=&quot;clip:rect(0px, 14px, 30px, 0px);&quot;&gt;&lt;/div&gt;\n\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t&lt;/td&gt;\n\t\t\t&lt;/tr&gt;\n\t\t\t&lt;tr&gt;\n\t\t\t\t&lt;td style=&quot;text-align:right;&quot;&gt;&lt;strong&gt;Lived with Americans&lt;/strong&gt;&lt;/td&gt;\n\t\t\t\t&lt;td&gt;\n\t\t\t\t\t&lt;div class=&quot;circle-graph circle-graph-full&quot;&gt;&lt;/div&gt;\n\t\t\t\t\t&lt;div class=&quot;circle-graph circle-graph-full&quot;&gt;&lt;/div&gt;\n\t\t\t\t\t&lt;div class=&quot;circle-graph-clip-container&quot;&gt;\n\t\t\t\t\t\t&lt;div class=&quot;circle-graph circle-graph-empty circle-graph-clip&quot;&gt;&lt;/div&gt;\n\t\t\t\t\t\t&lt;div class=&quot;circle-graph circle-graph-clip circle-graph-full&quot; style=&quot;clip:rect(0px, 28px, 30px, 0px);&quot;&gt;&lt;/div&gt;\n\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t\t&lt;div class=&quot;circle-graph circle-graph-empty&quot;&gt;&lt;/div&gt;\n\t\t\t\t\t&lt;div class=&quot;circle-graph circle-graph-empty&quot;&gt;&lt;/div&gt;\n\t\t\t\t&lt;/td&gt;\n\t\t\t&lt;/tr&gt;\n\t\t\t&lt;tr&gt;&lt;td colspan=2&gt;&lt;hr&gt;&lt;em&gt;Results from recent GEO program evaluation survey responses&lt;/em&gt;&lt;/td&gt;&lt;/tr&gt;\n\t\t&lt;/tbody&gt;\n\t&lt;/table&gt;\n&lt;/figure&gt;\n/% Results from Spring 2013 survey, combining answers to three questions: #s 14, 15, and 16 %/</div><div tiddler="Being American abroad" tags="living sidebar" created="201405201001" modifier="twee" twine-position="786,625">&lt;&lt;sidebar &quot;Being American abroad&quot;&gt;&gt;\nIf you grew up in the US and identify as American, your American-ness will probably be the most important factor in how natives of your host country relate to you. (This is true no matter what your background.) While other components of your identity may well be important factors, the fact that you are American will be a critical component of your identity abroad.\n\nBe prepared to encounter curiosity and interest. America's unique economic, political, and cultural position in the world mean that people all around the world take an interest. You may be asked all sorts of questions, from what it's like to live in America to what you think of politics and other issues in the US. (The FBI has recently warned that American students abroad may also be the target of espionage recruitment.)\n\nMost interest you receive will probably be friendly, even if frankly or passionately expressed! But do prepare yourself to encounter actual hostility as well, and to consider how you might handle it.\n\nIn many places, people may assume that because you are American, you are also rich. Or they may have other assumptions, based on media portrayals, local history with US policies or intervention, or other sources. Do some research before you go so that you can have some idea of what being an American might mean in your host country.\n\n|box|k\n|!Quick tip|\n|In some parts of the world, you should be careful about referring to yourself as &quot;American.&quot; The entire Western Hemisphere is properly called America, and in Central and South America people may find the term &quot;American&quot; arrogant when used for just one country. Plan on referring to yourself as North American (//norteamericano//) instead.|\n\n|box|k\n|!Resources|\n|[[Diversity Issues in Study Abroad|http://www.smith.edu/studyabroad/docs/diversity_st_abroad01.pdf]]: A booklet that collects statements of Brown University students about their experiences of identity abroad. A bit dated now, but many comments remain reflective of realities today.|\n|''A Student Guide to Study Abroad'', a guide to many aspects of the process of study abroad, is a physical volume that you are welcome to reference by visiting GEO's reading library.|\n\n&lt;&lt;segue &quot;Contacts and communications&quot;&gt;&gt;\s</div><div tiddler="Eating and diet" tags="living" created="201405271521" modifier="twee" twine-position="380,1557">!Eating and diet\n!!!!Balancing dietary requirements with cultural exploration\nPeople everywhere eat differently because they are different--they have different cultures. Exploring another culture means exploring its food. GEO recommends that you keep an open mind, accept cultural differences, and try everything you (safely!) can. Have a gastronomic adventure!\n\nIf you have dietary restrictions, eating well while fully experiencing your host culture may be a challenge. Whether you maintain your diet for medical, religious, philosophical, or other reasons, be sure to share the details with your program staff //before// you arrive on site. They will use this information to help identify appropriate housing for you. They may also be able to research restaurants, grocery stores, and useful vocabulary.\n\nIf you have a food allergy, be very detailed in what is safe for you.  For example, if you have a nut allergy, can you be around nuts? can you eat food processed on the same equipment as nuts? are all nuts harmful for you? Let your program and host family know.\n\nLearn as much as you can about your host culture's food, food culture, and food vocabulary before you go. Your diet and the terms you use for it may not be well understood there, so be prepared to explain why you can’t, or choose not to, eat certain foods--ideally before someone cooks you a meal! \n\n|box|k\n|!Resources|\n|[[Food|http://www.ciee.org/gap-year-abroad/downloads/school-resources/Food.pdf]], a pamphlet on &quot;the edible part of culture&quot;|\n|[[International Vegetarian Union|http://www.worldvegfest.org/]], information and recipes for vegetarians and vegans worldwide|\n|[[VegGuide|http://www.vegguide.org/]], a searchable guide to vegetarian restaurants worldwide|\n|[[SelectWisely|http://www.selectwisely.com/Resources/]], a library of links to information about traveling abroad with dietary restrictions|\n|[[Jewish Travel Advisor|http://jewishtraveladvisor.com/]], world-wide listing of kosher hotels and restaurants, synagogues, mikvaot, and Jewish communities around the world |\n|[[Halal Trip|http://www.halaltrip.com/city-guide-all]], website focused on Muslim travelers and including city guides with a focus on halal dining|\n\n&lt;&lt;segue &quot;Making friends&quot;&gt;&gt;\s</div><div tiddler="Passport Acquisition" tags="sidebar travel" created="201404171617" modifier="twee" twine-position="514,145">&lt;&lt;sidebar &quot;Getting or Renewing a Passport&quot;&gt;&gt;\nTo get a new passport, or to renew an old one, you will need to contact the proper issuing authority for your home country.\n\nUS citizens should visit the State Department's website for [[passport services|http://travel.state.gov/content/passports/english/passports.html]] to view requirements and to check on [[current processing times|http://travel.state.gov/content/passports/english/passports/information/processing-times.html]]. Be sure that you will receive your new passport in time to complete any visa or resident permit applications!\n\nIn Nashville, locations near Vanderbilt where you can apply for a passport include:\n\n|alternating-rows|k\n|!Church Street Post Office|Midtown&lt;br /&gt;1718 Church Street|(615) 321-0172|\n|!Acklen Post Office|Hillsboro Village&lt;br /&gt;2006 Acklen Ave|(615) 383-5396|\n|!Broadway Post Office|Downtown&lt;br /&gt;901 Broadway|(615) 255-3613|\n|![[Davidson County Clerk|http://www.nashvilleclerk.com/living/passports/]]|Downtown &lt;br /&gt;700 2nd Ave South, Suite 101|(615) 862-6223|\n\nYou may need to ''call in advance'' for an appointment!\n\nYou'll also need to get ''passport photos'' taken before you can apply. FedEx Kinko's, Walgreens, and CVS are locations near Vandy that can take passport photos.\n\n&lt;&lt;segue &quot;Documents&quot;&gt;&gt;\s</div><div tiddler="Coping with stress and culture shock" tags="health sidebar" created="201405271107" modifier="twee" twine-position="1120,275">&lt;&lt;sidebar &quot;Coping with stress & culture shock&quot;&gt;&gt;\nCulture shock is one expression of stress, but even after culture shock passes, living and studying abroad may sometimes be stressful. Stress may be harder to manage when you are far from your normal support group of family and friends. Learn to recognize the signs of stress and take steps to cope with the situation and make yourself more resilient.\n\n|box|k\n|&gt;|&gt;|Common signs of stress|h\n|exhaustion|fatigue|change in appetite|\n|anxiety|isolation|alienation|\n|frustration|extreme homesickness|increased use of nicotine, alcohol or drugs|\n|loneliness|change in behavior|self-harming|\n|&gt;|&gt;|new or more frequent physical symptoms, e.g. headaches, stomachaches, etc.|\n\nOne of the best ways to combat stress in a new environment is to prepare for the new location. ''Learn as much as you can about your host city'' before you go. Read up on climate, foods, politics, culture, religion, and more. Buy a phrasebook and try to learn some of the basics of the language.\n\n''Take a step back.'' Analyze your situation and study your own reactions. Where exactly is the stress coming from? Ask yourself if cultural differences might be a contributing factor, and how you can work with or around them. Focus on what you can change or control, not on what you can't: If you can't change the situation, work on changing your reactions to it.\n\n''Take care of your body.'' Be sure that you are staying active, eating well, and getting enough sleep. Work on being positive, and be active--get out of your room.\n\n''Identify what helps you //healthfully// manage stress.'' Avoid using pills, drugs, alcohol, cigarettes, over- or under-eating, and oversleeping to manage stress. Instead, focus on healthy antidotes and find the ones that work for you. Ideas include exercise, keeping a journal, regular social contact with //positive// people, hobbies, other leisure activities, or cultural activities.\n\n''Find your social support.'' Identify your support groups both locally and at home. These might include program staff, housing staff, homestay family, friends, home university staff, or family. Ask yourself who can best offer you the support you need, and ask for it!\n\n|box|k\n|!Resources|\n|[[Life in a Foreign Culture|http://www.northwestern.edu/studyabroad/outbound-students/life-in-a-foreign-culture-tips-for-cultural-adjustment-while-abroad.html]], tips to ease your cultural adjustment|\n|[[Culture Shock, Homesickness, and the &quot;Aha Moment&quot;|http://thestudyabroadblog.com/culture-shock-and-homesickness/]], firsthand description of culture shock, and of both failed and successful coping|\n|[[HelpGuide: Stress Management|http://collegelife.about.com/od/healthwellness/ht/Stress.htm]], practical tips for handling stress|\n|[[How Stress Affects Your Health|http://www.apa.org/helpcenter/stress.aspx]], info from the American Psychological Association|\n|[[Vanderbilt's Psychological Counseling Center|https://medschool.vanderbilt.edu/pcc/about-center]] As a student at Vanderbilt, the PCC is available to you wherever you are in the world|\n\n&lt;&lt;segue &quot;Illness abroad&quot;&gt;&gt;\s</div><div tiddler="Preparation and responsibilities" tags="policies" created="201405051659" modifier="twee" twine-position="10,481">!Preparation and responsibilities\n!!!!Get ready to go abroad, and to take advantage of opportunities when you return\nThere are many things that you need to do to prepare to go abroad. GEO can't help you manage all of them, of course, but we have prepared a checklist of things to do not only before you leave, but also while you're abroad and after you return to the US. (Later in this presentation, we'll also discuss tips for packing, traveling with prescription drugs, and other topics.)\n\nIn addition to responsibilities, the checklist also highlights opportunities you can prepare for or take advantage of.\n\n&lt;&lt;if $summer and (not $maymester)&gt;&gt;[[Summer Responsibilities & Opportunities Checklist|https://webapp.mis.vanderbilt.edu/studioabroad/_customtags/ct_FileRetrieve.cfm?File_ID=12585]]\n&lt;&lt;elseif $maymester&gt;&gt;[[Maymester Responsibilities & Opportunities Checklist|https://webapp.mis.vanderbilt.edu/studioabroad/_customtags/ct_FileRetrieve.cfm?File_ID=12584]]\n&lt;&lt;else&gt;&gt;[[Semester Responsibilities & Opportunities Checklist|https://webapp.mis.vanderbilt.edu/studioabroad/_customtags/ct_FileRetrieve.cfm?File_ID=11244]]\n&lt;&lt;/if&gt;&gt;\n&lt;&lt;segue &quot;Conduct and law&quot;&gt;&gt;\s</div><div tiddler="Handhelds" tags="stylesheet" created="201407031641" modifier="twee" twine-position="0,0">@media only screen and (max-width : 999px) { \n  #passages {\n    width:100%;\n    padding:55px 1em 3em 1em;\n  }\n  #custom {\n    width:100%!important;\n    margin:0!important;\n  }\n  #backgrounds {\n    display:none;\n  }\n  .passage h1 {\n    font-size:30px;\n  }\n  .passage h4 {\n    font-size:16px;\n  }\n  .passage table {\n    margin:0.8em 0;\n  }\n  #story-rewind::before {\n    content:&quot;&quot;!important;\n  }\n  #sound-controls::before {\n    content:&quot;Sound&quot;!important;\n  }\n  h1.index-section {\n    margin-top:1em;\n    font-size: 18px;\n  }\n  .index-columns p {\n    line-height: 120%;\n  }\n  .sidebar-box {\n    display:block!important;\n  }\n  .sidebar-head {\n    display: inline-block!important;\n    -webkit-border-radius: 5px 5px 0 0!important;\n    -moz-border-radius: 5px 5px 0 0!important;\n    border-radius: 5px 5px 0 0!important;\n    min-width:4em;\n    width: auto!important;\n  }\n  ul.sidebar-links {\n    border-radius: 0 5px 5px 5px!important;\n    line-height:140%!important;\n  }\n  #nav-sf-menu {\n    top:44px;\n  }\n  .sf-menu {\n    -webkit-border-radius: 0!important;\n    -moz-border-radius: 0!important;\n    border-radius: 0!important;\n    border: none;\n    left:0;\n    width:100%;\n    font-family: 'Open Sans', serif;\n    -webkit-box-shadow: 0 1px 2px rgba(0,0,0,.6);\n    -moz-box-shadow: 0 1px 2px rgba(0,0,0,.6);\n    box-shadow: 0 1px 2px rgba(0,0,0,.6);\n  }\n  .sf-menu, .sf-menu li {\n    font-size: 15px!important;\n  }\n  .sf-menu ul {\n    -webkit-border-radius: 0!important;\n    -moz-border-radius: 0!important;\n    border-radius: 0!important;\n    position: relative;\n    top: 100%;\n    left: 0;\n    width:100%;\n    -webkit-box-shadow: none;\n    -moz-box-shadow: none;\n    box-shadow: none;\n  }\n  .sf-menu ul ul {\n    -webkit-border-radius: 0!important;\n    -moz-border-radius: 0!important;\n    border-radius: 0!important;\n    position: relative;\n    top:100%;\n    left: 0;\n    width:100%;\n  }\n  .sf-menu a.chapter-list {\n    font-weight: bold;\n  }\n  .sf-menu a.chapter-list::before {\n    display: none!important;\n  }\n  #nav-sf-menu::after {\n    display:none; /* Hide tooltip arrow */\n  }\n  .sf-menu li {\n    text-shadow: none;\n  }\n  .sf-menu li:hover, .sf-menu li.sfHover {\n    background-image: none;\n  }\n}</div><div tiddler="Array Utilities" tags="script" created="201407031641" modifier="twee" twine-position="0,0">Array.prototype.purge = function (element) {\n\tvar i = this.indexOf(element);\n\twhile (i &gt; -1) {\n\t\tthis.splice(i);\n\t\ti = this.indexOf(element);\n\t}\n\treturn this;\n};\n\nArray.prototype.add = function (element) {\n\tif (this.indexOf(element) === -1) {\n\t\tthis.push(element);\n\t}\n\treturn this;\n};</div><div tiddler="Inline head" tags="widget" created="201407031641" modifier="twee" twine-position="0,0">/% Syntax:\n    &lt;&lt;$- [text] [optional: ending punctuation]&gt;&gt;%/\s\n&lt;&lt;widget &quot;$-&quot;&gt;&gt;\s\n    &lt;span class='inline-head'&gt;&lt;&lt;print $args[0]&gt;&gt;&lt;&lt;if $args.length &gt; 1&gt;&gt;&lt;&lt;print $args[1]&gt;&gt;&lt;&lt;else&gt;&gt;.&lt;&lt;endif&gt;&gt;&lt;/span&gt;\s\n&lt;&lt;/widget&gt;&gt;\s</div><div tiddler="Preparing for safety" tags="safety bookmark" created="201405281247" modifier="twee" twine-position="973,618">!Preparing for safety\n!!!!Research your destination and register your travel\nWhile not generally more dangerous than life in Nashville, study abroad is not a risk-free activity. You are traveling into an unfamiliar country and situation, and the the most effective way to avoid problems is to plug the gaps in your knowledge.\n\nThe more you know and learn about your destination before you go, the safer you will be. Read all the program information you are given, and do your own research as well. Up-to-date commercial guidebooks are often good resources, particularly for coverage of local risks and high-crime areas. Country-specific information provided by the US Department of State and its counterparts overseas can also be helpful.\n\nKnow the local laws, and learn about behavioral norms and expectations. Outspokenness and ostentatious public behavior are not virtues in most places abroad. In some situations they may invite unwanted attention and problems. Dress in a fashion that is appropriate to cultural norms and religious sensitivities.\n\nRegister your overseas travel plans with [[International SOS|https://www.internationalsos.com/MasterPortal/default.aspx?membnum=11BSGM000066&AspxAutoDetectCookieSupport=1]], Vanderbilt's emergency evacuation provider. You should register not only your main trip, but also any side trips you take while abroad! If you are a US citizen, you should also register with the Department of State's [[STEP program|https://step.state.gov/step/]].\n\n&lt;&lt;sidebar-box&gt;&gt;\n   [[What are the best resources for monitoring safety of regions overseas?|Resources for monitoring safety]]\n   [[How does Vanderbilt minimize risks that students face abroad?|Vanderbilt's safety efforts]]\n&lt;&lt;/sidebar-box&gt;&gt;\n\nDownload GEO's [[wallet-sized emergency numbers directory|http://studentsabroad.com/handbook/emergency-card.php?country=General]].\n\n&lt;&lt;segue &quot;Basic safety abroad&quot;&gt;&gt;\s</div><div tiddler="What we will cover in this presentation" tags="intro" created="201404171612" modifier="twee" twine-position="6,138">!Your PDO guidebook\n!!!!What to expect from this Predeparture Orientation\nOver the next ****half-hour****, you will learn a lot about what to expect during your study abroad experience and how to prepare for it. It is a lot of information, but you can access it at any time, even while you're overseas! The chart below shows how your time in this Predeparture Orientation (PDO) will be spent. Keep an eye on the progress meter at the top of the screen to track how far you've come!\n|box|k\n|!Topic|!Description|!Time|\n|''Basic Policy Information''|Everything you need to know about being a Vanderbilt student abroad, conduct, and the law!|X&nbsp;minutes|\n|''Academic Policies''|How credits work, rules for determining credit, and how study abroad will impact your Vanderbilt transcript|X minutes|\n|''Travel''|What you need to know before you get on the plane and preparing for your journey in a practical sense|X minutes|\n|''Living and Learning Abroad''|Answers to questions about on-the-ground logistics|X minutes|\n|''Health and Wellness''|How to have a healthy study abroad experience and what to do when you are not so healthy|X minutes|\n|''Safety and Security''|Information on staying safe abroad and protecting yourself|X minutes|\n|''Returning Home''|An introduction to how your study abroad experience will impact you when you return to Vanderbilt|X minutes|\n|''Finishing Up''|Your next steps, a brief recap, and verifying with GEO that you completed this required module|X minutes|\n\n&lt;&lt;segue &quot;Student status and billing&quot;&gt;&gt;\s</div><div tiddler="PassageReady" tags="nobr" created="201407031641" modifier="twee" twine-position="0,0">/% Runs just before each passage is rendered. %/\n&lt;&lt;set $autoplaySound to &quot;&quot;&gt;&gt;\n&lt;&lt;set $autoplayDestination to &quot;&quot;&gt;&gt;\n&lt;&lt;stopAllSounds&gt;&gt;\n&lt;&lt;script&gt;&gt;\n    var passage = tale.get(state.active.title);\n    if (passage.tags.indexOf(&quot;sidebar&quot;) &gt; -1) {\n        //we are going from main flow to a sidebar\n        $(&quot;#passages&quot;).addClass(&quot;sidebar&quot;);\n        $(&quot;.passage&quot;).addClass(&quot;flip&quot;);//add class to outgoing passage\n        passage.classes.add(&quot;flip&quot;);//add class to incoming passage\n    }\n    else if ($(&quot;#passages&quot;).hasClass(&quot;sidebar&quot;)) {\n        //we are transitioning from a sidebar to the main flow\n        passage.classes.add(&quot;flip&quot;);//add class to incoming passage\n        $(&quot;.passage&quot;).addClass(&quot;flip&quot;);//add class to outgoing passage\n    }\n&lt;&lt;/script&gt;&gt;</div><div tiddler="Medical insurance" tags="health" created="201404171642" modifier="twee" twine-position="981,144">!Medical Insurance\n!!!!You are covered by international insurance\nYou will be enrolled in international health insurance by your program provider, Vanderbilt GEO, or both (depending on the scope of the provider's coverage). Be sure to read your insurance benefits and know how to access health care providers in your host country. Also ''know what your insurance covers'' and how to file and pay claims.\n\n''This insurance only covers you for the official dates of your program and //outside the United States//.'' GEO strongly encourages all students to maintain health insurance in their home country. If unforeseen circumstances force you to return home, you want subsidized care to be available.\n\nIf you are currently under medical care, your international health insurance can help in locating an appropriate care provider in your host country. Plan ahead!  If you know you want to continue care overseas, contact your international insurance //before// you leave the US.\n\n|box|k\n|!Resources|\n|[[Medical Care and Insurance|http://www.studentsabroad.com/handbook/medical-care-and-insurance.php?country=General]], a brief guide|\n|[[Brief plan info for HTH Worldwide Health Insurance|https://webapp.mis.vanderbilt.edu/studioabroad/_customtags/ct_FileRetrieve.cfm?File_ID=2361]]: If you have HTH health insurance through GEO, this is basic description of your plan. You may contact HTH for more information on particulars.|\n\n&lt;&lt;segue &quot;Culture shock&quot;&gt;&gt;\s</div><div tiddler="Grades and credits" tags="academics bookmark" created="201404171614" modifier="twee" twine-position="21,1162">!Grades and Credits\n!!!!You're earning Vanderbilt credit abroad\nCourses you take on programs offered through GEO earn you ''direct Vanderbilt credit''. This means that your grades will appear on your Vanderbilt transcript and will factor into your GPA, almost exactly as if you had taken them at VU.\n\nJust as at Vanderbilt, you must take the equivalent of 12-18 hours of credit. Courses taken on GEO programs can count toward majors and minors, or as hours toward graduation. However, they //do not// count toward AXLE requirements.\n\nStudy abroad courses come with some special rules:\n#You cannot take courses pass/fail. \n#You cannot retake classes abroad that you have already taken on campus (and vice versa). If you do take a course abroad that is equivalent to a course you've already taken on campus, you may well get //no credit// for it!\n#You cannot opt out of a course you took abroad. Withdraw from courses you don't want to take during the drop/add period!\n#Vanderbilt cannot change the grade you earned abroad. If a grade is incorrect, work with your program provider abroad to get it changed and to issue a new transcript.\n#You must monitor prerequisites and other requirements for courses you take abroad. Consult with your VU academic advisor, but understand that ultimately you are responsible for taking appropriate courses abroad!\n\n&lt;&lt;sidebar-box &quot;Academics Abroad&quot;&gt;&gt;\n   [[How might academic systems abroad differ from Vanderbilt?|Academic systems abroad]]\n&lt;&lt;/sidebar-box&gt;&gt;\n\n&lt;&lt;segue &quot;Course equivalency evaluations&quot;&gt;&gt;\s</div><div tiddler="When should I contact GEO" tags="sidebar living" created="201404171622" modifier="twee" twine-position="524,898">&lt;&lt;sidebar &quot;When should I contact GEO?&quot;&gt;&gt;\nMost of the time, your most appropriate contact abroad will be your Resident Director, or if you are an exchange student, an advisor in your host university's international office. But there may also be times when it makes more sense to phone home to Vanderbilt and GEO. See the chart for things that GEO is well prepared to help you with!\n\n|box|k\n|!What GEO Can Help You With|\n|You are uncomfortable discussing an issue with your on-site staff|\n|Questions about specific Vanderbilt policies|\n|Questions about billing|\n|Questions about your transcript|\n|You want to remain abroad for another term|\n|You're just not sure who to talk to!|\n\n&lt;&lt;segue &quot;Balancing Contact&quot;&gt;&gt;</div><div tiddler="Nano Scroller" tags="stylesheet" created="201407031641" modifier="twee" twine-position="0,0">/** initial setup **/\n.nano {\n  position : relative;\n  width    : 100%;\n  height   : 100%;\n  overflow : hidden;\n}\n.nano .content {\n  position      : absolute;\n  overflow      : scroll;\n  overflow-x    : hidden;\n  top           : 0;\n  right         : 0;\n  bottom        : 0;\n  left          : 0;\n}\n.nano .content:focus {\n  outline: thin dotted;\n}\n.nano .content::-webkit-scrollbar {\n  visibility: hidden;\n}\n.has-scrollbar .content::-webkit-scrollbar {\n  visibility: visible;\n}\n.nano &gt; .pane {\n  background : rgba(0,0,0,.25);\n  position   : absolute;\n  width      : 10px;\n  right      : 0;\n  top        : 0;\n  bottom     : 0;\n  visibility : hidden\s9; /* Target only IE7 and IE8 with this hack */\n  opacity    : .01; \n  -webkit-transition    : .2s;\n  -moz-transition       : .2s;\n  -o-transition         : .2s;\n  transition            : .2s;\n  -moz-border-radius    : 5px;\n  -webkit-border-radius : 5px;  \n  border-radius         : 5px;\n}\n.nano &gt; .pane &gt; .slider {\n  background: #444;\n  background: rgba(0,0,0,.5);\n  position              : relative;\n  margin                : 0 1px;\n  -moz-border-radius    : 3px;\n  -webkit-border-radius : 3px;  \n  border-radius         : 3px;\n}\n.nano:hover &gt; .pane, .pane.active, .pane.flashed {\n  visibility : visible\s9; /* Target only IE7 and IE8 with this hack */\n  opacity    : 0.99;\n}</div><div tiddler="Play Sounds" tags="script" created="201407031641" modifier="twee" twine-position="0,0">//based on http://www.glorioustrainwrecks.com/node/5061\n(function () {\n    macros.add([&quot;playSound&quot;, &quot;playSoundDelay&quot;, &quot;stopSound&quot;, &quot;pauseSound&quot;],  {\n        version: {\n            major: 1,\n            minor: 0,\n            revision: 0\n        },\n        soundtracks: {},\n        handler: function () {\n            try {\n                var soundName = this.args[0];\n                if (soundName) {\n                    soundName = soundName.toString(); //necessary?\n                    var sound = macros.get(&quot;playSound&quot;).soundtracks[soundName.slice(0, soundName.lastIndexOf(&quot;.&quot;))];\n                    if (sound) {\n                        if (this.name == &quot;playSoundDelay&quot;) {\n                            var delay = this.args[1];\n                            if (delay) {\n                                setTimeout(function() {\n                                    sound.play()\n                                }, delay);\n                            }\n                            else { sound.play() }\n                        }\n                        if (this.name == &quot;playSound&quot;) {\n                            sound.play();\n                        }\n                        if (this.name == &quot;playSoundDelay&quot; || this.name == &quot;playSound&quot;) {\n                            var passage = this.args.length &gt; 2 ? this.args[2] : undefined;\n                            if (passage) {\n                                $(sound).on(&quot;ended&quot;, function () {\n                                    state.display(passage)\n                                });\n                            }\n                        }\n                        if (this.name == &quot;pauseSound&quot;) {\n                            sound.pause();\n                        }\n                        if (this.name == &quot;stopSound&quot;) {\n                            sound.pause();\n                            sound.currentTime = 0;\n                        }\n                    }\n                }\n            } catch (e) {\n                return this.error(&quot;Error: &quot; + e.message);\n            }\n        }\n    });\n\n    var div = document.getElementById(&quot;store-area&quot;).firstChild;\n    var sourceTypes = [&quot;mp3&quot;, &quot;ogg&quot;];\n    while (div) {\n        var b = String.fromCharCode(92);\n        var q = '&quot;';\n        var re = &quot;['&quot; + q + &quot;]([^&quot; + q + &quot;']*?)&quot; + b + &quot;.audio['&quot; + q + &quot;]&quot;;\n        preloadSounds(new RegExp(re, &quot;gi&quot;));\n        div = div.nextSibling;\n    }\n\n    function preloadSounds(search, e) {\n        do {\n          var fileName = search.exec(div.innerHTML);\n          if (fileName) {\n            var sound = new Audio();\n            if (sound.canPlayType) {\n              for (var i = 0; i &lt; sourceTypes.length; i++) {\n                fileName[2] = sourceTypes[i];\n                if (sound.canPlayType(&quot;audio/&quot; + fileName[2])) break;\n              }\n              if (i &lt; sourceTypes.length) {\n                sound.setAttribute(&quot;src&quot;, fileName[1] + &quot;.&quot; + fileName[2]);\n                sound.interval = null;\n                macros.get(&quot;playSound&quot;).soundtracks[fileName[1]] = sound;\n              } else console.log(&quot;Browser can't play '&quot; + fileName[1] + &quot;'&quot;);\n            }\n          }\n        } while (fileName);\n    }\n\n}());</div><div tiddler="Conduct and law" tags="policies" created="201404171613" modifier="twee" twine-position="15,623">!Conduct and law\n!!!!Be a good ambassador\nWhile you are abroad, be an ambassador for both Vanderbilt and your home country. You are part of a worldwide web of interactions, and the impression you make on the people of your host country reflects on where you came from!\n\nTake some time to learn about norms in the country you're visiting so that you can attempt to blend in socially. Beyond that, treat those you meet courteously and with sensitivity toward cultural differences. Remember, you are in their world!\n\nMoreover, you are ''subject to local laws'' while you are abroad. Foreign laws and legal systems may be quite different from those in your home country, and you need to know the differences. If you break local laws while abroad, neither Vanderbilt nor the U.S. Embassy can get you out of jail.\n&lt;&lt;if ($vanderbilt neq &quot;true&quot;) or ($facultyled neq &quot;true&quot;)&gt;&gt;\nWhether you are studying abroad at a university or on a smaller program with one of GEO's partners, you must also ''follow that institution's rules and policies''. These institutions may sanction or dismiss you if you violate their rules. //Dismissal from an abroad program will have the same consequences for your GPA and four-year plan as a dismissal from Vanderbilt!//&lt;&lt;/if&gt;&gt;\n\n&lt;&lt;segue &quot;Vanderbilt conduct policies&quot;&gt;&gt;\s</div><div tiddler="Background image support" tags="script" created="201407031641" modifier="twee" twine-position="0,0">(function () {\n    //Cross-browser (mobile) screen sizing\n    window.isHandheld = function() {\n        var w = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);\n        var h = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);\n        if (Math.max(w, h) &lt; 900) {\n            return true;\n        }\n        return false;\n    };\n    //Alternate, principally to account for differences in reporting\n    //between mobile Safari and iOS Chrome. Probably not needed.\n    /* window.isHandheld = function() {\n        var elem = insertElement(body, &quot;div&quot;, &quot;removeMe&quot;);\n        var w = $(elem).width();\n        var h = $(elem).height();\n        $(elem).remove();\n        if (Math.max(w, h) &lt; 900) {\n            return true;\n        }\n        return false;\n    };\n    */\n\n    macros.add([&quot;imageRotate&quot;],  {\n        version: {\n            major: 1,\n            minor: 0,\n            revision: 0\n        },\n        handler: function() {\n        \ttry {\n                if (isHandheld() !== true) {\n                    var imageName = &quot;&quot;;\n                    imageName = state.active.variables.backgrounds[state.active.title];\n                    if (imageName) {\n                    \t$(&quot;#img-occluder&quot;).fadeIn(&quot;fast&quot;, function() {\n                    \t\t$(&quot;body&quot;).css(&quot;background-image&quot;, &quot;url(&quot; + imageName +&quot;)&quot;);\n                    \t\t$(&quot;#img-occluder&quot;).fadeOut(&quot;slow&quot;);\n                    \t});                   \n                    }\n                }\n            } catch (e) {\n                return this.error(&quot;Error: &quot; + e.message);\n            }\n        }\n    });\n\n    //Preload images, from http://www.glorioustrainwrecks.com/node/4982\n    var r = &quot;&quot;;\n    var s = Wikifier.formatters;\n    for (var j = 0; j &lt; s.length; j++) {\n        if (s[j].name == &quot;image&quot;) {\n            r = s[j].lookahead;\n            break;\n        }\n    }\n    var div = document.getElementById(&quot;store-area&quot;).firstChild.nextSibling;\n    while (div) {\n        if (r) {\n            k(new RegExp(r, &quot;mg&quot;), 4);\n        }\n        var b = String.fromCharCode(92);\n        var u = b + &quot;s*?['&quot; + '&quot;]?([^&quot;' + &quot;']+?(jpe?g|a?png|gif|bmp))['&quot; + '&quot;]?' + b + &quot;s*&quot;;\n        k(/['&quot;]([^&quot;']*\s.(jpe?g|a?png|gif|bmp))['&quot;]/mig, 1);\n        k(new RegExp(&quot;url&quot; + b + &quot;(&quot; + u + b + &quot;)&quot;, &quot;mig&quot;), 1);\n        //k(new RegExp(&quot;src&quot; + b + &quot;s*=&quot; + u, &quot;mig&quot;), 1);\n        div = div.nextSibling;\n    }\n\n    function k(c, e) {\n        \n        do {\n            var d = c.exec(div.innerHTML);\n            if (d) {\n                if (d[e].indexOf(&quot;backgrounds/&quot;) &gt; -1 && isHandheld()) continue;\n                var i = new Image();\n                i.src = d[e];\n                console.log(&quot;Preloaded &quot; + i.src);\n            }\n        } while (d);\n    }\n}());\n\n\njQuery.preloadCssImages = function(){\n    var allImgs = [];//new array for all the image urls  \n    var k = 0; //iterator for adding images\n    var sheets = document.styleSheets;//array of stylesheets\n    \n    for(var i = 0; i&lt;sheets .length; i++){//loop through each stylesheet\n        var cssPile = '';//create large string of all css rules in sheet\n        var csshref = (sheets[i].href) ? sheets[i].href : 'window.location.href';\n        var baseURLarr = csshref.split('/');//split href at / to make array\n        baseURLarr.pop();//remove file path from baseURL array\n        var baseURL = baseURLarr.join('/');//create base url for the images in this sheet (css file's dir)\n        if(baseURL!=&quot;&quot;) baseURL+='/'; //tack on a / if needed\n        if(document.styleSheets[i].cssRules){//w3\n            var thisSheetRules = document.styleSheets[i].cssRules; //w3\n            for(var j = 0; j&lt;thisSheetRules.length; j++){\n                cssPile+= thisSheetRules[j].cssText;\n            }\n        }\n        else {\n            cssPile+= document.styleSheets[i].cssText;\n        }\n        \n        //parse cssPile for image urls and load them into the DOM\n        var imgUrls = cssPile.match(/[^\s(]+\s.(gif|jpg|jpeg|png)/g);//reg ex to get a string of between a &quot;(&quot; and a &quot;.filename&quot;\n        if(imgUrls != null && imgUrls.length&gt;0 && imgUrls != ''){//loop array\n            var arr = jQuery.makeArray(imgUrls);//create array from regex obj    \n            jQuery(arr).each(function(){\n                allImgs[k] = new Image(); //new img obj\n                allImgs[k].src = (this[0] == '/' || this.match('http://')) ? this : baseURL + this; //set src either absolute or rel to css dir\n                k++;\n            });\n        }\n    }//loop\n    return allImgs;\n}</div><div tiddler="Credits" tags="finish" created="201404171650" modifier="twee" twine-position="1616,881">!Credits\n!!!!Content to come!\n\n Thanks, folks!\n\n&lt;&lt;segue &quot;Registration&quot;&gt;&gt;</div><div tiddler="Contacts and communications" tags="living" created="201404171622" modifier="twee" twine-position="381,897">!Contacts and communications\n!!!!Who should I contact for help abroad?\nCommunications abroad can seem difficult at first! You need to learn who are your best resources, as well as figure out the most convenient methods of communication within your host country and back home.\n\nYour ''Resident Director'' will be your most reliable contact person: he or she is knowledgeable about the program, the host country, and the city--and he/she is //right there!// Whether you have a basic question, a scheduling conundrum, or you are in the midst of an emergency, your Resident Director and on-site staff should be the ''first people you contact.'' You will find out more about who your contact(s) should be in your program-specific predeparture orientation.\n\n''Remember this:'' Problems will be resolved faster if you work with someone who is on the ground with you, rather than contacting someone back home who is a few time zones and thousands of miles away.\n\n&lt;&lt;sidebar-box &quot;Hm...&quot;&gt;&gt;\n   [[When should I contact GEO?|When should I contact GEO]]\n&lt;&lt;/sidebar-box&gt;&gt;\n\n&lt;&lt;segue &quot;Balancing Contact&quot;&gt;&gt;</div><div tiddler="Illness abroad" tags="health" created="201404171642" modifier="twee" twine-position="980,406">!Illness abroad\n!!!!Know attendance policies and who to contact\nIf you become sick while abroad think about who can best help you. It will usually be someone on site, with your program's resident director or staff at the top of the list. Don't contact home for help unless you've exhausted all your local contacts.\n\nWhen you arrive at your program site, you should receive a list of all appropriate emergency contacts for your program or host university, as well as for emergency services (police, ambulance, etc.). If you don't receive this information, ask for it! Also consider recording it on a [[handy wallet-sized card|http://studentsabroad.com/handbook/emergency-card.php?country=General]].\n\nRemember that phone numbers for emergency services will be different in each country you might visit. Get that information before you take a side trip!\n\nBe aware of the absence and illness policies for your program or host university. They may differ drastically from Vanderbilt policies! Always keep your program staff in the loop while ill (via email or phone). \n\nBe sure to keep any doctor's notes for your files! You may need them later for academic or medical reasons.\n\n|box|k\n|!Resources|\n|[[The Yellow Book|http://wwwnc.cdc.gov/travel/yellowbook/2014/table-of-contents]], the CDC's extensive guide for foreign travel, with answers to questions you didn't even know to ask!|\n|[[Emergency services numbers abroad|http://studentsabroad.state.gov/content/pdfs/911_ABROAD.pdf]], the US Department of State's list of 911 equivalents around the world|\n|[[Vanderbilt's Psychological Counseling Center|https://medschool.vanderbilt.edu/pcc/about-center]] As a Vanderbilt student, the PCC is available to you wherever you are in the world|\n\n&lt;&lt;segue &quot;Preparing for safety&quot;&gt;&gt;\s</div><div tiddler="What you will get out of study abroad" tags="intro bookmark" created="201404171612" modifier="twee" twine-position="7,7">!What you'll get out of study abroad\n!!!!Academics, Cultural Competencies, Personal Growth\nCongratulations, you are getting closer to lift-off! Let us take a moment to remind you what you will get out of your study abroad experience.\s\n\n&lt;p&gt;&lt;&lt;$- &quot;Academic Training&quot;&gt;&gt; Without a doubt, you will be //studying// abroad. You will have the chance to take classes that are not available at Vanderbilt, broadening your horizons and expanding the breadth of perspectives available to you.&lt;/p&gt;\s\n&lt;p&gt;&lt;&lt;$- &quot;Experiential Learning&quot;&gt;&gt; As a study abroad student, you will learn in part by doing. In or out of the classroom, everything you do overseas will be a learning experience! It may even lead to [[increased creativity|http://www.apa.org/news/press/releases/2009/04/abroad-creativity.aspx]]...&lt;/p&gt;\s\n&lt;p&gt;&lt;&lt;$- &quot;Cultural Competencies&quot;&gt;&gt; You will build [[cultural competencies|https://en.wikipedia.org/wiki/Cultural_competence]] by experiencing cultural differences, gaining a new perspective on your own culture, and acquiring skills that help you interact with a diverse set of people.&lt;/p&gt;\s\n&lt;p&gt;&lt;&lt;$- &quot;Personal Growth&quot;&gt;&gt; Regardless of where you go, facing the world outside the Vanderbubble will help shape you as a person and hone your life skills. You will become more self-reliant, confident, and self-aware. In fact, 97% of Vanderbilt study abroad alumni say that study abroad helped them develop self-confidence and independence.&lt;/p&gt;\s\n&lt;figure&gt;\s\n|box|k\n|&gt;|!According to Recent College Graduates Who Studied Abroad...|\n| ''84%''|Studying abroad helped me build valuable job skills, including language proficiency, cultural training, tolerance for ambiguity, adaptability, communication skills|\n| ''80%''|Studying abroad helped me develop confidence to deal with new skills required for my first job|\n|&gt;|&lt;hr /&gt;//Source: [[IES Recent Graduates Survey|http://www.iesabroad.org/system/files/recentgraduatessurvey.pdf]]//|\n&lt;/figure&gt;\n&lt;&lt;segue &quot;What we will cover in this presentation&quot;&gt;&gt;\s</div><div tiddler="Before you leave" tags="health bookmark" created="201404171642" modifier="twee" twine-position="981,13">!Before you leave\n!!!!Know where you are medically before you depart\nRegardless of whether you have an existing medical condition, there are a few things you should do before you go abroad.\n\nFirst, consult with a travel medicine clinic about any ''vaccinations'' that might be necessary or advisable. You should do this as soon as possible!\n\nMeet with your medical, dental, and other care providers for a ''full checkup''. You don't want to be blindsided by an unnoticed condition when you arrive in your new location!\n\nIf you have an existing medical condition, have an honest discussion with your care providers about your current history and ''how study abroad will fit into your care plan''.\n\nWhile you know your history, your program staff does not. In an emergency, you may not be able to relay information that is critical to your care. //Please// ''disclose any physical or mental health conditions'' to your program staff prior to arrival. You can use the program's medical history form, or send an email detailing your history and current care plan.\n\nLearn the generic names and legal status of any ''prescription medications'' you take //before// you leave the US. Request a letter from your physician explaining your use of prescription and over-the-counter drugs to ensure that you will be allowed entry to your host country.\n\n&lt;&lt;sidebar-box&gt;&gt;\n   [[Do I need any vaccinations?|Vaccination]]\n   [[How do I find out more about my medications?|Medications]]\n   [[Should I really disclose my medical information?|Disclosing medical information]]\n&lt;&lt;/sidebar-box&gt;&gt;\n\n&lt;&lt;segue &quot;Medical insurance&quot;&gt;&gt;</div><div tiddler="Custom UI styles" tags="stylesheet" created="201407031641" modifier="twee" twine-position="0,0">header#custom {\n    position:fixed;\n    font-family: &quot;Open Sans&quot;, sans-serif;\n    top:0;\n    margin:0 auto 0 20%;\n    height:44px;\n    width:60%;\n    background-color:#555;\n    border-bottom:1px solid #333;\n    -moz-box-shadow: 0 0 10px black;\n    -webkit-box-shadow: 0 0 10px black;\n    box-shadow: 0 0 10px black;\n    z-index:10;\n    display:none;\n}\n\n@media print {\n  header#custom {\n    display:none!important;\n  }\n}\n\n#custom h2 {\n    margin:2px 0 0 8px;\n    display:inline-block;\n    color:#bbb;\n    font-size:16px;\n}\n\n#controls {\n  float:right;\n}\n\n#sound-controls {\n    display:inline-block;\n    margin-top:3px;\n    right:5px;\n}\n\n#story-rewind {\n    display: inline-block;\n    font-size:13px;\n    margin-top:3px;\n    margin-right: 10px;\n    color:#bbb;\n}\n\n#story-rewind::before {\n  content: &quot;Navigate&quot;;\n}\n\n#story-rewind div {\n    display: inline-block;\n}\n\n#story-rewind a#rewind-icon {\n    margin-left:7px;\n}\n\n#story-rewind a#rewind-icon::after {\n    content: &quot;\se602&quot;;\n    font-family: 'icomoon-sugarcube-extended';\n    font-size: 13px;\n    color: #222;\n    text-shadow: 0px 1px 1px #888;\n    font-weight:bold;\n    font-size:100%!important;\n    position:relative;\n    top:1px;\n}\n\n#story-rewind a#rewind-icon:hover::after {\n    color: #45cbe6;\n    text-decoration: none;\n}\n\n.hilight {\n    -webkit-animation-name: hilight;\n    -webkit-animation-duration: 1s;\n    -webkit-animation-iteration-count: 1;\n}\n\n@-webkit-keyframes hilight {\n    from { color:#bbb; text-shadow:none; }\n    20% { color: #ffffff; text-shadow:0px 0px 16px #ffffff; }\n    to { color:#bbb; text-shadow:none; }\n}\n\n\nlabel.autoplay-switch {\n    color: #bbb;\n    font-size: 13px;\n    margin-right: 6px;\n}\n\nbutton:focus {outline:none;}\nbutton::-moz-focus-inner {border:0;}\n\nbutton#autoplay-switch {\n    display:inline-block;\n    width:19px;\n    height:19px;\n    margin:-1px 4px 0 0;\n    vertical-align:middle;\n    background:url(ui/check_radio_sheet.png) -38px top no-repeat;\n    cursor:pointer;\n    border:none;\n    -webkit-transition-duration: 0s;\n    -moz-transition-duration: 0s;\n    -o-transition-duration: 0s;\n    transition-duration: 0s;\n}\n\n#sound-controls::before {\n  content:&quot;Autoplay + Sound&quot;;\n  color: #bbb;\n  font-size: 13px;\n  margin-right: 6px;\n}\n\nbutton.switchedon {\n    background:url(ui/check_radio_sheet.png) -57px top no-repeat!important;\n    border:none;\n}\n\n/*** Using superfish.js to handle hierarchical navigation menu ***/\n/* ESSENTIAL STYLES from superfish.css */\n.sf-menu, .sf-menu * {\n  margin: 0;\n  padding: 0;\n  list-style: none;\n}\n.sf-menu li {\n  position: relative;\n}\n.sf-menu ul {\n  position: absolute;\n  display: none;\n  top: 100%;\n  right: 0;\n  z-index: 99;\n}\n.sf-menu li:hover &gt; ul,\n.sf-menu li.sfHover &gt; ul {\n  display: block;\n}\n.sf-menu a {\n  display: block;\n  position: relative;\n}\n.sf-menu ul ul {\n  top: 0;\n  right: 0;\n}\n\n/*** Custom skin for superfish nav menu ***/\n/* Based on http://jsfiddle.net/LPbhS/ */\n#nav-sf-menu {\n  display:none;\n  position: absolute;\n  z-index:1000;\n  top: 30px;\n}\n.passage-list-inactive {\n  color: #ddd!important;\n  text-shadow: none!important;\n}\n.sf-menu {\n  /*margin-bottom: 1em;*/\n  line-height: 160%;\n  padding-bottom: 6px;\n  border: 1px solid;\n  border-color: #777 #6c6c6c #666;\n  border-radius: 5px;\n  background-color: #d9e3fa;\n  background-image: -webkit-gradient(linear, left top, left bottom, color-stop(0%, #eef3fe), color-stop(100%, #d9e3fa));\n  background-image: -webkit-linear-gradient(top, #eef3fe, #d9e3fa);\n  background-image: -moz-linear-gradient(top, #eef3fe, #d9e3fa);\n  background-image: -ms-linear-gradient(top, #eef3fe, #d9e3fa);\n  background-image: -o-linear-gradient(top, #eef3fe, #d9e3fa);\n  background-image: linear-gradient(top, #eef3fe, #d9e3fa);\n  -webkit-box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.9), 0 1px 2px rgba(0, 0, 0, 0.1);\n  -moz-box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.9), 0 1px 2px rgba(0, 0, 0, 0.1);\n  box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.9), 0 1px 2px rgba(0, 0, 0, 0.1);\n}\n.sf-menu::before, .sf-menu::after, .sf-menu li:first-child::after {\n  display: block;\n  content: '';\n  width: 0;\n  height: 0;\n  position: absolute;\n  left: 5px;\n  border: 7px outset transparent;\n}\n.sf-menu::before {\n  border-bottom: 7px solid #555;\n  top: -14px;\n}\n.sf-menu::after {\n  border-bottom: 7px solid #EEF3FE;\n  top: -12px;\n}\n.sf-menu li {\n  /*padding: 0 12px;*/\n  font-size: 11px;\n  color: #838ca2;\n  /*text-shadow: 0 1px #fff;*/\n  white-space: nowrap; /* no need for Supersubs plugin */\n  *white-space: normal; /* ...unless you support IE7 (let it wrap) */\n  -webkit-transition: background .2s;\n  transition: background .2s;\n}\n.sf-menu li.sep {\n  border-bottom: 1px solid #b4bbce;\n  /*padding-top:*/\n  padding-bottom: 4px;\n  margin-bottom: 4px;\n  text-shadow:none;\n}\n.sf-menu li.sep:hover {\n  border-color: #b4bbce;\n  background: none;\n  text-decoration: inherit;\n  text-shadow: none;\n}\n.sf-menu a.chapter-list:hover::before {\n  display:block;\n}\n.sf-menu a.chapter-list::before {\n  display: none;\n  content: '';\n  width: 0;\n  height: 0;\n  position: absolute;\n  top: 50%;\n  left: 2px;\n  margin-top: -4px;\n  border: 4px solid transparent;\n  border-right-color: #9facd1;\n}\n.sf-menu a {\n  display: block;\n  position: relative;\n  padding: 0 20px 0 12px;\n  color: #313a4f;\n  border: 1px solid transparent;\n  text-decoration: none;\n  zoom: 1; /* IE7 */\n}\n.sf-menu a.chapter-list {\n  padding: 0 20px 0 15px;\n}\n.sf-menu a:hover {\n  color: #13a;\n  color: #fff;\n}\n.sf-menu li:hover,\n.sf-menu li.sfHover {\n  text-decoration: none;\n  /*text-shadow: 0 1px rgba(0, 0, 0, 0.3);*/\n  border-color: #5a70b0 #495d98 #42558a;\n  background-color: #5a70b0;\n  background-image: -webkit-gradient(linear, left top, left bottom, color-stop(0%, #7688bd), color-stop(100%, #4e64a3));\n  background-image: -webkit-linear-gradient(top, #7688bd, #4e64a3);\n  background-image: -moz-linear-gradient(top, #7688bd, #4e64a3);\n  background-image: -ms-linear-gradient(top, #7688bd, #4e64a3);\n  background-image: -o-linear-gradient(top, #7688bd, #4e64a3);\n  background-image: linear-gradient(top, #7688bd, #4e64a3);\n  /* only transition out, not in */\n  -webkit-transition: none;\n  transition: none;\n}\n.sf-menu  span.disable, .sf-menu span.disable:hover {\n  color: #838ca2!important;\n  padding: 6px 20px 0 12px;\n}\n.sf-menu ul {\n  box-shadow: 2px 2px 6px rgba(0,0,0,.2);\n  min-width: 12em; /* allow long menu items to determine submenu width */\n  *width: 12em; /* no auto sub width for IE7, see white-space comment below */\n}\n\n.sf-menu ul li {\n  background: #AABDE6;\n}\n.sf-menu ul ul li {\n  background: #9AAEDB;\n}\n\n/* adding sf-vertical class in addition to sf-menu creates a vertical menu */\n/* eg. &lt;ul class=&quot;sf-menu sf-vertical&quot;&gt; ... */\n.sf-vertical {\n  min-width: 12em;\n  *width: 12em;\n}\n.sf-vertical ul {\n  right: 100%;\n  top: 0;\n}\n.sf-vertical &gt; li {\n  float: none;\n}\n.sf-vertical li {\n  width: 100%;\n}\n\n\n\n#progress {\n  clear:both;\n  display:block;\n}\n#progress-meter {\n  border: 1px solid #ccc;\n  border-radius: 4px;\n  background-color: whiteSmoke;\n  box-shadow: 0 5px 5px -5px #222 inset;\n  width: 95%;\n  height: 6px;\n  display: inline-block;\n  box-shadow: 0 5px 5px -5px #888 inset;\n  background-color: #d8d8d8;\n  background-size: 100% 100%;\n  display: block;\n  text-indent: -9999px;\n  position:relative;\n  top:5px;\n  margin:auto;\n}\n#pb-complete {\n    position:absolute;\n    display:block;\n    top:2px;\n    bottom:2px;\n    background-color:#008EDB;/*#57C7DE;*/\n    right:100%;\n    left:0;\n}\n#pb-position {\n    position:absolute;\n    top:1px;\n    bottom:2px;\n    display:block;\n    left:0%;\n    width:4px;\n    height:4px;\n    background-color:#008EDB;/*#45cbe6;*/\n    border-radius:2px;\n}\nlabel.progress-meter {\n  color: #bbb;\n  font-size: 13px;\n  margin-right: 3px;\n  font-family: 'Open Sans', serif;\n}</div><div tiddler="Phones and internet abroad" tags="sidebar living" created="201404171622" modifier="twee" twine-position="525,1029">&lt;&lt;sidebar &quot;Phones and internet abroad&quot;&gt;&gt;\n****Incomplete****\nGEO can’t tell you what cell phone company is the most reliable in your home away from home, but we can help you figure out who is your best person to ask!\n\n&lt;&lt;$- &quot;Dialing Telephones.&quot;&gt;&gt; The details of dialing internationally vary depending on which countries you're trying to connect. Bookmark [[How To Call Abroad|http://www.howtocallabroad.com/]] to share with family and friends.\n\n&lt;&lt;segue &quot;Disabilities and accommodations&quot;&gt;&gt;\s</div><div tiddler="Large-scale emergencies" tags="safety" created="201405281257" modifier="twee" twine-position="978,1141">!Large-scale emergencies\n!!!!Procedures for dealing with large-scale disaster\nLarge-scale emergencies take many forms. Massive accidents, civil strife, acts of terrorism, natural disasters... They are hard to predict and proper response depends heavily on local circumstances. \n\nIn general, your program staff will brief you soon after arrival on emergency protocols. Local emergency plans typically include the following elements:\n\n*a pre-established location where students and staff will assemble after a large-scale disaster;\n*communications protocols designed to account for all program participants;\n*an evacuation plan;\n*contingency plans short of full evacuation.\n\nThe most important general advice that Vanderbilt can offer is that you know the protocols of your site's emergency plan. Keep calm, follow those protocols, and act with common sense and your best knowledge of the local situation.\n\nIf you are traveling independently or are unable to reach your rally point, contact International SOS (ISOS). Vanderbilt contracts with ISOS to provide emergency services around the globe. They can provide you with information as well as direct aid. See the information on the next page.\n\nDownload GEO's [[wallet-sized emergency numbers directory|http://studentsabroad.com/handbook/emergency-card.php?country=General]].\n\n|box|k\n|!Resources|\n|[[FAQ on the US Department of State's role in crises overseas|http://travel.state.gov/content/passports/english/emergencies/crisis-support.html]]|\n|[[Vanderbilt's ISOS portal|https://www.internationalsos.com/MasterPortal/default.aspx?membnum=11BSGM000066]], includes contact information|\n\n&lt;&lt;segue &quot;International SOS&quot;&gt;&gt;\s</div><div tiddler="Making local friends" tags="living" created="201405161426" modifier="twee" twine-position="383,1816">!Making __local__ friends\n!!!!Get involved--outside your comfort zone!\nGEO strongly encourages our students to get to know local people and students in more than superficial ways. Not only does this provide the greatest opportunities for building cross-cultural and language skills, it will also give you a more meaningful experience. But getting to know locals can seem daunting. Here are some tips!\n\nIn most countries, your visa or residence permit will allow you to ''volunteer'' in the community or even do an ''internship'' or other paid work: fantastic ways to immerse yourself in the local community while also beefing up your resume! If you have questions about whether you can volunteer in your country, [[contact GEO|https://webapp.mis.vanderbilt.edu/studioabroad/index.cfm?FuseAction=Abroad.ViewLink&Parent_ID=1B2936BD-9D45-883A-02A56AC77951A353&Link_ID=1B34B64E-9B4D-6FCE-D278333739D84B5D&pID=1&lID=5]].\n\nIf you will be living with a ''host family'', explore the opportunities provided by their wider social network. They likely know people that you might like to get to know!\n\nIf you are enrolled in or taking classes at a university, join ''student organizations'' on campus. Your campus probably has many clubs and intramural sports, and joining up is a great way to find locals who share your interests.\n\nVisit your university's ''office of international student services''. In addition to local knowledge about bus routes and student discounts, they may offer inexpensive excursions and other social opportunities.\n\nMost important, ''put yourself out there!'' It may be uncomfortable at first, but it will pay off in the long run!\n\n&lt;&lt;sidebar-box &quot;Homestays&quot;&gt;&gt;\n   [[Gifts and relationships|Gifts and relationships]]\n&lt;&lt;/sidebar-box&gt;&gt;\n\n&lt;&lt;segue &quot;Before you leave&quot;&gt;&gt;\n</div><div tiddler="URL Query String Utilities" tags="script" created="201407031641" modifier="twee" twine-position="0,0">//from http://www.joezimjs.com/javascript/3-ways-to-parse-a-query-string-in-a-url/\nwindow.parseQueryString = function( queryString ) {\n    var params = {}, queries, temp, i, l;\n \n    // Split into key/value pairs\n    queries = queryString.split(&quot;&&quot;);\n \n    // Convert the array of strings into an object\n    for ( i = 0, l = queries.length; i &lt; l; i++ ) {\n        temp = queries[i].split('=');\n        params[temp[0]] = temp[1];\n    }\n \n    return params;\n};</div><div tiddler="Returnee resources" tags="home sidebar" created="201404171648" modifier="twee" twine-position="1886,144">&lt;&lt;sidebar &quot;More Ideas and Resources for Getting Involved After Returning Home&quot;&gt;&gt;\nWhether you're interested in publishing your experiences, submitting photos to the GEO photo contest, or getting involved with the international communities of Vanderbilt and Nashville, GEO has information for you! In fact, there's an [[entire section of our website|http://vanderbi.lt/rusg8]] dedicated to giving you ideas for post-study abroad involvement. Check it out!</div><div tiddler="Alcohol Policy" tags="sidebar policies" created="201404171613" modifier="twee" twine-position="147,751">&lt;&lt;sidebar &quot;Vanderbilt policy on alcohol abroad&quot;&gt;&gt;\nVanderbilt does not really treat alcohol use abroad any differently than it does on campus. However, in all of the countries where Vanderbilt has approved study abroad programs, the drinking age is lower than it is here in Nashville. You need to abide by the legal drinking age of the country you're in. Remember that violations of law overseas may also become grounds for disciplinary action both at Vanderbilt and under the rules of your abroad program.\n\nAt the same time that you are considering the legal implications of drinking, be mindful of cultural norms surrounding alcohol use in your host country. In many countries, for example, American-style &quot;binge drinking&quot; may appear pathological or merely pathetic. Take the opportunity to see cultural practices in a new light. \n\n|box|k\n|!The Student Handbook says:|\n|Students are required to abide by the laws of the respective countries in which they reside, study, or travel, with respect to the age at which alcoholic beverages may be consumed. Otherwise, the policies with respect to [[alcoholic beverages and controlled substances|http://www.vanderbilt.edu/student_handbook/alcohol/]] included in the Vanderbilt //Student Handbook// apply. Students are subject to student-accountability sanctions, including expulsion, and referral for prosecution for violation of these policies.|\n|&lt;hr&gt;//From// [[VU Student Handbook, Study Abroad|http://www.vanderbilt.edu/student_handbook/university-policies-regulations/#study-abroad]]|\n\n&lt;&lt;segue &quot;Grades and credits&quot;&gt;&gt;\s</div><div tiddler="Personal emergencies" tags="safety" created="201405281257" modifier="twee" twine-position="981,1008">!Personal emergencies\n!!!!What to do after experiencing a personal emergency\nPersonal emergencies may arise from illness, accidents, behavioral health crises, or criminal/negligent behavior. They generally require immediate assistance, whether from a health professional, law enforcement, a counselor, or some combination of these. If you encounter a personal emergency abroad, follow these steps:\n\n''Request help immediately''. Know the local [[emergency number or numbers|http://studentsabroad.state.gov/content/pdfs/911_ABROAD.pdf]] (911 doesn't work abroad!) and have your phone with you at all times.\n\n''Notify your program's emergency contact''. At least one member of your program's staff will be available to you around the clock. On-site personnel are best positioned to provide timely and appropriate emergency support. If you are reporting an emergency on behalf of a friend, be sure to identify yourself as well as your friend.\n\nIf you are in immediate danger, or have been in a serious accident or the victim of a criminal act, ''contact law enforcement as soon as possible''. Your program staff may be in a better position to talk with law enforcement, and will also know the proper protocols. Work with him or her if at all possible.\n\n''Contact your insurance provider'' if the emergency requires medical attention of any kind. Depending on the nature of the emergency, it may also be appropriate to contact International SOS (ISOS). See information later in this presentation.\n\n''Notify the Vanderbilt Global Education Office''. A direct notification from you will help us coordinate support services. We can often provide additional assistance or help streamline communications.\n\n''Contact the nearest embassy''. Consular agents at US embassies are available 24/7 to help US citizens with emergencies. If you are not a US citizen, contact both the US embassy and your home country's embassy.\n\n''Contact your family''. Your family will be anxious and concerned about your well-being. Your program staff and GEO are both limited in the information they can share, so be sure to communicate with your family directly.\n\nDownload GEO's [[wallet-sized emergency numbers directory|http://studentsabroad.com/handbook/emergency-card.php?country=General]].\n\n&lt;&lt;segue &quot;Large-scale emergencies&quot;&gt;&gt;\s</div><div tiddler="Find Previous Passage" tags="script" created="201407031641" modifier="twee" twine-position="0,0">/* Syntax:\n    &lt;&lt;prevPassage [optional offset]&gt;&gt;\n\n    - The offset indicates how many steps backward to look\n      for the previous passage. Default is 1, of course.\n      Passing in 0 will look for the passage that linked\n      to the current sidebar, if the reader is on a sidebar.\n*/\n(function () {\n    macros.add(&quot;prevPassage&quot;, {\n        version: {\n            major: 1,\n            minor: 0,\n            revision: 0\n        },\n        handler: function () {\n            try {\n                var index = state.active.variables.index;\n                var current = index[state.active.title].enumeration;\n                if (current &lt; 1) {return this.error(&quot;already at the first passage&quot;);}\n                var offset = 1;\n                if (this.args.length &gt; 0) {\n                    offset = parseInt(this.args[0]);\n                    if (this.args[0] !== offset) {return this.error(&quot;supplied parameter must be an integer&quot;);}\n                }\n                for (var key in index) {\n                    if (index[key].enumeration === current - offset) {\n                        if (tale.get(key).tags.indexOf(&quot;sidebar&quot;) !== -1) {\n                            continue;\n                        }\n                        state.display(key);\n                        break;\n                    }\n                } \n            } \n            catch (e) {\n                return this.error(e.message);\n            }\n        }\n    });\n}());</div><div tiddler="Table of Contents" tags="" created="201404181154" modifier="twee" twine-position="1333,1741">/% \n\tEach passage can be part of only one section,\n\tsections cannot overlap. Sections must be listed\n\t*in order* of their appearance in the presentation.\n%/\n\n/% Where should we begin? Give first passage's name here. %/\n&lt;&lt;set $first to &quot;What you will get out of study abroad&quot;&gt;&gt;\n\n&lt;&lt;contents&gt;&gt;\n    &lt;&lt;section &quot;Global Education Office&quot; &quot;nosave&quot; &quot;backgrounds/Wheelock_Elizabeth_Rose_Tulips_at_Keukenhof_Gardens_outside_Amsterdam.jpg&quot;&gt;&gt;\n    &lt;&lt;section &quot;Introduction&quot; &quot;intro&quot; &quot;backgrounds/Weinstein_Lori_Ann_Sunrise_at_Byron_Bay_Australia.jpg&quot;&gt;&gt;\n    &lt;&lt;section &quot;Basic Policy Information&quot; &quot;policies&quot; &quot;backgrounds/Boppana_Sushma_Hillside_Door_Budapest_Hungary.jpg&quot;&gt;&gt;\n    &lt;&lt;section &quot;Academic Policies&quot; &quot;academics&quot; &quot;backgrounds/Grubb_Joshua_LouAllen_Checkered_Lawn_Buenos_Aires.jpg&quot;&gt;&gt;\n    &lt;&lt;section &quot;Travel&quot; &quot;travel&quot; &quot;backgrounds/Morrison_Danielle_Antoinette_Rooftop_View_Segovia_Spain.jpg&quot;&gt;&gt;\n    &lt;&lt;section &quot;Living and Learning Abroad&quot; &quot;living&quot; &quot;backgrounds/Pribish_Abby_Marie_Lake_Geneva_Through_the_Foliage_Switzerland.jpg&quot;&gt;&gt;\n    &lt;&lt;section &quot;Health and Wellness&quot; &quot;health&quot; &quot;backgrounds/Sims-Jones_John_Fields_and_mountains_of_Moray.jpg&quot;&gt;&gt;\n    &lt;&lt;section &quot;Safety and Security&quot; &quot;safety&quot; &quot;backgrounds/Tollefsen_Stefanie_Violet_tree_Rome_Italy.jpg&quot;&gt;&gt;\n    &lt;&lt;section &quot;Returning Home&quot; &quot;home&quot; &quot;backgrounds/Williams_Jon_Beaches_of_Tarifa_Spain.jpg&quot;&gt;&gt;\n    &lt;&lt;section &quot;Finishing Up&quot; &quot;finish&quot; &quot;backgrounds/Babbitt_Martha_Ann_Lake_Como_Italy.jpg&quot;&gt;&gt;\n&lt;&lt;create-index&gt;&gt;</div><div tiddler="Gifts and relationships" tags="living sidebar" created="201405161649" modifier="twee" twine-position="525,1820">&lt;&lt;sidebar &quot;Gifts and Relationships&quot;&gt;&gt;\nPresenting a gift shows that you place importance on a relationship. Consider a gift to start off your more important relationships abroad, such as with your homestay family or a host-country roommate.\n\nIn a cross-cultural setting, the best gifts can be those that let you bring a little of where you're from to the relationship. Examples might include a Vanderbilt mug or pendant, a photo book about Nashville or your hometown, maple syrup if you're from Vermont, or maybe biscuit or grits mix if you're from the South. Not only are gifts like these polite, positive, well-meaning gestures, they can also spur conversations (&quot;Is a biscuit the same thing as a scone?&quot;)\n\nPhotos of home are another great conversation starter. Make sure you have along some photos of your family, your house, your campus, your hobbies, etc. It's a great way for people to feel like they are getting to know you and where you come from. \n\n&lt;&lt;segue &quot;Before you leave&quot;&gt;&gt;\s</div><div tiddler="Reset index" tags="widget" created="201407031641" modifier="twee" twine-position="0,0">&lt;&lt;widget &quot;contents&quot;&gt;&gt;\s\n\t&lt;&lt;set $index to {}&gt;&gt;\n\t&lt;&lt;set $backgrounds to {}&gt;&gt;\n    &lt;&lt;set $tags to []&gt;&gt;\n    &lt;&lt;set $bookmarks to {}&gt;&gt;\n    &lt;&lt;set $fullindex to []&gt;&gt;\n    &lt;&lt;set $totalPassages to 0&gt;&gt;\n&lt;&lt;/widget&gt;&gt;</div></div>
</body>
</html>
